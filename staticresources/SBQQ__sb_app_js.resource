"use strict";System.register("app.js",["docgen/docgen.routes.js","quotes/quotes.routes.js","assets/assets.routes.js","contracts/contracts.routes.js","subscriptions/subscriptions.routes.js","products/products.routes.js","favorites/favorites.routes.js","common/core/AppContext.js","common/core/sb-i18n/I18n.js","common/core/sb-router/Router.js","common/forms/sb-rte/dialog/RichTextEditorDialog.js","common/common.js","quotes/quotes.js","products/products.js","favorites/favorites.js","assets/assets.js","subscriptions/subscriptions.js"],function(e,t){var s,a,l,u,d,c,h,p,f,g,i;return{setters:[function(e){s=e},function(e){a=e},function(e){l=e},function(e){u=e},function(e){d=e},function(e){c=e},function(e){h=e},function(e){p=e.AppContext},function(e){f=e.I18n},function(e){e.Router},function(e){g=e.RichTextEditorDialog},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r)}e("App",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(r,null,[{key:"init",value:function(e,t,i,n){var o={};return o[s.PREFIX]=s.ROUTES,o[a.PREFIX]=a.ROUTES,o[c.PREFIX]=c.ROUTES,o[h.PREFIX]=h.ROUTES,o[l.PREFIX]=l.ROUTES,o[u.PREFIX]=u.ROUTES,o[d.PREFIX]=d.ROUTES,e.allRoutes=o,g.setBaseUrl(n.tinymce),Promise.all([p.init(i),r._initIntlLocale(n.intl,i.locale)])}},{key:"_initIntlLocale",value:function(o,r){return new Promise(function(t,i){var n=new XMLHttpRequest,e=o+"/locale-data/json/"+r+".json";n.open("GET",e),n.onerror=function(e){i(new Error("Cannot get locale data: "+e))},n.ontimeout=function(e){i(new Error("Timeout for locale data"))},n.onload=function(){if(n.responseText)try{var e=JSON.parse(n.responseText);f.addLocaleData(e),Intl&&Intl.__addLocaleData&&Intl.__addLocaleData(JSON.parse(n.responseText)),t(e)}catch(e){i(new Error("Cannot parse locale data"))}else i(new Error("Cannot understand locale data: "+n.statusText))},n.send()})}}]),i=r)),e("App",i)}}}),System.register("labels_en.js",[],function(e,t){var i;return{setters:[],execute:function(){e("LABELS",i={Apply:"Apply","Asset Selection":"Asset Selection",Cancel:"Cancel","Clear Fields":"Clear Fields",Filter:"Filter",Select:"Select",searchText:"Search {0}",FieldSetWarning:"Create a Field Set with the label of CPQ_Lookup in {0} object setup to determine which fields are displayed in this CPQ list view popup.",numResults:"{0} Results",Save:"Save","Edit Description":"Edit Description","Search Products":"Search Products","Product Search":"Product Search","Select All":"Reduce search results to fewer than {0} to enable select all",Popup:"Popup","Add Products":"Add Products",Delete:"Delete","Favorite Lookup":"Favorite Lookup","Select & Add More":"Select & Add More",Share:"Share","Share Favorites":"Share Favorites",Attributes:"Attributes",Options:"Options",showAvailableUpgrades:"This feature has products available for upgrade, click the Show Available Upgrades button at the bottom of the feature to select upgrade options.","No visible options in feature":"No visible options in feature '{0}'",Features:"Features","Add Options":"Add Options",Add:"Add","Configure Products":"Configure Products","Configuration Attribute Error":"Please review required configuration attributes","Configuration Error":"Some or all options require further configuration. Look for configuration icon next to options that must be configured.","Maximum Quantity Error":"Exceeded maximum quantity available. Value has been reduced to {0}","Add to Cart":"Add to Cart",Categories:"Categories",Description:"Description",Go:"Go","My Favorites":"My Favorites",Price:"Price","Product Code":"Product Code","Product Name":"Product Name","Start Over":"Start Over",Alert:"Alert",Continue:"Continue","Active Contract Selection":"Active Contract Selection","Select Contract":"Select Contract",Skip:"Skip",Favorites:"Favorites","Guided Selling":"Guided Selling","Product Filter":"Product Filter","Product Selection":"Product Selection",Suggest:"Suggest","Available Groups":"Available Groups","Clone To Groups":"Clone To Group(s)","Select Groups":"Select one or more group(s)","Selected Groups":"Selected Groups","Custom Segments":"Custom Segments","Discount Schedule Editor":"Discount Schedule Editor",Update:"Update","Add to Favorites":"Add to Favorites","Favorite Name":"Favorite Name","Choose Price Book":"Choose Price Book",Details:"Details",Total:"Total","Quote Total":"Quote Total","Add To Favorite":"Add To Favorite","Click to edit description":"Click to edit description.",emptyLinesMsg:"This group has no line items. Click on Add Products button or drag lines from other groups.",mobileEmptyLinesMsg:"This group has no line items. Click on Add Products button to add a product.","Remove From Favorites":"Remove From Favorites","Segmented Products":"Segmented Products","Standard Products":"Standard Products",Subtotal:"Subtotal",invalidPricebookEntry:"There is not a valid price book entry for this line item.",missingOpportunityLineItem:"This product will not sync to the opportunity because a valid pricebook entry does not exist.","Edit Quote":"Edit Quote",emptyGroupedQuoteMsg:"This quote has no line items. Click on Add Group button to select products.",emptyQuoteMsg:"This quote has no line items. Click on Add Products button to select products.",fullScreenMode:"Toggle Full Screen Mode","Subscription Selection":"Subscription Selection"}),e("LABELS",i)}}}),System.register("org.local.js",[],function(e,t){var i;return{setters:[],execute:function(){e("settings",i={developerPrefix:"SBQQ",isMultiCurrencyOrg:!1,calculateImmediately:!1,locale:"en-US",language:"en",defaultCurrency:"USD",currencySymbol:"",currencyDecimalScale:2,fullName:"Admin User",userName:"admin-user@steelbrick.com",userId:"0XXX1",device:"",isOAuth:!0,additionalLookupSearchTypes:[],oik:"",maxLookupSearchFields:1,isJSProductRulesEnabled:!0,hasQuoteSelectionProductRules:!0,ui3Enabled:!1}),e("settings",i)}}}),System.register("Utils/CacheManager.js",[],function(e,t){var n,o,i,r,s,a;function l(){o.trace("Creating new instance of cache manager"),this._caches=new Map}return{setters:[],execute:function(){n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=require("js-logger").logger.getLogger(),l.prototype.getCache=function(e,t){o.debug("Getting cache by name:",e);var i=this._caches.get(e);if(i)o.trace("Find cache for name:",e);else{if(o.trace("Cache with name:",e,"not exist yet."),t){if(o.trace("Cache class defined"),"function"!=typeof t)throw o.warn("Cache class defined, but is not a function.",void 0===t?"undefined":n(t)),new Error("Customize cache class type wrong.");o.trace("Creating new cache by customized class for name:",e),i=new t}else o.trace("Creating new cache as Map for name:",e),i=new Map;if(void 0===i)throw o.warn("Cache undefined, something wrong."),new Error("Create cache get undefined.");this._caches.set(e,i)}return i},l.prototype.flushCaches=function(e){o.debug("Flushing all caches"),this._caches.forEach(function(e){e&&"function"==typeof e.clear&&e.clear()}),e&&(o.trace("Rest cache"),this._caches.clear())},i=Symbol.for("client.Utils.CacheManager"),r="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},s=Object.getOwnPropertySymbols(r),-1<s.indexOf(i)||(a=new l,Object.freeze(a),r[i]=a),module.exports={cacheManager:r[i]}}}}),System.register("Utils/DateUtils.js",[],function(e,t){function i(e){return e.toISOString().replace(new RegExp("[Tt].*"),"")}function n(e){var t=e.toISOString();return t.slice(0,t.length-1)+"+0000"}function o(e){var t=e.getTimezoneOffset();return new Date(e.setMinutes(e.getMinutes()+parseInt(t))).toLocaleDateString()}function r(e){var t=new RegExp("\\d{4}-\\d{2}-\\d{2}"),i=new RegExp("\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}.\\d{3}(Z|(\\+\\d{4}))");return t.test(e)&&10==e.length?"date":!i.test(e)||24!=e.length&&28!=e.length?"none":"datetime"}function s(e,t){if(t<e)return-1*s(t,e);var i=0;return i+=12*(t.getUTCFullYear()-e.getUTCFullYear()),i+=t.getUTCMonth()-e.getUTCMonth()}function a(e,t){if(t<e)return-1*a(t,e);var i=s(e,t),n=new Date(e.getTime());return u(n,i),n<t&&(i+=1),i}function l(e,t){if(t<e)return-1*l(t,e);var i=t.getTime()-e.getTime();return Math.round(i/864e5)}function u(e,t){var i=e.getUTCMonth();e.setUTCMonth(e.getUTCMonth()+t);var n=i+t;return n=n<0?n+12:n,e.getUTCMonth()!=n%12&&e.setUTCDate(0),e}function d(e,t){return e.setUTCDate(e.getUTCDate()+t),e}function c(e,t){for(var i,n=0,o=e.getUTCFullYear(),r=t.getUTCFullYear();o<=r;o++)if(!((i=o)%4)&&i%100||!(i%400)){var s=new Date(o,1,29);e<s&&s<t&&n++}return l(e,t)-n}return{setters:[],execute:function(){module.exports.toApexDate=i,module.exports.toApexDateTime=n,module.exports.toUTCDateString=o,module.exports.monthsBetween=s,module.exports.monthsBetweenRoundPartialUp=a,module.exports.daysBetween=l,module.exports.daysBetweenIgnoringLeapYearDays=c,module.exports.distinguishDateFromDateTime=r,module.exports.addMonths=u,module.exports.addDays=d}}}),System.register("Utils/NumberUtils.js",[],function(e,t){function i(e,t){var i=Math.pow(10,t);e*=i;var n=Math.round(+e.toFixed(t));return n/=i}return{setters:[],execute:function(){module.exports.setScale=i}}}),System.register("Utils/RecordJobManager.js",[],function(e,t){var a;function i(e,t){this._conn=e;var i=""===t?"":"/SBQQ";this._serviceRouterUrl=i+"/ServiceRouter",e.oik&&(this._serviceRouterUrl+="?oik="+e.oik),this._setJobStatusProvider="JobCheckerServiceProvider.SetJobStatus",this._setJobsStatusProvider="JobCheckerServiceProvider.SetJobsStatus"}return{setters:[],execute:function(){a=require("js-logger").logger.getLogger(),i.prototype.updateJobStatus=function(e,t,i,n,o){var r={saver:this._setJobStatusProvider,model:JSON.stringify({recordId:e,jobType:t,jobStatus:i,jobDetails:n||"",targetId:o||null})},s=Date.now();return a.info(t+" RecordJobManager.js: Start apex rest call to update job status."),this._conn.apex.post(this._serviceRouterUrl,r).then(function(){var e=Date.now();a.info(t+" RecordJobManager.js: Apex rest call to update job status took "+(e-s)+" ms.")}).catch(function(e){return Promise.reject("Error occurred while updating RecordJob__c Status: "+(e.message||e))})},i.prototype.updateJobsStatus=function(e,t,i,n){var o={saver:this._setJobsStatusProvider,model:JSON.stringify({recordIds:e,jobType:t,jobStatus:i,jobDetails:n})};return this._conn.apex.post(this._serviceRouterUrl,o).catch(function(e){return Promise.reject("Error occurred while updating RecordJob__c Status: "+(e.message||e))})},module.exports=i}}}),System.register("ajax/ajax.js",[],function(e,t){return{setters:[],execute:function(){"undefined"!=typeof window&&window&&(window.SB=window.SB||{},window.SB.ajax=require("./../calc/Utils/ApexUtils.js"))}}}),System.register("assets/assets.js",[],function(e,t){return{setters:[],execute:function(){}}}),System.register("assets/assets.routes.js",[],function(e,t){var i;return{setters:[],execute:function(){e("PREFIX","/asset"),e("PREFIX","/asset"),e("ROUTES",i={"/lookup":{comp:"sb-asset-lookup",mod:"assets/selection/routes/sb-asset-lookup/AssetLookup.js"},"/upgrade":{comp:"sb-asset-upgrade",mod:"assets/upgrade/routes/sb-asset-upgrade/AssetUpgrade.js"}}),e("ROUTES",i)}}}),System.register("common/Util.js",[],function(e,t){var i,o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t)}e("Util",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,null,[{key:"pad",value:function(e,t,i){return i=i||"0",(e+="").length>=t?e:new Array(t-e.length+1).join(i)+e}},{key:"toIsoDate",value:function(e){return(e="number"==typeof e?new Date(e):e).getUTCFullYear()+"-"+t.pad(e.getUTCMonth()+1,2)+"-"+t.pad(e.getUTCDate(),2)+"T"+t.pad(e.getUTCHours(),2)+":"+t.pad(e.getUTCMinutes(),2)+":"+t.pad(e.getUTCSeconds(),2)+"Z"}},{key:"notifyTopObjects",value:function(e,t,i){var n=!0,o=!1,r=void 0;try{for(var s,a=Object.keys(t)[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;e.notifyPath(i+"."+l,t[l])}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}},{key:"arithmeticOperatorConversion",value:function(e,t,i){switch("boolean"==typeof e&&("true"===t.toLowerCase()?t=!0:"false"===t.toLowerCase()&&(t=!1)),i){case"equals":return e===t;case"not equals":return e!=t;case"less than":return e<t;case"less or equals":return e<=t;case"greater than":return t<e;case"greater or equals":return t<=e;case"starts with":return(e=e||"").toLowerCase().startsWith(t.toLowerCase());case"ends with":return(e=e||"").toLowerCase().endsWith(t.toLowerCase());case"contains":return(e=e||"").toLowerCase().includes(t.toLowerCase())}}},{key:"toHTML",value:function(e){return null!=e&&(e=e.replace(/(?:\r\n|\r|\n)/g,"<br>")),e}}]),i=t)),e("Util",i),i.Map=Map,Map&&Map.prototype.get&&Map.prototype.set||(o=document.createElement("iframe"),document.body.appendChild(o),i.Map=o.contentWindow.Map,o.parentNode.removeChild(o))}}}),System.register("common/common.js",["common/behaviors/DeviceBehavior.js","common/behaviors/LookupBehavior.js","common/core/sb-i18n/I18n.js","common/core/sb-loading-spinner/LoadingSpinner.js","common/core/sf-loading-spinner/LoadingSpinner.js","common/core/sb-page-container/PageContainer.js","common/core/sb-toast/Toast.js","common/core/sb-page-header/PageHeader.js","common/data/sb-service/Service.js","common/filter/searcher/Searcher.js","common/forms/sb-field/Field.js","common/forms/sb-typeahead/Typeahead.js","common/forms/sb-lookup/Lookup.js","common/forms/sb-lookup-dialog/LookupDialog.js","common/forms/sb-datepicker/Datepicker.js","common/forms/sb-date-range/DateRange.js","common/forms/sb-discount/Discount.js","common/forms/sb-pagination/Pagination.js","common/forms/sb-rte/dialog/RichTextEditorDialog.js","common/forms/sb-rte/RichTextEditor.js","common/forms/sb-search-bar/SearchBar.js","common/forms/sb-search-bar-dialog/SearchBarDialog.js","common/layout/sb-actions/Actions.js","common/forms/sb-input/Input.js","common/forms/sb-select/Select.js","common/forms/sb-textarea/Textarea.js","common/forms/sb-checkbox/Checkbox.js","common/forms/sb-multi-lookup/MultiLookup.js","common/forms/sb-dual-list-box/DualListBox.js","common/layout/sb-div/Div.js","common/layout/sb-field-item/FieldItem.js","common/layout/sb-field-table/FieldTable.js","common/layout/sb-group/Group.js","common/layout/sb-side-panel/SidePanel.js","common/layout/sb-swipe-container/SwipeContainer.js","common/layout/sb-table-cell/TableCell.js","common/layout/sb-table-cell-select/TableCellSelect.js","common/layout/sb-table-header/TableHeader.js","common/layout/sb-table-row/TableRow.js","common/layout/sb-tabs/Tabs.js","common/layout/sb-badge/Badge.js","common/layout/sb-dialog/Dialog.js","common/layout/sb-popup/Popup.js","common/layout/sb-lookup-layout/LookupLayout.js","common/layout/sb-filter-layout/FilterLayout.js","common/layout/sb-filter-item/FilterItem.js","common/layout/sb-row-drawer/RowDrawer.js","common/services/sb-line-editor-read/LineEditorReader.js","common/services/sb-line-editor-cache-save/LineEditorCacheSaver.js","common/services/sb-job-checker/JobChecker.js","common/services/sb-field-md/FieldMetadata.js","common/services/sb-search-model-load/SearchModelLoader.js","common/services/sb-search-model-select/SearchModelSelector.js","common/data/sb-describe/Describe.js","common/services/sb-product-rules-quote-line-adder/ProductRulesQuoteLineAdder.js"],function(e,t){var i;return{setters:[function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){}],execute:function(){1e3,Polymer&&(i=null,Polymer.Gestures.register({name:"hold",deps:["mousedown","mouseup","touchstart","touchend"],flow:{start:["mousedown","touchstart"],end:["mouseup","touchend"]},emits:["hold"],mouseup:function(e){return this.up(e)},touchend:function(e){return this.up(e.changedTouches[0],e)},up:function(e){return clearTimeout(i),!1},mousedown:function(e){return this.down(e)},touchstart:function(e){return this.down(e.changedTouches[0],e)},down:function(e,t){return i=setTimeout(function(){Polymer.Gestures.fire(Polymer.Gestures.findOriginalTarget(e),"hold",{x:e.clientX,y:e.clientY,sourceEvent:e,preventer:t})},1e3),!1}}))}}}),System.register("contracts/contracts.routes.js",[],function(e,t){var i;return{setters:[],execute:function(){e("PREFIX","/contract"),e("PREFIX","/contract"),e("ROUTES",i={"/lookup":{comp:"sb-contract-lookup",mod:"contracts/selection/routes/sb-contract-lookup/ContractLookup.js"}}),e("ROUTES",i)}}}),System.register("docgen/docgen.routes.js",[],function(e,t){var i;return{setters:[],execute:function(){e("PREFIX","/docgen"),e("PREFIX","/docgen"),e("ROUTES",i={"/preview":{comp:"sb-docgen-preview",mod:"docgen/sb-docgen-preview/DocgenPreview.js"}}),e("ROUTES",i)}}}),System.register("favorites/favorites.js",["favorites/sb-favorite-lookup/FavoriteLookup.js","favorites/sb-favorite-share-dialog/FavoriteShareDialog.js"],function(e,t){return{setters:[function(e){},function(e){}],execute:function(){}}}),System.register("favorites/favorites.routes.js",[],function(e,t){var i;return{setters:[],execute:function(){e("PREFIX","/favorite"),e("PREFIX","/favorite"),e("ROUTES",i={"/lookup":{comp:"sb-favorite-lookup",mod:"favorites/sb-favorite-lookup/FavoriteLookup.js"}}),e("ROUTES",i)}}}),System.register("perfMetrics/MetricsService.js",[],function(t,e){var f,i,o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}f=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},"cpqEPT","/_ui/common/request/servlet/CPQLoggingServlet","1.0",t("IDLE_RETRIES",2),t("IDLE_RETRIES",2),t("MetricsService",(i(e,[{key:"startTransaction",value:function(e){this.canGatherMetrics()&&this._isNotStarted()&&(this._init(),this._queueIdleCallback(),console.log(e||"CPQ Performance Metrics Service: started ept"))}},{key:"startServiceRequest",value:function(e,t){if(this._isNotStarted())return null;window.sb.MetricsService.internal.sptNum+=1;var i=this._getUniqueId();return void 0===e&&(e=""),void 0!==t&&(e=e+"/"+t),window.sb.MetricsService.internal.actions.set(i,this._buildTransportAction(e)),console.log("CPQ Performance Metrics Service: started service call"),i}},{key:"addExternalLogMetrics",value:function(e){e=e||{},this._externalLogMetrics||(this._externalLogMetrics={}),Object.assign(this._externalLogMetrics,e)}},{key:"_buildTransportAction",value:function(e){return{context:{actionDefs:[e]},pageStartTime:Date.now(),ts:this._getTime(),name:"request",ns:"transport"}}},{key:"stopServiceRequest",value:function(e,t){var i=1<arguments.length&&void 0!==t?t:0;this._isNotStarted()||(window.sb.MetricsService.internal.sptNum-=1,window.sb.MetricsService.internal.idleRetries=2,0<window.sb.MetricsService.internal.idleStart&&(window.sb.MetricsService.internal.idleTime+=this._getTime()-window.sb.MetricsService.internal.idleStart,window.sb.MetricsService.internal.idleStart=0),this._populateTransportAction(e),window.sb.MetricsService.internal.sptTime+=i,console.log("CPQ Performance Metrics Service: ended service call",i))}},{key:"_init",value:function(e){var t=0<arguments.length&&void 0!==e?e:null,i=Date.now(),n=this._getTime(),o=this._getPageStartTime();if(window.sb.visibilityStateEnd=document.visibilityState,window.sb=window.sb||{},null!=window.sb&&null==window.sb.MetricsService){if(window.sb.MetricsService={},window.sb.MetricsService.bootstrap={id:"qtc:bootstrap"},window.sb.MetricsService.bootstrap.bootstrapEPT=n,window.sb.MetricsService.bootstrap.pageStartTime=o,window.sb.MetricsService.bootstrap.visibilityStateStart=window.sb.visibilityStateStart,window.sb.MetricsService.bootstrap.visibilityStateEnd=window.sb.visibilityStateEnd,window.performance&&performance.timing){var r=window.performance,s=r.timing,a={readyStart:s.fetchStart-s.navigationStart,lookupDomainTime:s.domainLookupEnd-s.domainLookupStart,connectTime:s.connectEnd-s.connectStart,requestTime:s.responseEnd-s.requestStart,initDomTreeTime:s.domInteractive-s.responseEnd,domReadyTime:s.domComplete-s.domInteractive,loadEventTime:s.loadEventEnd-s.loadEventStart,loadTime:s.loadEventEnd-s.fetchStart,unloadEventTime:s.unloadEventEnd-s.unloadEventStart,appCacheTime:s.domainLookupStart-s.fetchStart,redirectTime:s.redirectEnd-s.redirectStart};window.sb.MetricsService.bootstrap.timing=Object.assign(s.toJSON(),a),window.sb.MetricsService.bootstrap.allRequests=[],r.getEntries().forEach(function(e){var t=this._summarizeResourcePerfInfo(e);window.sb.MetricsService.bootstrap.allRequests.push(t)},this)}}else window.sb.MetricsService.bootstrap={};window.sb.MetricsService.internal={lastIdleEndTime:n,sptNum:0,idleStart:0,idleTime:0,sptTime:0,idleRetries:2,actions:new Map},window.sb.MetricsService.currentPage={ept:void 0,bpt:void 0,spt:void 0,pageStartTime:i,ts:n,page:{attributes:{app:{appName:"SteelBrick",appType:"Standard"},url:window.location.href},entity:t}}}},{key:"_idle",value:function(){if(!this._isNotStarted()){if(0===window.sb.MetricsService.internal.sptNum){if(0===window.sb.MetricsService.internal.idleRetries)return this._calcAndDisplayMetrics(),void this._logMetrics();2==window.sb.MetricsService.internal.idleRetries&&(window.sb.MetricsService.internal.lastIdleEndTime=this._getTime()),window.sb.MetricsService.internal.idleRetries--}0===window.sb.MetricsService.internal.idleStart&&(window.sb.MetricsService.internal.idleStart=this._getTime()),this._queueIdleCallback()}}},{key:"_summarizeResourcePerfInfo",value:function(e){return{name:e.name,initiatorType:e.initiatorType,duration:parseInt(e.responseEnd-e.startTime,10),startTime:parseInt(e.startTime,10),fetchStart:parseInt(e.fetchStart,10),requestStart:parseInt(e.requestStart,10),dns:parseInt(e.domainLookupEnd-e.domainLookupStart,10),tcp:parseInt(e.connectEnd-e.connectStart,10),ttfb:parseInt(e.responseStart-e.startTime,10),transfer:parseInt(e.responseEnd-e.responseStart,10),transferSize:parseInt(e.transferSize,10),encodedBodySize:parseInt(e.encodedBodySize,10),decodedBodySize:parseInt(e.decodedBodySize,10)}}},{key:"_populateTransportAction",value:function(e){if(e){var t=window.sb.MetricsService.internal.actions.get(e);t&&(t.duration=parseInt(this._getTime()-t.ts))}}},{key:"_queueIdleCallback",value:function(){this.canGatherMetrics()&&window.requestIdleCallback(this._idle.bind(this))}},{key:"_calcAndDisplayMetrics",value:function(){var e=window.sb.MetricsService.internal.lastIdleEndTime-window.sb.MetricsService.currentPage.ts,t=e-window.sb.MetricsService.internal.idleTime,i=window.sb.MetricsService.internal.sptTime,n=[],o=null;window.performance&&window.performance.getEntriesByType&&(o=window.performance.getEntriesByType("resource"));var r=!0,s=!1,a=void 0;try{for(var l,u=window.sb.MetricsService.internal.actions[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var d=f(l.value,2),c=(d[0],d[1]);if(null!=o){var h=o.filter(function(e){return e.startTime>=c.ts&&e.startTime<=c.ts+c.duration})[0];null!=h&&(c.resource=h)}n.push(c)}}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}if(window.sb.MetricsService.internal=null,window.sb.MetricsService.currentPage.ept=e,window.sb.MetricsService.currentPage.bpt=t,window.sb.MetricsService.currentPage.spt=i,window.sb.MetricsService.currentPage.marks={transport:n},console.log("CPQ Performance Metrics Service: ",window.sb.MetricsService.bootstrap,window.sb.MetricsService.currentPage),this._canDisplayMetrics()){var p=new CustomEvent("metrics-changed",{detail:window.sb.MetricsService.currentPage,bootstrap:window.sb.MetricsService.bootstrap});document.dispatchEvent(p)}}},{key:"_normalizeApiHost",value:function(e){var t=/([a-zA-Z0-9_-]+)\.(vpod\.visual\.t\.force|visual\.force|salesforce)\.com$/.exec(e);return t&&(e="vpod.visual.t.force"==t[2]?t[1]+".vpod.t.force.com":t[1]+".salesforce.com"),e}},{key:"_logMetrics",value:function(){if(!(window.sb.MetricsService.currentPage.ept<150)){var e=this._normalizeApiHost(location.host),t=location.protocol+"//"+e+"/_ui/common/request/servlet/CPQLoggingServlet",i=new XMLHttpRequest;i.withCredentials=!0,i.open("POST",t,!0),i.onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&(200==i.status?console.log("CPQ Performance Metrics service Successfully logged"):(console.log("Error while logging CPQ Performance Metrics Service:"),console.log(i.getAllResponseHeaders())))};var n={pkgVersion:window.sb.pkgVersion,apiVersion:window.sb.common.core.AppContext.org.apiVersion,url:window.sb.MetricsService.currentPage.page.attributes.url,pageStartTime:window.sb.MetricsService.currentPage.pageStartTime,version:"1.0"};this._externalLogMetrics&&Object.assign(n,this._externalLogMetrics);var o=[{logName:"cpqEPT",logLevel:"INFO",logAttrs:{attrsId:"cpq:page",ept:window.sb.MetricsService.currentPage.ept,bpt:window.sb.MetricsService.currentPage.bpt,spt:window.sb.MetricsService.currentPage.spt,resources:window.sb.MetricsService.currentPage.marks}}];Object.assign(o[0].logAttrs,n),0!==Object.keys(window.sb.MetricsService.bootstrap).length&&(o.push({logName:"cpqEPT",logLevel:"INFO",logAttrs:{attrsId:window.sb.MetricsService.bootstrap.id,bootstrapEPT:window.sb.MetricsService.bootstrap.bootstrapEPT,visibilityStateStart:window.sb.MetricsService.bootstrap.visibilityStateStart,visibilityStateEnd:window.sb.MetricsService.bootstrap.visibilityStateEnd,resources:window.sb.MetricsService.bootstrap.allRequests,timing:window.sb.MetricsService.bootstrap.timing}}),Object.assign(o[1].logAttrs,n));var r=new FormData;r.append("logLines",JSON.stringify(o)),i.send(r)}}},{key:"_canDisplayMetrics",value:function(){if(!this.canGatherMetrics())return!1;var e=new URL(window.location.href);return 1==new URLSearchParams(e.search).get("eptVisible")}},{key:"canGatherMetrics",value:function(){return"function"==typeof window.requestIdleCallback}},{key:"_isNotStarted",value:function(){return null==window.sb||null==window.sb.MetricsService||null==window.sb.MetricsService.internal||null==window.sb.MetricsService.internal.sptNum}},{key:"_getTime",value:function(){return window.performance?window.performance.now():Date.now()}},{key:"_getPageStartTime",value:function(){var e=window.performance;return e&&e.timing&&e.timing.navigationStart?e.timing.navigationStart:window.pageStartTime}},{key:"_getUniqueId",value:function(){return this._getRandomInt(1,1e4)}},{key:"_getRandomInt",value:function(e,t){return Math.floor(Math.random()*(t-e+1))+e}}]),o=e)),t("MetricsService",o)}}}),System.register("products/products.js",["products/config/attribute/sb-attribute-item/AttributeItem.js","products/config/attribute/sb-attribute-table/AttributeTable.js","products/config/bundles/sb-product-bundles-layout/ProductBundlesLayout.js","products/config/bundles/sb-product-bundles-filter-item/ProductBundlesFilterItem.js","products/config/feature/sb-product-feature/ProductFeature.js","products/config/feature/sb-product-feature-layout/ProductFeatureLayout.js","products/config/feature/sb-product-feature-category-list/ProductFeatureCategoryList.js","products/config/feature/sb-product-feature-list/ProductFeatureList.js","products/config/option/sb-product-option-table/ProductOptionTable.js","products/config/option/sb-option-cell/OptionCell.js","products/config/option/sb-option-drawer/OptionDrawer.js","products/config/routes/services/sb-pc-product-load/ProductLoader.js","products/config/routes/services/sb-pc-option-save/OptionSaver.js","products/config/routes/services/sb-product-rules-invoke/ProductRulesInvoker.js","products/config/routes/services/sb-pc-option-configure/OptionConfigurator.js","products/config/actions/sb-custom-actions/CustomActions.js","products/localization/LocalizeFields.js","products/resources/sb-product-alert/ProductAlert.js"],function(e,t){return{setters:[function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){}],execute:function(){}}}),System.register("products/products.routes.js",[],function(e,t){var i;return{setters:[],execute:function(){e("PREFIX","/product"),e("PREFIX","/product"),e("ROUTES",i={"/dl":{comp:"sb-dynamic-lookup",mod:"products/config/routes/sb-dynamic-lookup/DynamicLookup.js"},"/lookup":{comp:"sb-product-lookup",mod:"products/selection/routes/sb-product-lookup/ProductLookup.js"},"/ol":{comp:"sb-option-lookup",mod:"products/config/routes/sb-option-lookup/OptionLookup.js"},"/pc":{comp:"sb-product-config",mod:"products/config/routes/sb-product-config/ProductConfig.js"},"/search":{comp:"sb-product-search",mod:"products/prototype/sb-product-search/ProductSearch.js"}}),e("ROUTES",i)}}}),System.register("quotes/QuoteContext.js",[],function(t,e){var i,o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("QuoteContext",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,i=null,[{key:"isDiscountField",value:function(e){return e===i.ADDITIONAL_DISCOUNT_FIELD}},{key:"isMarkupField",value:function(e){return e===i.MARKUP_FIELD}},{key:"isListPriceField",value:function(e){return e===i.LIST_PRICE_FIELD}},{key:"isProductNameField",value:function(e){return e===i.PRODUCT_NAME_FIELD}},{key:"isNetTotalField",value:function(e){return e===i.NET_TOTAL_FIELD}},{key:"isSubscriptionScopeField",value:function(e){return e===i.SUBSCRIPTION_SCOPE_FIELD}},{key:"constants",get:function(){return i},set:function(e){i=e}}]),o=e)),t("QuoteContext",o)}}}),System.register("quotes/quotes.js",["quotes/pages/sb-line-editor/LineEditor.js","quotes/sb-le-custom-action-services/LECustomActionServices.js","quotes/md/sb-le-field-md/LEFieldMD.js","quotes/layout/sb-le-group/LEGroup.js","quotes/tables/sb-standard-lines/StandardLines.js","quotes/tables/sf-standard-table/SFStandardTable.js","quotes/tables/sf-segmented-table/SFSegmentedTable.js","quotes/layout/sf-segmented-cell-tooltip/SFSegmentedCellTooltip.js","quotes/tables/sb-segmented-lines/SegmentedLines.js","quotes/layout/sb-segmented-line-details/SegmentedLineDetails.js","quotes/layout/sb-segmented-detail-row/SegmentedDetailRow.js","quotes/layout/sf-le-table-row/SFLETableRow.js","quotes/layout/sb-le-table-row/LETableRow.js","quotes/layout/sf-line-actions/SFLineActions.js","quotes/layout/sf-line-warning/SFLineWarning.js","quotes/layout/sb-le-table-cell/LETableCell.js","quotes/layout/sb-ds-table-cell/DSTableCell.js","quotes/layout/sb-ds-tiers/DSTiers.js","quotes/layout/sb-le-table-header/LETableHeader.js","quotes/layout/sb-le-table-header-cell/LETableHeaderCell.js","quotes/layout/sb-le-footer/LEFooter.js","quotes/layout/sb-le-group-layout/LEGroupLayout.js","quotes/layout/sb-le-list/LEList.js","quotes/layout/sb-le-list-row/LEListRow.js","quotes/layout/sb-le-list-group-header-row/LEListGroupHeaderRow.js","quotes/layout/sb-le-list-group-footer-row/LEListGroupFooterRow.js","quotes/layout/sb-le-list-standard-line-row/LEListStandardLineRow.js","quotes/layout/sb-le-list-segmented-line-row/LEListSegmentedLineRow.js","quotes/layout/sb-field-set-table-item/FieldSetTableItem.js","quotes/layout/sb-field-set-table/FieldSetTable.js","quotes/layout/sb-le-drawer/LEDrawer.js","quotes/layout/sb-line-editor-tabs/sb-quote-tabs/QuoteTabs.js","quotes/layout/sb-line-editor-tabs/sb-group-tabs/GroupTabs.js","quotes/layout/sb-custom-action/CustomAction.js","quotes/layout/sb-le-summary-row/LESummaryRow.js","quotes/layout/sb-le-summary-row/sb-le-summary-cell/LESummaryCell.js","quotes/dialogs/sb-favorite-dialog/FavoriteDialog.js","quotes/dialogs/sb-clone-to-group-dialog/CloneToGroupDialog.js","quotes/dialogs/sb-custom-segment-dialog/CustomSegmentDialog.js","quotes/layout/sb-cse-table-cell/CSETableCell.js","quotes/dialogs/sb-pricebook-dialog/PricebookDialog.js","quotes/models/DragDropModel.js","quotes/dialogs/sb-discount-schedule-dialog/DiscountScheduleDialog.js"],function(e,t){return{setters:[function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){},function(e){}],execute:function(){}}}),System.register("quotes/quotes.routes.js",[],function(e,t){var i;return{setters:[],execute:function(){e("PREFIX","/quote"),e("PREFIX","/quote"),e("ROUTES",i={"/le":{comp:"sb-line-editor",mod:"quotes/pages/sb-line-editor/LineEditor.js"}}),e("ROUTES",i)}}}),System.register("subscriptions/subscriptions.js",[],function(e,t){return{setters:[],execute:function(){}}}),System.register("subscriptions/subscriptions.routes.js",[],function(e,t){var i;return{setters:[],execute:function(){e("PREFIX","/subscription"),e("PREFIX","/subscription"),e("ROUTES",i={"/lookup":{comp:"sb-subscription-lookup",mod:"subscriptions/selection/routes/sb-subscription-lookup/SubscriptionLookup.js"}}),e("ROUTES",i)}}}),System.register("Utils/DAOs/UsageRateCardDAO.js",[],function(e,t){return{setters:[],execute:function(){}}}),System.register("common/behaviors/DeviceBehavior.js",["common/core/AppContext.js"],function(t,e){var i,o,r,s,a,l,u;return{setters:[function(e){i=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}l=a=void(s=r=0),!!(o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}),t("DeviceBehavior",(o(e,[{key:"ready",value:function(){var e=Polymer.dom(this.root).querySelectorAll("*[device]")||[],t=this.getDeviceClasses(),i=!0,n=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;this.toggleClass(a,!0,this);var l=!0,u=!1,d=void 0;try{for(var c,h=e[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var p=c.value;this.toggleClass(a,!0,p)}}catch(e){u=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(u)throw d}}}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}this.deviceClasses=t.join(" ")}},{key:"getDeviceClasses",value:function(){return l||(i.hasInitialized()||i.init({}),l=i.isPhone?["--phone","--mobile"]:i.isTablet?["--tablet","--mobile"]:["--desktop"])}},{key:"startPerformanceCheck",value:function(){a=performance.now()}},{key:"stopPerformanceCheck",value:function(){var e=performance.now()-a;r+=e,s++,1<e?console.warn("total ("+r.toFixed(2)+"ms) | current ("+e.toFixed(2)+"ms) | totalComponents ("+s+") | component ("+this.tagName.toLowerCase()+")"):console.log("total ("+r.toFixed(2)+"ms) | current ("+e.toFixed(2)+"ms) | totalComponents ("+s+") | component ("+this.tagName.toLowerCase()+")")}}]),u=e)),t("DeviceBehavior",u),window.CommonBehaviors=window.CommonBehaviors||{},window.CommonBehaviors.DeviceBehavior=u.prototype}}}),System.register("common/behaviors/LookupBehavior.js",["common/core/AppContext.js"],function(t,e){var i;return{setters:[function(e){e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LookupBehavior",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"ready",value:function(){this.handleProductsLoadServerResponse(),this.handleHideSearchFilterIfNoSearchColumnsDisplayed(),this.bindFilterEnterCallBacks()}},{key:"handleHideSearchFilterIfNoSearchColumnsDisplayed",value:function(){this.addEventListener("no-displayed-filters",function(){this.removeFilter()}.bind(this))}}]),i=e)),t("LookupBehavior",i),window.CommonBehaviors=window.CommonBehaviors||{},window.CommonBehaviors.LookupBehavior=i.prototype}}}),System.register("common/behaviors/SFTableRowBehavior.js",["quotes/layout/template-generator/TemplateGenerator.js","quotes/tables/SFAbstractTable.js","common/core/AppContext.js"],function(t,e){var l,u,i;return{setters:[function(e){l=e.TemplateGenerator},function(e){u=e.SFAbstractTable},function(e){e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SFTableRowBehavior",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"getCellByIndex",value:function(e){var t=this.querySelector("#content > div");if(t){var i=Array.from(t.children);if(i)return i[e=Math.min(Math.max(0,e),i.length-1)]}}},{key:"hydrateTemplate",value:function(e,t){var i=document.createElement("template");return i.innerHTML="<div>"+e+"</div>",this.templatize(i),this.stamp(t||{})}},{key:"hydrateTemplateFromNode",value:function(e,t){var i=document.createElement("template");return i.content.appendChild(e),this.templatize(i),this.stamp(t||{})}},{key:"onHovered",value:function(e){this.toggleClass("show",!0,this.$$("#content")),this.hook_onHovered(e)}},{key:"onUnhovered",value:function(){this.toggleClass("show",!1,this.$$("#content"))}},{key:"onTap",value:function(e){var t=!1,i=this.getTableComponent(e),n=u.findCell(e),o=n&&n.classList.contains(l.classNames.EDITABLE),r=n&&n.classList.contains(l.classNames.BOOLEAN),s=n&&n.classList.contains(l.classNames.HAS_FOCUS),a=n&&n.classList.contains(l.classNames.EDIT_MODE);i&&!s&&(i.applyCellFocus(n),i.setEditOnFocus(!1)),o&&!a&&(s&&!r||function(e){var t=Polymer.dom(e).path;if(t&&0<t.length&&t[0].classList.contains(l.classNames.EDIT_ICON))return t[0]}(e))&&(this.toggleInlineEdit(n,!0),i&&i.setEditOnFocus(!0),t=!0),this.hook_onTap(e,t,o)}},{key:"getTableComponent",value:function(e){return Polymer.dom(e).path.find(function(e){var t=e&&e.tagName?e.tagName.toUpperCase():"";return"SF-STANDARD-TABLE"===t||"SF-SEGMENTED-TABLE"===t})}},{key:"hook_onHovered",value:function(e){}},{key:"hook_onTap",value:function(e,t){}},{key:"toggleInlineEdit",value:function(e,t){}}],[{key:"properties",get:function(){return{rowTemplate:{type:Object,observer:"_rowTemplateChanged"}}}}]),i=e)),t("SFTableRowBehavior",i),window.CommonBehaviors=window.CommonBehaviors||{},window.CommonBehaviors.SFTableRowBehavior=i.prototype}}}),System.register("common/core/AppContext.js",[],function(e,t){var i,r,o,s,a,l,u,d;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t)}i=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},r={},o={},{},s={},a={},l={},(u=window&&window.sb||{}).ui=u.ui||{},u.common=u.common||{},u.common.core=u.common.core||{},window.sb=u,e("AppContext",(i(t,[{key:"user",get:function(){return s}},{key:"labels",get:function(){return r}},{key:"org",get:function(){return o}}],[{key:"init",value:function(e){t.buildUserAndOrgFromSettings(e),t.device="desktop",navigator.userAgent.match(/Tablet|iPad|iPod/i)&&!navigator.userAgent.match(/Tablet PC/i)||navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/Mobi/i)?t.device="tablet":navigator.userAgent.match(/Mobi/i)&&(t.device="phone");var o=null;return new Promise(function(n,t){System.import("common/core/sb-i18n/I18n.js").then(function(e){o=e.I18n,System.import("labels_en.js").then(function(e){var t=e.LABELS;u.labels&&(t=window.sb.labels);var i={labels:r=t,user:s};o&&(l=new o(i)),n(i)}).catch(function(e){t(e)})})})}},{key:"hasInitialized",value:function(){return!0===t.userAndOrgSettingsSet}},{key:"buildUserAndOrgFromSettings",value:function(e){e&&(t.userAndOrgSettingsSet=!0,t.user={lang:e.language,locale:e.locale,id:e.userId,fullname:e.fullName,username:e.userName,device:e.device,inCommunity:e.inCommunity,hasQuoteEditPermission:e.hasQuoteEditPermission,oik:e.oik},t.org={prefix:void 0!==e.developerPrefix?e.developerPrefix:"SBQQ",isMultiCurrencyOrg:e.isMultiCurrencyOrg,calculateImmediately:e.calculateImmediately,defaultCurrency:e.defaultCurrency,currencySymbol:e.currencySymbol,currencyDecimalScale:e.currencyDecimalScale,quantityScale:e.quantityScale,isOAuth:e.isOAuth,orgUrl:e.orgUrl,orgInstanceUrl:e.orgInstanceUrl,siteUrl:e.siteUrl,additionalLookupSearchTypes:e.additionalLookupSearchTypes,maxLookupSearchFields:e.maxLookupSearchFields,isJSProductRulesEnabled:e.isJSProductRulesEnabled,hasQuoteSelectionProductRules:e.hasQuoteSelectionProductRules,isUI3Enabled:e.ui3Enabled,apiVersion:39})}},{key:"isIE",value:function(){var e=window.navigator.userAgent;return 0<=e.indexOf("MSIE ")||0<=e.indexOf("Trident/")}},{key:"isChrome",value:function(){return 0<=window.navigator.userAgent.indexOf("Chrome")}},{key:"isFirefox",value:function(){return 0<=window.navigator.userAgent.indexOf("Firefox")}},{key:"isSafari",value:function(){var e=window.navigator.userAgent;return 0<=e.indexOf("Safari")&&e.indexOf("Chrome")<0}},{key:"properties",get:function(){return{app:{type:Object,value:function(){return{user:s,labels:r,org:o,deviceContext:{isDesktop:t.isDesktop,isTablet:t.isTablet,isPhone:t.isPhone,isMobile:t.isPhone||t.isTablet}}}},i18n:{type:Object,value:function(){return l}}}}},{key:"user",get:function(){return s},set:function(e){s=e}},{key:"labels",get:function(){return r}},{key:"org",get:function(){return o},set:function(e){o=e}},{key:"device",get:function(){return a},set:function(e){a=e}},{key:"isDesktop",get:function(){return s.device?"desktop"===s.device:"desktop"===a}},{key:"isTablet",get:function(){return s.device?"tablet"===s.device:"tablet"===a}},{key:"isPhone",get:function(){return s.device?"phone"===s.device:"phone"===a}},{key:"apiVersion",get:function(){return t.org.apiVersion},set:function(e){t.org.apiVersion=e}},{key:"apiVersionString",get:function(){return t.org.apiVersion+".0"}},{key:"i18n",get:function(){return l}},{key:"isMobile",get:function(){return t.properties.app.value().deviceContext.isMobile}}]),d=t)),e("AppContext",d),u.common.core.AppContext=d.prototype}}}),System.register("common/core/Navigator.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Navigator",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,null,[{key:"nav",value:function(e,t,i,n,o){var r=e,s=i?i.length:0,a=t?Object.keys(t):[],l=a.length;if(i)for(var u=0;u<s;u++)null!=i[u]&&null!=i[u]&&""!=i[u]&&(r+="/"+encodeURIComponent(i[u]));for(var d=0;d<l;d++)r+=0==d?"?":"&",r+=encodeURIComponent(a[d])+"="+encodeURIComponent(t[a[d]]);o.fire("iron-signal",{name:"sb-navigation-changed",data:{url:e,location:r}}),this.setPreviousRoute(i.join("/")),window.location.hash=r}},{key:"setPreviousRoute",value:function(e){if(!(!window.location.hash||window.location.hash.indexOf("#")<0||window.location.hash.indexOf("?")<0)){var t=0===window.location.hash.indexOf("#/")?"#/":"#",i=window.location.hash.split(t)[1].split("?");i[0]!==e&&(this.previousRoute=i[0],this.previousParams=i[1].indexOf("=")<0?{}:this._getParams(i[1]))}}},{key:"getPreviousRoute",value:function(){return this.previousRoute}},{key:"navToPreviousRoute",value:function(e,t,i){this.previousParams&&0<Object.keys(this.previousParams).length&&this.previousRoute&&0<this.previousRoute.length?this.nav("#",this.previousParams,this.previousRoute.split("/"),!1,e):this.nav("#",t,i,!1,e)}},{key:"_setRoute",value:function(e){this.previousRoute=e}},{key:"_getParams",value:function(e){var t={},i=!0,n=!1,o=void 0;try{for(var r,s=e.split("&")[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;if(null!=a&&""!==a){var l=a.split("=");t[decodeURIComponent(l[0])]=decodeURIComponent(l[1])}}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t}}]),i=e)),t("Navigator",i)}}}),System.register("common/core/Page.js",["common/core/sb-page-container/PageContainer.js","common/core/AppContext.js","common/core/Navigator.js"],function(t,e){var i,o,r,s,a,l;return{setters:[function(e){i=e.PageContainer},function(e){o=e.AppContext},function(e){r=e.Navigator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}s=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},(a=window&&window.sb||{}).ui=a.ui||{},a.common=a.common||{},a.common.core=a.common.core||{},window.sb=a,t("SIZE_S","S"),t("SIZE_S","S"),t("SIZE_M","M"),t("SIZE_M","M"),t("SIZE_L","L"),t("SIZE_L","L"),t("SIZE_XL","XL"),t("SIZE_XL","XL"),t("Page",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,o),s(e,[{key:"nav",value:function(e,t,i,n){r.nav(e,t,i,n,this)}}],[{key:"properties",get:function(){return Polymer.Base.extend({ctx:{type:Object,value:function(){return{}}},viewport:{type:Object,value:function(){return i.getViewport()}}},o.properties)}}]),l=e)),t("Page",l),a.common.core.Page=l.prototype}}}),System.register("common/formatter/Formatter.js",["common/forms/NumberFormatter.js","common/core/AppContext.js","quotes/QuoteContext.js","common/layout/sb-html/Html.js","quotes/layout/sb-le-table-cell/DiscountConverter.js"],function(e,t){var l,u,d,c,h,p,i;return{setters:[function(e){l=e.NumberFormatter},function(e){u=e.AppContext},function(e){d=e.QuoteContext},function(e){c=e.Html},function(e){h=e.getUnitAndDisplayValue,p=e.updateUnitIfAmountInactive}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a)}e("Formatter",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(a,null,[{key:"formatFieldData",value:function(e,t,i,n){if(!i)return t;var o=i.type,r=new l(!1,i,u.i18n,o);switch(d.isDiscountField(i.name)&&(o="discount"),d.isMarkupField(i.name)&&(o="markup"),i&&"richtextarea"===i.extraTypeInfo&&(o="richtextarea"),o){case"double":return r.format(t,!1);case"currency":case"percent":return r.format(t,!0);case"discount":case"markup":return this.formatDiscountField(e,r);case"date":case"datetime":return u.i18n.format(t,{date:!0});case"reference":return a.formatReferenceField(i,n);case"richtextarea":case"url":var s=c.sanitizeHtmlText(t);return null===s?"":s;case"string":if(i.calculatedFormula&&c.containsMarkup(t))return c.sanitizeHtmlText(t);break;case"picklist":case"multipicklist":return this.formatPicklistData(i,t)}return t}},{key:"formatPicklistData",value:function(i,e){var n=this;if(i.picklistValues&&e){var o=[];return e.split(";").forEach(function(e){var t=n.findPickListValue(i,e);t?o.push(t.label):o.push(e)}),o.join(";")}return e}},{key:"findPickListValue",value:function(e,t){var i=this,n=e.name;return this._pickListValuesMap||(this._pickListValuesMap={}),this._pickListValuesMap[n]||(this._pickListValuesMap[n]={},e.picklistValues.forEach(function(e){i._pickListValuesMap[n][e.value]=e})),this._pickListValuesMap[n][t]}},{key:"formatDiscountField",value:function(e,t){p(e,t.metadata.name);var i=h(e,t.metadata.name),n=i.displayValue,o=i.units,r=i.unit;if(null===n||isNaN(n))return"";var s=o.find(function(e){return e.value===r}),a=s?s.label:"";return t.format(n)+" "+a}},{key:"formatReferenceField",value:function(e,t){var i="";return t&&e.relationshipName&&t[e.relationshipName]&&(i=t[e.relationshipName].Name),i}},{key:"toApexDate",value:function(e){return e&&e instanceof Date?e.toISOString().replace(new RegExp("[Tt].*"),""):""}},{key:"toApexDateTime",value:function(e){if(e&&e instanceof Date){var t=e.toISOString();return t.slice(0,t.length-1)+"+0000"}return""}}]),i=a)),e("Formatter",i)}}}),System.register("common/forms/DateParser.js",["common/core/sb-i18n/I18n.js"],function(e,t){var r,i;return{setters:[function(e){r=e.I18n}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.stripTime=e;var t=(r.getLocaleData()?r.getLocaleData().date.formats.dateFormats.yMd:"M/D/YY").replace(new RegExp("[dD]+"),"D").replace(new RegExp("[mM]+"),"M").replace(new RegExp("[yY]+"),"Y");this.separator=t.match(new RegExp("[/.-]"))[0];var i=t.split(this.separator);this.dateIdx=i.indexOf("D"),this.monthIdx=i.indexOf("M"),this.yearIdx=i.indexOf("Y")}e("DateParser",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"parse",value:function(e,t){var i=1<arguments.length&&void 0!==t?t:this._isValidYear;if("string"!=typeof e)return e;this.stripTime&&(e=e.split(" ")[0]);var n=!0,o=e.split(this.separator),r=o[this.dateIdx],s=o[this.monthIdx],a=o[this.yearIdx];if(a&&4==a.length&&s&&0<s.length&&s.length<=2&&r&&0<r.length&&r.length<=2){if(r=parseInt(r),s=parseInt(s),a=parseInt(a),o.length&&!isNaN(a)&&!isNaN(s)&&!isNaN(r)){if("function"==typeof i&&!i(a))return null;if(1<=s&&s<=12){var l=31;2==s?(l=28,a%4==0&&(a%100!=0?l=29:a%400==0&&(l=29))):4!=s&&6!=s&&9!=s&&11!=s||(l=30),1<=r&&r<=l&&(n=!1)}}return n?null:new Date(a,s-1,r)}return null}},{key:"_isValidYear",value:function(e){return 1700<=e&&e<=4e3}}]),i=o)),e("DateParser",i)}}}),System.register("common/forms/DependentPicklistBuilder.js",[],function(e,t){var o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.controlledPicklist=e,this.controllingValue=t}e("DependentPicklistBuilder",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"build",value:function(){var e=this.controlledPicklist.picklistValues,t=[];return e.forEach(function(e){this._testBit(atob(e.validFor),this._getControllingValueIndex(this.controllingValue))&&t.push(e)}.bind(this)),t}},{key:"_getControllingValueIndex",value:function(e){if("boolean"===this.controlledPicklist.controllingField.type)return!0===e?1:0;for(var t=this.controlledPicklist.controllingField.picklistValues,i=0,n=t.length;i<n;i++)if(t[i].value==e)return i;return-1}},{key:"_testBit",value:function(e,t){var i=Math.floor(t/8),n=7-t%8;return(Math.pow(2,n)&e.charCodeAt(i))>>n==1}}]),o=i)),e("DependentPicklistBuilder",o)}}}),System.register("common/forms/Locale.js",["common/core/AppContext.js"],function(e,t){var i,o,r;return{setters:[function(e){i=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t)}e("Locale",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,null,[{key:"get",value:function(){return i.user&&i.user.locale||"en-US"}},{key:"isCommaDecimal",value:function(e){return-1!==r.indexOf(e||t.get())}}]),o=t)),e("Locale",o),e("COMMA_DECIMAL_LOCALES",r=["bg-BG","ca-ES","hr-HR","cs-CZ","da-DK","nl-AW","nl-BE","nl-NL","nl-SR","en-ZA","et-EE","fi-FI","fr-BE","fr-CA","fr-KM","fr-FR","fr-GN","fr-HT","fr-LU","fr-MR","fr-MC","fr-WF","de-AT","de-DE","de-LU","el-GR","hu-HU","in-ID","it-IT","lv-LV","lt-LT","no-NO","pl-PL","pt-AO","pt-BR","pt-CV","pt-MZ","pt-PT","pt-ST","ro-MD","ro-RO","ru-RU","sr-BA","sr-RS","sr-CS","sk-SK","sl-SI","es-AR","es-BO","es-CL","es-CO","es-EC","es-PY","es-ES","es-UY","es-VE","sv-SE","tr-TR","uk-UA","vi-VN"]),e("COMMA_DECIMAL_LOCALES",r)}}}),System.register("common/forms/NumberFormatter.js",["common/core/sb-page-container/PageContainer.js","common/core/AppContext.js","common/forms/Locale.js"],function(e,t){var s,a,o,i;return{setters:[function(e){s=e.PageContainer},function(e){a=e.AppContext},function(e){o=e.Locale}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.editable=e,this.metadata=t,this.i18n=i,this.type=n,this.viewport=o||s.getViewport(),this.appContext=a}e("NumberFormatter",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(r,[{key:"format",value:function(t,e){var i={};if(null!=this.metadata.scale&&0<=this.metadata.scale&&(i.minimumFractionDigits=this.metadata.scale,i.maximumFractionDigits=this.metadata.scale),e&&("currency"===this.type?this._setCurrencyFormatOptions(i):"percent"===this.type&&(this._setPercentFormatOptions(i),t=null!=t?t/100:null)),this.editable&&this.isMobile()&&!o.isCommaDecimal()&&(i.useGrouping=!1),this.isNil(t))return null;try{var n=this.i18n.format(t,i);if("NaN"===n)throw new Error(t+" is not a number");return n}catch(e){return t}}},{key:"isNil",value:function(e){return null==e||""===e||isNaN(e)}},{key:"isMobile",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"_setCurrencyFormatOptions",value:function(e){e.style="currency",this.appContext.org.isMultiCurrencyOrg?(e.currency=this.metadata&&this.metadata.CurrencyIsoCode?this.metadata.CurrencyIsoCode:this.appContext.org.defaultCurrency,e.currencyDisplay="code"):(e.currencyDisplay="symbol",this.appContext.org.currencySymbol?e.currency="XXX":e.currency=this.appContext.org.defaultCurrency)}},{key:"_setPercentFormatOptions",value:function(e){e.style="percent"}}]),i=r)),e("NumberFormatter",i)}}}),System.register("common/forms/NumberParser.js",["common/forms/Locale.js"],function(e,t){var i,o;return{setters:[function(e){i=e.Locale}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.locale=e||i.get(),this.isCommaDecimalLocale=i.isCommaDecimal(this.locale)}e("NumberParser",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"parse",value:function(e,t,i){var n=1<arguments.length&&void 0!==t&&t,o=i;if("string"!=typeof e)return this.applyScale(e,o);e=this.removeUnusualSeparators(e),e=this.removeNonDecimalCommas(e),e=this.removeDecimalSepartors(e),e=this.replaceCommaDecimalWithPeriod(e);var r=parseFloat(e);return n?r==e?this.applyScale(r,o):NaN:this.applyScale(r,o)}},{key:"removeUnusualSeparators",value:function(e){return e.replace(new RegExp("[\\s]+","g"),"").replace(new RegExp("'","g"),"").replace(new RegExp("","g"),"")}},{key:"removeNonDecimalCommas",value:function(e){return this.isCommaDecimalLocale?e:e.replace(new RegExp(",","g"),"")}},{key:"removeDecimalSepartors",value:function(e){return this.isCommaDecimalLocale?e.replace(new RegExp("[.]","g"),""):e}},{key:"replaceCommaDecimalWithPeriod",value:function(e){return this.isCommaDecimalLocale?e.replace(new RegExp(",","g"),"."):e}},{key:"applyScale",value:function(e,t){return null==t||"number"!=typeof e?e:parseFloat(e.toFixed(t))}}]),o=t)),e("NumberParser",o)}}}),System.register("common/oauth/OAuth.js",["common/oauth/oauth.local.js"],function(e,t){var i,o,s,a,l,u,d,c,h;return{setters:[function(e){i=e.OAUTH_KEY,o=e.OAUTH_SECRET,s=e.PRIVATE_API_SECRET,a=e.OAUTH_PROXY_URL,l=e.OAUTH_LOGIN_URL}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),!c.clientId||!c.clientSecret)throw Error(this._getNoOAuthClientKeyMessage());var t=jsforce.browser.Client.prototype._storeTokens.bind(jsforce.browser);jsforce.browser.Client.prototype._storeTokens=function(e){t(e),localStorage.setItem(this._prefix+"_refresh_token",e.refresh_token)}.bind(jsforce.browser);var i=jsforce.browser.Client.prototype._removeTokens.bind(jsforce.browser);jsforce.browser.Client.prototype._removeTokens=function(){i(),localStorage.removeItem(this._prefix+"_refresh_token")}.bind(jsforce.browser);var n=jsforce.browser.Client.prototype._getTokens.bind(jsforce.browser);jsforce.browser.Client.prototype._getTokens=function(){var e=n();return e&&(e.refreshToken=localStorage.getItem(this._prefix+"_refresh_token")),e}.bind(jsforce.browser);var o=jsforce.browser.Client.prototype.isLoggedIn.bind(jsforce.browser);jsforce.browser.Client.prototype.isLoggedIn=function(){return!!o()&&this.connection.refreshToken}.bind(jsforce.browser),function(){localStorage.setItem(this._prefix+"_issued_at",(new Date).getTime()),document.cookie=this._prefix+"_loggedin=true;"}.bind(jsforce.browser)(),e&&jsforce.browser._storeTokens(e),jsforce.OAuth2.prototype.refreshToken=this._refresAccessToken,jsforce.browser.init(c)}u=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},d="http://localhost:"+location.port+"/common/oauth",c={clientId:i,clientSecret:o,redirectUri:d+"/callback",proxyUrl:a,loginUrl:l},e("OAuth",(u(r,[{key:"login",value:function(){jsforce.browser.login()}},{key:"getConnection",value:function(){return jsforce.browser.isLoggedIn()?new Promise(function(t){jsforce.browser.once("connect",function(e){e.oik=s,e.once("refresh",function(e){this.accessToken=e}.bind(this)),t(e)}.bind(this)),jsforce.browser.init(c)}.bind(this)):Promise.reject("Please login before establishing a connection at http://localhost:"+location.port+"/common/oauth")}},{key:"_getNoOAuthClientKeyMessage",value:function(){return'Need to add a \'.env.json\' file in the CPQ dir whose contents contains the Consumer Key and Consumer Secret of the Salesforce CPQ Connected App, and then execute a gulp compile.\n{"oauth_key": "<Consumer Key>, "oauth_secret": "<Consumer Secret>"}'}},{key:"_refresAccessToken",value:function(e,t){return this._transport.httpRequest({method:"POST",url:c.proxyUrl,body:"grant_type=refresh_token&refresh_token="+e+"&client_id="+this.clientId+"&client_secret="+this.clientSecret,headers:{"SalesforceProxy-Endpoint":this.tokenServiceUrl,"Content-Type":"application/x-www-form-urlencoded"}}).then(function(e){var t;try{t=JSON.parse(e.body)}catch(e){}if(400<=e.statusCode){t=t||{error:"ERROR_HTTP_"+e.statusCode,error_description:e.body};var i=new Error(t.error_description);throw i.name=t.error,i}return t}).thenCall(t)}},{key:"encodeTokenUrl",value:function(){var e=jsforce.browser._getTokens(),t=e.refreshToken,i=encodeURIComponent(e.instanceUrl),n=encodeURIComponent(e.userInfo.url);return d+"?rt="+t+"&org="+i+"&id="+n}},{key:"accessToken",set:function(e){localStorage.setItem(jsforce.browser._prefix+"_access_token",e)}},{key:"tokens",get:function(){return jsforce.browser._getTokens()},set:function(e){jsforce.browser._storeTokens(e)}}],[{key:"decodeTokenUrl",value:function(e){if(e){var t=r._getParameterByName("rt",e),i=r._getParameterByName("org",e),n=r._getParameterByName("id",e);return t&&i&&n?{refresh_token:t,instance_url:i,id:n,access_token:"xyz",issued_at:(new Date).getTime()}:void 0}}},{key:"_getParameterByName",value:function(e,t){e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}}]),h=r)),e("OAuth",h)}}}),System.register("common/oauth/oauth.local.js",[],function(e,t){return{setters:[],execute:function(){e("OAUTH_KEY","undefined"),e("OAUTH_KEY","undefined"),e("OAUTH_SECRET","undefined"),e("OAUTH_SECRET","undefined"),e("PRIVATE_API_SECRET",""),e("PRIVATE_API_SECRET",""),e("OAUTH_PROXY_URL","http://brick-dynos-proxy-na-dev.herokuapp.com/proxy/"),e("OAUTH_PROXY_URL","http://brick-dynos-proxy-na-dev.herokuapp.com/proxy/"),e("OAUTH_LOGIN_URL","https://test.salesforce.com"),e("OAUTH_LOGIN_URL","https://test.salesforce.com")}}}),System.register("common/relationship/RelationshipFieldManager.js",["common/forms/sb-lookup/map/LookupNameMapper.js"],function(e,t){var a,i;return{setters:[function(e){a=e.LookupNameMapper}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.field=e,this.record=t}e("RelationshipFieldManager",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(s,[{key:"hasRelationship",value:function(){return!!this.getRelationship()}},{key:"getRelationship",value:function(){var e=s.getRelationshipField(this.field);if(e)return"function"==typeof this.record?this.record(e):this.record[e]}},{key:"getRelationshipName",value:function(e){var t=this.getRelationship();if(t)return t[e||this._getLookupName(t)]}},{key:"addRelationshipName",value:function(e,t,i){var n=this.buildRelationship(e,t,i);if(n.value.Id||(n.value=null),n)return"function"==typeof this.record?this.record(n.field,n.value):void(this.record[n.field]=n.value)}},{key:"buildRelationship",value:function(e,t,i){var n=s.getRelationshipField(this.field);if(n){var o=this.getRelationship()||{},r=new a(i).getNameField();return o.Id=e,o[r]=t,{value:o,field:n}}}},{key:"_getLookupName",value:function(e){var t=e.attributes?e.attributes.type:"";return new a(t).getNameField()}}],[{key:"getRelationshipField",value:function(e,t){var i=void 0;return e.endsWith("__c")?i=e.replace(/__c$/,"__r"):e.endsWith("Id")&&(i=e.substring(0,e.length-2)),i&&t?i+"."+new a(t).getNameField():i}}]),i=s)),e("RelationshipFieldManager",i)}}}),System.register("common/rules/QuoteRuleExecutor.js",["common/rules/RuleExecutor.js","common/rules/RuleEvaluator.js"],function(e,t){var i,p,o,s,a;return{setters:[function(e){i=e.RuleExecutor},function(e){p=e.RuleEvaluator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,i,n));return o._init(e),o}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},s=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(n):void 0},e("QuoteRuleExecutor",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,i),o(r,[{key:"_init",value:function(e){this.quote=e,this.response={requiredProductIds:[]};var t=!0,i=!(this.lineItemsById={}),n=void 0;try{for(var o,r=(this.quote.lineItems||[])[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this.lineItemsById[s.record[this.PRODUCT]]=s}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"execute",value:function(){var e=new p(this.rules,this.quote,this.prefix,this.errorStrings),t=!0,i=!1,n=void 0;try{for(var o,r=(this.rules||[])[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;if(e.isRuleSatisfied(s)){var a=!0,l=!1,u=void 0;try{for(var d,c=s[this.ACTIONS].records[Symbol.iterator]();!(a=(d=c.next()).done);a=!0){var h=d.value;this._conditionallyAddToResponseObject(h)}}catch(e){l=!0,u=e}finally{try{!a&&c.return&&c.return()}finally{if(l)throw u}}}}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return this.response}},{key:"_conditionallyAddToResponseObject",value:function(e){var t=s(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"_getResponseType",this).call(this,e[this.TYPE]);null!==t&&("requiredProductIds"===t&&this._productAdded(e[this.PRODUCT])||this.response[t].push(e[this.PRODUCT]))}},{key:"_productAdded",value:function(e){return!!this.lineItemsById[e]}}]),a=r)),e("QuoteRuleExecutor",a)}}}),System.register("common/rules/RuleEvaluator.js",["common/rules/operators/OperatorsUtils.js"],function(e,t){var r,i;return{setters:[function(e){r=e.OperatorsUtils}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.rules=e,this.quote=t,this.prefix=void 0===i?"":i,this.errorStrings=n,this._init()}e("RuleEvaluator",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"_init",value:function(){this._setConstants(),this._setAliasedFieldsMap()}},{key:"_setConstants",value:function(){this.ERROR_CONDITIONS=this.prefix+"ErrorConditions__r",this.TESTED_VARIABLE=this.prefix+"TestedVariable__c",this.CONDITIONS_MET=this.prefix+"ConditionsMet__c",this.TESTED_OBJECT=this.prefix+"TestedObject__c",this.TESTED_FIELD=this.prefix+"TestedField__c",this.FILTER_VALUE=this.prefix+"FilterValue__c",this.FILTER_TYPE=this.prefix+"FilterType__c",this.OPERATOR=this.prefix+"Operator__c",this.ACTIONS=this.prefix+"Actions__r"}},{key:"_setAliasedFieldsMap",value:function(){this.aliasedFieldsMap={Quote:{"Group Line Items":this.prefix+"LineItemsGrouped__c"}}}},{key:"isRuleSatisfied",value:function(e){if(!this._hasActions(e))return!1;if(!this._hasErrorConditions(e))return!0;var t=e[this.CONDITIONS_MET],i=!1,n=!0,o=!1,r=void 0;try{for(var s,a=(e[this.ERROR_CONDITIONS].records||[])[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=l[this.TESTED_VARIABLE],d=l[this.TESTED_OBJECT],c=this.packageConditionDetails(l);if("Quote"===d?i=this.evaluateCondition(l,this.quote.record,c):"Quote Line"===d&&0<this.quote.lineItems.length?i=this.evaluateCollection(l,this.quote.lineItems,c):"Quote Line Group"===d&&0<this.quote.lineItemGroups.length?i=this.evaluateCollection(l,this.quote.lineItemGroups,c):u?this._throwError(this.errorStrings.msg_jspr_err_summary_variable_used.replace("{0}",l.Id)):this._throwError(this.errorStrings.msg_jspr_err_no_tested_object.replace("{0}",l.Id)),this._canReturnImmediately(i,t))return i}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}},{key:"packageConditionDetails",value:function(e){var t=new r(e[this.OPERATOR]).getInstance();if(null===t){var i=this.errorStrings.msg_jspr_err_invalid_operator.replace("{0}",e[this.OPERATOR]).replace("{1}",e.Id);this._throwError(i)}return"Variable"===e[this.FILTER_TYPE]&&this._throwError(this.errorStrings.msg_jspr_err_summary_variable_used.replace("{0}",e.Id)),{op:t,filterValue:e[this.FILTER_VALUE]}}},{key:"evaluateCollection",value:function(e,t,i){for(var n=0,o=t.length,r=!1;n<o&&!r;)r=this.evaluateCondition(e,t[n++].record,i);return r}},{key:"evaluateCondition",value:function(e,t,i){var n=this._getValue(e,t);return i.op.evaluate(n,i.filterValue)}},{key:"_getValue",value:function(e,t){var i=e[this.TESTED_OBJECT],n=e[this.TESTED_FIELD],o=this.aliasedFieldsMap[i]&&this.aliasedFieldsMap[i][n]?this.aliasedFieldsMap[i][n]:null,r=null===o?n:o;if(Object.keys(t).indexOf(r)<0){var s=this.errorStrings.msg_jspr_err_no_tested_field.replace("{0}",e.Id).replace("{1}",e[this.TESTED_FIELD]).replace("{2}",i);this._throwError(s)}return t[r]}},{key:"_throwError",value:function(e){throw{msg:e,type:"info"}}},{key:"_canReturnImmediately",value:function(e,t){return!("All"!=t||e)||!("Any"!=t||!e)}},{key:"_hasErrorConditions",value:function(e){return!!e[this.ERROR_CONDITIONS]}},{key:"_hasActions",value:function(e){return!!e[this.ACTIONS]&&0<e[this.ACTIONS].totalSize}}]),i=o)),e("RuleEvaluator",i)}}}),System.register("common/rules/RuleExecutor.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.rules=e,this.prefix=void 0===t?"":t,this.errorStrings=i,this._setConstants()}e("RuleExecutor",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"_setConstants",value:function(){this.ACTIONS=this.prefix+"Actions__r",this.TYPE=this.prefix+"Type__c",this.PRODUCT=this.prefix+"Product__c"}},{key:"_getResponseType",value:function(e){return"Add"===e||"Enable & Add"===e||"Show & Add"===e?"requiredProductIds":null}}]),i=o)),e("RuleExecutor",i)}}}),System.register("common/signal/AbstractFocusSignaler.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.element=e,this.focusEvents=t,this.blurEvents=i}e("AbstractFocusSignaler",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"signalOnFocus",value:function(e,t){this.fireFocusSignal=this.fireFocusSignal||this._fireSignal.bind(this,e,!0),this.fireBlurSignal=this.fireBlurSignal||this._fireSignal.bind(this,e,!1);var i=!0,n=!1,o=void 0;try{for(var r,s=this.focusEvents[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;this.element.removeEventListener(a,this.fireFocusSignal),t||this.element.addEventListener(a,this.fireFocusSignal)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}var l=!0,u=!1,d=void 0;try{for(var c,h=this.blurEvents[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var p=c.value;this.element.removeEventListener(p,this.fireBlurSignal),t||this.element.addEventListener(p,this.fireBlurSignal)}}catch(e){u=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(u)throw d}}}},{key:"fireSignal",value:function(e,t){this._fireSignals(e,t);var i=this._getLastSignaler();i!==this&&(i&&i._fireSignals(e,!1),this._setLastSignaler())}},{key:"getSignalTargets",value:function(){return[]}},{key:"disable",value:function(){this._toggleDisabled(!0)}},{key:"enable",value:function(){this._toggleDisabled(!1)}},{key:"_fireSignal",value:function(e,t){this._isDisabled()||this.fireSignal(e,t)}},{key:"_fireSignals",value:function(e,t){var i=this.getSignalTargets(),n=!0,o=!1,r=void 0;try{for(var s,a=i[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)s.value.fire(e,{focused:t,signaler:this})}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}},{key:"_getLastSignaler",value:function(){return window&&window.signaler?window.signaler.last:null}},{key:"_isDisabled",value:function(){return window&&window.signaler&&window.signaler.disabled}},{key:"_setLastSignaler",value:function(){var e=window.signaler||{};e.last=this,window.signaler=e}},{key:"_toggleDisabled",value:function(e){var t=window.signaler||{};t.disabled=e,window.signaler=t}}]),i=o)),e("AbstractFocusSignaler",i)}}}),System.register("common/signal/RowFocusSignaler.js",["common/signal/AbstractFocusSignaler.js","common/layout/tables/RowFieldSelector.js"],function(e,t){var i,r,o,s;return{setters:[function(e){i=e.AbstractFocusSignaler},function(e){r=e.RowFieldSelector}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function l(e,t,i,n,o,r,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,e,["tap","mouseenter"],["mouseleave"]));return a.groupId=t,a.cellName=i,a.rowId=n,a.rowIndex=o,a.rowIndexAttribute=r,a.ironList=s,a}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},e("RowFocusSignaler",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,i),o(l,[{key:"getSignalTargets",value:function(){var e=this.groupId.constructor===Array?this.groupId:[this.groupId],t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l=this.element.$$("#"+a);if(l){var u=Polymer.dom(l.root).querySelectorAll(this.cellName),d=!0,c=!1,h=void 0;try{for(var p,f=u[Symbol.iterator]();!(d=(p=f.next()).done);d=!0){var g=p.value;t.push(g.$$("sb-field"))}}catch(e){c=!0,h=e}finally{try{!d&&f.return&&f.return()}finally{if(c)throw h}}}}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t}},{key:"signalNextPreviousEditableTarget",value:function(e,t){var i=this.selector,n=t?i.selectNextEditableField(e):i.selectPreviousEditableField(e);n&&n.fire("sb-field-edit",{next:t})}},{key:"signalFirstLastEditableTarget",value:function(e){var t=this.selector,i=e?t.selectFirstEditableField():t.selectLastEditableField();i&&i.fire("sb-field-edit",{next:e})}},{key:"toggleRowFocus",value:function(e){e.detail.focused&&!this.element.focused?(this.element.focused=!0,this.rowId&&this.element.toggleClass("focused",!0,this.element.$$("#"+this.rowId))):!e.detail.focused&&this.element.focused&&(this.element.focused=!1,this.rowId&&this.element.toggleClass("focused",!1,this.element.$$("#"+this.rowId)))}},{key:"selector",get:function(){return new r(this.element,this.getSignalTargets(),this.rowIndex,this.rowIndexAttribute)}}],[{key:"signalFirstEditableTargetFirstRow",value:function(e,t,i){var n=r.selectFirstEditableFieldInFirstRow(e,t,i);n&&n.fire("sb-field-edit",{next:!0})}},{key:"signalLastEditableTargetLastRow",value:function(e,t,i,n){var o=r.selectLastEditableFieldInLastRow(e,t,i,n);o&&o.fire("sb-field-edit",{next:!1})}}]),s=l)),e("RowFocusSignaler",s)}}}),System.register("docgen/sb-docgen-preview/DocgenPreview.js",["../../common/core/Page.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.Page}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},r=[{name:"t1",title:"My Favorite Template"},{name:"t2",title:"Okay Template"},{name:"t3",title:"Super Template"},{name:"t4",title:"Nasty Template"},{name:"t5",title:"Don't Go Here"}],t("DocgenPreview",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),o(e,[{key:"beforeRegister",value:function(){this.is="sb-docgen-preview",this.properties=Polymer.Base.extend({obj:{type:Object,value:function(){return{}}},templates:{type:Array,value:function(){return r}}},i.properties)}},{key:"cancel",value:function(){this.nav("/entities/quote/detail?id="+this.ctx.params.id)}},{key:"preview",value:function(){this.nav("/docgen/preview?id="+this.ctx.params.id)}},{key:"behaviors",get:function(){return[sb.common.core.Page]}}]),s=e)),t("DocgenPreview",s),Polymer(s)}}}),System.register("favorites/sb-favorite-lookup/FavoriteLookup.js",["common/core/Page.js","common/core/Navigator.js","common/data/format/DataBuilder.js","common/data/format/ErrorFormatter.js","common/aggregate/quote-line-aggregator/QuoteLineAggregator.js"],function(t,e){var i,o,r,s,a,l,u;return{setters:[function(e){i=e.Page},function(e){o=e.Navigator},function(e){r=e.DataBuilder},function(e){s=e.ErrorFormatter},function(e){a=e.QuoteLineAggregator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}l=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("FavoriteLookup",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),l(e,[{key:"beforeRegister",value:function(){this.is="sb-favorite-lookup",this.properties=Polymer.Base.extend({lineEditorModel:Object,favoriteModel:Object,selectedFavorites:{type:Object,value:{}},actions:{type:Array,value:[]},errors:{type:Array,value:[],notify:!0},error:{type:Array,value:[]},qId:String,aId:String,groupKey:Number,isMobile:Boolean},i.properties)}},{key:"ready",value:function(){this.qId=this.qId||this.ctx.params.qId,this.aId=this.aId||this.ctx.params.aId,this.groupKey=parseInt(this.groupKey||this.ctx.params.groupKey)||null,this.isMobile=this._isMobileViewport(),this.$.le.addEventListener("line-editor-model-changed",function(e){this.lineEditorModel=e.detail.value}.bind(this)),this.$.md.addEventListener("md-changed",function(e){this._setMetaData(e.detail.value.fields)}.bind(this)),this.$.fm.addEventListener("response-changed",function(){this._setSelected()}.bind(this)),this.$.addFavorite.addEventListener("response-changed",function(e){var t=e.detail.value;if(t.partialVO&&(t=this._recombinePartialQuoteWithFullQuote(t)),this.lineEditorModel.quote=t,this._toggleSelected(),!this.addMore){var i={qId:this.qId};0<Object.keys(this.selectedFavorites).length&&(i.jspr=!0),null!=this.ctx.params.groupKey&&(i.groupKey=this.ctx.params.groupKey),o.nav("#",i,["quote","le"],!1,this)}this.$.header.selected=!1,this.addMore=!1}.bind(this)),this.addEventListener("favorite-shared",function(e){this.$.shareFavorites.addEventListener("response-changed",function(){this._toggleSelected()}.bind(this));var t=(new r).add("favIds",Object.keys(this.selectedFavorites)).add("groupIds",e.detail.groups).add("userIds",e.detail.users).build();this.$.shareFavorites.model=t}.bind(this)),this._handleOneFavoriteSelected(),this._handleAllFavoritesSelected()}},{key:"_recombinePartialQuoteWithFullQuote",value:function(e){var t=this.le.quote.lineItems;return e.lineItems=t.concat(e.lineItems),delete e.segmentTemplatesByDimensionTypeByGroupKey,delete e.emptyGroupKeys,e.partialVO=!1,e}},{key:"_setMetaData",value:function(e){this.cols=this.favoriteModel.resultFieldNames;for(var t={},i={},n=[],o=e.length,r=0;r<o;r++){var s=e[r];t[s.name]={type:s.type},i[s.name]=s.label,n.push(s.label)}this.model=t,this.primaryMobileCols=["Name","SBQQ__Description__c"],this.colsDisplay=i,this.fieldLabels=n}},{key:"_setSelected",value:function(){this.favoriteModel.favorites.forEach(function(e){e.selected=!1})}},{key:"_handleOneFavoriteSelected",value:function(){this.addEventListener("selection-changed",function(e){var t=e.detail,i=t.selected,n=t.Id;i?this.selectedFavorites[n]=t:delete this.selectedFavorites[n]}.bind(this))}},{key:"_handleAllFavoritesSelected",value:function(){this.addEventListener("header-selection-changed",function(e){e.detail.selected?(this._toggleSelected(!0),this.favoriteModel.favorites.forEach(function(e){this.selectedFavorites[e.record.Id]=e.record}.bind(this))):(this._toggleSelected(!1),this.selectedFavorites={})}.bind(this))}},{key:"_toggleSelected",value:function(e){var t=e||!1;this.$.header.selected=t;var i=Polymer.dom(this.$.tbody).querySelectorAll("sb-table-row");if(i&&0<i.length){var n=!0,o=!1,r=void 0;try{for(var s,a=i[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)s.value.selected=t}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}}},{key:"_removeSelections",value:function(){this.selectedFavorites={},this._setSelected()}},{key:"_isMobileViewport",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"onDeleteFavorite",value:function(){var e=(new r).add("quoteFavIds",this.le.quote.favoriteIds||[]).add("favIdsToRemove",Object.keys(this.selectedFavorites)).build();this.$.deleteFavorite.model=e}},{key:"toggleAddProducts",value:function(){this._toggleSelected();var e={qId:this.qId};null!=this.groupKey&&(e.groupKey=this.groupKey),this.aId&&(e.aId=this.aId),o.nav("#",e,["product","lookup"],!1,this)}},{key:"onShareFavorite",value:function(){0!==Object.keys(this.selectedFavorites).length?this.$.shareFavorite.$.dialog.toggle():this.error=["Please select at least one favorite to share."]}},{key:"onSelect",value:function(){var e=this.le.settings.largeQuoteThreshold,t=this.le.customLabels.msg_large_quote_sent_without_lines,i=this.le.quote;e&&i.lineItems.length>e&&(i=this._minimizeQuoteVO(i),console.log(t.replace("{0}",i.record.Id).replace("{1}",e)));var n=(new r).addQuote("quote",i).add("groupKey",this.groupKey).add("favIds",Object.keys(this.selectedFavorites)).build();this.$.addFavorite.model=n}},{key:"_minimizeQuoteVO",value:function(e){var t=JSON.parse(JSON.stringify(e)),i=new a(e),n=i.getSegmentTemplatesByDimensionTypeForGroupKey(this.groupKey);return t.segmentTemplatesByDimensionTypeByGroupKey={},t.segmentTemplatesByDimensionTypeByGroupKey[(this.groupKey||-1)+""]=n,t.emptyGroupKeys=i.getKeysOfEmptyGroups(),t.lineItems=[],t.partialVO=!0,t}},{key:"onSelectMore",value:function(){this.addMore=!0,this.onSelect()}},{key:"onCancel",value:function(){var e={qId:this.qId};null!=this.ctx.params.groupKey&&(e.groupKey=this.ctx.params.groupKey),o.nav("#",e,["quote","le"],!1,this)}},{key:"clearStackTrace",value:function(){this.errors.validations&&0<this.errors.validations.length?this.error=this.errors.validations:this.errors[0]&&(this.error=new s(this.errors).truncate())}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior]}},{key:"listeners",get:function(){return{"errors-changed":"clearStackTrace"}}}]),u=e)),t("FavoriteLookup",u),Polymer(u)}}}),System.register("favorites/sb-favorite-share-dialog/FavoriteShareDialog.js",["common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o;return{setters:[function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("FavoriteShareDialog",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-favorite-share-dialog",this.properties={favdUsers:{type:Array,value:[]},favdGroups:{type:Array,value:[]},favoriteCallback:{type:Function,value:function(){return this._favoriteCallbackFunction.bind(this)}},iconMap:{type:Object,value:{User:"sf-icon-user",Group:"sf-icon-groups"}},viewport:{type:Object,value:function(){return i.getViewport()}}}}},{key:"ready",value:function(){this.addEventListener("sb-cancel-share-fav",this.onCancel),this.viewport&&this.viewport.isMobile()&&this.toggleClass("mobile",!0,this.$.dialog)}},{key:"_favoriteCallbackFunction",value:function(e){return new Promise(function(i,t){null==e||e.length<2?this.viewport.isMobile()?this.$.multilookup.updateTable([]):i([]):(this.$.service.uid="",this.$.service.context=e,this.$.multilookup.menuItemLabels=["label"],this.$.service.addEventListener("response-changed",function(e){var t=this._parseResults(e.detail.value);this.viewport.isMobile()?this.$.multilookup.updateTable(t):i(t)}.bind(this)),this.$.service.addEventListener("error-changed",function(e){t(e.detail.value)}.bind(this)))}.bind(this))}},{key:"_parseResults",value:function(e){for(var t=e.groups,i=t.length,n=e.users,o=n.length,r=0;r<i;r++)t[r].type="Group",t[r].label="Group - "+t[r].Name;for(var s=0;s<o;s++)n[s].type="User",n[s].label="User - "+n[s].Name;return n.concat(t)}},{key:"onShare",value:function(){for(var t=this.$.multilookup.selectedIdsByItems,e=Object.keys(t).map(function(e){return t[e]}),i=e.length,n=0;n<i;n++){var o="Group"===e[n].type?"favdGroups":"favdUsers";this.push(o,e[n].Id)}this.fire("favorite-shared",{groups:this.favdGroups,users:this.favdUsers}),this.$.dialog.toggle(),this._clearFavdLists()}},{key:"onCancel",value:function(){this.$.dialog.toggle()}},{key:"_clearFavdLists",value:function(){this.set("favdUsers",[]),this.set("favdGroups",[]),this.$.multilookup.clear()}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),o=e)),t("FavoriteShareDialog",o),Polymer(o)}}}),System.register("products/localization/LocalizeFields.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.prefix=e}e("LocalizeFields",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"localizeSearchModel",value:function(e){var t=e.localizationByFieldByProductId;if(!t)return e;var i=!0,n=!1,o=void 0;try{for(var r,s=e.results[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l=t[a.record.Product2Id];if(l)for(var u in l){var d=this.getLocalizedValue(l[u].record);d&&(a.record.Product2[u]=d)}}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return e}},{key:"localizeProduct",value:function(e){if(!e.localizationByFieldByProductId)return e;var t=e.localizationByFieldByProductId[e.record.Id];if(t&&t.Name){var i=this.getLocalizedValue(t.Name.record);i&&(e.untranslatedRecord||(e.untranslatedRecord={Name:JSON.parse(JSON.stringify(e.record.Name))}),e.record.Name=i)}var n=!0,o=!1,r=void 0;try{for(var s,a=e.options[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u={};for(var d in l.localizationByFieldName){var c=null;if(-1!==d.indexOf("__c")){var h=l.localizationByFieldName[d];h&&(c=this.getLocalizedValue(h.record)),"Description__c"===d&&(d="ProductDescription__c"),d.replace("__c","")===h.record[this.prefix+"APIName__c"].replace("__c","")&&d!==h.record[this.prefix+"APIName__c"].replace(this.prefix,"")||(d=this.prefix+d),u[d]=l.record[d],c&&l.record[d]?l.record[d]=JSON.parse(JSON.stringify(c)):c&&l.record[this.prefix+d]&&(l.record[this.prefix+d]=JSON.parse(JSON.stringify(c)))}}l.untranslatedRecord||(l.untranslatedRecord=u)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}var p=!0,f=!1,g=void 0;try{for(var y,v=e.features[Symbol.iterator]();!(p=(y=v.next()).done);p=!0){var m=y.value;m.untranslatedRecord||(m.untranslatedRecord={Name:JSON.parse(JSON.stringify(m.record.Name))});var b=m.localizationByFieldName;if(b&&b.Name){var _=b.Name,S=this.getLocalizedValue(_.record);S&&(m.record.Name=S)}}}catch(e){f=!0,g=e}finally{try{!p&&v.return&&v.return()}finally{if(f)throw g}}return e}},{key:"getLocalizedValue",value:function(e){return e[this.prefix+"Text__c"]||e[this.prefix+"TextArea__c"]||e[this.prefix+"LongTextArea__c"]||e[this.prefix+"RichTextArea__c"]}}]),i=t)),e("LocalizeFields",i)}}}),System.register("quotes/models/AssetQuantityValidator.js",[],function(e,t){var o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.quoteModel=e,this.constants=t}e("AssetQuantityValidator",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"validateAssetQuantityChanges",value:function(){var e=this.quoteModel.record[this.constants.TYPE_FIELD];return"Renewal"===e?this._validateAssetQuantityChangeForRenewal():"Amendment"===e?this._validateAssetQuantityChangeForAmendment():[]}},{key:"_validateAssetQuantityChangeForRenewal",value:function(){var s=[];return this.quoteModel.lineItems.forEach(function(e){var t=e.record[this.constants.RENEWAL_CHECKBOX],i=e.record[this.constants.EXISTING_FIELD],n=e.record[this.constants.PRIOR_QUANTITY_FIELD];if(t&&i&&null!=n){var o=e.record[this.constants.QUANTITY_FIELD];if(0!=o&&o<n){var r="Quantity of Line {0} cannot decrease below original value {1} on a Renewal Quote.".replace("{0}",e.record[this.constants.NUMBER_FIELD]).replace("{1}",n);s.push(r)}}},this),s}},{key:"_validateAssetQuantityChangeForAmendment",value:function(){var s=this,o=[],i=[],n=[],r=[];if(this.quoteModel.lineItems.forEach(function(e){if(null!=e.record[this.constants.UPGRADED_ASSET_FIELD])if(e.record[this.constants.QUANTITY_FIELD]<0)e.record[this.constants.EXISTING_FIELD]&&e.record[this.constants.RENEWAL_CHECKBOX]&&i.push(e);else if(e.record[this.constants.EXISTING_FIELD]||e.record[this.constants.CARRYOVER_LINE_FIELD]){var t=e.record[this.constants.UPGRADED_QUANTITY];e.record[this.constants.PRIOR_QUANTITY_FIELD]<t?n.push(e):!e.record[this.constants.ALLOW_ASSET_REFUND_FIELD]&&function(e){var t=e.record[s.constants.QUANTITY_FIELD],i=e.record[s.constants.PRIOR_QUANTITY_FIELD]||0,n=e.record[s.constants.UPGRADED_QUANTITY]||0,o=e.record[s.constants.EXISTING_FIELD],r=e.record[s.constants.CARRYOVER_LINE_FIELD];return o||r?t-i+n:t}(e)<0&&r.push(e)}},this),0<i.length){var t="";i.forEach(function(e){t+=e.record[this.constants.NUMBER_FIELD]+", "},this),t=t.substr(0,t.lastIndexOf(",")),o.push("The quantities of the assets in the Amendment Quote are not allowed to be negative. Please adjust line(s) {0}".replace("{0}",t))}return 0<n.length&&n.forEach(function(e){var t=e.record[this.constants.NUMBER_FIELD],i=e.record[this.constants.PRIOR_QUANTITY_FIELD],n="Combined quantity of upgrades to Line {0} cannot exceed {1}.".replace("{0}",t).replace("{1}",i);o.push(n)},this),0<r.length&&r.forEach(function(e){var t=e.record[this.constants.PRODUCT_NAME_FIELD],i=e.record[this.constants.NUMBER_FIELD],n='Product "{0}" cannot be refunded. The quantity of Line {1} cannot decrease without a corresponding upgrade.'.replace("{0}",t).replace("{1}",i);o.push(n)},this),o}}]),o=i)),e("AssetQuantityValidator",o)}}}),System.register("quotes/models/Constants.js",[],function(e,t){return{setters:[],execute:function(){e("Constants",function(e){this.QUOTE=e+"Quote__c",this.QUOTE_LINE=e+"QuoteLine__c",this.QUOTE_LINE_GROUP=e+"QuoteLineGroup__c",this.ACCOUNT_FIELD=e+"Account__r",this.ACCOUNT_ID_FIELD=e+"Account__c",this.ACTION_FIELD=e+"Action__c",this.ADDITIONAL_DISCOUNT_AMOUNT_FIELD=e+"AdditionalDiscountAmount__c",this.ADDITIONAL_DISCOUNT_FIELD=e+"AdditionalDiscount__c",this.ADDITIONAL_DISCOUNT_RATE_FIELD=e+"Discount__c",this.ADDITIONAL_QUANTITY_FIELD=e+"AdditionalQuantity__c",this.ALLOW_ASSET_REFUND_FIELD=e+"AllowAssetRefund__c",this.BATCH_QUANTITY=e+"BatchQuantity__c",this.BUNDLE_FIELD=e+"Bundle__c",this.BUNDLED_FIELD=e+"Bundled__c",this.BUNDLED_QUANTITY_FIELD=e+"BundledQuantity__c",this.CARRYOVER_LINE_FIELD=e+"CarryoverLine__c",this.CLASS_FIELD=e+"Class__c",this.COMPONENT_DISCOUNTED_BY_PACKAGE_FIELD=e+"ComponentDiscountedByPackage__c",this.COMPONENT_LIST_TOTAL_FIELD=e+"ComponentListTotal__c",this.COMPONENT_SUBSCRIPTION_SCOPE_FIELD=e+"ComponentSubscriptionScope__c",this.COMPONENT_VISIBILITY_FIELD=e+"ComponentVisibility__c",this.CONDITIONS_MET_FIELD=e+"ConditionsMet__c",this.COST_EDITABLE_FIELD=e+"CostEditable__c",this.CUSTOM_ACTION_CONDITIONS_FIELD=e+"Custom_Action_Conditions__r",this.CUSTOMER_AMOUNT_FIELD=e+"CustomerAmount__c",this.CUSTOMER_PRICE_FIELD=e+"CustomerPrice__c",this.DEFAULT_SUBSCRIPTION_TERM_FIELD=e+"DefaultSubscriptionTerm__c",this.DEFAULT_FIELD=e+"Default__c",this.DESCRIPTION_FIELD=e+"Description__c",this.DIMENSION_ID_FIELD=e+"Dimension__c",this.DIMENSION_FIELD=e+"Dimension__r",this.DISCOUNT_AMOUNT_FIELD=e+"DiscountAmount__c",this.DISCOUNT_SCHEDULE_FIELD=e+"DiscountSchedule__c",this.DISCOUNT_SCHEDULE_TYPE_FIELD=e+"DiscountScheduleType__c",this.DISCOUNT_TIER_FIELD=e+"DiscountTier__c",this.DISCOUNT_TIERS_FIELD=e+"DiscountTiers__r",this.DISCOUNT_UNIT_FIELD=e+"DiscountUnit__c",this.DISTRIBUTOR_DISCOUNT_FIELD=e+"DistributorDiscount__c",this.DISTRIBUTOR_DISCOUNT_FIELD=e+"DistributorDiscount__c",this.EFFECTIVE_QUANTITY=e+"EffectiveQuantity__c",this.END_DATE_FIELD=e+"EndDate__c",this.EVENT_HANDLER_NAME_FIELD=e+"EventHandlerName__c",this.EXISTING_FIELD=e+"Existing__c",this.FAVORITE_ID_FIELD=e+"Favorite__c",this.FIELD_FIELD=e+"Field__c",this.FILTER_VALUE_FIELD=e+"FilterValue__c",this.GROUP_LINE_ITEMS_FIELD=e+"LineItemsGrouped__c",this.ICON_CLASS_FIELD=e+"IconClass__c",this.LABEL_FIELD=e+"Label__c",this.LIST_PRICE_FIELD=e+"ListPrice__c",this.LOCATION_FIELD=e+"Location__c",this.LONG_TEXT_AREA_FIELD=e+"LongTextArea__c",this.LOWER_BOUND_FIELD=e+"LowerBound__c",this.MARKUP_AMOUNT_FIELD=e+"MarkupAmount__c",this.MARKUP_FIELD=e+"Markup__c",this.MARKUP_RATE_FIELD=e+"MarkupRate__c",this.NET_AMOUNT_FIELD=e+"NetAmount__c",this.NET_PRICE_FIELD=e+"NetPrice__c",this.NET_TOTAL_FIELD=e+"NetTotal__c",this.NON_DISCOUNTABLE_FIELD=e+"NonDiscountable__c",this.NON_PARTNER_DISCOUNTABLE_FIELD=e+"NonPartnerDiscountable__c",this.NUMBER_FIELD=e+"Number__c",this.OPERATOR_FIELD=e+"Operator__c",this.OPPORTUNITY_FIELD=e+"Opportunity2__r",this.OPPORTUNITY_ID_FIELD=e+"Opportunity2__c",this.OPTION_LEVEL_FIELD=e+"OptionLevel__c",this.OPTION_TYPE_FIELD=e+"OptionType__c",this.OPTIONAL_FIELD=e+"Optional__c",this.ORIGINAL_QUOTE_LINE_FIELD=e+"OriginalQuoteLine__c",this.ORIGINAL_SCHEDULE_FIELD=e+"OriginalDiscountSchedule__c",this.OVERRIDE_BEHAVIOR_FIELD=e+"OverrideBehavior__c",this.PAGE_FIELD=e+"Page__c",this.PARENT_CUSTOM_ACTION_FIELD=e+"ParentCustomAction__c",this.PARTNER_DISCOUNT_FIELD=e+"PartnerDiscount__c",this.PARTNER_PRICE_FIELD=e+"PartnerPrice__c",this.PRICE_EDITABLE_FIELD=e+"PriceEditable__c",this.PRICEBOOK_ID_FIELD=e+"PricebookId__c",this.PRICEBOOK_LOOKUP_ID_FIELD=e+"PriceBook__c",this.PRICING_METHOD_EDITABLE_FIELD=e+"PricingMethodEditable__c",this.PRICING_METHOD_FIELD=e+"PricingMethod__c",this.PRIMARY_FIELD=e+"Primary__c",this.BRAND_BUTTON_FIELD=e+"BrandButton__c",this.PRIOR_QUANTITY_FIELD=e+"PriorQuantity__c",this.PRODUCT=e+"Product__c",this.PRODUCT_CODE_FIELD=e+"ProductCode__c",this.PRODUCT_NAME_FIELD=e+"ProductName__c",this.PRORATE_MULTIPLIER_FIELD=e+"ProrateMultiplier__c",this.QUANTITY_FIELD=e+"Quantity__c",this.QUOTE_PROCESS_FIELD=e+"QuoteProcess__c",this.QUOTE_PROCESS_ID_FIELD=e+"QuoteProcessId__c",this.REGULAR_PRICE_FIELD=e+"RegularPrice__c",this.RENEWAL_CHECKBOX=e+"Renewal__c",this.RENEWED_ASSET_ID_FIELD=e+"RenewedAsset__c",this.RENEWED_ASSET_RELATIONSHIP_FIELD=e+"RenewedAsset__r",this.RENEWED_SUBSCRIPTION_RELATIONSHIP_FIELD=e+"RenewedSubscription__r",this.REQUIRED_BY_FIELD=e+"RequiredBy__c",this.RICH_TEXT_AREA_FIELD=e+"RichTextArea__c",this.SEGMENT_INDEX_FIELD=e+"SegmentIndex__c",this.SEGMENT_KEY_FIELD=e+"SegmentKey__c",this.SEGMENT_LABEL_FIELD=e+"SegmentLabel__c",this.SOURCE_FIELD=e+"Source__c",this.SPECIAL_PRICE_FIELD=e+"SpecialPrice__c",this.START_DATE_FIELD=e+"StartDate__c",this.SUBSCRIBED_ASSET_IDS_FIELD=e+"SubscribedAssetIds__c",this.SUBSCRIPTION_BASE_FIELD=e+"SubscriptionBase__c",this.SUBSCRIPTION_PRICING_FIELD=e+"SubscriptionPricing__c",this.SUBSCRIPTION_SCOPE_FIELD=e+"SubscriptionScope__c",this.SUBSCRIPTION_TERM_FIELD=e+"SubscriptionTerm__c",this.TARGET_CUSTOMER_AMOUNT=e+"TargetCustomerAmount__c",this.TARGET_OBJECT_FIELD=e+"TargetObject__c",this.TEXT_FIELD=e+"Text__c",this.TEXT_AREA_FIELD=e+"TextArea__c",this.TYPE_FIELD=e+"Type__c",this.UNIT_COST_FIELD=e+"UnitCost__c",this.UPGRADE_CONVERSION_RATE=e+"UpgradeConversionRate__c",this.UPGRADED_ASSET_FIELD=e+"UpgradedAsset__c",this.UPGRADED_QUANTITY=e+"UpgradedQuantity__c",this.UPGRADED_SUBSCRIPTION_FIELD=e+"UpgradedSubscription__c",this.UPLIFT_FIELD=e+"Uplift__c",this.UPPER_BOUND_FIELD=e+"UpperBound__c",this.URL_TARGET_FIELD=e+"URLTarget__c",this.URL_FIELD=e+"URL__c",this.RETURN_URL_FIELD=e+"ReturnURL__c",this.USE_PRICE_FOR_AMOUNT_FIELD=e+"UsePriceForAmount__c",this.USER_DEFINED_FIELD=e+"UserDefined__c",this.UNOPENED_FIELD=e+"Unopened__c",this.CUSTOM_VALUE="Custom",this.PANEL_ADDED_INDEX=2,this.PERCENT_OF_TOTAL="Percent Of Total",this.TYPE_STANDARD="Standard",this.TYPE_YEARLY_DIMENSION="Year",this.TYPE_QUARTERLY_DIMENSION="Quarter",this.TYPE_MONTHLY_DIMENSION="Month",this.TYPE_SINGLE_DIMENSION="One-time",this.TYPE_CUSTOM_DIMENSION="Custom",this.STANDARD_LINE="STANDARD_LINE",this.SEGMENTED_LINE="SEGMENTED_LINE",this.GROUP_HEADER="GROUP_HEADER",this.GROUP_FOOTER="GROUP_FOOTER",this.QUANTITY_FIELDS=new Set([this.ADDITIONAL_QUANTITY_FIELD,this.BATCH_QUANTITY,this.BUNDLED_QUANTITY_FIELD,this.EFFECTIVE_QUANTITY,this.PRIOR_QUANTITY_FIELD,this.QUANTITY_FIELD,this.UPGRADED_QUANTITY]),this.UNIT_PRICE_FIELDS=new Set([this.ADDITIONAL_DISCOUNT_FIELD,this.CUSTOMER_PRICE_FIELD,this.LIST_PRICE_FIELD,this.MARKUP_AMOUNT_FIELD,this.NET_PRICE_FIELD,this.PARTNER_PRICE_FIELD,this.REGULAR_PRICE_FIELD,this.SPECIAL_PRICE_FIELD,this.UNIT_COST_FIELD])})}}}),System.register("quotes/models/CustomActionModel.js",["common/Util.js","quotes/models/LineModel.js"],function(e,t){var a,i;return{setters:[function(e){a=e.Util},function(e){e.LineModel}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.editorModel=e,this.record=t,this.customActionModelsByParentId=i,this.renderLocation=n,this.record&&(this.icon=this.record[this.editorModel.constants.ICON_CLASS_FIELD],this.class=this.icon?this.icon:"",this.caClass=this.record[this.editorModel.constants.CLASS_FIELD],this.location=this.record[this.editorModel.constants.LOCATION_FIELD],this.eventHandlerName=this.record[this.editorModel.constants.EVENT_HANDLER_NAME_FIELD],this.label=this.record[this.editorModel.constants.LABEL_FIELD],this.title=this.icon?this.record[this.editorModel.constants.LABEL_FIELD]:null,this.type=this.record[this.editorModel.constants.TYPE_FIELD],this.isSeparator="Separator"===this.type,this.primary=this.record[this.editorModel.constants.BRAND_BUTTON_FIELD],this.urlTarget=this.record[this.editorModel.constants.URL_TARGET_FIELD],this.url=this.record[this.editorModel.constants.URL_FIELD],this.name=this.record.Name),"Line"===this.renderLocation&&(this.class=this.class+" "+this.eventHandlerName+" lineAction")}e("CustomActionModel",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"isHidden",value:function(e){if(e&&(this.model=e),e&&!this._customActionsConditionsMet)return!0;if("Line"===this.renderLocation&&e)switch(this.eventHandlerName){case"onAddToFavorites":return e.favorite||e.hasParent||e.existing;case"onRemoveFromFavorites":return!e.favorite||e.existing;case"onDeleteLine":return e.hasParent||e.existing&&this.editorModel.quoteModel.isAmendment;case"onCloneLine":return e.hasParent;case"onReconfigureLine":return e.hasParent||!e.configurable;case"onResegmentLine":return!e.lineVO.productHasDimensions||e.segmented||e.existing||e.bundle;case"onDesegmentLine":return!e.lineVO.productHasDimensions||!e.segmented||e.existing||e.bundle;case"showDSModal":var t=this.editorModel.constants.DISCOUNT_SCHEDULE_FIELD;return null==e.lineVO.record[t]||e.isDiscountScheduleIdExcluded(e.lineVO.record[t])}else{if("Quote"===this.renderLocation&&"Quote/Group"===this.location&&this.editorModel.quoteModel.grouped)return!0;switch(this.eventHandlerName){case"onUngroup":return!this.editorModel.quoteModel.grouped;case"updateLineOptional":return!this.editorModel.toggleOptionalShown||"Group"!==this.location&&"optionalAllBtn"===this.caClass===this.editorModel.quoteModel.allOptional;case"onRenewSubscriptions":return!this.editorModel.data.settings.renewSubscriptionsButtonRendered||this.editorModel.quoteModel.isAmendmentOrChangeQuote;case"onAmendSubscriptions":return!this.editorModel.quoteModel.isAmendment;case"onUpgradeAssets":return!this.editorModel.data.settings.upgradeAssetsButtonRendered;case"onDeleteLines":return!this.editorModel.data.settings.multiLineDeleteEnabled}}return!1}},{key:"_customActionsConditionsMet",get:function(){var e=this,t=this.editorModel.constants;if(!this.record||!this.record[t.CUSTOM_ACTION_CONDITIONS_FIELD])return!0;for(var i,n="Any"!==this.record[t.CONDITIONS_MET_FIELD],o=this.record[t.CUSTOM_ACTION_CONDITIONS_FIELD].records,r=0,s=o.length;r<s;r++)if("Product"===(i=o[r])[t.TARGET_OBJECT_FIELD]?!e.model.productVO||a.arithmeticOperatorConversion(e.model.productVO.record[i[t.FIELD_FIELD]],i[t.FILTER_VALUE_FIELD],i[t.OPERATOR_FIELD]):"Quote"!==i[t.TARGET_OBJECT_FIELD]||a.arithmeticOperatorConversion(e.editorModel.quoteModel.quoteVO.record[i[t.FIELD_FIELD]],i[t.FILTER_VALUE_FIELD],i[t.OPERATOR_FIELD])){if(!n)return!0}else if(n)return!1;return n}},{key:"hasMenu",get:function(){if(this.children||(this.children=this.customActionModelsByParentId?this.customActionModelsByParentId[this.record.Id]:null),"Menu"===this.type&&this.children&&0<this.children.length)for(var e=0,t=this.children.length;e<t;e++)if(!this.children[e].isHidden(this.model))return!0;return!1}},{key:"default",get:function(){var e=this.record[this.editorModel.constants.DEFAULT_FIELD];return this.record[this.editorModel.constants.DEFAULT_FIELD]=!1,e}},{key:"customActionId",get:function(){return this.record.Id}}]),i=o)),e("CustomActionModel",i)}}}),System.register("quotes/models/DiscountTierModel.js",[],function(e,t){var i;return{setters:[],execute:function(){e("DiscountTierModel",i=function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.template=t,this.discountSchedule=i,this.selected=!1,this.hidden=!1,this.disabled=!1,this.tiers=[]}),e("DiscountTierModel",i)}}}),System.register("quotes/models/DiscountTiersValidator.js",[],function(e,t){var o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.schedule=e,this.editorModel=t,this.constants=t.constants,this.unitPriceScale=t.data.settings.priceScale,this.isMultiCurrencyOrg=t.data.settings.isMultiCurrencyOrg}e("DiscountTiersValidator",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"validate",value:function(e){var l=new Map,u=null,d=this.editorModel.data.customLabels,c=this.schedule;return e.forEach(function(t){var i=null,n=t.template[this.constants.NUMBER_FIELD],e=t.template[this.constants.LOWER_BOUND_FIELD],o=t.template[this.constants.UPPER_BOUND_FIELD],r=null!=u?u[this.constants.UPPER_BOUND_FIELD]:null,s=c[this.constants.DISCOUNT_UNIT_FIELD],a=t.template[this.constants.ADDITIONAL_DISCOUNT_RATE_FIELD];delete t.template.Price,null==e?i=this.formatLabel(d.msg_missing_lower_bound_tier,[n]):null!=u&&e!=r?i=this.formatLabel(d.msg_unequal_lower_upper_bounds_tier,[n]):null!=a||null!=s&&"PERCENT"!==s.toUpperCase()?null!=o&&""!=o&&o<=e?i=this.formatLabel(d.msg_upper_greater_tier,[n]):s&&"AMOUNT"===s.toUpperCase()?t.tiers.forEach(function(e){null===this.discountFormatted(e)&&(i=this.isMultiCurrencyOrg?this.formatLabel(d.msg_missing_discount_amount_tier_currency,[n,t.CurrencyIsoCode]):this.formatLabel(d.msg_missing_discount_amount_tier,[n]))}.bind(this)):null!=o&&""!=o&&o<=e&&(i=this.formatLabel(d.msg_upper_greater_tier,[n])):i=this.formatLabel(d.msg_missing_discount_tier,[n]),null!=i&&l.set(Number(n),i),u=t.template}.bind(this)),l}},{key:"discountFormatted",value:function(e){return null==e[this.constants.DISCOUNT_AMOUNT_FIELD]?null:Number(e[this.constants.DISCOUNT_AMOUNT_FIELD]).toFixed(this.unitPriceScale)}},{key:"formatLabel",value:function(e,t){for(var i=0,n=t.length;i<n;i++)e=e.replace("{"+i+"}",t[i].toString());return e}}]),o=i)),e("DiscountTiersValidator",o)}}}),System.register("quotes/models/DragDropModel.js",["perfMetrics/MetricsService.js"],function(e,t){var i,a,l,d,c;function f(e){e.classList.add(a)}function g(e){e.classList.add(l)}return{setters:[function(e){i=e.MetricsService}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,i,n,o,r,s,a,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),this.host=e,this.keepBundleTogether=t,this.draggable=i,this.validTargets=n,this.sourceElement,this.hoverOver,this.placeHolderComp=null,this.ghostField,this.targetClass,this.dropBefore,this.usePlaceholder,this.highlightTargetPosition,this.highlightableElements=[],this.enableHighLight,this.lineEditor=document.body.querySelector("sb-page-container")?Polymer.dom(document.body.querySelector("sb-page-container").root).querySelector("sb-line-editor"):document.body.querySelector("sb-line-editor"),this.linesByParentKey=this.lineEditor&&this.lineEditor.editorModel?this.lineEditor.editorModel.quoteModel.linesByParentItemKey:null,this.standardLinesByParentKey=this.lineEditor&&this.lineEditor.editorModel?this.lineEditor.editorModel.quoteModel.standardLinesByParentItemKey:null,this.segmentedLinesByParentKey=this.lineEditor&&this.lineEditor.editorModel?this.lineEditor.editorModel.quoteModel.segmentedLinesByParentItemKey:null,this.ghost=null,this.ghostXOffset=null==a?60:a,this.ghostYOffset=null==l?23:l,this.handleDrag=o,this.handleTrack=r,this.handleDrop=s,this._bootstrapMetricsService()}function p(e){e.classList.contains(a)&&e.classList.remove(a),e.classList.contains(l)&&e.classList.remove(l)}function o(e){if(e&&e.lineModel)return e.lineModel.component}function r(e,t){if(e.lineModel&&t.lineModel)return e.lineModel.lineVO.parentItemKey===t.lineModel.lineVO.parentItemKey}function s(e,t){if(e.lineModel&&t.lineModel)return e.lineModel.lineVO.key===t.lineModel.lineVO.parentItemKey}a="droppableTopBorder",l="droppableBottomBorder",60,d=!23,e("DragDropModel",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(u,[{key:"_bootstrapMetricsService",value:function(){window.sb&&window.sb.MetricsService&&!this.metricsService&&(this.metricsService=new i)}},{key:"_onTrack",value:function(e){var t=e.detail.x,i=e.detail.y;switch(function(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}(e),e.detail.state){case"start":if(Math.abs(e.detail.dx)<9&&Math.abs(e.detail.dy)<4)return;this.metricsService&&this.metricsService.startTransaction("CPQ Performance Metrics Service: drag start ept"),d=!0,this.lineEditor.toggleClass("disable-selection",!0),this.sourceElement=Polymer.dom(e).localTarget;var n=this.sourceElement.getBoundingClientRect();this.sourceWidth=n.width,this.sourceHeight=n.height,this.handleDrag(this.sourceElement,e),this._appendGhostImage(t,i);break;case"track":if(!d)return;this.metricsService&&this.metricsService.startTransaction("CPQ Performance Metrics Service: drag tracking ept");try{this._moveGhost(t,i);var o=Polymer.dom(e).event.detail.hover();if("sb-le-table-row"!==this.draggable&&"sf-le-table-row"!==this.draggable||"panel"!==o.id&&!o.classList.contains("nav-item")?this._showGhost():this._hideGhost(),this.handleTrack(o),this.host.debounce("Cursor flipping",function(){var e=this;Polymer.RenderStatus.afterNextRender(this.lineEditor,function(){e.hoverOver&&0!=Object.keys(e.hoverOver).length?(o!==e.previousHoverOverComp&&e.lineEditor.toggleClass("dropCursor",!0),e.previousHoverOverComp=e.hoverOver.comp):(e.lineEditor.toggleClass("dropCursor",!1),e._removePlaceholder())})}.bind(this),15),!this.hoverOver||0==Object.keys(this.hoverOver).length)return void this._removeHighlightHover(this.previousHoverOverComp);this.host.debounce("Apply Placeholder",function(){this._removePlaceholder(),this.usePlaceholder&&this.hoverOver&&0!=Object.keys(this.hoverOver).length&&this._usePlaceholder(t,i)}.bind(this),22),this.enableHighLight&&(this._removeHighlightHover(this.previousHoverOverComp),this._highlightHover(this.hoverOver.comp))}catch(e){this.sourceElement.toggleAttribute?this.sourceElement.toggleAttribute("hidden",!1):this.sourceElement.removeAttribute("hidden"),this._removeGhost(),this._removePlaceholder(),this.lineEditor.toggleClass("dropCursor",!1)}break;case"end":if(!d)return;this.metricsService&&this.metricsService.startTransaction("CPQ Performance Metrics Service: drag end ept"),this._removePlaceholder(),this._removeGhost(),this.hoverOver?(this.handleDrop(this.sourceElement,this.hoverOver.comp,this.targetClass,this.dropBefore),this._removeHighlightHover(this.hoverOver.comp)):this.handleDrop(this.sourceElement,null,this.targetClass,this.dropBefore),this.lineEditor.toggleClass("dropCursor",!1),this.sourceElement=null,this.previousHoverOverComp=null,this.hoverOver={},d=!1,this.lineEditor.toggleClass("disable-selection",!1)}}},{key:"_appendGhostImage",value:function(e,t){var i=this._clonePolymerElement(this.sourceElement),n=i.querySelector(".loadingSpinner");n&&n.remove(),i.hidden=!1;var o=e-this.ghostXOffset+"px",r=t-this.ghostYOffset+"px";this.ghost.style.width=this.sourceWidth+"px",this.ghost.style.height=this.sourceHeight+"px",this.ghost.style.left=o,this.ghost.style.top=r,this.ghost.style.visibility="visible",this.ghost.appendChild(i)}},{key:"_moveGhost",value:function(e,t){var i=e-this.ghostXOffset+"px",n=t-this.ghostYOffset+"px";this.ghost.style.left=i,this.ghost.style.top=n}},{key:"_removeGhost",value:function(){this.ghost.innerHTML="",this.ghost.style.left="",this.ghost.style.top="",this.ghost.style.width="",this.ghost.style.height="",this.ghost.style.visibility="hidden"}},{key:"_hideGhost",value:function(){this.ghost.style.visibility="hidden"}},{key:"_showGhost",value:function(){this.ghost.style.visibility="visible"}},{key:"_findTableRowValidTarget",value:function(e){return e?this._ifParentIsValidTarget(e)&&!e.classList.contains("tfoot")&&"header"!==e.id&&"template"!==e.localName&&"sb-le-summary-row"!==e.localName?e:e.domHost?this._findTableRowValidTarget(e.domHost):e.host?this._findTableRowValidTarget(e.host):e.parentNode?this._findTableRowValidTarget(e.parentNode):null:null}},{key:"_updateMDQTableRowHoverOverObject",value:function(e,t){t.lineModel.dimensionType!==e.lineModel.dimensionType?this.hoverOver=null:this.keepBundleTogether&&e.lineModel.component&&t.lineModel.groupModel.groupKey!==e.lineModel.groupModel.groupKey?this.hoverOver=null:this.hoverOver={comp:t,phLoc:"both"}}},{key:"_findSidePanelGroupValidTarget",value:function(e){if(this._ifParentIsValidTarget(e))return e;if("panel"!==e.id)return null;var t=e.querySelectorAll(".nav-item");return t[t.length-1]}},{key:"_updateTableRowHoverOverObject",value:function(e,t){if(e)if("placeholder"===e.id&&(e="before"===e.ref?e.previousElementSibling:e.nextElementSibling),!this.keepBundleTogether&&e.lineModel)this.hoverOver={comp:e,phLoc:"both"};else if(e.lineModel){var i=e.lineModel.lineVO.key;if(o(this.sourceElement)){if(o(this.sourceElement))if(r(e,this.sourceElement)&&s(e,e.nextElementSibling))this.hoverOver={comp:e,phLoc:"before"};else{if(!r(e,this.sourceElement))return void(this.hoverOver=null);this.hoverOver={comp:e,phLoc:"both"}}}else if(this.standardLinesByParentKey[i]||e.lineModel.component){if(!e.lineModel.bundle||e.lineModel.component)return void(this.hoverOver=null);this.hoverOver={comp:e,phLoc:"before"}}else this.hoverOver={comp:e,phLoc:"both"}}else e.classList.contains("tfoot"),this.hoverOver=null}},{key:"_findParentCustomElement",value:function(e,t,i){if(!e)return null;switch(i){case"id":if(e.id===t)return e;break;case"class":if(e.classList.contains(t))return e;break;case"nodeName":if(e.nodeName===t)return e}return e.rootNode?this._findParentCustomElement(e.rootNode,t,i):e.host?this._findParentCustomElement(e.host,t,i):e.parentNode?this._findParentCustomElement(e.parentNode,t,i):null}},{key:"_highlightHover",value:function(e){this.host.toggleClass("hoverover",!0,e)}},{key:"_ifParentIsValidTarget",value:function(e){if(!e||!e.parentElement)return!1;for(var t=Array.from(e.parentElement.classList),i=0,n=t.length;i<n;i++)if(this.validTargets.has(t[i]))return this.targetClass=t[i],!0;return!1}},{key:"_removePlaceholder",value:function(){this.placeHolderComp&&this.placeHolderComp.parentElement&&(this.placeHolderComp.parentElement.removeChild(this.placeHolderComp),this.placeHolderComp=null)}},{key:"_removeHighlightHover",value:function(e){var t=this;e&&e.parentNode&&Polymer.dom(e.parentNode).querySelectorAll(e.localName).forEach(function(e){t.host.toggleClass("hoverover",!1,e)})}},{key:"_highlightDroppableBorder",value:function(e,t){var i=this.hoverOver.comp.getBoundingClientRect(),n=i.top+i.height/2,o=this.highlightableElements;switch(this.hoverOver.phLoc){case"both":if(t<n){for(var r=0,s=o.length;r<s;r++)p(o[r]),f(o[r]);this.dropBefore=!0}else if(n<t){for(var a=0,l=o.length;a<l;a++)p(o[a]),g(o[a]);this.dropBefore=!1}break;case"before":for(var u=0,d=o.length;u<d;u++)p(o[u]),f(o[u]);this.dropBefore=!0;break;case"after":for(var c=0,h=o.length;c<h;c++)p(o[c]),g(o[c]);this.dropBefore=!1}}},{key:"_removeHighlightDroppableBorder",value:function(e){if(e)for(var t=0,i=e.length;t<i;t++)p(e[t])}},{key:"_usePlaceholder",value:function(e,t){if(this.hoverOver&&this.hoverOver.comp!==this.placeHolderComp){var i=this.hoverOver.comp.getBoundingClientRect(),n=i.top+i.height/2;if(!this.placeHolderComp){if(this.sourceElement.deepCloneNode)this.placeHolderComp=this.sourceElement.deepCloneNode(),this.placeHolderComp.setAttribute("id","placeholder"),this.placeHolderComp.$$&&this.placeHolderComp.toggleClass("placeholder",!0,this.placeHolderComp.$$(".tr"));else{for(var o in this.placeHolderComp=this.host.create(this.draggable),this.placeHolderComp.setAttribute("id","placeholder"),this.placeHolderComp.$$&&this.placeHolderComp.toggleClass("placeholder",!0,this.placeHolderComp.$$(".tr")),this.sourceElement.properties)if("data"!==o)try{this.placeHolderComp[o]=this.sourceElement[o]}catch(e){}this.placeHolderComp.data=this.sourceElement.data}this.placeHolderComp.style.width=i.width+"px",this.placeHolderComp.style.height=i.height+"px",this.placeHolderComp.style.backgroundColor="#d8dde6"}switch(this.hoverOver.phLoc){case"both":t<n?(Polymer.dom(this.targetHost.root).querySelector("."+this.targetClass).appendChild(this.placeHolderComp),this.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp,this.hoverOver.comp),this.placeHolderComp.setAttribute("ref","after"),this.dropBefore=!0):n<t&&(Polymer.dom(this.targetHost.root).querySelector("."+this.targetClass).appendChild(this.placeHolderComp),this.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp,this.hoverOver.comp.nextElementSibling),this.placeHolderComp.setAttribute("ref","before"),this.dropBefore=!1);break;case"before":Polymer.dom(this.host.root).querySelector("."+this.targetClass).appendChild(this.placeHolderComp),this.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp,this.hoverOver.comp),this.placeHolderComp.setAttribute("ref","after"),this.dropBefore=!0;break;case"after":Polymer.dom(this.host.root).querySelector("."+this.targetClass).appendChild(this.placeHolderComp),this.hoverOver.comp.parentElement.insertBefore(this.placeHolderComp,this.hoverOver.comp.nextElementSibling),this.placeHolderComp.setAttribute("ref","before"),this.dropBefore=!1}}else if(this.hoverOver&&this.hoverOver.comp===this.placeHolderComp){if(!this.placeHolderComp.hasAttribute("ref"))return;"before"===this.placeHolderComp.getAttribute("ref")?(this.hoverOver.comp=this.hoverOver.comp.previousElementSibling,this.dropBefore=!1):"after"===this.placeHolderComp.getAttribute("ref")&&(this.hoverOver.comp=this.hoverOver.comp.nextElementSibling,this.dropBefore=!0)}}},{key:"_clonePolymerElement",value:function(e){if(e.deepCloneNode)return e.deepCloneNode();var t=e.cloneNode(!0);for(var i in e.properties)if("data"!==i)try{t[i]=e[i]}catch(e){}return t.data=e.data,t}}]),c=u)),e("DragDropModel",c),e("removeTableRowBorderClass",function(e){for(var t,i=0,n=(t=Array.from(Polymer.dom(e.root).querySelector(".tr").getElementsByClassName("td"))).length;i<n;i++)p(t[i])}),e("removeTopBottomBorderClass",p),e("isComponent",o),e("ifLineElementsShareParent",r),e("ifLineElementsAreParentChild",s)}}}),System.register("quotes/models/EditorModel.js",["common/core/AppContext.js","quotes/models/QuoteModel.js","quotes/models/Constants.js","quotes/models/CustomActionModel.js"],function(e,t){var r,i,s,y,a,l,u,d,c,h;return{setters:[function(e){r=e.AppContext},function(e){i=e.QuoteModel},function(e){s=e.Constants},function(e){y=e.CustomActionModel}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.i18n=r.properties.i18n.value(),this._observers=new Map,this.data=e,this.md=t,this.fieldsetMap=l(this.data,this.md),this.constants=new s(e.developerPrefix),this.deviceContext=i?i.app.deviceContext:{},this.fieldNameSet=i?i.fieldNameSet:{},this.md.fieldsMap[this.data.quoteLineObjectName][this.constants.SUBSCRIPTION_SCOPE_FIELD].required=!0,this.data.excludedDiscountScheduleIds=this.data.excludedDiscountScheduleIds&&0<this.data.excludedDiscountScheduleIds.length?this._convertExcludedDiscountScheduleIdsToObject(this.data.excludedDiscountScheduleIds):{},this.largeQuoteExperienceEnabled=e.settings.largeQuoteExperienceEnabled&&!this.deviceContext.isMobile,this.summarized=e.quote.summaries&&0<Object.keys(e.quote.summaries).length,this.createQuoteModel(e.quote),this.standardPrimaryMobileCols=[],this.segmentedPrimaryMobileCols=[],this.segmentedDetailsPrimaryMobileCols=[],this.toggleOptionalShown=d(this),i&&i.editorModel?(this.customActionsByLocation=i.editorModel.customActionsByLocation,this.customActionsByLocationMobile=i.editorModel.customActionsByLocationMobile,this.groupMobileMenuButtonAction=i.editorModel.groupMobileMenuButtonAction,h(this)):c(e.customActions,this),this.quoteCustomActions=this.deviceContext.isMobile?this.customActionsByLocationMobile.Quote:this.customActionsByLocation.Quote,this.lineCustomActions=this.deviceContext.isMobile?this.customActionsByLocationMobile.Line:this.customActionsByLocation.Line,this.styleQuoteAndGroupActionButtons(),this.communityPrefix=this._getCommunityPrefix(),this.isMultiGroupViewEnabled=e.settings.multiGroupViewEnabled}e("EditorModel",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"createQuoteModel",value:function(e){this.quoteModel=new i(e,this)}},{key:"styleQuoteAndGroupActionButtons",value:function(){function e(e){for(var t=!0,i=s.customActionsByLocation[e],n=i[0],o=0,r=i.length;o<r;o++)i[o].isHidden(s.quoteModel)||(i[o].first=t,i[o].isSeparator?(t=!0,n.last=!0):(t=!1,(n=i[o]).last=!1));n&&(n.last=!0)}var s=this;e("Quote"),e("Group")}},{key:"_getCommunityPrefix",value:function(){var e=document.location.pathname,t=e.indexOf("/apex");return t<0?"":e.substring(0,t)}},{key:"getFieldMetadata",value:function(e){return this.md.fieldsMap[this.data.quoteLineObjectName][e]}},{key:"getDependentFields",value:function(t){var i=this.md.fieldsMap[this.data.quoteLineObjectName];return Object.keys(i).filter(function(e){return i[e].controllerName===t})}},{key:"hasDrawerFields",value:function(){return 0<this.fieldsetMap.standardLineItemDrawerFieldNames.length}},{key:"isProductHierarchyVisualized",value:function(){return this.data.settings.productHierarchyVisualized}},{key:"_convertExcludedDiscountScheduleIdsToObject",value:function(e){if(e)return e.reduce(function(e,t){return e[t]=!0,e},{})}},{key:"actionsOnTheLeft",get:function(){return"Left"===this.data.settings.actionsColumnPlacement}}]),a=o)),e("EditorModel",a),l=function(e,i){var t=u(e.developerPrefix),n={};return t.forEach(function(t){e[t.name]?(n[t.name]=[],e[t.name].forEach(function(e){i.fieldsMap[t.table][e]&&n[t.name].push(e)})):n[t.name]=e[t.name]}),n},u=function(e){return[{table:e+"QuoteLine__c",name:"lineFieldNames"},{table:e+"QuoteLine__c",name:"lineFieldNamesTablet"},{table:e+"QuoteLine__c",name:"lineFieldNamesPhone"},{table:e+"QuoteLine__c",name:"standardLineItemDrawerFieldNames"},{table:e+"QuoteLine__c",name:"multiSegmentLineFieldNames"},{table:e+"QuoteLine__c",name:"multiSegmentLineSummaryFieldNames"},{table:e+"DiscountTier__c",name:"discountScheduleModalFieldNames"},{table:e+"Quote__c",name:"quoteFieldNames"},{table:e+"QuoteLineGroup__c",name:"groupFieldNames"}]},d=function(n){function e(e){for(var t=0,i=e.length;t<i;t++)if(e[t]===n.constants.OPTIONAL_FIELD)return!0}return e(n.fieldsetMap.lineFieldNames)||e(n.fieldsetMap.multiSegmentLineFieldNames)||e(n.fieldsetMap.standardLineItemDrawerFieldNames)},c=function(e,r){r.defaultCustomActions=[];for(var s=["Quote","Group","Line"],a={Quote:[],Group:[],Line:[]},l={Quote:[],Group:[],Line:[]},u={Quote:{},Group:{},Line:{}},d=void 0,t=function(e,t){if(-1!==s.indexOf(t)){var i=new y(r,e,u[t],t);if(i.isSeparator||l[t].push(i),i.default&&r.defaultCustomActions.push(i),"onAddGroup"===i.eventHandlerName&&(d=i),e[r.constants.PARENT_CUSTOM_ACTION_FIELD]){var n=e[r.constants.PARENT_CUSTOM_ACTION_FIELD],o=u[t][n];o?o.push(i):u[t][n]=[i]}else a[t].push(i)}},i=0,n=e.length;i<n;i++){var o=e[i][r.constants.LOCATION_FIELD];"Quote/Group"===o?(t(e[i],"Quote"),t(e[i],"Group")):o&&"Configurator"!==o&&t(e[i],o)}if(r.customActionsByLocation=a,r.customActionsByLocationMobile=l,r.groupMobileMenuButtonAction=new y(r),r.groupMobileMenuButtonAction.children=l.Group,r.data.settings.solutionGroupsEnabled&&0<r.data.solutionGroups.length&&d){var c=r.data.solutionGroups,h=u.Quote[d.record.Id]||[];d.type="Menu";for(var p=0,f=c.length;p<f;p++){var g=new y(r,c[p]);g.type="Solution Group",g.eventHandlerName="onAddGroup",g.label=c[p].Name,h.push(g)}d.children=h}},e("getSubchange",function(e,t,i){for(var n=0;n<i;n++){if(e.length<=1||"splices"===e[1])return null;t=t[e[0].startsWith("#")?e[0].substring(1):e[0]],e=e.slice(1)}return{path:e,target:t}}),h=function(a){function e(e){for(var t in e){var i=!0,n=!1,o=void 0;try{for(var r,s=e[t][Symbol.iterator]();!(i=(r=s.next()).done);i=!0){r.value.editorModel=a}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}}}a.deviceContext.isMobile?(e(a.customActionsByLocationMobile),a.groupMobileMenuButtonAction.editorModel=a):e(a.customActionsByLocation)}}}}),System.register("quotes/models/GroupModel.js",["common/core/sb-page-container/PageContainer.js","common/layout/fields/FieldSetHandler.js","quotes/layout/sb-le-table-cell/DiscountConverter.js","quotes/models/EditorModel.js","quotes/models/LineModel.js","quotes/models/UiNotifier.js"],function(e,t){var i,r,s,a,l,u,d,c,h;return{setters:[function(e){i=e.PageContainer},function(e){r=e.FieldSetHandler},function(e){s=e.setDiscountValue},function(e){a=e.getSubchange},function(e){l=e.LineModel},function(e){u=e.register,d=e.notify,c=e.setThenNotify}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.groupVO=e,this.quoteModel=t,this.standardLines=[],this.segmentedLines=[],this.dimensions=[],this.dimensionsMap={},this.segmentedLinesByDimension={},this.segmentedLinesBySegmentKey={},this.segmentedLineKeysBySegmentKey={},this.standardSubscriptionScopeEditable=!1,this.segmentedSubscriptionScopeEditable=!1,this.groupObjectName=this.constants.QUOTE_LINE_GROUP,this.summaries=this.quoteModel.grouped?this.groupVO.summaries:this.quoteModel.quoteVO.summaries,this.multiSegmentColumnTotals=this.groupVO.multiSegmentColumnTotals?this.groupVO.multiSegmentColumnTotals:this.quoteModel.quoteVO.multiSegmentColumnTotals,this.netMultiSegmentTotal=this.groupVO.netMultiSegmentTotal?this.groupVO.netMultiSegmentTotal:this.quoteModel.quoteVO.netMultiSegmentTotal,this.hasVisibleStandardLines=!1,this.hasVisibleSegmentedLines={},this.standardLineFieldNames=this._setStandardLineFieldNames(),this.groupFieldNames=this._getFieldSetNames(),this._setDrawerFields(),u(this,function(e){"lineType"!==e[0]&&(i.lineType===i.constants.TYPE_STANDARD?"standardLines"!==e[0]:"segmentedLinesByDimension"!==e[0]||e[1]!==i.lineType)||d(i,["flattenedRows"])})}e("GroupModel",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"processQuoteLines",value:function(e){var t=new l(e,this);(this.quoteModel.lineModelsByKey[t.lineVO.key]=t).segmented?this._addSegmentedLine(t):this._addStandardLine(t),t.lineVO.parentItemKey&&(!t.segmented||t.segmented&&t.segments)&&this.addToLinesByParentItemKey(t)}},{key:"_addStandardLine",value:function(e){e.visible&&(this.hasVisibleStandardLines=!0),this.quoteModel.indexByGroupKey[e.lineVO.parentGroupKey].indexByLineKey[e.lineVO.key]=this.standardLines.length,this.standardLines.push(e),e.subscriptionScopeEditable&&this.quoteModel.grouped&&(this.standardSubscriptionScopeEditable=!0)}},{key:"_addSegmentedLine",value:function(e){var t=e.lineVO,i=t.record,n=t.key,o=i[this.constants.SEGMENT_KEY_FIELD],r=i[this.constants.SEGMENT_LABEL_FIELD],s=this.quoteVO.multiSegmentKeys?this.quoteVO.multiSegmentKeys[o]:null;if(this.segmentedLinesBySegmentKey[o])this.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[n]=this.segmentedLinesBySegmentKey[o].segments.length,e.segmentedLineKey=this.segmentedLineKeysBySegmentKey[o],this.segmentedLinesBySegmentKey[o].segments.push(e),this.segmentedLinesBySegmentKey[o].segmentsByLabel[r]=e;else{e.visible&&!this.hasVisibleSegmentedLines[s]&&(this.hasVisibleSegmentedLines[s]=!0);var a=new l(t,this);this.setDimensionProperties(s),e.addToSegmentsArray(a),e.addToSegmentsByLabel(r,e),this.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[n]=e.segments.length-1,a.segmentedLineKey=this.segmentedLineKeysBySegmentKey[o],this.segmentedLines.push(e),s&&(this.quoteModel.indexByGroupKey[this.groupKey].indexBySegmentKey[o]=this.segmentedLinesByDimension[s].length,this.segmentedLinesByDimension[s].push(e),(this.segmentedLinesBySegmentKey[o]=e).dimensionType=s)}e.subscriptionScopeEditable&&this.quoteModel.grouped&&(this.segmentedSubscriptionScopeEditable=!0)}},{key:"removeDimensionProperties",value:function(e){e&&this.segmentedLinesByDimension[e]&&0===this.segmentedLinesByDimension[e].length&&(delete this.segmentedLinesByDimension[e],this.dimensionsMap[e]&&delete this.dimensionsMap[e],this.dimensions.splice(this.dimensions.indexOf(e),1))}},{key:"setDimensionProperties",value:function(e){e&&(this.dimensionsMap[e]||(this.dimensionsMap[e]=!0,this.dimensions.push(e)),this.segmentedLinesByDimension[e]||(this.segmentedLinesByDimension[e]=[]))}},{key:"addToLinesByParentItemKey",value:function(e){var t=this.quoteModel.linesByParentItemKey,i=this.quoteModel.standardLinesByParentItemKey,n=this.quoteModel.segmentedLinesByParentItemKey,o=e.lineVO.parentItemKey;o&&(t[o]||(t[o]=[]),t[o].push(e),e.segmented?(n[o]||(n[o]=[]),n[o].push(e)):(i[o]||(i[o]=[]),i[o].push(e)))}},{key:"cloneLine",value:function(e,t,i){var n=JSON.parse(JSON.stringify(e.lineVO));n.record=JSON.parse(JSON.stringify(e.lineVO.record));var o=i||e.groupModel,r=new l(n,o);return r.lineVO.parentItemKey=t||null,r.segmented&&!e.segmentedLineKey&&(r.segments=[],r.segmentsByLabel={}),this._hasCards(e)&&this._cloneCards(e,r),r.lineVO.record.Id=null,r.lineVO.record[this.constants.REQUIRED_BY_FIELD]=null,r.lineVO.record[this.constants.SOURCE_FIELD]=e.lineVO.record.Id,"Amendment"===e.editorModel.quoteModel.quoteVO.record[this.constants.TYPE_FIELD]&&(r.lineVO.record[this.constants.EXISTING_FIELD]=!1,r.lineVO.record[this.constants.RENEWAL_CHECKBOX]=!1,r.lineVO.record[this.constants.UPGRADED_ASSET_FIELD]=null,r.lineVO.record[this.constants.UPGRADED_SUBSCRIPTION_FIELD]=null,r.lineVO.record[this.constants.NET_TOTAL_FIELD]=null,r.lineVO.record[this.constants.PRIOR_QUANTITY_FIELD]=null,r.lineVO.record[this.constants.RENEWED_ASSET_ID_FIELD]=null,r.lineVO.record[this.constants.SUBSCRIBED_ASSET_IDS_FIELD]=null),r.lineVO.key=++r.editorModel.quoteModel.quoteVO.nextKey,i&&(r.lineVO.parentGroupKey=i.groupKey),this._updateColWidths(e),r}},{key:"numberOfRateCards",value:function(e){var t=e.getRateCards();return t?t.length:0}},{key:"_hasCards",value:function(e){return e.getRateCards()&&0!=e.getRateCards().length}},{key:"_cloneCards",value:function(e,t){for(var i=e.getRateCards(),n=JSON.parse(JSON.stringify(i)),o=this.editorModel.data.developerPrefix,r=o+"OriginalUsageRateCard__c",s=o+"UsageRates__r",a=0;a<n.length;a++)if(n[a].Id&&(n[a][r]=n[a].Id,n[a].Id=null),n[a][s])for(var l=n[a][s].records,u=0;u<l.length;u++)l[u].Id=null;t.setCards(n)}},{key:"cloneSegmentedLine",value:function(e,t,i){var n=this.cloneLine(e,t,i),o=Math.random().toString(36).substr(2,9);n.lineVO.record[this.constants.SEGMENT_KEY_FIELD]=o;var r=n.lineVO.record[this.constants.SEGMENT_KEY_FIELD],s=e.lineVO.record[this.constants.SEGMENT_KEY_FIELD],a=this.quoteModel.quoteVO.multiSegmentRowTotals;a&&(a[r]=a[s]),this.segmentedLinesBySegmentKey[r]=n,this.quoteVO.multiSegmentKeys[r]=n.lineVO.dimensionType;for(var l=0,u=e.segments.length;l<u;l++){var d=this.cloneLine(e.segments[l],null,i);if(d.lineVO.record[this.constants.SEGMENT_KEY_FIELD]=r,d.lineVO.parentItemKey=n.lineVO.parentItemKey,d.segmentedLineKey=n.lineVO.key,n.segments&&n.segments.push(d),n.segmentsByLabel){var c=d.lineVO.record[this.constants.SEGMENT_LABEL_FIELD];n.segmentsByLabel[c]=d}}n.dimensionType=e.dimensionType;var h=n.dimensionType;return this.segmentedLinesByDimension[h]||this.setDimensionProperties(h),this.quoteModel.grouped&&(this._updateColWidths(e,h),this.groupVO.multiSegmentColumns[h]=e.groupModel.groupVO.multiSegmentColumns[h],this.groupVO.localizedMultiSegmentColumns[h]=e.groupModel.groupVO.localizedMultiSegmentColumns[h]),n}},{key:"_updateColWidths",value:function(e,t){this.editorModel.deviceContext.isMobile||(this.colWidth||(this.colWidth={}),this.colWidth[t]||(this.colWidth[t]=e.groupModel.colWidth[t]),this.colWidth.Standard||(this.colWidth.Standard=e.groupModel.colWidth.Standard))}},{key:"_groupHasStandardProducts",value:function(){this.hasVisibleStandardLines=!1;for(var e=0,t=this.standardLines.length;e<t;e++)if(this.standardLines[e].visible){this.hasVisibleStandardLines=!0;break}return this.hasVisibleStandardLines}},{key:"_groupHasSegmentedProducts",value:function(){Object.keys(this.hasVisibleSegmentedLines);var e=!1;for(var t in this.segmentedLinesByDimension){this.hasVisibleSegmentedLines[t]=!1;for(var i=0,n=this.segmentedLinesByDimension[t].length;i<n;i++)if(this.segmentedLinesByDimension[t][i].visible){e=this.hasVisibleSegmentedLines[t]=!0;break}}return e}},{key:"_updateStandardSubscriptionScopeEditable",value:function(e){for(var t=0,i=this.standardLines.length;t<i;t++)if(this.standardLines[t].visible&&this.standardLines[t].subscriptionScopeEditable&&this.standardLines[t]!==e)return void(this.standardSubscriptionScopeEditable=!0);this.standardSubscriptionScopeEditable=!1}},{key:"_updateSegmentedSubscriptionScopeEditable",value:function(e){for(var t=0,i=this.segmentedLines.length;t<i;t++)if(this.segmentedLines[t].visible&&this.segmentedLines[t].subscriptionScopeEditable&&this.segmentedLines[t]!==e)return void(this.segmentedSubscriptionScopeEditable=!0);this.segmentedSubscriptionScopeEditable=!1}},{key:"renumberStandardIndexes",value:function(){for(var e=0,t=this.standardLines.length;e<t;e++)this.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[this.standardLines[e].lineVO.key]=e}},{key:"renumberSegmentedIndexes",value:function(){for(var e=0,t=this.dimensions.length;e<t;e++)for(var i=this.dimensions[e],n=this.segmentedLinesByDimension[i],o=0;o<n.length;o++)for(var r=n[o].lineVO.record[this.constants.SEGMENT_KEY_FIELD],s=n[this.quoteModel.indexByGroupKey[this.groupKey].indexBySegmentKey[r]=o].segments,a=0,l=s.length;a<l;a++)this.quoteModel.indexByGroupKey[this.groupKey].indexByLineKey[s[a].lineVO.key]=a}},{key:"canDelete",value:function(){function e(e){return e.every(function(e){return!e.existing})}return e(this.standardLines)&&e(this.segmentedLines)}},{key:"_setStandardLineFieldNames",value:function(){var e=new r(this.editorModel.fieldsetMap,"lineFieldNames","lineFieldNamesTablet","lineFieldNamesPhone");return this.fieldSet=e.getByViewport(i.getViewport()),this.fieldSetName!=this.fieldSet.name&&(this.fieldSetName=this.fieldSet.name),this._getFields()}},{key:"_getFields",value:function(){return this.standardSubscriptionScopeEditable?[this.constants.SUBSCRIPTION_SCOPE_FIELD].concat(this.fieldSet.fields):this.fieldSet.fields}},{key:"_setDrawerFields",value:function(){var e=this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames,t=this.editorModel.deviceContext.isMobile;e&&!t?this.standardLineDrawerFieldNames=e:e&&t&&(this.standardLineFieldNames=this.standardLineFieldNames.concat(e))}},{key:"toggleOptional",value:function(t){var i=this;this._callChildren(function(e){c(e,["lineVO","record",i.constants.OPTIONAL_FIELD],t)})}},{key:"notifyUi",value:function(e){var t="segmentedLinesByDimension"===e[0]?a(e,this,3):"standardLines"===e[0]?a(e,this,2):null;null!==t?d(t.target,t.path):d(this,e)}},{key:"_getFieldSetNames",value:function(){for(var e=this.editorModel.fieldsetMap.groupFieldNames.slice(),t=0,i=e.length;t<i;t++)this.isMobile||this.constants.DESCRIPTION_FIELD!=e[t]&&"Name"!=e[t]||(e.splice(t,1),t--);return e}},{key:"getFieldMD",value:function(e){return this.groupMD[e]}},{key:"toggleSelected",value:function(t){this._callChildren(function(e){c(e,["selected"],t)})}},{key:"resetDiscounts",value:function(){var t=this;this._callChildren(function(e){s(e,t.constants.ADDITIONAL_DISCOUNT_FIELD,null)})}},{key:"_callChildren",value:function(t){var i=this;this.standardLines.forEach(t),this.dimensions.forEach(function(e){i.segmentedLinesByDimension[e].forEach(function(e){e.segments.forEach(t)})})}},{key:"editorModel",get:function(){return this.quoteModel.editorModel}},{key:"constants",get:function(){return this.editorModel.constants}},{key:"quoteVO",get:function(){return this.quoteModel.quoteVO}},{key:"lineType",get:function(){return this._lineType||(this._lineType=0<this.standardLines.length||0===this.dimensions.length?"Standard":this.dimensions[0]),this._lineType},set:function(e){this._lineType=e,d(this,["lineType"])}},{key:"tabs",get:function(){var t=this;return(0===this.dimensions.length?[]:0<this.standardLines.length?["Standard"].concat(this.dimensions):this.dimensions).map(function(e){return{name:e,label:t.editorModel.i18n.l(e)}})}},{key:"groupMD",get:function(){return this.editorModel.md.fieldsMap[this.constants.QUOTE_LINE_GROUP]}},{key:"standardLineColumnWidths",get:function(){return this.colWidth.Standard}},{key:"groupKey",get:function(){return this.groupVO.key}},{key:"serviceModel",get:function(){return{keys:[this.groupKey],favIds:[this.groupVO.record[this.constants.FAVORITE_ID_FIELD]]}}},{key:"flattenedRows",get:function(){var t=this.lineType===this.constants.TYPE_STANDARD?this.constants.STANDARD_LINE:this.constants.SEGMENTED_LINE,e=t===this.constants.STANDARD_LINE?this.standardLines:this.segmentedLinesByDimension[this.lineType];return[{rowType:this.constants.GROUP_HEADER,model:this}].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(e.map(function(e){return{rowType:t,model:e}})),[{rowType:this.constants.GROUP_FOOTER,model:this}])}}]),h=o)),e("GroupModel",h)}}}),System.register("quotes/models/JSQCNotifier.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function a(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),this.lineEditorComponent=e,this.editorModel=this.lineEditorComponent.editorModel,this.indexByGroupKey=this.editorModel.quoteModel.indexByGroupKey,this.fieldNameSet=this.lineEditorComponent.editorModel.fieldNameSet,this.propertyNameSet=new Set,this.propertyNameSet.add("multiSegmentRowTotals"),this.propertyNameSet.add("multiSegmentColumnTotals"),this.propertyNameSet.add("netMultiSegmentTotal"),this.propertyNameSet.add("summaries"),this.propertyNameSet.add("fieldVisibility"),this.propertyNameSet.add("fieldEditability"),this.pathNameSet=new Set(this.fieldNameSet);var t=!0,i=!1,n=void 0;try{for(var o,r=this.propertyNameSet[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this.pathNameSet.has(s)||this.pathNameSet.add(s)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}this.constants=this.editorModel.constants,this.pathsToNotify={},this.originalPathValues={},this.pathsToSet={},this.groupModels=this.editorModel.quoteModel.lineGroups,this.quoteVO=this.editorModel.quoteModel.quoteVO}e("JSQCNotifier",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(a,[{key:"notify",value:function(e,t,i,n,o){var r=void 0,s=void 0;if(this.pathNameSet.has(t.split(".").pop()))if("QuoteModel"==e){if(this.notifyPath("editorModel.quoteModel.quoteVO."+t,i,o,e),"multiSegmentRowTotals"==t){if(!i)return;for(var a=0,l=this.groupModels.length;a<l;a++)for(var u=this.groupModels[a].dimensions,d=0,c=u.length;d<c;d++)for(var h=0,p=this.groupModels[a].segmentedLinesByDimension[u[d]].length;h<p;h++){var f=this.groupModels[a].segmentedLinesByDimension[u[d]][h].lineVO.record[this.constants.SEGMENT_KEY_FIELD];this.notifyPath("groupModels."+a+".segmentedLinesByDimension."+u[d]+"."+h+".total",i[f],o,e)}}if(n.grouped)return;var g=this.indexByGroupKey[this.groupModels[0].groupVO.key].index;this.notifySpecificPath(g,t,n,i,o,e)}else if("QuoteLineGroupModel"==e)null!=this.indexByGroupKey[n.key]&&null!=this.indexByGroupKey[n.key].index&&(r=this.indexByGroupKey[n.key].index,this.notifyPath("groupModels."+r+".groupVO."+t,i,o,e),this.notifySpecificPath(r,t,n,i,o,e));else if("QuoteLineModel"==e)if(r=this.indexByGroupKey[n.parentGroupKey].index,s=this.indexByGroupKey[n.parentGroupKey].indexByLineKey[n.key],n.record[this.constants.SEGMENT_KEY_FIELD]){var y=n.parentQuote.multiSegmentKeys[n.record[this.constants.SEGMENT_KEY_FIELD]],v=this.indexByGroupKey[n.parentGroupKey].indexBySegmentKey[n.record[this.constants.SEGMENT_KEY_FIELD]];this.notifyPath("groupModels."+r+".segmentedLinesByDimension."+y+"."+v+".segments."+s+".lineVO."+t,i,o,e),t=="record."+[this.constants.NET_TOTAL_FIELD]&&this.notifyPath("groupModels."+r+".segmentedLinesByDimension."+y+"."+v+"."+n.record[this.constants.SEGMENT_LABEL_FIELD].replace(/\W/g,""),i,o,e)}else this.notifyPath("groupModels."+r+".standardLines."+s+".lineVO."+t,i,o,e)}},{key:"notifySpecificPath",value:function(e,t,i,n,o,r){if("multiSegmentColumnTotals"==t||"netMultiSegmentTotal"==t||"summaries"==t)if("summaries"!=t){if(n)for(var s=i.localizedMultiSegmentColumns?Object.keys(i.localizedMultiSegmentColumns):Object.keys(i.multiSegmentColumnTotals),a=0,l=s.length;a<l;a++){var u="netMultiSegmentTotal"==t?i.netMultiSegmentTotal[s[a]]:i.multiSegmentColumnTotals[s[a]];if("netMultiSegmentTotal"==t)this.set("groupModels."+e+".netMultiSegmentTotal."+s[a],n[s[a]],o,r);else for(var d=Object.keys(u),c=0,h=d.length;c<h;c++)this.set("groupModels."+e+".multiSegmentColumnTotals."+s[a]+"."+d[c],n[s[a]][d[c]],o,r)}}else this.set("groupModels."+e+".summaries",n,o,r)}},{key:"notifyPath",value:function(e,t,i,n){this.originalPathValues.hasOwnProperty(e)||(this.originalPathValues[e]=i),this.pathsToNotify[e]={value:t,root:n}}},{key:"set",value:function(e,t,i,n){this.originalPathValues.hasOwnProperty(e)||(this.originalPathValues[e]=i),this.pathsToSet[e]={value:t,root:n}}}]),i=a)),e("JSQCNotifier",i)}}}),System.register("quotes/models/LineModel.js",[],function(e,t){var o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.lineVO=e,this.groupModel=t,this.selected=!1,this.lineItemDrawerIconClass=this._getLineItemDrawerIconClass(),this.expandedIconClass=this._getExpansionClass(),this.visible=this.isVisibleInLineEditor(),this.hasParent=this.hasParentLine(),this.setItemClassMap(),null==this.lineVO.record[this.constants.PRICING_METHOD_FIELD]&&(this.lineVO.record[this.constants.PRICING_METHOD_FIELD]="List")}e("LineModel",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"isDiscountScheduleIdExcluded",value:function(e){return this.editorModel.data.excludedDiscountScheduleIds.hasOwnProperty(e)}},{key:"getFieldMD",value:function(e){return this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName][e]}},{key:"getField",value:function(e){return this.lineVO.record[e]}},{key:"_getExpansionClass",value:function(){return this.segmented?this.lineVO.expanded?"sf-icon-down":"sf-icon-right":""}},{key:"_hasStandardLineItemDrawer",value:function(){return this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames&&0<this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames.length&&!this.editorModel.deviceContext.isMobile&&!this.segmented}},{key:"_getLineItemDrawerIconClass",value:function(){return this.segmented||!this.hasStandardLineItemDrawer?"":this.lineVO.expanded?"sf-icon-chevrondown":"sf-icon-chevronright"}},{key:"isEditable",value:function(e){var t=this.getFieldMD(e);return!!t&&(this.lineVO.fieldEditability&&null!=this.lineVO.fieldEditability[e]?this.lineVO.fieldEditability[e]:("richtextarea"!==t.extraTypeInfo||!this.editorModel.deviceContext.isMobile)&&(t.name==this.constants.QUANTITY_FIELD||t.name==this.constants.ADDITIONAL_QUANTITY_FIELD?t.updateable&&this.quantityEditable:t.name==this.constants.LIST_PRICE_FIELD?t.updateable&&this.listPriceEditable:t.name==this.constants.ADDITIONAL_DISCOUNT_FIELD?this.discountable&&this.discountEditable:t.name==this.constants.PARTNER_DISCOUNT_FIELD?!this.nonPartnerDiscountable&&!this.partnerDiscountEditable:t.name==this.constants.DISTRIBUTOR_DISCOUNT_FIELD?this.discountEditable:t.name==this.constants.UPLIFT_FIELD?t.updateable&&this.lineVO.upliftable:t.name==this.constants.UNIT_COST_FIELD?t.updateable&&this.unitCostEditable:t.name==this.constants.CUSTOMER_PRICE_FIELD?t.updateable&&this.pricingMethodCustom:t.name==this.constants.PRICING_METHOD_FIELD?t.updateable&&!this.pricingMethodDisabled:t.name==this.constants.MARKUP_FIELD?!this.bundled&&this.pricingMethodCost&&this.discountEditable:t.name!=this.constants.NET_PRICE_FIELD&&t.name!=this.constants.PARTNER_PRICE_FIELD&&(t.name==this.constants.DESCRIPTION_FIELD?!this.descriptionLocked:t.name!=this.constants.PACKAGE_PRODUCT_CODE_FIELD&&t.name!=this.constants.PRORATED_LIST_PRICE_FIELD&&t.name!=this.constants.REGULAR_PRICE_FIELD&&(t.name==this.constants.START_DATE_FIELD||t.name==this.constants.END_DATE_FIELD?this.subscription&&!this.isMDQ:t.name===this.constants.SUBSCRIPTION_SCOPE_FIELD?t.updateable&&this.subscriptionScopeEditable:!!t&&t.updateable))))}},{key:"isFieldRendered",value:function(e,t){if(this.lineVO.fieldVisibility&&null!=this.lineVO.fieldVisibility[e])return this.lineVO.fieldVisibility[e];var i=this.getFieldMD(e);return i&&i.name==this.constants.SUBSCRIPTION_TERM_FIELD?this.subscription:!i||"richtextarea"!==i.extraTypeInfo||!t||this.lineVO.record[e]&&t}},{key:"isVisibleInLineEditor",value:function(){var e=null==this.lineVO.componentVisibility||""==this.lineVO.componentVisibility||"Always"==this.lineVO.componentVisibility||"Editor Only"==this.lineVO.componentVisibility;return(!e||null==this.renewedAssetId||!this.editorModel.data.settings.renewedAssetsHiddenWhenEditing)&&e}},{key:"getRateCards",value:function(){return this.lineVO.rateCards}},{key:"setCards",value:function(e){this.lineVO.rateCards=e}},{key:"hasParentLine",value:function(){return null!==this.lineVO.parentItemKey}},{key:"addToSegmentsArray",value:function(e){this.segments||(this.segments=[]),this.segments.push(e)}},{key:"removeFromSegmentsArray",value:function(e){this.segments.splice(this.segments.indexOf(e),1),0===this.segments.length&&delete this.segments}},{key:"addToSegmentsByLabel",value:function(e,t){this.segmentsByLabel||(this.segmentsByLabel={}),this.segmentsByLabel[e]=t}},{key:"removeFromSegmentsByLabel",value:function(e){this.segmentsByLabel[e]&&delete this.segmentsByLabel[e],0==Object.keys(this.segmentsByLabel).length&&delete this.segmentsByLabel}},{key:"setLineTypeClass",value:function(){return this.bundle?"parent-line":this.component?"component":"standalone"}},{key:"setItemClassMap",value:function(){var e=this.editorModel.deviceContext.isMobile,t={};for(var i in this.lineVO.record)this.isFieldRendered(i,e)||(t[i]=e?"hiddenInMobile":"hiddenInDesktop"),this.segmented&&(t[i]?t[i]+=" mdqSummaryRow":t[i]="mdqSummaryRow"),t.total="hiddenInMobile";this.itemClassMap=t}},{key:"editorModel",get:function(){return this.quoteModel.editorModel}},{key:"quoteModel",get:function(){return this.groupModel.quoteModel}},{key:"constants",get:function(){return this.editorModel.constants}},{key:"fieldNames",get:function(){return this.constants}},{key:"component",get:function(){return null!=this.lineVO.record[this.constants.OPTION_LEVEL_FIELD]}},{key:"subscription",get:function(){return null!=this.lineVO.record[this.constants.SUBSCRIPTION_PRICING_FIELD]}},{key:"isMDQ",get:function(){return null!=this.lineVO.record[this.constants.SEGMENT_LABEL_FIELD]}},{key:"dynamicSubscription",get:function(){return"Percent Of Total"==this.lineVO.record[this.constants.SUBSCRIPTION_PRICING_FIELD]}},{key:"dynamic",get:function(){return"Percent Of Total"==this.lineVO.record[this.constants.SUBSCRIPTION_PRICING_FIELD]||"Percent Of Total"==this.lineVO.record[this.constants.PRICING_METHOD_FIELD]}},{key:"isBundle",get:function(){return this.bundle&&this.quoteModel.linesByParentItemKey[this.lineVO.key]}},{key:"subscriptionScopeEditable",get:function(){return this.dynamic&&null==this.lineVO.record[this.constants.COMPONENT_SUBSCRIPTION_SCOPE_FIELD]&&null==this.lineVO.record[this.constants.SUBSCRIBED_ASSET_IDS_FIELD]}},{key:"rootPackage",get:function(){return(this.bundle||this.lineVO.productPullIns&&(this.lineVO.productPullIns.hasConfiguration||this.lineVO.productPullIns.hasConfigurationAttributes))&&!this.component}},{key:"legacySupport",get:function(){return!(1==this.lineVO.record[this.constants.RENEWAL_CHECKBOX]&&1!=this.lineVO.record[this.constants.EXISTING_FIELD]&&null==this.lineVO.record[this.constants.PRIOR_QUANTITY_FIELD])||this.editorModel.data.settings.renewalQuotesWithoutAssetsAllowed}},{key:"quantityEditable",get:function(){return(null==this.lineVO.record[this.constants.BUNDLED_QUANTITY_FIELD]||!this.component)&&this.legacySupport&&this.lineVO.productQuantityEditable||1==this.lineVO.quantityEditable}},{key:"costEditable",get:function(){return 1==this.lineVO.record[this.constants.COST_EDITABLE_FIELD]}},{key:"unitCostEditable",get:function(){return this.costEditable&&!this.bundled&&!this.dynamic}},{key:"pricingMethodList",get:function(){return"List"==this.lineVO.record[this.constants.PRICING_METHOD_FIELD]}},{key:"pricingMethodCustom",get:function(){return"Custom"==this.lineVO.record[this.constants.PRICING_METHOD_FIELD]}},{key:"pricingMethodCost",get:function(){return"Cost"==this.lineVO.record[this.constants.PRICING_METHOD_FIELD]}},{key:"pricingMethodDisabled",get:function(){return this.dynamicSubscription||this.bundled||!this.lineVO.record[this.constants.PRICING_METHOD_EDITABLE_FIELD]}},{key:"bundled",get:function(){return 1==this.lineVO.record[this.constants.BUNDLED_FIELD]}},{key:"bundle",get:function(){return 1==this.lineVO.record[this.constants.BUNDLE_FIELD]}},{key:"nonDiscountable",get:function(){return 1==this.lineVO.record[this.constants.NON_DISCOUNTABLE_FIELD]}},{key:"nonPartnerDiscountable",get:function(){return 1==this.lineVO.record[this.constants.NON_PARTNER_DISCOUNTABLE_FIELD]}},{key:"partnerDiscountEditable",get:function(){return this.quoteModel.isAmendmentOrChangeQuote||this.existing}},{key:"componentDiscountedByPackage",get:function(){return 1==this.lineVO.record[this.constants.COMPONENT_DISCOUNTED_BY_PACKAGE_FIELD]}},{key:"discountable",get:function(){return!(this.bundled||this.nonDiscountable||this.pricingMethodCustom||this.componentDiscountedByPackage)}},{key:"discountEditable",get:function(){return!this.quoteModel.isAmendmentOrChangeQuote||!this.existing}},{key:"removable",get:function(){return!this.component&&(!this.quoteModel.isAmendment||this.quoteModel.isAmendment&&!this.existing)}},{key:"configurable",get:function(){return this.rootPackage&&!this.lineVO.reconfigurationDisabled&&"Disabled"!=this.lineVO.configurationType&&(null==this.lineVO.configurationEvent||"Always"==this.lineVO.configurationEvent||"Edit"==this.lineVO.configurationEvent)}},{key:"listPriceEditable",get:function(){return this.lineVO.record[this.constants.PRICE_EDITABLE_FIELD]&&!this.bundled&&!this.dynamicSubscription&&this.pricingMethodList}},{key:"segmented",get:function(){return null!=this.lineVO.record[this.constants.SEGMENT_KEY_FIELD]}},{key:"favorite",get:function(){return!this.component&&null!=this.lineVO.record[this.constants.FAVORITE_ID_FIELD]}},{key:"existing",get:function(){return this.lineVO.record[this.constants.EXISTING_FIELD]}},{key:"descriptionLocked",get:function(){return this.lineVO.descriptionLocked}},{key:"hasStandardLineItemDrawer",get:function(){return this._hasStandardLineItemDrawer()}},{key:"asset",get:function(){return null!=this.lineVO.record[this.constants.RENEWED_ASSET_ID_FIELD]}},{key:"renewal",get:function(){return this.lineVO.record[this.constants.RENEWAL_CHECKBOX]}},{key:"hasSubscribedAssetIds",get:function(){return null!=this.lineVO.record[this.constants.SUBSCRIBED_ASSET_IDS_FIELD]}},{key:"isAsset",get:function(){return null!=this.lineVO.record[this.constants.UPGRADED_ASSET_FIELD]}},{key:"isDeltaQty",get:function(){return!this.existing||this.existing&&!this.renewal&&(this.lineVO.record[this.constants.UPGRADED_ASSET_FIELD]||this.asset)}},{key:"standardLineFieldNames",get:function(){return this.groupModel.standardLineFieldNames}},{key:"standardLineDrawerFieldNames",get:function(){return this.groupModel.standardLineDrawerFieldNames}},{key:"standardLineColumnWidths",get:function(){return this.editorModel.layout.colWidths[this.groupModel.groupKey].Standard}},{key:"serviceModel",get:function(){var e=[];if(this.segments)for(var t=0,i=this.segments.length;t<i;t++)e.push(this.segments[t].lineVO.key);else e.push(this.lineVO.key);return{keys:e,segmentKey:this.getField(this.constants.SEGMENT_KEY_FIELD),segmented:this.segmented,updateCustomSegments:!1,favIds:[this.getField(this.constants.FAVORITE_ID_FIELD)],scheduleId:this.getField(this.constants.DISCOUNT_SCHEDULE_FIELD)}}}],[{key:"recordPath",get:function(){return"lineModel.lineVO.record"}}]),o=i)),e("LineModel",o)}}}),System.register("quotes/models/MDQSegmentHelper.js",["quotes/models/LineModel.js"],function(e,t){var o;return{setters:[function(e){e.LineModel}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.MONTHLY_DIM="Month",this.YEARLY_DIM="Year",this.QUARTERLY_DIM="Quarter",this.editorModel=e,this.groupModelsByKey=t,this.prefix=e.developerPrefix,this.START_DATE_FIELD=this.prefix+"StartDate__c",this.END_DATE_FIELD=this.prefix+"EndDate__c",this.SUBSCRIPTION_TERM_FIELD=this.prefix+"SubscriptionTerm__c",this.LINES_GROUPED_FIELD=this.prefix+"LineItemsGrouped__c",this.SEGMENT_KEY_FIELD=this.prefix+"SegmentKey__c",this.SEGMENT_INDEX_FIELD=this.prefix+"SegmentIndex__c",this.SEGMENT_LABEL_FIELD=this.prefix+"SegmentLabel__c",this.FIRST_SEGMENT_END_DATE_FIELD=this.prefix+"FirstSegmentTermEndDate__c",this.TYPE_FIELD=this.prefix+"Type__c",this.EXISTING_FIELD=this.prefix+"Existing__c",this._segmentsChanged=!1}e("MDQSegmentHelper",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"updateSegments",value:function(){var t=this.editorModel.quote;return this._hasMultiSegmentLines(t)&&(t.grouped||t.record[this.LINES_GROUPED_FIELD]?t.lineItemGroups.forEach(function(e){this._adjustSegments(t,e)},this):this._adjustSegments(t,null)),this._segmentsChanged}},{key:"_hasMultiSegmentLines",value:function(e){for(var t=e.lineItems.length,i=0;i<t;i++)if(null!=e.lineItems[i].record[this.SEGMENT_KEY_FIELD])return!0;return!1}},{key:"_adjustSegments",value:function(e,t){var i=this._calculateSubscriptionTerm(e,t),n=t?e.lineItems.filter(function(e){return e.parentGroupKey===t.key}):e.lineItems;this._calculateSegmentDeltasAndModifySegments(e,t,n,i,this.YEARLY_DIM),this._calculateSegmentDeltasAndModifySegments(e,t,n,i,this.MONTHLY_DIM),this._calculateSegmentDeltasAndModifySegments(e,t,n,i,this.QUARTERLY_DIM)}},{key:"_calculateSubscriptionTerm",value:function(e,t){var i=t&&t.record[this.START_DATE_FIELD]||e.record[this.START_DATE_FIELD],n=t&&t.record[this.END_DATE_FIELD]||e.record[this.END_DATE_FIELD],o=t&&null!=t.record[this.SUBSCRIPTION_TERM_FIELD]?t.record[this.SUBSCRIPTION_TERM_FIELD]:e.record[this.SUBSCRIPTION_TERM_FIELD],r=i?new Date(i):null,s=n?new Date(n):null,a=e.record[this.FIRST_SEGMENT_END_DATE_FIELD],l=a?new Date(a):null;if(l){r=r||new Date,s||(s=new Date(r.getTime()),this.editorModel.settings.subscriptionTermUnitIsDay?s.setUTCDate(s.getUTCDate()+o-1):(SB.addMonths(s,o),s.setUTCDate(s.getUTCDate()-1)));var u=new Date(l.getTime());return u.setUTCDate(u.getUTCDate()+1),s.setDate(s.getDate()+1),this.editorModel.settings.subscriptionTermUnitIsDay?SB.daysBetween(u,s):SB.monthsBetweenRoundPartialUp(u,s)}return r&&s?(s.setDate(s.getDate()+1),this.editorModel.settings.subscriptionTermUnitIsDay?SB.daysBetween(r,s):SB.monthsBetweenRoundPartialUp(r,s)):o}},{key:"_calculateSegmentDeltasAndModifySegments",value:function(e,t,i,n,o){var r=this._calculateSegmentDeltas(e,i,n,o);0!=r.size&&this._modifySegmentsBasedOnDelta(e,t,r,o)}},{key:"_calculateSegmentDeltas",value:function(s,a,l,u){var d=this.editorModel.settings.subscriptionTermUnitIsDay;l=null==l?d?365:12:l;var e=function(){for(var e=new Map,t=a.length,i=0;i<t;i++){var n=a[i];if(n.dimensionType==u){var o=n.record[this.SEGMENT_KEY_FIELD],r=e.get(o)||0;e.set(o,r+1)}}return e}.bind(this)(),i=function(){var e=0,t=s.record[this.FIRST_SEGMENT_END_DATE_FIELD],i=t?new Date(t):null;if(i){e=1;var n=new Date(i.getTime());n.setUTCDate(n.getUTCDate()+1)}if(d){var o=n||new Date(this.editorModel.quote.record[this.START_DATE_FIELD]),r=this.editorModel.quote.record[this.END_DATE_FIELD]?new Date(this.editorModel.quote.record[this.END_DATE_FIELD]):new Date(o.setUTCDate(o.getUTCDate()+l));l=SB.monthsBetween(o,r),o.setUTCMonth(o.getUTCMonth()+l),o.setUTCDate(o.getUTCDate()-1),o<r&&(l+=1)}switch(u){case this.YEARLY_DIM:e+=Math.ceil(l/12);break;case this.QUARTERLY_DIM:e+=Math.ceil(l/3);break;case this.MONTHLY_DIM:e+=l}return e}.bind(this)(),n=new Map;return e.forEach(function(e,t){n.set(t,i-e)}),n}},{key:"_modifySegmentsBasedOnDelta",value:function(f,e,t,g){t.forEach(function(e,t){var i=this._getLastSegmentFromQuote(f,t,g),n=0===e,o="Amendment"===f.record[this.TYPE_FIELD]&&i.record[this.EXISTING_FIELD],r=i.record[this.START_DATE_FIELD],s=i.record[this.END_DATE_FIELD],a=r?new Date(r):null,l=s?new Date(s):null;if(!n&&!o)if(0<e&&a<=l){this._segmentsChanged=!0;for(var u=1;u<=e;u++){var d=this._createNewSegment(f,i,u);f.lineItems.push(d),this.groupModelsByKey&&this.groupModelsByKey[d.parentGroupKey].processQuoteLines(d)}}else if(e<0){this._segmentsChanged=!0;for(var c=0;e<c;c--){var h=this._getLastSegmentFromQuote(f,t,g);if(this._removeSegment(f,h),this.groupModelsByKey){var p=this.groupModelsByKey[h.parentGroupKey].segmentedLinesBySegmentKey[t];p.segments.splice(p.segments.length-1,1)}}}},this)}},{key:"_getLastSegmentFromQuote",value:function(e,i,n){var o=null,r=null;return e.lineItems.forEach(function(e){if(e.record[this.SEGMENT_KEY_FIELD]===i&&e.dimensionType===n){var t=e.record[this.SEGMENT_INDEX_FIELD];null!=t&&(null==r||r<t)&&(r=t,o=e)}},this),o}},{key:"_createNewSegment",value:function(e,t,i){var n=this,o=JSON.parse(JSON.stringify(t));o.key=++e.nextKey,o.record.Id=null,o.record[this.SEGMENT_KEY_FIELD]=t.record[this.SEGMENT_KEY_FIELD],o.record[this.SEGMENT_INDEX_FIELD]=t.record[this.SEGMENT_INDEX_FIELD]+i;var r=o.record[this.SEGMENT_INDEX_FIELD]<10?"  ":" ";return o.record[this.SEGMENT_LABEL_FIELD]=t.dimensionType+r+o.record[this.SEGMENT_INDEX_FIELD],o.rateCards&&0<o.rateCards.length&&o.rateCards.forEach(function(e){e.Id=null,e[n.prefix+"QuoteLine__c"]=null;var t=e[n.prefix+"UsageRates__r"];t&&0<t.records.length&&t.records.forEach(function(e){e.Id=null,e[n.prefix+"UsageRateCard__c"]=null})}),o}},{key:"_removeSegment",value:function(e,t){for(var i=e.lineItems.length,n=0;n<i;n++){var o=e.lineItems[n];if(o.key===t.key)return e.lineItems=e.lineItems.slice(0,n).concat(e.lineItems.slice(n+1,i)),void(e.deletedLineIds&&o.record&&o.record.Id&&e.deletedLineIds.push(o.record.Id))}}}]),o=i)),e("MDQSegmentHelper",o)}}}),System.register("quotes/models/QuoteMessenger.js",[],function(e,t){var o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.editorModel=e,this.targetRecord=t}e("QuoteMessenger",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"getRequest",value:function(){return{target:this.targetRecord,quote:this.editorModel.quoteModel.quoteVO.record,lines:[],actions:[]}}},{key:"getResponse",value:function(e){if(e)switch(e.actions[0].toLowerCase().replace(" ","")){case"save":return{lines:e.lines,action:"save"};case"quicksave":return{lines:e.lines,action:"quicksave"};case"reload":return{lines:e.lines,action:"reload"};case"none":default:return{lines:e.lines,action:"none"}}}}]),o=i)),e("QuoteMessenger",o)}}}),System.register("quotes/models/QuoteModel.js",["quotes/models/EditorModel.js","quotes/models/GroupModel.js","quotes/models/LineModel.js","quotes/models/UiNotifier.js"],function(e,t){var i,_,S,k,C,o;return{setters:[function(e){i=e.getSubchange},function(e){_=e.GroupModel},function(e){e.LineModel},function(e){S=e.register,k=e.notify}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,t){var i=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,b),this.quoteVO=e,this.editorModel=t,this.grouped=e.record[this.constants.GROUP_LINE_ITEMS_FIELD],this.groupsByKey={},this.lineModelsByKey={},this.indexByGroupKey={},this.lineGroups=[],this.linesByParentItemKey={},this.standardLinesByParentItemKey={},this.segmentedLinesByParentItemKey={},this.selectedLinesByKey={},this.allOptional=!0,this.isPrimary=this.quoteVO.record[this.constants.PRIMARY_FIELD],this.isRenewal=this.quoteVO.record[this.constants.TYPE_FIELD]===C.RENEWAL,this.isAmendment=this.quoteVO.record[this.constants.TYPE_FIELD]===C.AMENDMENT,this.isChangeQuote=this.quoteVO.record[this.constants.TYPE_FIELD]===C.CHANGE_ORDER,this.isAmendmentOrChangeQuote=this.isAmendment||this.isChangeQuote,this.grouped&&0==this.quoteVO.lineItemGroups.length){var n={key:++this.quoteVO.nextKey,record:{Name:"Group1"},multiSegmentColumns:{},localizedMultiSegmentColumns:{}},o=new _(n,this);this.quoteVO.lineItemGroups.push(n),this.groupsByKey[o.groupVO.key]=o,this.indexByGroupKey[o.groupVO.key]={index:Object.keys(this.indexByGroupKey).length,indexByLineKey:{},indexBySegmentKey:{}};for(var r=this.quoteVO.lineItems,s=0;s<r.length;s++){r[s].parentGroupKey=o.groupVO.key}}for(var a=this.grouped?this.quoteVO.lineItemGroups:[{key:null,record:{}}],l=0,u=a.length;l<u;l++){var d=new _(a[l],this);this.lineGroups.push(d),this.groupsByKey[d.groupVO.key]=d,this.indexByGroupKey[d.groupVO.key]={index:l,indexByLineKey:{},indexBySegmentKey:{}}}var c=!0,h=!1,p=void 0;try{for(var f,g=this.quoteVO.lineItems[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var y=f.value;y.record[this.constants.OPTIONAL_FIELD]||(this.allOptional=!1),this.groupsByKey[y.parentGroupKey].processQuoteLines(y)}}catch(e){h=!0,p=e}finally{try{!c&&g.return&&g.return()}finally{if(h)throw p}}function v(){m&&setTimeout(function(){k(i,["flattenedRows"]),m=!0},0),m=!1}var m=!0;S(this,function(e){"lineGroups"===e[0]&&v()}),this.lineGroups.forEach(function(e){S(e,function(e){"flattenedRows"===e[0]&&v()})})}C={RENEWAL:"Renewal",AMENDMENT:"Amendment",CHANGE_ORDER:"Re-Quote"},e("QuoteModel",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(b,[{key:"getFieldMD",value:function(e){return this.quoteMD[e]}},{key:"renumberIndexes",value:function(e){for(var t=0,i=this.lineGroups.length;t<i;t++){var n=this.lineGroups[t].groupKey;this.indexByGroupKey[n].index=t,e&&(this.lineGroups[t].renumberStandardIndexes(),this.lineGroups[t].renumberSegmentedIndexes())}}},{key:"renumber",value:function(){for(var e=1,t=3e3,i=0,n=this.lineGroups.length;i<n;i++){for(var o=this.lineGroups[i],r=0,s=o.dimensions.length;r<s;r++)for(var a=o.dimensions[r],l=o.segmentedLinesByDimension[a],u=0,d=l.length;u<d;u++){var c=l[u].segments;if(l[u].visible){this.lineGroups[i].segmentedLinesByDimension[a][u].lineVO.record[this.constants.NUMBER_FIELD]=e;for(var h=0,p=c.length;h<p;h++)c[h].lineVO.record[this.constants.NUMBER_FIELD]=e;e++}else{l[u].lineVO.record[this.constants.NUMBER_FIELD]=t;for(var f=0,g=c.length;f<g;f++)c[f].lineVO.record[this.constants.NUMBER_FIELD]=t;t++}}for(var y=0,v=o.standardLines.length;y<v;y++)o.standardLines[y].visible?(this.lineGroups[i].standardLines[y].lineVO.record[this.constants.NUMBER_FIELD]=e,e++):(o.standardLines[y].lineVO.record[this.constants.NUMBER_FIELD]=t,t++)}}},{key:"toggleOptional",value:function(t,e){this._callChildren(e,function(e){e.toggleOptional(t)})}},{key:"resetDiscounts",value:function(e){this._callChildren(e,function(e){e.resetDiscounts()})}},{key:"_callChildren",value:function(e,t){e?t(this.groupsByKey[e]):this.lineGroups.forEach(t)}},{key:"notifyUi",value:function(e){var t="lineGroups"===e[0]?i(e,this,2):null;null!==t?t.target.notifyUi(t.path):k(this,e)}},{key:"constants",get:function(){return this.editorModel.constants}},{key:"quoteMD",get:function(){return this.editorModel.md.fieldsMap[this.editorModel.data.quoteObjectName]}},{key:"flattenedRows",get:function(){var e;return(e=[]).concat.apply(e,function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(this.lineGroups.map(function(e){return e.flattenedRows})))}}]),o=b)),e("QuoteModel",o)}}}),System.register("quotes/models/SortLinesHandler.js",["quotes/models/Constants.js"],function(e,t){var i,o;return{setters:[function(e){i=e.Constants}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.constants=new i(e)}e("SortLinesHandler",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"sortLineItems",value:function(e,r){return e.sort(function(e,t){if(e.lineSortValue=e.record[r],t.lineSortValue=t.record[r],null!=e.lineSortValue&&null!=t.lineSortValue&&e.lineSortValue!=t.lineSortValue){var i=e.lineSortValue-t.lineSortValue;return i==i?i:e.lineSortValue<t.lineSortValue?-1:1}if(e.lineSortValue!=t.lineSortValue)return null==e.lineSortValue?-1:null==t.lineSortValue?1:e.record[this.constants.NUMBER_FIELD]-t.record[this.constants.NUMBER_FIELD];var n=e.record[this.constants.SEGMENT_INDEX_FIELD],o=t.record[this.constants.SEGMENT_INDEX_FIELD];return n==o?e.record[this.constants.NUMBER_FIELD]-t.record[this.constants.NUMBER_FIELD]:null==n?-1:null==o?1:n-o}.bind(this)),e}}]),o=t)),e("SortLinesHandler",o)}}}),System.register("quotes/models/UiNotifier.js",[],function(t,e){var n,r;return{setters:[],execute:function(){function e(e,t){n.has(e)||n.set(e,new Set);var i=n.get(e);return i.add(t),function(){i.delete(t)}}function o(e,t){n.has(e)&&n.get(e).forEach(function(e){e(t)})}n=new Map,t("register",e),t("notify",o),r=new Map,t("registerComponent",function(t){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"model";r.has(t)&&r.get(t)(),r.set(t,e(t[i],function(e){t.notifyPath([i].concat(e).join("."))}))}),t("setThenNotify",function(e,t,i){var n=t.length-1;t.slice(0,n).reduce(function(e,t){return e[t]},e)[t[n]]=i,o(e,t)})}}}),System.register("quotes/precaching/IdConverter.js",[],function(e,t){var i;function n(e){if(e){if(18===e.length)return e;if(15!==e.length)return null;var t=o(e.slice(0,5)),i=o(e.slice(5,10)),n=o(e.slice(10,15));return e+t+i+n}return null}function o(e){return i[function(e){return e.replace(/[^A-Z]/g,"0").replace(/[A-Z]/g,"1")}(function(e){return e.split("").reverse().join("")}(e))]}return{setters:[],execute:function(){module.exports=n,i={"00000":"A","00001":"B","00010":"C","00011":"D","00100":"E","00101":"F","00110":"G","00111":"H","01000":"I","01001":"J","01010":"K","01011":"L","01100":"M","01101":"N","01110":"O","01111":"P",1e4:"Q",10001:"R",10010:"S",10011:"T",10100:"U",10101:"V",10110:"W",10111:"X",11e3:"Y",11001:"Z",11010:"0",11011:"1",11100:"2",11101:"3",11110:"4",11111:"5"}}}}),System.register("quotes/precaching/JSQCPrecacheWorker.js",[],function(e,t){return{setters:[],execute:function(){self.addEventListener("message",function(e){(new Date).getTime();importScripts("//cdnjs.cloudflare.com/ajax/libs/jsforce/1.7.0/jsforce.min.js"),importScripts("https://www.promisejs.org/polyfills/promise-7.0.4.min.js");var t=new jsforce.Connection({sessionId:e.data.sessionId,instanceUrl:e.data.siteUrl});t.oik=e.data.oik;var i=function(s){function n(e,n,o,r){return new Promise(function(t,i){s.load(e,n,o||"",r).then(function(e){t(e)},function(e){i(e.message||e)})})}return{read:function(e,n,o){return new Promise(function(t,i){s.read(e,n,o).then(function(e){t(e)},function(e){i(e.message||e)})})},load:n,md:function(e,t,i){return n(i,"MetaDataServiceProvider.FieldMetaDataLoader",null,{fields:t})},setOptions:function(e){s.setOptions(e)}}}(require("./PrecacheRestClient.js")(t,e.data.orgUrl,e.data.siteUrl,e.data.proxyUrl)),n=e.data.precacheSequence,o=function(e){return{PriceRuleSequence:require("./PrecacheSequenceRunners/PriceRuleSequenceRunner.js"),MetadataSequence:require("./PrecacheSequenceRunners/MetadataSequenceRunner.js"),OptionSequence:require("./PrecacheSequenceRunners/OptionSequenceRunner.js"),DiscountAndAccountSequence:require("./PrecacheSequenceRunners/DiscountScheduleSequenceRunner.js"),ProductSequence:require("./PrecacheSequenceRunners/ProductSequenceRunner.js"),RelatedRecordSequence:require("./PrecacheSequenceRunners/RelatedRecordSequenceRunner.js")}[e]||null}(n);o||(self.postMessage({failure:!0,sequence:n,msg:"Unrecognized sequence"}),close());var r=function(e,t,i,n){var o=[t,i.prefix,n];switch(e){case"PriceRuleSequence":return o.concat([i.accountId]);case"MetadataSequence":return o.concat([i.referencedFieldMap]);case"DiscountAndAccountSequence":return o.concat([i.quote,i.accountId]);case"RelatedRecordSequence":return o.concat([i.quote,i.lookupFieldMap,i.referencedFieldMap]);case"ProductSequence":case"OptionSequence":return o.concat([i.quote,i.referencedFields]);default:return null}}(n,i,e.data,self.postMessage);o.apply(null,r).executeSequence().then(function(){close()})})}}}),System.register("quotes/precaching/JSQCPrecacheWorkerManager.js",["quotes/models/Constants.js"],function(e,t){var i,o;return{setters:[function(e){i=e.Constants}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=e,this.orgUrl=this.data.settings.orgUrl,this.siteUrl=this.data.settings.siteUrl,this.proxyUrl=this.data.settings.proxyUrl,this.oik=this.data.settings.oik,this.prefix=this.data.developerPrefix?"SBQQ":"",this.constants=new i(this.data.developerPrefix),this.filePath=this.siteUrl+"/resource/"+(new Date).getTime()+"/"+this.data.developerPrefix+"PrecacherUI2"}e("JSQCPrecacheWorkerManager",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"beginPrecaching",value:function(){this.sessionId=window.sb.vfSessionId,this._spoolWorkers()}},{key:"_spoolWorkers",value:function(){var e=this.data.quote.record[this.constants.ACCOUNT_ID_FIELD],o=this.data.settings,t=this.data.quote,i=this.data.settings.referencedFieldMap,n=this._createWorker(),r=this._createWorkerContext("PriceRuleSequence",new Map([["accountId",e]]));n.postMessage(r);var s=this._createWorker(),a=this._createWorkerContext("MetadataSequence",new Map([["referencedFieldMap",i]]));s.postMessage(a);var l=this._createWorker(),u=this._createWorkerContext("DiscountAndAccountSequence",new Map([["accountId",e],["quote",t]]));l.postMessage(u);var d=this._createWorker(),c={quoteLookups:o.quoteLookups||{},groupLookups:o.groupLookups||{},lineLookups:function(){var e=o.lineLookups||{},t={},i=o.developerPrefix||"";for(var n in e)n!==i+"Product__c"&&n!==i+"ProductOption__c"&&(t[n]=e[n]);return t}()},h=this._createWorkerContext("RelatedRecordSequence",new Map([["quote",t],["referencedFieldMap",i],["lookupFieldMap",c]]));d.postMessage(h);var p=this._createWorker(),f=this._createWorkerContext("ProductSequence",new Map([["quote",t],["referencedFields",o.referencedFieldMap.Product2]]));p.postMessage(f);var g=o.developerPrefix||"",y=this._createWorker(),v=this._createWorkerContext("OptionSequence",new Map([["quote",t],["referencedFields",o.referencedFieldMap[g+"ProductOption__c"]]]));y.postMessage(v)}},{key:"_createWorkerContext",value:function(e,t){var i={orgUrl:this.orgUrl,siteUrl:this.siteUrl,proxyUrl:this.proxyUrl,sessionId:this.sessionId,precacheSequence:e,prefix:this.prefix,oik:this.oik};return t&&0!=t.size&&t.forEach(function(e,t){i[t]=e}),i}},{key:"_createWorker",value:function(){var e=new Worker(this.filePath),t=this._precache;return e.addEventListener("message",function(e){e.data.successful?t(e.data.provider,e.data.uid,e.data.results):e.data.failure?console.error("Main thread received failure from precache sequence "+e.data.sequence+": "+e.data.msg):e.data.err&&console.error("Main thread received error from precache sequence "+e.data.sequence+": "+e.data.msg)}),e}},{key:"_precache",value:function(e,t,i){SB&&SB.JSQCPrecacher&&(new SB.JSQCPrecacher).precacheValue(e,t,i)}}]),o=t)),e("JSQCPrecacheWorkerManager",o)}}}),System.register("quotes/precaching/PrecacheRestClient.js",[],function(e,t){function i(e,t,i,n){var a=function(o,r,s,a){function i(e,t,i){e+=void 0===o.oik?"":"&oik="+o.oik;var n={url:""!=s?s+"/services/apexrest"+e:a,method:t,headers:{"SalesforceProxy-Endpoint":r+"/services/apexrest"+e,"Content-Type":"application/json"}};return i&&(n.body=i),o.request(n)}return{get:function(e){return i(e,"GET")},patch:function(e,t){return i(e,"PATCH",t)}}}(e,t,i,n);function l(e){var t="/ServiceRouter";return e?"/"+e+t:t}function u(t){try{return JSON.parse(t)}catch(e){return t}}return{read:function(e,n,o){var r=l(e);return new Promise(function(t,i){a.get(r+"?reader="+n+"&uid="+o).then(function(e){t(u(e))},function(e){i(e)})})},load:function(e,n,o,t){var r=l(e),s=JSON.stringify({context:JSON.stringify(t)});return new Promise(function(t,i){a.patch(r+"?loader="+n+"&uid="+o,s).then(function(e){t(u(e))},function(e){i(e)})})},setOptions:function(e){}}}return{setters:[],execute:function(){module.exports=i}}}),System.register("quotes/sb-le-custom-action-services/LECustomActionServices.js",["common/core/Navigator.js","common/aggregate/quote-line-aggregator/QuoteLineAggregator.js","quotes/models/GroupModel.js","common/data/client/ConnectionClient.js","quotes/models/JSQCNotifier.js","quotes/models/SortLinesHandler.js","quotes/models/QuoteMessenger.js","common/data/format/JsonFormatter.js","quotes/models/MDQSegmentHelper.js","common/relationship/RelationshipFieldManager.js","common/core/sb-page-container/PageContainer.js","common/core/AppContext.js","quotes/models/AssetQuantityValidator.js"],function(t,e){var i,s,d,l,u,o,r,c,h,a,p,f,g;function y(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}return{setters:[function(e){i=e.Navigator},function(e){s=e.QuoteLineAggregator},function(e){d=e.GroupModel},function(e){l=e.ConnectionClient},function(e){u=e.JSQCNotifier},function(e){o=e.SortLinesHandler},function(e){r=e.QuoteMessenger},function(e){c=e.JsonFormatter},function(e){h=e.MDQSegmentHelper},function(e){a=e.RelationshipFieldManager},function(e){p=e.PageContainer},function(e){e.AppContext},function(e){f=e.AssetQuantityValidator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LECustomActionServices",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-custom-action-services",this.properties={editorModel:Object,eventDetail:Object,response:{type:Object,notify:!0},error:{notify:!0}}}},{key:"_executeServiceAction",value:function(e,t,i){var n=t||(this.eventDetail&&this.eventDetail.model?this.eventDetail.model.serviceModel:null);this.editorModel&&(this._usesClientCalculator()&&this.sortLines(this.editorModel.quoteModel.quoteVO,!1),this.editorModel.quoteModel.quoteVO.lineItems=this._reorderLineItems(),this._reorderGroups());var o=this.editorModel?this.editorModel.quoteModel.quoteVO:this.data.quote,r=this.editorModel?this.editorModel.data.settings.referencedFieldMap:this.data.settings.referencedFieldMap,s=i&&n?i(o,n):o.lineItems,a=o.lineItems;o.partialVO=a.length!=s.length,o.lineItems=s;var l=this.data.settings.largeQuoteThreshold,u=l&&o.lineItems.length>l;if(("saveService"===e||"quickSaveService"===e)&&u&&SB&&SB.QuoteDAO)return o.lineItems=a,o.partialVO=!1,void this._saveLargeQuote(o,e);n?(this.$[e].model=void 0,n.quote=new c(!0,!1,!1,r).format(o),this.$[e].model=n):(this.$[e].model=void 0,this.$[e].model=new c(!0,!1,!1,r).format(o)),o.lineItems=a,o.partialVO=!1}},{key:"_executeQuotelessServiceAction",value:function(e,t){var i=t||(this.eventDetail&&this.eventDetail.model?this.eventDetail.model.serviceModel:null);i?(this.$[e].model=void 0,this.$[e].model=i):console.log("no service model means nothing to do")}},{key:"_saveLargeQuote",value:function(o,r){var s=this.app.org.prefix;new l(s).getConnection().then(function(n){new SB.QuoteDAO(s,n,this.data.settings).saveQuote(o).then(function(){var i=this;n.sobject=function(){var t=this;return{upsertBulk:function(e){return t._bulkService("oppSyncUpserter",e)},insertBulk:function(e){return t._bulkService("oppSyncInserter",e)},deleteBulk:function(e){return t._bulkService("oppSyncDeleter",e)}}}.bind(this);var e=new SB.QuoteOpportunitySynchronizer(this.data.settings,n,s),t=[];return t.push(e.updateOpportunityProducts(o)),t.push(this._checkIfRecordJobFailed(n,s)),Promise.all(t).then(function(e){var t=[];return t.push(i._saveRateCardsAttachedToQuote(o)),t.push(Promise.resolve(e)),Promise.all(t)}).then(function(e){if("Failed"===e[1][1])return i._SetRecordJobCompleted(n,s).then(i._handleLargeQuoteSaveResponse(r));i._handleLargeQuoteSaveResponse(r)})}.bind(this)).catch(function(e){this.error=this.$[r].createError(e),this.showSpinner=!1}.bind(this))}.bind(this))}},{key:"_saveRateCardsAttachedToQuote",value:function(e){var n=[],i=this.app.org.prefix?this.app.org.prefix+"__":"";e.lineItems.forEach(function(t){t.rateCards&&0<t.rateCards.length&&(t.rateCards.forEach(function(e){e[i+"QuoteLine__c"]=t.record.Id}),n=n.concat(t.rateCards))});var o=[],r=this.$.rateCardSaver;return function t(i){return i>=n.length?Promise.resolve(o):r.save({model:n.slice(i,i+200)}).then(function(e){return o=o.concat(e),t(i+200)})}(0).then(function(){var t=0;e.lineItems.forEach(function(e){e.rateCards&&0<e.rateCards.length&&(e.rateCards=o.slice(t,t+e.rateCards.length),t+=e.rateCards.length)})})}},{key:"_checkIfRecordJobFailed",value:function(e,t){var i=this.editorModel.quoteModel.quoteVO.record.Id,n="/ServiceRouter?";t&&(n="/"+t+n),void 0!==e.oik&&(n+="oik="+e.oik+"&");var o={context:JSON.stringify({recordId:i,jobType:"QuoteCalculator"})};return e.apex.patch(n+"loader=JobCheckerServiceProvider.GetRecordJobStatus&uid=AllJobs",o)}},{key:"_SetRecordJobCompleted",value:function(e,t){var i=this.editorModel.quoteModel.quoteVO.record.Id,n="/ServiceRouter";t&&(n="/"+t+n),void 0!==e.oik&&(n+="?oik="+e.oik);var o={saver:"JobCheckerServiceProvider.SetJobsStatus",model:JSON.stringify({recordIds:[i],jobType:"QuoteCalculator",jobStatus:"Completed"})};return e.apex.post(n,o).then(function(e){return e})}},{key:"_bulkService",value:function(e,t){var n=[],i=t.slice(),o=function(t,i){return this.$[t].save({model:i.splice(0,200)}).then(function(e){return n=n.concat(e),0<i.length?o(t,i):Promise.resolve(n)})}.bind(this);return o(e,i)}},{key:"_handleLargeQuoteSaveResponse",value:function(e){if("saveService"===e)this.saverResponse="SUCCESS";else if("quickSaveService"===e){this._reloadEditor();var t=this.domHost.$.sbLineEditorRead;t.clearFromCache(),t.read()}}},{key:"_reorderLineItems",value:function(){for(var e=[],t=this.editorModel.quoteModel.lineGroups,i=0,n=t.length;i<n;i++){for(var o=t[i],r=0,s=o.dimensions.length;r<s;r++)for(var a=o.dimensions[r],l=o.segmentedLinesByDimension[a],u=0,d=l.length;u<d;u++)for(var c=l[u].segments,h=0,p=c.length;h<p;h++)e.push(c[h].lineVO);for(var f=0,g=o.standardLines.length;f<g;f++)e.push(o.standardLines[f].lineVO)}return e}},{key:"_reorderGroups",value:function(){for(var e=this.domHost.groupModels,t=0;t<e.length;t++)e[t].groupVO.record[this.editorModel.constants.NUMBER_FIELD]=t+1}},{key:"updateUIAfterCalculate",value:function(e){var t=e.lineSortField&&e.lineSortField==this.editorModel.constants.NUMBER_FIELD;this.domHost.updateAfterJSQC(this.notifier,t),this.sortLines(e,!0)||this.fire("iron-signal",{name:"refresh-table"})}},{key:"_saveFavorite",value:function(e){var s=this;this._executeServiceAction("favoriteLinesService",{keys:e.detail.keys,favName:e.detail.name,groupKey:e.detail.groupKey},function(e,t){var i=null==e.lineItems||0==e.lineItems.length,n=null==t.keys||0==t.keys.length;if(i||n)return[];var o=new Set;t.keys.forEach(function t(i){o.add(i),e.lineItems.forEach(function(e){e.parentItemKey===i&&(o.add(e.key),e.record[s.data.developerPrefix+"Bundle__c"]&&t(e.key))})});var r=[];return e.lineItems.forEach(function(e){o.has(e.key)&&r.push(e)}),r})}},{key:"_handleFavoriteResponse",value:function(){this.domHost.updateQuote(this.favoriteResponse,function(e,t){var n=t.lineItems,o=n.length;e.lineItems&&0!==e.lineItems.length&&e.lineItems.forEach(function(e){for(var t=e.key,i=0;i<o;i++)if(n[i].key===t){n[i]=e;break}});var r=t.lineItemGroups,s=r.length;return e.lineItemGroups&&0!==e.lineItemGroups.length&&e.lineItemGroups.forEach(function(e){for(var t=e.key,i=0;i<s;i++)if(r[i].key===t){r[i]=e;break}}),e.lineItems=n,e.lineItemGroups=r,e})}},{key:"_handleUnfavoriteResponse",value:function(){this._removeFavoritesFromQuote(this.unfavoriteResponse)}},{key:"_removeFavoritesFromQuote",value:function(e){var t=new Set(e),i=this.editorModel.constants.FAVORITE_ID_FIELD;if(this.editorModel.quoteModel.quoteVO.lineItems.forEach(function(e){t.has(e.record[i])&&(e.record[i]=null)}),this.editorModel.quoteModel.quoteVO.lineItemGroups.forEach(function(e){t.has(e.record[i])&&(e.record[i]=null)}),this.editorModel.quoteModel.quoteVO.favoriteIds){var n=this.editorModel.quoteModel.quoteVO.favoriteIds;this.editorModel.quoteModel.quoteVO.favoriteIds=n.filter(function(e){return!t.has(e)})}this._updateQuote(this.editorModel.quoteModel.quoteVO)}},{key:"_executeCustomAction",value:function(){var e=this.eventDetail.customAction;"function"==typeof this[e.eventHandlerName]?this[e.eventHandlerName]():e.url&&e.urlTarget?this._executeCustomURLAction(e.url,e.urlTarget,this.eventDetail.model):this._executeServiceAction(this.eventDetail.customAction.eventHandlerName)}},{key:"onSaveAndNavigate",value:function(){this.onSave()}},{key:"_executeCustomURLAction",value:function(e,t,i){i.quoteVO?this.model=i.quoteVO:i.lineVO?this.model=i.lineVO:i.groupVO&&(this.model=i.groupVO);var n=this._parseURL(e,this.model);"Popup"===t?this._handlePopup(n,this.model.record):this._navigateToURL(n)}},{key:"_handleCalculateResponse",value:function(){var e=this.calculateResponse;e&&(null!=e.jobId?this._onJobChecker(e):this._updateQuote(e))}},{key:"_updateQuote",value:function(e){this.domHost.updateQuote(e)}},{key:"_checkForGuidedMessages",value:function(){this.saverResponse.guidedMessages&&0<this.saverResponse.guidedMessages.length?(this.domHost.handleProductRuleAlertModal("saveService",this.saverResponse),this.showSpinner=!1):this.navigateToReturnUrl(!0)}},{key:"navigateToReturnUrl",value:function(e){if(e&&this.saverResponse&&this.saverResponse.messages&&0<this.saverResponse.messages.length)return this.showSpinner&&(this.showSpinner=!1),void(this.domHost.error={validations:this.saverResponse.messages});var t="";if("onSaveAndNavigate"===this.eventDetail.customAction.eventHandlerName)t=this._parseURL(this.eventDetail.customAction.url,this.editorModel.quoteModel.quoteVO,this.editorModel.quoteModel);else{var i=this.editorModel.quoteModel.quoteVO.record.Id;if((t=this.eventDetail.customAction.record?this.eventDetail.customAction.record[this.editorModel.constants.RETURN_URL_FIELD]:null)&&(15!==(t=this._parseURL(t,this.editorModel.quoteModel.quoteVO,this.editorModel.quoteModel)).length&&18!==t.length||!t.match(/^[a-zA-Z0-9]*$/)||(i=t,t=null)),this.domHost.inFullScreenMode&&this.domHost.exitFullScreenMode(),window.postMessage({acknowledgement:"I acknowledge that this is an unsupported feature that may stop working at any time.",recordId:i},window.location.origin),!t){if(this._isLightningExperience())return!0===p.getViewport().isMobile()?this._navigateToURL("#/sObject/"+i+"/view"):sforce.one.navigateToSObject(i),void(this.showSpinner&&(this.showSpinner=!1));if("undefined"!=typeof Sfdc&&Sfdc&&Sfdc.Url){var n=Sfdc.Url.getUrlParameters(window.location.href);if(n&&"vw"===n.isdtp)return void(window.location.href=this.editorModel.communityPrefix+"/"+i+"?isdtp=vw")}}t=t||this.editorModel.communityPrefix+"/"+i}window.parent?window.parent.location.href=t:window.location.href=t}},{key:"_reloadEditor",value:function(){this.domHost.destampGroups(),this.domHost.md=void 0,Polymer.RenderStatus.afterNextRender(this,function(){var e=this.editorModel.data.settings.largeQuoteThreshold;(null==e||this.editorModel.quoteModel.quoteVO.lineItems.length<=e)&&(this.domHost.rawData=this.quoteEditorModelResponse,this.quoteEditorModelResponse.guidedMessages&&0<this.quoteEditorModelResponse.guidedMessages.length&&this.domHost.handleProductRuleAlertModal("quickSaveService",this.quoteEditorModelResponse)),this.showSpinner=!1})}},{key:"_handleToggleGroupResponse",value:function(){this.domHost.set("editorModel.quoteModel.quoteVO",this.toggleGroupResponse),this.domHost.$$("#quoteTabs")&&this.domHost.$$("#quoteTabs").destroyTabs();var e=this.editorModel.quoteModel,t=e.quoteVO.lineItemGroups;if(e.grouped){this.domHost.set("editorModel.quoteModel.grouped",!1),this.domHost.rightSideButton=!1,this.fire("iron-signal",{name:"close-group-panel"});for(var i=0;i<this.domHost.groupModels.length;i++)this.domHost.set("groupModels."+i+".groupVO",{})}else"Solution Group"===this.eventDetail.customAction.type&&this._extendSolutionGroupRecord(t[0].record),this.set("editorModel.quoteModel.grouped",!0),this.set("editorModel.quoteModel.quoteVO.lineItemGroups",e.quoteVO.lineItemGroups);this._updateQuote(e.quoteVO),this.domHost.viewport.isMobile()&&this.domHost.buildQuoteTabs(),this.domHost.quoteHasNoLines()}},{key:"_handlePopupResponse",value:function(){switch(this.popupResponse.action){case"save":this.onSave();break;case"quicksave":this.onQuickSave();break;case"reload":location.reload()}}},{key:"_handlePopup",value:function(e,t){var i=this.$.popup;i.url=e,i.messenger=new r(this.editorModel,t),i.open()}},{key:"_parseURL",value:function(e,s,a){return e.replace(/{!(.*?)}/g,function(e,t){var i=void 0,n=t.split("."),o=n[0];"SBQQ__Quote__c"==o||"SBQQ__Quote__r"==o||"Quote__c"==o||"Quote__r"==o?(i=a.quoteVO.record,n.shift()):"SBQQ__Group__c"==o||"SBQQ__Group__r"==o||"Group__c"==o||"Group__r"==o?(i=a.groupsByKey[this.model.parentGroupKey].groupVO.record,n.shift()):i=s.record;for(var r=0;r<n.length;r++){if(r===n.length-1)return i[n[r]];i=i[n[r]]}}.bind(this))}},{key:"_navigateToURL",value:function(e,t){this._isLightningExperience()?sforce.one.navigateToURL(e,!!t):window.location.href=e}},{key:"_isLightningExperience",value:function(){return"undefined"!=typeof sforce&&sforce&&!!sforce.one}},{key:"onFlagCalculate",value:function(e,t,i){this.domHost.errors=null,this._usesClientCalculator()?this._jsqcCalculate(e).then(function(e){return t||e.updateQuoteRequired?(this.data.quote.calculationRequired=!1,void this._updateQuote(e.value)):this.data.quote.calculationRequired?(this.data.quote.calculationRequired=!1,e.value.lineSortField&&e.value.lineSortField!=this.data.developerPrefix+"Number__c"&&(e.value.lineItems=new o(this.data.developerPrefix).sortLineItems(e.value.lineItems,e.value.lineSortField)),void this.domHost._createEditorModel()):(this.updateUIAfterCalculate(e.value),void("function"==typeof i&&i()))}.bind(this),function(e){"function"==typeof i&&i(),void 0===this.editorModel?(this.$.alertModal.displayContinueButton=!1,this.$.alertModal.cancelCB=function(){location.reload()}.bind(this),this.$.alertModal.alerts=[e.message]):this.domHost.error=e}.bind(this)):(this.$.calculateService.model=void 0,this.$.calculateService.background=!1===e,this._executeServiceAction("calculateService"),"function"==typeof i&&i())}},{key:"onSave",value:function(){this.showSpinner=!0,this.$.saveService.background=!0,this._save("saveService")}},{key:"onQuickSave",value:function(){if(this.$.quickSaveService.uid=this.editorModel.quoteModel.quoteVO.record.Id.substring(0,15),this.showSpinner=!0,this.$.quickSaveService.background=!0,this.editorModel.largeQuoteExperienceEnabled){for(var e=this.editorModel.quoteModel.lineGroups,t=0,i=e.length;t<i;t++)if(e[t].groupKey==this.domHost.selectedGroupKey){this.domHost.returnGroupKeyAfterQuickSave=t+2;break}}else this.domHost.returnGroupKeyAfterQuickSave=null;this._save("quickSaveService"),this.fire("iron-signal",{name:"quote-saved"})}},{key:"onCancel",value:function(){this.showSpinner=!0,this.navigateToReturnUrl()}},{key:"onAddProducts",value:function(){this._navigateToLookup("product")}},{key:"onAddFavorites",value:function(){this._navigateToLookup("favorite")}},{key:"onDeleteLines",value:function(){if(this._usesClientCalculator()){var t=new Set;if(this._retrieveKeysOfSelected().forEach(function(e){t.add(e)}),this._deleteLines(t,this.editorModel.quoteModel.quoteVO,!0),this.domHost.renumber(),this.onFlagCalculate(!0,!1),this.domHost.quoteHasNoLines(),this.editorModel.largeQuoteExperienceEnabled||this.editorModel.deviceContext.isMobile){this.editorModel.deviceContext.isMobile&&this.domHost.buildQuoteTabs();for(var e=0,i=this.editorModel.quoteModel.lineGroups.length;e<i;e++)this.fire("iron-signal",{name:"render-new-tab",data:{groupKey:this.editorModel.quoteModel.lineGroups[e].groupKey}})}}else this._executeServiceAction("onDeleteLine",{keys:this._retrieveKeysOfSelected()})}},{key:"onDeleteLine",value:function(){if(this._usesClientCalculator()){var e=new Set;e.add(this.eventDetail.model.serviceModel.keys[0]),this._deleteLines(e,this.editorModel.quoteModel.quoteVO,!0),this.domHost.renumber(),this.onFlagCalculate(!0,!1),this.domHost.quoteHasNoLines(),this.editorModel.deviceContext.isMobile?(this.domHost.buildQuoteTabs(),this.fire("iron-signal",{name:"render-new-tab",data:{groupKey:this.eventDetail.model.groupModel.groupKey}})):this.editorModel.largeQuoteExperienceEnabled&&this.fire("iron-signal",{name:"render-new-tab",data:{groupKey:this.domHost.selectedGroupKey}})}else this._executeServiceAction("onDeleteLine",{keys:this.eventDetail.model.serviceModel.keys})}},{key:"onAddGroup",value:function(){this._resetOnActionSignal(),this.editorModel.quoteModel.grouped?this._addGroup():this._groupQuote()}},{key:"onUngroup",value:function(){this._resetOnActionSignal(),this._ungroupQuote()}},{key:"_groupQuote",value:function(){var t=this.editorModel.quoteModel,e=t.quoteVO;if(e.record[this.data.developerPrefix+"LineItemsGrouped__c"]=!0,0===e.lineItemGroups.length){var i=this.editorModel.data.customLabels.lbl_default_group_name;if(e.record[this.data.developerPrefix+"DefaultGroupName__c"]){var n=e.record[this.data.developerPrefix+"DefaultGroupName__c"];n&&(i=n)}var o=this.editorModel.constants,r=this._createGroupRecord(t);r.Name=i,r[o.NUMBER_FIELD]=1,r=JSON.parse(JSON.stringify(r)),"Solution Group"===this.eventDetail.customAction.type&&this._extendSolutionGroupRecord(r),t.lineGroups[0].groupVO={key:++t.quoteVO.nextKey,record:r,multiSegmentColumns:{},localizedMultiSegmentColumns:{}},sb.common.core.AppContext.org.isMultiCurrencyOrg&&(t.lineGroups[0].groupVO.CurrencyIsoCode=e.record.CurrencyIsoCode),t.grouped=!0,e.lineItemGroups.push(t.lineGroups[0].groupVO),t.groupsByKey[t.lineGroups[0].groupVO.key]=t.lineGroups[0],delete t.groupsByKey.null;var s=t.indexByGroupKey;s[t.lineGroups[0].groupVO.key]={index:Object.keys(s).length,indexByLineKey:{},indexBySegmentKey:{}},e.lineItems.forEach(function(e){e.parentGroupKey=t.lineGroups[0].groupVO.key}),this.onFlagCalculate(!0,!0),this.editorModel.largeQuoteExperienceEnabled&&this.domHost.set("selectedGroupKey",t.lineGroups[0].groupVO.key)}}},{key:"_ungroupQuote",value:function(){var e=this.editorModel.quoteModel;e.indexByGroupKey.null={index:0,indexByLineKey:{},indexBySegmentKey:{}},e.grouped=!1;var t=e.quoteVO,i=this.data.developerPrefix,n=[];0!==t.lineItemGroups.length&&(t.lineItemGroups.forEach(function(e){e.record.Id&&-1===n.indexOf(e.record.Id)&&n.push(e.record.Id)}),t.lineItemGroups=[],t.deletedGroupIds=n,t.lineItems.forEach(function(e){e.parentGroupKey=null,e.record[i+"Group__c"]=null})),t.record[i+"LineItemsGrouped__c"]=!1,this.onFlagCalculate(!0,!0),this.domHost.rightSideButton=!1,this.fire("iron-signal",{name:"close-group-panel"}),this.editorModel.largeQuoteExperienceEnabled&&(this.domHost.set("groupModels",[]),this.domHost.set("selectedGroupKey",null))}},{key:"onResegmentLine",value:function(){var e=this.editorModel.data.settings.largeQuoteThreshold,t=this.editorModel.data.customLabels.msg_large_quote_sent_without_lines;if(null!=e&&e<this.editorModel.quoteModel.quoteVO.lineItems.length){var i=this.eventDetail.model.lineVO.parentGroupKey,n=this.editorModel.quoteModel.quoteVO,o=new s(n).getSegmentTemplatesByDimensionTypeForGroupKey(i);n.segmentTemplatesByDimensionTypeByGroupKey={},n.segmentTemplatesByDimensionTypeByGroupKey[(i||-1)+""]=o;var r=t.replace("{0}",n.record.Id).replace("{1}",e);console.log(r),this._executeServiceAction("onResegmentLine",null,function(e,t){for(var i=t.keys[0],n=[],o=e.lineItems.length,r=0;r<o;r++){var s=e.lineItems[r];if(s.key==i){n.push(s);break}}return n})}else this._executeServiceAction("onResegmentLine")}},{key:"_handleResegmentResponse",value:function(){var l=this;delete this.resegmentResponse.segmentTemplatesByDimensionTypeByGroupKey,this.domHost.updateQuote(this.resegmentResponse,function(e,t){for(var i=void 0,n=e.lineItems.length,o=l.editorModel.constants,r=0;r<n;r++){var s=e.lineItems[r];if(1==s.record[o.SEGMENT_INDEX_FIELD]){i=s.key;break}}var a=[];return t.lineItems.forEach(function(e){e.key!==i&&a.push(e)}),a=a.concat(e.lineItems),e.lineItems=a,e})}},{key:"onDesegmentLine",value:function(){var t=this.editorModel.constants,i=(this.eventDetail&&this.eventDetail.model?this.eventDetail.model.serviceModel:null).segmentKey,e=JSON.parse(JSON.stringify(this.editorModel.quoteModel.quoteVO)),n=void 0,o=new Set;e.lineItems.forEach(function(e){e.record[t.SEGMENT_KEY_FIELD]===i&&(1===e.record[t.SEGMENT_INDEX_FIELD]?n=e:o.add(e.key))});var r=this._transformLineToNonSegmentedLine(n);0!==o.size&&this._deleteLines(o,e,!1);var s=[],a=null!=r.parentItemKey;e.lineItems.forEach(function(e){e.key!=r.key&&s.push(e),a&&r.parentItemKey==e.key&&(s.push(r),a=!1)}),null==r.parentItemKey&&s.push(r),e.lineItems=s,e.calculationRequired=!0,this._updateQuote(e)}},{key:"_deleteLines",value:function(o,r,e){var d=this.editorModel.constants,c=new Set,h=new Set,p=new Set,t=this._getAllRelatedKeys(o,e);o=new Set([].concat(y(o),y(t))),r.lineItems.forEach(function(e,t){if(o.has(e.key)&&(c.add(t),e.record.Id&&(h.add(e.record.Id),e.rateCards&&0<e.rateCards.length&&e.rateCards.forEach(function(e){e.Id&&p.add(e.Id)})),e.parentGroup&&(e.parentGroup.record[d.FAVORITE_ID_FIELD]=null),e.record[d.FAVORITE_ID_FIELD]&&r.favoriteIds)){var i=e.record[d.FAVORITE_ID_FIELD],n=[];r.favoriteIds.forEach(function(e){e!=i&&n.push(e)}),r.favoriteIds=n}});var f=[];r.lineItems.forEach(function(e,t){var i=this;if(c.has(t)){var n=e.parentGroupKey,o=this.editorModel.quoteModel.indexByGroupKey[e.parentGroupKey].index;if(e.record[this.editorModel.constants.SEGMENT_KEY_FIELD]){var r=e.record[this.editorModel.constants.SEGMENT_KEY_FIELD],s=this.editorModel.quoteModel.lineModelsByKey[e.key];if(s.segments&&0<s.segments.length){var a=s.dimensionType,l=this.editorModel.quoteModel.indexByGroupKey[n].indexBySegmentKey[r];s.segments=[],this.domHost.splice("groupModels."+o+".segmentedLinesByDimension."+a,l,1)}}else{var u=this.editorModel.quoteModel.indexByGroupKey[n].indexByLineKey[e.key];this.domHost.splice("groupModels."+o+".standardLines",u,1)}this.editorModel.quoteModel.renumberIndexes(!0)}else h.has(e.record[d.SOURCE_FIELD])&&(e.record[d.SOURCE_FIELD]=null),f.push(e),e.rateCards&&0<e.rateCards.length&&e.rateCards.forEach(function(e){p.has(e[i.prefix+"OriginalUsageRateCard__c"])&&(e[i.prefix+"OriginalUsageRateCard__c"]=null)})}.bind(this)),r.lineItems=f,r.deletedLineIds=r.deletedLineIds||[],h.forEach(function(e){r.deletedLineIds.push(e)})}},{key:"_transformLineToNonSegmentedLine",value:function(e){var o=this.editorModel.constants;e.dimensionType=null,e.record[o.DIMENSION_ID_FIELD]=null,e.record[o.DIMENSION_FIELD]=null,e.record[o.SEGMENT_KEY_FIELD]=null,e.record[o.SEGMENT_INDEX_FIELD]=null,e.record[o.SEGMENT_LABEL_FIELD]=null,e.record[o.START_DATE_FIELD]=null,e.record[o.END_DATE_FIELD]=null;var t=e.record[o.OPTION_TYPE_FIELD];return t&&"component"===t.toLowerCase()?e.record[o.BUNDLED_QUANTITY_FIELD]=function(e){if(null!=e.actualQuantity)return e.actualQuantity;var t=e.record[o.QUANTITY_FIELD],i=e.record[o.PRIOR_QUANTITY_FIELD]||0,n=e.record[o.UPGRADED_QUANTITY]||0;return e.record[o.EXISTING_FIELD]||e.record[o.CARRYOVER_LINE_FIELD]?t-i+n:t}(e):t&&"accessory"===t.toLowerCase()&&(e.record[o.BUNDLED_QUANTITY_FIELD]=e.record[o.QUANTITY_FIELD]),e}},{key:"onResetDiscounts",value:function(){this.editorModel.quoteModel.resetDiscounts(this.eventDetail.model.groupKey)}},{key:"updateLineOptional",value:function(){var e=void 0;this.eventDetail.model.groupKey&&(e=this.eventDetail.model.groupKey),this.editorModel.quoteModel.allOptional="optionalAllBtn"===this.eventDetail.customAction.caClass,this.editorModel.styleQuoteAndGroupActionButtons(),this.notifyPath("editorModel.quoteModel.allOptional",this.editorModel.quoteModel.allOptional),this.fire("iron-signal",{name:"toggle-optional-clicked",data:{toggleOptionalBoolean:this.editorModel.quoteModel.allOptional,groupKey:e}})}},{key:"onUpgradeAssets",value:function(){this._navigateToLookup("asset")}},{key:"onRenewSubscriptions",value:function(){this._navigateToLookup("subscription")}},{key:"onAmendSubscriptions",value:function(){this._navigateToLookup("subscription")}},{key:"onCloneGroup",value:function(){this.$.showSpinner=!0;var e=this.editorModel.quoteModel,t=this.eventDetail.model.serviceModel.keys[0];this._cloneGroup(e,t),delete this.eventDetail.model,this.onFlagCalculate(!0,!1)}},{key:"_cloneGroup",value:function(e,t){var i=this,n=e.groupsByKey[t];if(n){this._addGroup(n.groupVO);var o=e.groupsByKey[e.quoteVO.nextKey];if(o){var r=new Set,s=n.quoteModel.lineModelsByKey;for(var a in s)s.hasOwnProperty(a)&&(s[a].lineVO.parentItemKey||s[a].lineVO.parentGroupKey==t||r.add(s[a].lineVO.key));n.segmentedLines.forEach(function(e){var t=null;e.lineVO.parentItemKey&&(t=i._getRootPackage(s[e.lineVO.parentItemKey],s)),t&&r.has(t.lineVO.key)?i._cloneLine(t,o):e.lineVO.parentItemKey||i._cloneLine(e,o)}),n.standardLines.forEach(function(e){if(e.lineVO.key){var t=null;e.lineVO.parentItemKey&&(t=i._getRootPackage(s[e.lineVO.parentItemKey],s)),t&&r.has(t.lineVO.key)?i._cloneLine(t,o):e.lineVO.parentItemKey||i._cloneLine(e,o)}})}}}},{key:"_getRootPackage",value:function(e,t){return e.lineVO.parentItemKey?this._getRootPackage(t[e.lineVO.parentItemKey],t):e}},{key:"onDeleteGroup",value:function(){!this.editorModel.quoteModel.isAmendmentOrChangeQuote||this.eventDetail.model.canDelete()?confirm("All lines will also be deleted. Are you sure you want to delete this group?")&&this._deleteGroup():this.domHost.errors=[this.domHost.i18n.l("You cannot delete this Group as it contains Quote Lines being amended.")]}},{key:"_deleteGroup",value:function(){var e=this.eventDetail.model.serviceModel.keys[0],t=this.editorModel.quoteModel;this.eventDetail.model=void 0,null!=t.groupsByKey&&(this._removeGroup(t,e),this.onFlagCalculate(!0,!0),this._updateQuote(t.quoteVO),1==t.lineGroups.length&&this.fire("iron-signal",{name:"close-group-panel"}),this.editorModel.largeQuoteExperienceEnabled&&t.lineGroups[0]&&this.fire("iron-signal",{name:"group-deleted",data:{groupKey:t.lineGroups[0].groupKey}}))}},{key:"_removeGroup",value:function(e,t){var i=this,n=!0,o=new Set;if(0<e.quoteVO.lineItems.length&&(e.quoteVO.lineItems.forEach(function(e){e.parentItemKey&&e.parentGroupKey==t&&o.add(e.parentItemKey)}),e.quoteVO.lineItems.forEach(function(e){e.parentGroupKey!=t&&o.has(e.key)&&(n=!1)}),n)){var r,s=new Set,a=new Set,l=[];e.quoteVO.lineItems.forEach(function(e){e.parentGroupKey!=t?l.push(e):e.record.Id&&!s.has(e.record.Id)&&(s.add(e.record.Id),e.rateCards&&0<e.rateCards.length&&e.rateCards.forEach(function(e){e.Id&&a.add(e.Id)}))}),l.forEach(function(e){s.has(e.record[i.editorModel.constants.SOURCE_FIELD])&&(e.record[i.editorModel.constants.SOURCE_FIELD]=null),e.rateCards&&0<e.rateCards.length&&e.rateCards.forEach(function(e){a.has(e[i.prefix+"OriginalUsageRateCard__c"])&&(e[i.prefix+"OriginalUsageRateCard__c"]=null)})}),e.quoteVO.deletedLineIds=(r=e.quoteVO.deletedLineIds).concat.apply(r,y(s)),e.quoteVO.lineItems=l}if(n){var u=[],d=[];e.quoteVO.lineItemGroups.forEach(function(e){e.key!=t?u.push(e):e.record.Id&&-1==d.indexOf(e.record.Id)&&d.push(e.record.Id)}),e.quoteVO.lineItemGroups=u,e.quoteVO.deletedGroupIds=e.quoteVO.deletedGroupIds.concat(d);var c=[];e.lineGroups.forEach(function(e){e.groupKey!=t&&c.push(e)}),e.lineGroups=c,delete e.groupsByKey[t],delete e.indexByGroupKey[t]}}},{key:"onReconfigureLine",value:function(){var e={lineKey:this.eventDetail.model.lineVO.key,qId:this.editorModel.quoteModel.quoteVO.record.Id,ignoreCache:!0};this.eventDetail.model.groupModel.quoteModel.grouped&&(e.groupKey=this.eventDetail.model.groupModel.groupKey),i.nav("#",e,["product","pc"],!1,this)}},{key:"onAddToFavorites",value:function(){this._openDialog("favDialog")}},{key:"onRemoveFromFavorites",value:function(){if("Line"===this.eventDetail.customAction.location){if(!confirm("Are you sure you want to remove the favorite?"))return}else if(!confirm("All lines will be removed from favorites. Are you sure you want to remove this group from favorites?"))return;this._executeQuotelessServiceAction("onRemoveFromFavorites")}},{key:"_cloneToGroup",value:function(e){var t=e.detail;if(0!==t.length){var i=this.editorModel.quoteModel,n=this.editorModel.constants,o=this.domHost,r=i.indexByGroupKey;for(var s in this.selectedLinesByKey){for(var a=this.selectedLinesByKey[s],l=0,u=t.length;l<u;l++){var d=i.groupsByKey[t[l].value];this._cloneLine(a,d)}var c=r[a.lineVO.parentGroupKey],h=c.index,p=a.segmented?c.indexBySegmentKey[a.lineVO.record[n.SEGMENT_KEY_FIELD]]:c.indexByLineKey[s];this._clearSelectedCheckbox(p,h,o,a.lineVO.dimensionType)}if(this.editorModel.largeQuoteExperienceEnabled)for(var f=0,g=t.length;f<g;f++)this.fire("iron-signal",{name:"render-new-tab",data:{groupKey:t[f].value}});this.onFlagCalculate(!0,!1)}}},{key:"_clearSelectedCheckbox",value:function(e,t,i,n){n?i.set("groupModels."+t+".segmentedLinesByDimension."+n+"."+e+".selected",!1):i.set("groupModels."+t+".standardLines."+e+".selected",!1)}},{key:"onCloneLine",value:function(){var e=this.eventDetail.model;if(e.selected&&this.editorModel.quoteModel.grouped){this.selectedLinesByKey=this.editorModel.quoteModel.selectedLinesByKey;var t=this.$.cloneToGroupDialog;t.quoteModel=this.editorModel.quoteModel,t.open()}else this._cloneLine(e);delete this.eventDetail.model,this.onFlagCalculate(!0,!1)}},{key:"_cloneLine",value:function(l,h){var p=this,u=[],f={Year:{lines:[]},Quarter:{lines:[]},Month:{lines:[]},Custom:{lines:[]}},g=this.domHost.groupModels,e=h?h.groupKey:l.lineVO.parentGroupKey,y=e?this.editorModel.quoteModel.indexByGroupKey[e].index:0;!function e(t,i){var n=void 0;if(t.segmented?(n=g[y].cloneSegmentedLine(t,i,h),f[n.dimensionType].lines.push(n),f[n.dimensionType].key=t.lineVO.key):(n=g[y].cloneLine(t,i,h),u.push(n)),g[y].addToLinesByParentItemKey(n),t.bundle&&g[y].quoteModel.linesByParentItemKey[t.lineVO.key])for(var o=g[y].quoteModel.linesByParentItemKey[t.lineVO.key],r=0,s=o.length;r<s;r++)e(o[r],n.lineVO.key)}(l),function(){var e=g[y].standardLines.length;if(0<u.length){var t=void 0,i=void 0,n=g[y].standardLines.length;if(h)t=n;else for(i=0;i<n;i++)if(l.lineVO.key===g[y].standardLines[i].lineVO.key){t=i+1;break}if(l.bundle)if(p.editorModel.data.settings.bundleKeptTogether)for(var o=i;o<n;o++){if(!g[y].standardLines[o].component&&g[y].standardLines[o].lineVO.key!==l.lineVO.key){t=o;break}t=n}else t=n;for(var r=0,s=u.length;r<s;r++){var a=u[r];p.domHost.splice("groupModels."+y+".standardLines",t,0,a),g[y].quoteModel.quoteVO.lineItems.push(a.lineVO),p.editorModel.quoteModel.lineModelsByKey[a.lineVO.key]=a,t++}p.editorModel.deviceContext.isMobile&&0===e&&p.fire("iron-signal",{name:"render-new-tab",data:{groupKey:h.groupKey}})}}(),function(){for(var e in f)if(0<f[e].lines.length){var t=0,i=f[e].lines,n=g[y].segmentedLinesByDimension[e],o=n.length,r=f[e].key;if(h)t=o;else for(var s=0,a=n.length;s<a;s++)if(n[s].lineVO.key===r){t=s+1;break}for(var l=0,u=i.length;l<u;l++){var d=i[l];p.domHost.splice("groupModels."+y+".segmentedLinesByDimension."+e,t+l,0,d),p.domHost.push("groupModels."+y+".segmentedLines",d);for(var c=0;c<d.segments.length;c++)g[y].quoteModel.quoteVO.lineItems.push(d.segments[c].lineVO),p.editorModel.quoteModel.lineModelsByKey[d.segments[c].lineVO.key]=d.segments[c];0<d.segments.length&&(p.editorModel.quoteModel.lineModelsByKey[d.segments[0].lineVO.key].segments=d.segments,p.editorModel.quoteModel.lineModelsByKey[d.segments[0].lineVO.key].dimensionType=d.dimensionType)}0===o&&p.fire("iron-signal",{name:"render-new-tab",data:{groupKey:h.groupKey}})}}(),this.domHost.renumber(),this.editorModel.quoteModel.renumberIndexes(!0)}},{key:"_usesClientCalculator",value:function(){return this.data.settings.usesClientCalculator}},{key:"_jsqcCalculate",value:function(a){return this.showSpinner=!(!a&&null!=a)||this.showSpinner,new Promise(function(t,i){if(SB&&SB.JSQC){var n={},e=this.data.settings,o=new l(this.app.org.prefix);this.notifier=!this.data.quote.calculationRequired&&this.domHost.editorModel?new u(this.domHost):null,e.displayedLookupMap=this.getDisplayedLookupNames(this.data),(this.editorModel?new h(this.data,this.editorModel.quoteModel.groupsByKey):new h(this.data,null)).updateSegments()&&!this.data.quote.calculationRequired&&(n.updateQuoteRequired=!0,this.notifier=null);var r=new SB.JSQC(e,this.data.quote,this.notifier),s=[o.getConnection(),o.getConnection()];Promise.all(s).then(function(e){r.setConnection(e[0]),r.setCustomerOnlyConnection(e[1]),r.onCalc().then(function(e){this.showSpinner=!a&&null!=a&&this.showSpinner,n.value=e,t(n)}.bind(this),function(e){this.showSpinner=!a&&null!=a&&this.showSpinner,i({message:e.message||e})}.bind(this))}.bind(this),function(e){i({message:e.message||e})}.bind(this))}else i({message:"ERROR: Could not find the Client-Side Calculator"})}.bind(this))}},{key:"getDisplayedLookupNames",value:function(e){var t={line:[],group:[],quote:[]},i=e.settings.lineLookups?Object.keys(e.settings.lineLookups):[],n=e.settings.groupLookups?Object.keys(e.settings.groupLookups):[],o=e.settings.quoteLookups?Object.keys(e.settings.quoteLookups):[];return i.forEach(function(e){t.line.push(a.getRelationshipField(e))}),n.forEach(function(e){t.group.push(a.getRelationshipField(e))}),o.forEach(function(e){t.quote.push(a.getRelationshipField(e))}),t}},{key:"_onJobChecker",value:function(e){e.jobType="QuoteCalculator",this.$.jobchecker.useSpinner=!this.$.calculateService.background,this.$.jobchecker.data=e}},{key:"_jobCompleted",value:function(){if(null!=this.$.jobchecker.result.payload){var e=JSON.parse(this.$.jobchecker.result.payload);if(e.backgroundCalculatePending=!1,this.saveServiceAfterBackgroundCalc)return this.editorModel.createQuoteModel(e),this._executeServiceAction(this.saveServiceAfterBackgroundCalc),void(this.saveServiceAfterBackgroundCalc=null);this.domHost.updateQuote(e)}}},{key:"_save",value:function(i){this.editorModel.data.settings.usesClientCalculator?this._jsqcCalculate(!1).then(function(e){var t=new f(this.editorModel.quoteModel.quoteVO,this.editorModel.constants).validateAssetQuantityChanges();0!==t.length?this.domHost.error={validations:t}:this._executeServiceAction(i)}.bind(this),function(e){this.domHost.error=e}.bind(this)):this.editorModel.data.settings.usesBackgroundCalculator?(this.saveServiceAfterBackgroundCalc=i,this.onFlagCalculate(!1)):this._executeServiceAction(i)}},{key:"_navigateToLookup",value:function(e){this._resetOnActionSignal(),this.domHost.errors=null;var t={qId:this.editorModel.quoteModel.quoteVO.record.Id,aId:this.eventDetail.customAction.customActionId};this.eventDetail.model&&this.eventDetail.model.groupKey&&(t.groupKey=this.eventDetail.model.groupKey),i.nav("#",t,[e,"lookup"],!1,this)}},{key:"_retrieveKeysOfSelected",value:function(){for(var e=[],t=this.editorModel.quoteModel.lineGroups,i=0,n=t.length;i<n;i++){for(var o=t[i].standardLines,r=0,s=t[i].standardLines.length;r<s;r++)o[r].selected&&o[r].removable&&e.push(o[r].lineVO.key);for(var a=t[i].segmentedLines,l=0,u=a.length;l<u;l++)if(a[l].selected&&a[l].removable)for(var d=a[l].segments,c=0,h=d.length;c<h;c++)e.push(d[c].lineVO.key)}return e}},{key:"_getAllRelatedKeys",value:function(e,s){var a=this,l=new Set;return e.forEach(function(e){if(e){var t=a.editorModel.quoteModel.lineModelsByKey[e],i=a.editorModel.quoteModel.linesByParentItemKey[e];if(i){for(var n=new Set,o=0;o<i.length;o++)n.add(i[o].lineVO.key);var r=a._getAllRelatedKeys(n,s);l=new Set([].concat(y(l),y(n),y(r)))}else s&&t.segmented&&t.segments&&t.segments.forEach(function(e){l.add(e.lineVO.key)})}}),l}},{key:"_addGroup",value:function(e){var t=this.editorModel.constants,i=this.editorModel.quoteModel,n=!1,o=!1;if(e){var r=this.editorModel.quoteModel.groupsByKey[e.key];n=r.standardSubscriptionScopeEditable,o=r.segmentedSubscriptionScopeEditable}else{var s=this._createGroupRecord(i);s.Name="Group"+(i.lineGroups.length+1),e={record:s,multiSegmentColumns:{},localizedMultiSegmentColumns:{}}}"Solution Group"===this.eventDetail.customAction.type&&this._extendSolutionGroupRecord(e.record),(e=JSON.parse(JSON.stringify(e))).key=++i.quoteVO.nextKey,e.record.Id=void 0;var a=new d(e,i);a.standardSubscriptionScopeEditable=n,a.segmentedSubscriptionScopeEditable=o,i.quoteVO.lineItemGroups.push(e),i.groupsByKey[a.groupVO.key]=a;var l=i.indexByGroupKey;l[a.groupVO.key]={index:Object.keys(l).length,indexByLineKey:{},indexBySegmentKey:{}},this.domHost.push("groupModels",a);for(var u=0;u<i.quoteVO.lineItemGroups.length;u++)i.quoteVO.lineItemGroups[u].record[t.NUMBER_FIELD]=u+1;this.domHost.rightSideButton=1<i.lineGroups.length&&this.editorModel.quoteModel.grouped,this.domHost.notifyPath("editorModel.quoteModel.lineGroups.length",this.editorModel.quoteModel.lineGroups.length),i.lineGroups.length==t.PANEL_ADDED_INDEX?this.fire("iron-signal",{name:"group-panel-created",groupKey:a.groupVO.key}):this.fire("iron-signal",{name:"build-layout",data:{group:a}}),this.editorModel.largeQuoteExperienceEnabled&&this.fire("iron-signal",{name:"group-added",data:{groupKey:a.groupVO.key}}),this.domHost.quoteHasNoLines()}},{key:"_createGroupRecord",value:function(e){var t={},i=this.editorModel.constants;return t[i.QUOTE_PROCESS_FIELD]=this.editorModel.data.defaultQuoteProcessId,t[i.ACCOUNT_FIELD]=e.quoteVO.record[i.ACCOUNT_FIELD],t[i.ACCOUNT_ID_FIELD]=e.quoteVO.record[i.ACCOUNT_ID_FIELD],t}},{key:"_extendSolutionGroupRecord",value:function(e){e.Name=this.eventDetail.customAction.record.Name,e[this.editorModel.constants.DESCRIPTION_FIELD]=this.eventDetail.customAction.record[this.editorModel.constants.DESCRIPTION_FIELD]}},{key:"_openDialog",value:function(e){var t=this.$[e];if("Line"===this.eventDetail.customAction.location)t.favoritedLine=this.eventDetail.model.serviceModel.keys;else{var i=[].concat(this.eventDetail.model.standardLines).concat(this.eventDetail.model.segmentedLines);if(0===i.length)return void(this.domHost.errors=["Please select a group with one or more lines to favorite."]);t.favoritedGroup=this.eventDetail.model.groupKey,t.groupLines=i}t.$.dialog.toggle()}},{key:"sortLines",value:function(e,t){var i=e.lineSortField;return!(!e.lineSortField||i==this.editorModel.constants.NUMBER_FIELD||(this.fire("iron-signal",{name:"sort-lines-required",data:{lineSortField:i,notify:t}}),0))}},{key:"_resetOnActionSignal",value:function(){this.editorModel.deviceContext.isMobile&&this.fire("iron-signal",{name:"reset-on-action"})}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"listeners",get:function(){return{"sb-favorite-saved":"_saveFavorite","sb-clone-to-group-selected":"_cloneToGroup","job-completed":"_jobCompleted"}}},{key:"observers",get:function(){return["_executeCustomAction(eventDetail)","_handleCalculateResponse(calculateResponse)","_checkForGuidedMessages(saverResponse)","_reloadEditor(quoteEditorModelResponse)","_handleFavoriteResponse(favoriteResponse)","_handleUnfavoriteResponse(unfavoriteResponse)","_handleResegmentResponse(resegmentResponse)","_updateQuote(quoteVOResponse)","_handleToggleGroupResponse(toggleGroupResponse)","_handlePopupResponse(popupResponse)"]}},{key:"prefix",get:function(){if(void 0!==this.app)return this.app.org.prefix?this.app.org.prefix+"__":""}}]),g=e)),t("LECustomActionServices",g),Polymer(g)}}}),System.register("quotes/sb-line-sort/QuoteLineSort.js",["../layout/sb-le-table-cell/Localizer.js"],function(e,t){var s,l,u,d;function c(e,t){return e.lineVO.key-t.lineVO.key}function h(e,t){var i=u&&e.lineVO.record[l]?e.lineVO.record[l][u]:e.lineVO.record[l],n=u&&t.lineVO.record[l]?t.lineVO.record[l][u]:t.lineVO.record[l],o=void 0,r=void 0;if(l===d.LIST_PRICE_FIELD)o=e.lineVO.record[d.BUNDLED_FIELD],r=t.lineVO.record[d.BUNDLED_FIELD];else if(e.groupModel.quoteVO.localizationByFieldByProductId&&0<Object.keys(e.groupModel.quoteVO.localizationByFieldByProductId).length){i=s.getLocalizedValue(e,l,u)||i,n=s.getLocalizedValue(t,l,u)||n}return(i=a(i,o))==(n=a(n,r))?0:i<n?-1:n<i?1:null==i?-1:null==n?1:0}function p(e,t){var i=u&&e.lineVO.record[l]?e.lineVO.record[l][u]:e.lineVO.record[l],n=u&&t.lineVO.record[l]?t.lineVO.record[l][u]:t.lineVO.record[l],o=void 0,r=void 0;if(l===d.LIST_PRICE_FIELD)o=e.lineVO.record[d.BUNDLED_FIELD],r=t.lineVO.record[d.BUNDLED_FIELD];else if(e.groupModel.quoteVO.localizationByFieldByProductId&&0<Object.keys(e.groupModel.quoteVO.localizationByFieldByProductId).length){i=s.getLocalizedValue(e,l,u)||i,n=s.getLocalizedValue(t,l,u)||n}return(i=a(i,o))==(n=a(n,r))?0:n<i?-1:i<n?1:null==i?1:null==n?-1:0}function a(e,t){return t&&(e=0),"string"==typeof e?e.toUpperCase():void 0===e&&(e=null),e}return{setters:[function(e){s=e.Localizer}],execute:function(){d=u=l=void 0,e("depthFirstLineItemsTreeSort",function(t,e,i,n,o){var r=0;d=t[0].editorModel.constants;var s=n;l=t[0].segmented&&!t[0].lineVO.record[e]?d.NET_TOTAL_FIELD:e,u=o;var a=function(e){var i=void 0,n=void 0;return e.forEach(function(e){var t=e.lineVO.record[d.NUMBER_FIELD];e.visible?i=!i||t<i?t:i:n=!n||t<n?t:n}.bind(this)),{lowestVisibleNumber:i,lowestInvisibleNumber:n}}(t);return s?function e(t,i,n,o){var r=t[i];if(r){""===n?r.sort(c.bind(this)):"asc"===n?r.sort(h.bind(this)):"desc"===n&&r.sort(p.bind(this));for(var s=0;s<r.length;s++)o(r[s]),e(t,r[s].lineVO.key,n,o)}}(function(e){for(var t={},i=0;i<e.length;i++)null==e[i].lineVO.parentItemKey&&(e[i].lineVO.parentItemKey=0),t[e[i].lineVO.parentItemKey]||(t[e[i].lineVO.parentItemKey]=[]),t[e[i].lineVO.parentItemKey].push(e[i]);return t}(t),0,i,function(e){t[r++]=e}):"asc"===i?t.sort(h.bind(this)):"desc"===i?t.sort(p.bind(this)):""===i&&t.sort(c.bind(this)),t=function(e,t,i){if(0<i.length)var n=i[0].groupModel.quoteModel.indexByGroupKey,o=i[0].lineVO.parentGroupKey;for(var r=0;r<i.length;r++){var s=i[r].lineVO.key;i[r].lineVO.record[d.SEGMENT_KEY_FIELD]?n[o].indexBySegmentKey[i[r].lineVO.record[d.SEGMENT_KEY_FIELD]]=r:n[o].indexByLineKey[s]=r,i[r].visible?(i[r].lineVO.record[d.NUMBER_FIELD]=e,e++):(i[r].lineVO.record[d.NUMBER_FIELD]=t,t++)}return i}(a.lowestVisibleNumber,a.lowestInvisibleNumber,t)})}}}),System.register("quotes/sf-component-factory/SFComponentFactory.js",["common/forms/sb-field/factory/FieldFactory.js","common/core/AppContext.js","quotes/QuoteContext.js","common/forms/DependentPicklistBuilder.js"],function(t,e){var u,d,c,i;return{setters:[function(e){u=e.fieldFactory},function(e){d=e.AppContext},function(e){e.QuoteContext},function(e){c=e.DependentPicklistBuilder}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}"refDisplay",t("SFComponentFactory",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,null,[{key:"getFieldComponent",value:function(e,t,i){var n=e.type,o=e.name,r=t.lineVO.record,s=null,a=null;if("reference"===n)s={refDisplay:r&&e.relationshipName&&r[e.relationshipName]?r[e.relationshipName].Name:"",refDisplayName:"refDisplay",refTable:function(e){if(void 0!==e)return e.referenceTable?e.referenceTable:e.referenceTo&&0<e.referenceTo.length?e.referenceTo[0]:null}(e),refObjects:[],record:r};else if("picklist"===n||"multipicklist"===n)if(e.controllerName){var l=r[e.controllerName];a=new c(e,l).build()}else a=e.picklistValues;return u(n,t,r[o],!0,!1,!1,i,e,d.i18n,"richtextarea"===e.extraTypeInfo,a,s)}}]),i=e)),t("SFComponentFactory",i)}}}),System.register("quotes/tables/SFAbstractTable.js",["quotes/layout/template-generator/TemplateGenerator.js","quotes/layout/template-generator/LETemplateGenerator.js","quotes/layout/template-generator/MobileLETemplateGenerator.js","common/core/AppContext.js"],function(e,t){var m,r,s,a,i,b,o;function _(e,t,i){if(e){var n=e.tagName,o=t?"previousElementSibling":"nextElementSibling";if(i){var r=e.parentElement[o];if(r){var s=!0,a=!1,l=void 0;try{for(var u,d=r.children[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var c=u.value;if(c&&c.tagName==n)return c}}catch(e){a=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(a)throw l}}}}else for(var h=e[o];h;){if(h&&h.tagName==n)return h;h=h[o]}return null}}function S(e,t){var i=e?e.getAttribute("field"):null;return(t=t||(e?k(e):null))&&i?t._getFieldMetadata(i):null}function k(e){if(e&&e.parentElement)return"SF-LE-TABLE-ROW"===e.parentElement.tagName?e.parentElement:k(e.parentElement)}return{setters:[function(e){m=e.TemplateGenerator},function(e){r=e.LETemplateGenerator},function(e){s=e.MobileLETemplateGenerator},function(e){a=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function v(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,v)}i=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},13,32,27,9,37,39,38,40,b={INPUT:new Set([37,39]),TEXTAREA:new Set([37,39,38,40]),SELECT:new Set([38,40])},e("SFAbstractTable",(i(v,[{key:"getTemplateGenerator",value:function(e,t,i,n,o){return a.isMobile?new s(e,t,i,n,o):new r(e,t,i,n,o)}},{key:"_onFocusOut",value:function(e){var n=this;a.isMobile||setTimeout(function(){for(var e=null,t=!1,i=document.activeElement;i;){if(i.classList&&i.classList.contains("focusable"))e=i;else if("SF-STANDARD-TABLE"===i.tagName||"SF-SEGMENTED-TABLE"===i.tagName){t=Polymer.dom(i).node===n;break}i=i.parentElement}null!==e&&t||n.removeCellFocus(n.focusedCell)},5)}},{key:"_onKeyDown",value:function(e){switch(e.keyCode){case 13:this._onEnterKeyPress(e);break;case 32:this._onSpaceBarPress(e);break;case 27:this._onEscapePress(e);break;case 9:this._moveCellFocus(e,e.shiftKey?"left":"right");break;case 37:this._moveCellFocus(e,"left");break;case 38:this._moveCellFocus(e,"up");break;case 39:this._moveCellFocus(e,"right");break;case 40:this._moveCellFocus(e,"down")}}},{key:"_onEscapePress",value:function(e){this._routeKeyEvent(e)||(this._toggleInlineEditIfFocused(e,!1),this._editOnFocus=!1,this.focusedCell&&this.applyCellFocus(this.focusedCell))}},{key:"_onSpaceBarPress",value:function(e){this._routeKeyEvent(e)||(this._toggleInlineEditIfFocused(e,!0),this._editOnFocus=!0)}},{key:"_routeKeyEvent",value:function(e){var t=k(e.target);if(t&&t.onKeyDown)return t.onKeyDown(e)}},{key:"_onEnterKeyPress",value:function(e){var t=v.findCell(e);if(this._isCellFocusedAndEditable(t)){var i=t.classList.contains(m.classNames.EDIT_MODE),n=S(t);if(n&&i&&("textarea"===n.type||"reference"===n.type||"id"===n.type))return;i&&document.activeElement&&document.activeElement.blur(),this._toggleInlineEditIfFocused(e,!i),i&&this.focusedCell&&this.applyCellFocus(this.focusedCell),this._editOnFocus=!i}}},{key:"_openLookupDialog",value:function(){this.keepEditableFocus=!0}},{key:"_closeLookupDialog",value:function(){this.keepEditableFocus=!1}},{key:"_toggleInlineEditIfFocused",value:function(e,t){var i=v.findCell(e);if(this._isCellFocusedAndEditable(i)){var n=k(i);n&&n.toggleInlineEdit(i,t)}}},{key:"_isCellFocusedAndEditable",value:function(e){return e&&e.classList&&e.classList.contains(m.classNames.HAS_FOCUS)&&e.classList.contains(m.classNames.EDITABLE)}},{key:"removeCellFocus",value:function(e){if(e&&e.classList&&e.classList.contains(m.classNames.HAS_FOCUS)&&!this.keepEditableFocus){e.classList.remove(m.classNames.HAS_FOCUS);var t=k(e);return t&&t.toggleInlineEdit(e,!1),e===this.focusedCell&&(this.focusedCell=null),t}}},{key:"applyCellFocus",value:function(e){var t=this;e&&e.classList&&setTimeout(function(){!e.classList.contains("focusable")&&e.querySelector(".focusable")&&(e=e.querySelector(".focusable")),e.focus(),e.classList.add(m.classNames.HAS_FOCUS),t.focusedCell!==e&&t.removeCellFocus(t.focusedCell),t.focusedCell=e},10)}},{key:"setEditOnFocus",value:function(e){this._editOnFocus=e}},{key:"_moveCellFocus",value:function(e,t){if(e&&t&&!function(e){var t=e.target&&e.target.tagName?e.target.tagName:"",i=b[t];return i&&i.has(e.keyCode)}(e)){var i=v.findCell(e,"focusable");if(i){var n=k(i),o=n,r=null,s=n.querySelector("#content > div");switch(t){case"up":case"down":var a="up"===t,l=i.classList.contains(m.classNames.EDIT_MODE),u=S(i,n);if(u&&l&&("reference"===u.type||"id"===u.type||"date"===u.type||"datetime"===u.type))return;var d=_(n,a,this.editorModel.largeQuoteExperienceEnabled);if(d){o=d;var c=function(e,t){for(;t.parentElement!==e&&t.parentElement;)t=t.parentElement;return Array.from(e.children).indexOf(t)}(s,i);(r=d.getCellByIndex(c))&&this.applyCellFocus(r)}break;case"left":case"right":var h=s.querySelectorAll(".focusable"),p=Array.from(h).indexOf(i),f="left"==t,g=h.length;if(0==p&&f||!f&&p==g-1){var y=_(n,f,this.editorModel.largeQuoteExperienceEnabled);y&&(o=y,r=f?y.getCellByIndex(g-1):y.getCellByIndex(0),this.applyCellFocus(r))}else(r=h[p+(f?-1:1)])&&this.applyCellFocus(r)}this._editOnFocus&&o&&r&&o.toggleInlineEdit(r,!0,!0)}}}}],[{key:"findCell",value:function(e,t){var i=1<arguments.length&&void 0!==t?t:"td";return Polymer.dom(e).path.find(function(e){var t=e.classList;return t&&t.contains(i)})}}]),o=v)),e("SFAbstractTable",o),window.CommonBehaviors=window.CommonBehaviors||{},window.CommonBehaviors.SFAbstractTable=o.prototype}}}),System.register("quotes/ui-data-manager/UIDataManager.js",["common/formatter/Formatter.js","quotes/QuoteContext.js","common/core/AppContext.js","quotes/layout/template-generator/TemplateGenerator.js","quotes/sf-component-factory/SFComponentFactory.js","quotes/layout/sb-le-table-cell/Localizer.js"],function(t,e){var s,a,l,u,d,i;return{setters:[function(e){s=e.Formatter},function(e){a=e.QuoteContext},function(e){l=e.AppContext},function(e){u=e.TemplateGenerator},function(e){e.SFComponentFactory},function(e){d=e.Localizer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("UIDataManager",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,null,[{key:"prepareLineData",value:function(e,s,a){var l=[];return e.forEach(function(i,e){var n=i.lineVO.record,o={Id:n.Id},r=i.lineVO.fieldVisibility;s.forEach(function(e){var t=a[e];o[e]=this.prepareFieldData(n,e,t,i,r),this.computeCellClass(n,e,o,i,r,t)}.bind(this)),i.hasOwnProperty("segments")&&this.prepareSegmentedLineData(i,n,o,a,r);var t=i.editorModel.constants;o.lineNumber=n[t.NUMBER_FIELD],o.rowIndex=e,o.lineModel=i,this.prepareSelectionCheckbox(i,o),this.prepareWarningIcon(i,o),o._cellClasses||(o._cellClasses={}),l.push(o)}.bind(this)),l}},{key:"prepareSelectionCheckbox",value:function(e,t){e.editorModel.data.settings.multiLineDeleteEnabled&&e.component&&(t._cellClasses=t._cellClasses||{},t._cellClasses._selectionCB=u.classNames.DISABLED)}},{key:"prepareWarningIcon",value:function(e,t){!1===e.lineVO.validPricebookEntryExists&&(t.hasLineWarning=!0,e.groupModel.quoteModel.isPrimary&&0==e.lineVO.opportunityLineItemExists?(t.lineWarningKey="missingOpportunityLineItem",t.lineWarningMsg="This product will not sync to the opportunity because a valid pricebook entry does not exist."):(t.lineWarningKey="invalidPricebookEntry",t.lineWarningMsg="There is not a valid price book entry for this line item."))}},{key:"prepareFieldData",value:function(e,t,i,n,o){if(o&&!1===o[t])return"";if(a.isSubscriptionScopeField(t)&&!n.subscriptionScopeEditable)return"";if(n.bundled&&a.isListPriceField(t))return l.properties.i18n.value().l("Included");var r=d.getLocalizedValue(n,t);return r||(i?(this._updateFieldMetadata(e,i,n),s.formatFieldData(n,e[t],i,e)):e[t])}},{key:"_updateFieldMetadata",value:function(e,t,i){"currency"===t.type&&(t.CurrencyIsoCode=e.CurrencyIsoCode);var n=i.editorModel.constants.QUANTITY_FIELDS;n&&n.has(t.name)&&null!==i.lineVO.productQuantityScale&&(t.scale=i.lineVO.productQuantityScale)}},{key:"prepareSegmentedLineData",value:function(i,e,n,o,r){var s=this,a={};e.CurrencyIsoCode&&(a.CurrencyIsoCode=e.CurrencyIsoCode);var l=i.editorModel.constants;i.segments.forEach(function(e){var t=e.lineVO.record[l.SEGMENT_LABEL_FIELD].replace(/\W/g,"");t=isNaN(t)?t:"TimeSegment"+t,a[t]=e.lineVO.record[l.NET_TOTAL_FIELD]});var t=i.editorModel.quoteModel.quoteVO;a.total=t.multiSegmentRowTotals[e[l.SEGMENT_KEY_FIELD]],Object.keys(a).forEach(function(e){var t=o[l.NET_TOTAL_FIELD];n[e]=s.prepareFieldData(a,e,t,i,r),s.computeCellClass(a,e,n,i,r,o[e])})}},{key:"computeCellClass",value:function(e,t,i,n,o,r){var s="";o&&!1===o[t]||(s+=n.isEditable(t)?u.classNames.EDITABLE+" ":"",s+=n.itemClassMap[t]?n.itemClassMap[t]:""),o&&!1===o[t]&&r&&"boolean"===r.type&&(s+=u.classNames.HIDE_CHECKBOX+" "),n.editorModel.isProductHierarchyVisualized()&&!n.segmented&&(s+=this.computeProductHierarchyCss(t,e,n)),s&&(i._cellClasses=i._cellClasses||{},i._cellClasses[t]=s)}},{key:"computeProductHierarchyCss",value:function(e,t,i){var n="",o=u.classNames;return l.isMobile?(a.isProductNameField(e)||a.isNetTotalField(e))&&null!==t[a.constants.OPTION_LEVEL_FIELD]&&(n+=""+o.INDENT+t[a.constants.OPTION_LEVEL_FIELD]+" "):a.isProductNameField(e)&&(i.isBundle?n+=o.CHEVRON_DOWN_ICON+" ":i.component||(n+=o.TOP_LEVEL+" "),i.component&&(i.bundle||(n+=o.OPTION+" "),n+=""+o.INDENT+t[a.constants.OPTION_LEVEL_FIELD]+" ")),n}}]),i=e)),t("UIDataManager",i)}}}),System.register("common/aggregate/quote-aggregator/QuoteAggregator.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.clientQuote=e,this.serverQuote=t,this.requiredKeys=i}e("QuoteAggregator",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"reconcileServerQuoteWithUIQuote",value:function(){for(var t=this,i=new Map,e=[],n=this.serverQuote.lineItems.length,o=void 0,r=0;r<n;r++){var s=this.serverQuote.lineItems[r];this.requiredKeys.has(s.key)?(i.set(s.key,[s]),o=s.key):o&&s.parentItemKey?i.get(o).push(s):(o=null,e.push(s))}var a=[];return this.clientQuote.lineItems.forEach(function(e){t.requiredKeys.has(e.key)?i.has(e.key)&&(a=a.concat(i.get(e.key))):a.push(e)}),a=a.concat(e),this.serverQuote.lineItems=a,this.serverQuote}}]),i=o)),e("QuoteAggregator",i)}}}),System.register("common/aggregate/quote-line-aggregator/QuoteLineAggregator.js",["quotes/models/Constants.js"],function(e,t){var r,i;return{setters:[function(e){r=e.Constants}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this._quote=e,this._linesByKey=new Map,null!=this._quote.lineItems&&this._quote.lineItems.forEach(function(e){t._linesByKey.set(e.key,e)});var i="Quote__c"===e.record.attributes.type?"":e.record.attributes.type.slice(0,-8);this._constants=new r(i)}e("QuoteLineAggregator",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"mapPriorBundledQuantityByLineKey",value:function(){var t=this,i={};return null!=this._quote.lineItems&&this._quote.lineItems.forEach(function(e){i[e.key+""]=t._getPriorBundledQuantity(e)}),i}},{key:"getUpgradedAssetIdsAsArray",value:function(){var i=new Set,n=this._constants.UPGRADED_ASSET_FIELD;null!=this._quote.lineItems&&this._quote.lineItems.forEach(function(e){var t=e.record[n];null!=t&&i.add(t)});var t=[];return i.forEach(function(e){t.push(e)}),t}},{key:"getExistingProductIdsFromLines",value:function(){var t=new Set,i=this._constants.EXISTING_FIELD,n=this._constants.PRODUCT;null!=this._quote.lineItems&&this._quote.lineItems.forEach(function(e){e.record[i]&&t.add(e.record[n])});var o=[];return t.forEach(function(e){o.push(e)}),o}},{key:"getSegmentTemplatesByDimensionTypeForGroupKey",value:function(n){var o=this,e={},r=void 0,s=void 0,a=void 0,l=void 0,u=[],d=[],c=[],h=[],p=this._constants.DIMENSION_ID_FIELD,f=this._constants.DIMENSION_FIELD,g=this._constants.TYPE_FIELD,y=this._constants.SEGMENT_KEY_FIELD;return this._quote.lineItems&&this._quote.lineItems.forEach(function(e){if(e.parentGroupKey==n){var t=e.dimensionType||(e.record[p]?e.record[f][g]:null),i=e.record[y];switch(t){case o._constants.TYPE_CUSTOM_DIMENSION:r&&r!=i||(r=i,u.push(e));break;case o._constants.TYPE_YEARLY_DIMENSION:s&&s!=i||(s=i,c.push(e));break;case o._constants.TYPE_MONTHLY_DIMENSION:a&&a!=i||(a=i,d.push(e));break;case o._constants.TYPE_QUARTERLY_DIMENSION:l&&l!=i||(l=i,h.push(e))}}}),e[this._constants.TYPE_CUSTOM_DIMENSION]=u,e[this._constants.TYPE_MONTHLY_DIMENSION]=d,e[this._constants.TYPE_YEARLY_DIMENSION]=c,e[this._constants.TYPE_QUARTERLY_DIMENSION]=h,e}},{key:"getKeysOfEmptyGroups",value:function(){if(!this._quote.lineItemGroups||0==this._quote.lineItemGroups.length)return[];var t=new Set;this._quote.lineItemGroups.forEach(function(e){t.add(e.key)}),this._quote.lineItems&&this._quote.lineItems.forEach(function(e){t.delete(e.parentGroupKey)});var i=[];return t.forEach(function(e){i.push(e)}),i}},{key:"_getPriorBundledQuantity",value:function(e){var t=void 0,i=void 0;return null!=(i=this._isCarryoverLine(e)?(t=this._getCarryoverQuantity(e),this._linesByKey.get(e.parentItemKey).record[this._constants.QUANTITY_FIELD]):(t=e.record[this._constants.PRIOR_QUANTITY_FIELD],this._linesByKey.get(e.parentItemKey)?this._linesByKey.get(e.parentItemKey).record[this._constants.PRIOR_QUANTITY_FIELD]:null))&&null!=t&&this._optionTypeIsComponent(e)?t/i:t}},{key:"_isCarryoverLine",value:function(e){return 1==e.record[this._constants.CARRYOVER_LINE_FIELD]}},{key:"_getCarryoverQuantity",value:function(e){var t=e.record[this._constants.PRIOR_QUANTITY_FIELD],i=this._linesByKey.get(e.parentItemKey);if(null!=e.sourceLineKey&&i){var n=this._linesByKey.get(e.sourceLineKey);n&&(t=this._getPriorBundledQuantity(n),this._optionTypeIsComponent(n)&&(t*=i.record[this._constants.QUANTITY_FIELD]))}return t}},{key:"_optionTypeIsComponent",value:function(e){var t=e.record[this._constants.OPTION_TYPE_FIELD];return null!=t&&"component"===t.toLowerCase()}}]),i=o)),e("QuoteLineAggregator",i)}}}),System.register("common/calculate/asset-upgrade-quantity-calculator/AssetUpgradeQuantityCalculator.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.upgradeHandler=e}e("AssetUpgradeQuantityCalculator",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"setQuantitiesByRatio",value:function(){var e=void 0,t=void 0,i=this.upgradeHandler.isSourceLine();i?(e=this.upgradeHandler.getLine(),t=this._getUpgrade(e,null)):(t=this.upgradeHandler.getLine(),e=this._getSource(null,t)),e&&t&&(this.upgradeHandler.setSourceAndUpgrade(e,t),this._setAutomaticQuantity(e,t,i))}},{key:"_getSource",value:function(e,t){return this.upgradeHandler.getSourceOrUpgrade(e,t)}},{key:"_getUpgrade",value:function(e,t){return this.upgradeHandler.getSourceOrUpgrade(e,t)}},{key:"_setAutomaticQuantity",value:function(e,t,i){var n=this._getUpgradeRatio(e,t,this.upgradeHandler.getSourceIdField(),this.upgradeHandler.getUpgradeConversionRateField());if(null!=n){var o=this.upgradeHandler.getSourceCurrentQuantityField(e),r=this.upgradeHandler.getUpgradeCurrentQuantityField(t),s=n.split(":")[0],a=n.split(":")[1],l=o,u=r,d=this.upgradeHandler.getSourcePriorQuantity(e);o<0?(e.invalidQuantity=o,e.validQuantity=0):r<0&&(t.invalidQuantity=r,t.validQuantity=0),this.upgradeHandler.didSourceQuantityChange(i,e,t)?u=a/s*(d-o):this.upgradeHandler.didUpgradeQuantityChange(i,e)&&(l=d-r*(s/a)),l<0?(l=0,this.upgradeHandler.isSelected(t)&&(u=d*(a/s))<r&&(t.invalidQuantity=r,t.validQuantity=u)):u<0&&(u=0,this.upgradeHandler.isSelected(e)&&(l=d)<o&&(e.invalidQuantity=o,e.validQuantity=l)),this.upgradeHandler.setUpdatedQuantity(e,t,l,u)}}},{key:"_getUpgradeRatio",value:function(e,t,i,n){for(var o in t.upgradeSourcesBySourceProductId)if(o===e.record[i])return t.upgradeSourcesBySourceProductId[o][n]}}]),i=t)),e("AssetUpgradeQuantityCalculator",i)}}}),System.register("common/core/sb-i18n/I18n.js",["../AppContext.js","../../Util.js"],function(e,t){var i,s,o,a,l,r,u;return{setters:[function(e){i=e.AppContext},function(e){s=e.Util}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.app=e}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},a=new s.Map,l=new s.Map,r=void 0,e("I18n",(o(t,[{key:"beforeRegister",value:function(){this.is="sb-i18n",this.properties=Polymer.Base.extend({locale:{type:String,notify:!1,value:function(){return""}},key:{type:String,notify:!1},value:{type:String,value:null},values:{type:Array,value:[]}},i.properties)}},{key:"attached",value:function(){this.key=this.key?this.key:this.innerHTML,/{[0-9]}/.test(this.innerHTML)&&(this.innerHTML="")}},{key:"localize",value:function(){this.innerHTML=this.l(this.key,this.value?[this.value]:this.values)}},{key:"l",value:function(e,t){var i=this.labels[e]||e;return/{[0-9]}/.test(i)&&t&&0<t.length&&(i=this._replaceWildcards(i,t)),i}},{key:"_replaceWildcards",value:function(e,t){for(var i=0,n=t.length;i<n;i++)e=e.replace(new RegExp("{["+i+"]}","g"),t[i]);return e}},{key:"_getFormat",value:function(e,t,i){var n=null;if(e&&t){var o=i?a.get(e):l.get(e);o||(o=new s.Map,(i?a:l).set(e,o));var r=JSON.stringify(t);(n=o.get(r))||(n=i?new Intl.DateTimeFormat(e,t):new Intl.NumberFormat(e,t),o.set(r,n))}return n}},{key:"format",value:function(t,e){var i="",n=e||{},o="no-NO"===this.user.locale?"nb-NO":this.user.locale;if(t||0==t)if(t instanceof Date||n.date){var r=this._getFormat(o,n,!0);if(t instanceof Date)i=r.format(t);else if("number"==typeof t)i=r.format(new Date(t));else if("string"==typeof t)if(0<=t.indexOf("T"))try{i=r.format(Date.parse(t))}catch(e){var s=t.split("T")[0].split("-");s&&3==s.length&&(i=r.format(new Date(s[0],s[1]-1,s[2])))}else{var a=t.split("-");a&&3==a.length&&(i=r.format(new Date(a[0],a[1]-1,a[2])))}}else i=this._getFormat(o,n,!1).format(t),"currency"===n.style&&(i=this._additionalCurrencyFormat(n,i));return i}},{key:"_additionalCurrencyFormat",value:function(e,t){var i=void 0;if("XXX"===e.currency)i=this.org.currencySymbol+t.replace(/[XXX]/g,"");else{var n=void 0;"code"==e.currencyDisplay&&(n=-1<t.indexOf("-"))&&(t=t.replace("-",""));var o=n?" -":" ";i=t.replace(e.currency,e.currency+o)}return i.trim()}},{key:"behaviors",get:function(){return[sb.common.core.AppContext]}},{key:"observers",get:function(){return["localize(key, value, values)"]}}],[{key:"addLocaleData",value:function(e){e&&(r=e)}},{key:"getLocaleData",value:function(e){return r}}]),u=t)),e("I18n",u),Polymer(u)}}}),System.register("common/core/sb-loading-spinner/LoadingSpinner.js",["common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o;return{setters:[function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LoadingSpinner",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-loading-spinner",this.properties={show:{type:Boolean,value:!1,observer:"toggle"},isReady:{type:Boolean,value:!1},previousState:{type:Boolean,value:!1}}}},{key:"ready",value:function(){this.isReady=!0}},{key:"detached",value:function(){!1!==this.previousState&&i.toggleSpinner(!1)}},{key:"toggle",value:function(e){!0!==this.isReady&&!1===e||e!==this.previousState&&(i.toggleSpinner(e),this.previousState=e)}}]),o=e)),t("LoadingSpinner",o),Polymer(o)}}}),System.register("common/core/sb-page-container/PageContainer.js",["common/core/AppContext.js"],function(e,t){var s,o,r,a,l,u,d,c,h;return{setters:[function(e){s=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i)}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},0,480,800,1024,1200,r=window.matchMedia("screen and (max-width: 480px)"),a=window.matchMedia("screen and (min-width: 481px) and (max-width: 800px)"),l=window.matchMedia("screen and (min-width: 801px) and (max-width: 1024px)"),u=window.matchMedia("screen and (min-width: 1025px) and (max-width: 1200px)"),d=window.matchMedia("screen and (min-width: 1201px)"),c=0,e("PageContainer",(o(i,[{key:"beforeRegister",value:function(){this.is="sb-page-container",this.properties={route:String,allRoutes:{type:Object,value:function(){return{}},observer:"_allRoutesChanged"},viewport:{type:Object,observer:"_viewportChanged",value:function(){return this._buildViewport(r.matches,a.matches,l.matches,u.matches,d.matches)}}}}},{key:"_buildViewport",value:function(e,t,i,n,o){var r={XS:{},S:{},M:{},L:{},XL:{},current:function(){return this.XS.only?{size:"XS",window:[0,480]}:this.S.only?{size:"S",window:[481,800]}:this.M.only?{size:"M",window:[801,1024]}:this.L.only?{size:"L",window:[1025,1200]}:this.XL.only?{size:"XL",window:[1200,1e4]}:void 0},isMobile:function(){return this.isPhone()||this.isTablet()},isPhone:function(){return s.isPhone},isTablet:function(){return s.isTablet},isDesktop:function(){return s.isDesktop}};return r.XS.only=e&&!t&&!i&&!n&&!o,r.XS.down=r.XS.only,r.XS.up=e||t||i||n||o,r.S.only=!e&&t&&!i&&!n&&!o,r.S.down=(e||t)&&!i&&!n&&!o,r.S.up=!e&&(t||i||n||o),r.M.only=!e&&!t&&i&&!n&&!o,r.M.down=(e||t||i)&&!n&&!o,r.M.up=!e&&!t&&(i||n||o),r.L.only=!e&&!t&&!i&&n&&!o,r.L.down=(e||t||i||n)&&!o,r.L.up=!e&&!t&&!i&&(n||o),r.XL.only=!e&&!t&&!i&&!n&&o,r.XL.down=!0,r.XL.up=r.XL.only,r}},{key:"ready",value:function(){this._setupViewportListeners()}},{key:"renderPage",value:function(e,t,i){if(t.route.comp&&""!=t.route.comp){var n={};n.params=t.params,n.pathParams=t.pathParams;var o=(s=n,"<"+(r=t).route.comp+" ctx='"+JSON.stringify(s)+"'></"+r.route.comp+">");t.route.mod?System.import(t.route.mod).then(function(e){this.$.content.innerHTML=o,this._viewportChanged(),Polymer.updateStyles()}.bind(this)).catch(function(e){console.log(e),console.log(e.originalErr)}):(this.$.content.innerHTML=o,Polymer.updateStyles())}else this.$.ajax.url=t.route.view,this.$.ajax.url&&this.$.ajax.go();var r,s}},{key:"_allRoutesChanged",value:function(e){this.$.router.init(e)}},{key:"_viewportChanged",value:function(){var e=this.$.content.querySelector("*:first-child");e&&(e.viewport=this.viewport),setTimeout(function(){this.fire("iron-signal",{name:"sb-viewport-changed",data:{viewport:this.viewport}})}.bind(this),10)}},{key:"_setupViewportListeners",value:function(){var t=this;function e(e){e.matches&&(t.viewport=t._buildViewport(r.matches,a.matches,l.matches,u.matches,d.matches))}r.addListener(e),a.addListener(e),l.addListener(e),u.addListener(e),d.addListener(e)}}],[{key:"getContainer",value:function(){return document.querySelector("#"+i.domId)}},{key:"getViewport",value:function(){var e=i.getContainer();return e?e.viewport:null}},{key:"isMobile",value:function(){var e=i.getViewport();return e&&e.isMobile()}},{key:"toggleSpinner",value:function(e){c+=!0===e?1:-1;var t=i.getContainer();null!==t&&(t.$.spinner.show=0<c)}}]),h=i)),e("PageContainer",h),h.domId="sbPageContainer",Polymer(h)}}}),System.register("common/core/sb-page-header/PageHeader.js",["common/core/sb-page-container/PageContainer.js"],function(e,t){var i,o;return{setters:[function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t)}e("PageHeader",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"beforeRegister",value:function(){this.is="sb-page-header",this.properties={viewport:{type:Object,observer:"_viewportChanged",value:function(){return i.getViewport()}},showMenu:{type:Boolean,value:function(){return!0}},menuClosed:{type:Boolean,value:function(){return!0}},hideFullTitle:{type:Boolean,value:!1},searchbar:{type:Boolean,observer:"_setSearchbarStyles"},debugMode:Boolean,ept:{type:Number,value:0},bpt:{type:Number,value:0},spt:{type:Number,value:0}}}},{key:"ready",value:function(){this.debugMode=window.sb.mode&&window.sb.mode.debugMode||!1,this.debugMode&&this._setupMetricsServiceListeners()}},{key:"_showFullTitle",value:function(e){this.viewport.isMobile()&&(this.hideFullTitle||Polymer.dom(this).children[1].textContent)&&(this.hideFullTitle=!this.hideFullTitle,this.$.fullTitle.innerText=this.hideFullTitle?Polymer.dom(this).children[1].textContent:"",this.$.fullTitle.style.opacity=this.hideFullTitle?1:0)}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport}},{key:"navigationChanged",value:function(){this._closeMenu()}},{key:"_closeMenu",value:function(){this.toggleClass("open",!1,this.$.buttons),this.toggleClass("autoLaunch",!1,this.$.buttons),setTimeout(function(){this.menuClosed=!0}.bind(this),1)}},{key:"_changeMenu",value:function(e){"Popup"!==Polymer.dom(e).rootTarget.getAttribute("data-target")&&(this.menuClosed=t.changeMenu(e,this.menuClosed,this.$.buttons,"open",this),this.menuClosed&&this.fire("sb-menu-closed"))}},{key:"_viewportChanged",value:function(){this.showMenu=!(this.viewport&&!this.viewport.isMobile()&&this.viewport.M.up),this.showMenu?this.$.buttons.classList.remove("normal"):this.$.buttons.classList.add("normal")}},{key:"_setSearchbarStyles",value:function(){}},{key:"openLookupDialog",value:function(e){var t=this.$.lookup;t.invoker=e.detail.lookup,t.open(e.detail.searchValue)}},{key:"openRteDialog",value:function(e){var t=this.$.rte;t.value=e.detail.value,t.rte=e.detail.rte,t.open()}},{key:"openSearchDialog",value:function(e){var t=this.$.search;t.value=e.detail.value,t.quote=e.detail.quote,t.open()}},{key:"allowAutoLaunchPopup",value:function(){this.showMenu&&(this.toggleClass("open",!0,this.$.buttons),this.toggleClass("autoLaunch",!0,this.$.buttons),this.menuClosed=!1)}},{key:"_setupMetricsServiceListeners",value:function(){document.addEventListener("metrics-changed",function(e){var t=e.detail,i=Polymer.dom(this.root).querySelector(".header").querySelector(".sticker");null!=t.ept&&(this.ept=Math.round(t.ept)),null!=t.bpt&&(this.bpt=Math.round(t.bpt)),null!=t.spt&&(this.spt=Math.round(t.spt)),i&&(i.style.display="block",this.ept<=2e3?i.style.backgroundColor="#468847":2e3<this.ept&&this.ept<=3e3?i.style.backgroundColor="#daa520":i.style.backgroundColor="#b72020")}.bind(this))}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}],[{key:"changeMenu",value:function(e,t,i,n,o){var r=e.currentTarget.getBoundingClientRect(),s=i.style;return s.top=r.bottom+2+"px",s.right=window.innerWidth-r.right+"px",o.toggleClass(n,t,i),!t}}]),o=t)),e("PageHeader",o),Polymer(o)}}}),System.register("common/core/sb-router/Router.js",[],function(t,e){var i,c,h,o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}c=i=void 0,h=/:[a-z0-9_$]*/g,t("Router",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-router",this.properties={autoHash:{type:Boolean,value:function(){return!1}},route:{type:String,observer:"routeChanged"},router:{type:Object,readOnly:!0,value:function(){return i||(i=new window.Router).init(),i}}}}},{key:"init",value:function(e){var r=this,t=Object.keys(e);if(!c&&t.length){c=e;for(var s=this.router,i=t?t.length:0,n=0;n<i;n++)for(var a=t[n],l=Object.keys(c[a]),o=l?l.length:0,u=function(e){var t=l[e],i=t?t.match(h):null,n=[],o={};i&&(n=i.map(function(e,t){var i=e.substring(1);return o[i]=null,i})),s.on(a+t,function(e,t,i,n){for(var o=JSON.parse(JSON.stringify(n)),r=Array.prototype.slice.call(arguments,4),s=r?r.length:0,a=0;a<s;a++)o[i[a]]=r[a];this.routeHandler(e,t,o)}.bind(r,a,t,n,o))},d=0;d<o;d++)u(d);s.on("/*",function(){console.log("got an unknown route. need to show 404 here")}),s.on("",function(){console.log("Got the <empty> route")})}}},{key:"routeHandler",value:function(e,t,i){var n=window.location.hash.slice(1),o=n.indexOf("?"),r={};0<=o&&n.length>o&&(r=queryString.parse(n.substring(o+1))),this.fire("sb-route-complete",{mod:e,path:t,route:c[e][t],pathParams:i,params:r})}},{key:"routeChanged",value:function(e,t){if(this.autoHash&&e){var i=window.location.hash.slice(1)==this.route;window.location.hash=this.route,i&&this.router.dispatch("on",e)}}}]),o=e)),t("Router",o),Polymer(o)}}}),System.register("common/core/sb-toast/Toast.js",[],function(t,e){var u,i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t("Toast",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-toast",this.properties={messages:{type:Array,notify:!0},type:String}}},{key:"ready",value:function(){this.hasMessages=!1,this.messagesModel=[],this.repeatHandlers={}}},{key:"validation",value:function(){if(!this.messages)return this.messagesModel=[],this.hasMessages=!1,void(this.repeatHandlers={});var e={type:"error",class:"slds-theme--error",msgs:[],icon:"sf-icon-error"},t={type:"success",class:"slds-theme--success",msgs:[],icon:"sf-icon-notification"},i={type:"warning",class:"slds-theme--warning",msgs:[],icon:"sf-icon-warning"},n={type:"info",class:"",msgs:[],icon:"sf-icon-info"},o=this.messages.length;if("object"==u(this.messages[0]))for(var r=0;r<o;r++){var s=this.messages[r].msg.split("\n");"error"==this.messages[r].type?e.msgs.push(s):"warning"==this.messages[r].type?i.msgs.push(s):"success"==this.messages[r].type?t.msgs.push(s):n.msgs.push(s)}else if("string"==typeof this.messages[0]){for(var a=[],l=0;l<o;l++)a.push(this.messages[l].split("\n"));"error"==this.type?e.msgs=a:"success"==this.type?t.msgs=a:"warning"==this.type?i.msgs=a:n.msgs=a}this.messages&&0<this.messages.length?(this.removeRepeatedMessages(e,"error"),0<e.msgs.length&&this.push("messagesModel",e),this.removeRepeatedMessages(t,"success"),0<t.msgs.length&&this.push("messagesModel",t),this.removeRepeatedMessages(t,"warning"),0<i.msgs.length&&this.push("messagesModel",i),this.removeRepeatedMessages(n,"info"),0<n.msgs.length&&this.push("messagesModel",n),this.hasMessages=!0):(this.hasMessages=!1,this.messages=void 0)}},{key:"removeRepeatedMessages",value:function(e,t){if(this.messagesModel)for(var i=0,n=this.messagesModel.length;i<n;i++){var o=this.messagesModel[i];if(t===o.type){var r=this.isMessageRepeated(o,e);r&&(e.msgs=[]),this.toggleRepeatClass(t,r,i)}}}},{key:"isMessageRepeated",value:function(e,t){for(var i=0,n=e.msgs.length;i<n;i++)for(var o=0,r=e.msgs[i].length;o<r;o++)if(void 0!==t.msgs[i]&&e.msgs[i][o]!==t.msgs[i][o])return!1;return!0}},{key:"toggleRepeatClass",value:function(e,t,i){this.removeAnimationListeners(e,i);var n=this.addAnimationListeners(e,i);this.toggleClass("repeat",t,n)}},{key:"removeAnimationListeners",value:function(e,t){var i=e+"_"+t,n=this.repeatHandlers[i];if(n){var o=this.$$("#"+i);o.removeEventListener("animationend",n),o.removeEventListener("webkitAnimationEnd",n)}}},{key:"addAnimationListeners",value:function(e,t){var i=e+"_"+t,n=this.$$("#"+i),o=this.repeatHandlers[i]||this.removeRepeatClass.bind(this,n);return this.repeatHandlers[i]=o,n.addEventListener("animationend",o),n.addEventListener("webkitAnimationEnd",o),n}},{key:"removeRepeatClass",value:function(e){this.toggleClass("repeat",!1,e)}},{key:"closeMessage",value:function(e){for(var t=e.model.__data__.messages.type,i=0,n=0;n<this.messagesModel.length;n++)this.messagesModel[n].type==t&&(delete this.repeatHandlers[t+"_"+i++],this.splice("messagesModel",n,1),n--);0==this.messagesModel.length&&(this.hasMessages=!1,this.messages=void 0)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["validation(messages)"]}}]),i=e)),t("Toast",i),Polymer(i)}}}),System.register("common/core/sf-loading-spinner/LoadingSpinner.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LoadingSpinner",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sf-loading-spinner",this.properties={show:{type:Boolean,value:!1},position:{type:String,value:"fixed"},size:{type:String,value:"large"}}}}]),i=e)),t("LoadingSpinner",i),Polymer(i)}}}),System.register("common/data/cache/Cache.js",[],function(t,e){var s,i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}s={},t("Cache",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,null,[{key:"add",value:function(e,t,i,n,o){if(e&&t&&i){if(s[n=n||"value"]||(s[n]={}),!s[n][e]&&(s[n][e]={},o&&"value"==n&&"LineEditor"==e)){var r=document.createEvent("Event");r.initEvent(e+"-cached",!0,!0),document.dispatchEvent(r)}s[n][e][t]=i}}},{key:"get",value:function(e,t,i){return e&&t&&s[i=i||"value"]&&s[i][e]?s[i][e][t]:null}},{key:"remove",value:function(e,t,i){if(!e||!t||!i)return null;s[i=i||"value"]&&s[i][e]&&delete s[i][e][t]}}]),i=e)),t("Cache",i)}}}),System.register("common/data/client/ConnectionClient.js",["common/data/client/RemoteSession.js","common/oauth/OAuth.js"],function(e,t){var i,o,r;return{setters:[function(e){i=e.RemoteSession},function(e){o=e.OAuth}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.prefix=e}e("ConnectionClient",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"getConnection",value:function(){return"undefined"!=typeof Visualforce?Promise.resolve(this.getRemoteConnection()):(new o).getConnection()}},{key:"getRemoteConnection",value:function(e){return new i(window.sb.vfSessionId,e).getConnection()}}]),r=t)),e("ConnectionClient",r)}}}),System.register("common/data/client/RemoteClient.js",["common/data/client/ConnectionClient.js","common/data/client/RestClient.js","perfMetrics/MetricsService.js"],function(e,t){var i,o,r,s;return{setters:[function(e){i=e.ConnectionClient},function(e){o=e.RestClient},function(e){r=e.MetricsService}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.VF_MAX_INPUT=1e6,this._remoteConnection=(new i).getRemoteConnection(),this._restClient=new o(this._remoteConnection),this.metricsService=e||new r}e("RemoteClient",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"read",value:function(e,t,i){return this.prefix=e,this._remote("read",t,i)}},{key:"load",value:function(e,t,i,n){this.prefix=e;var o=JSON.stringify(n);return!0===this._isPayloadTooLarge([o,i])?this._restClient.load(e,t,i,n):this._remote("load",t,i,o)}},{key:"save",value:function(e,t,i){this.prefix=e;var n="string"==typeof i?i:JSON.stringify(i);return!0===this._isPayloadTooLarge([n,t])?this._restClient.save(e,t,i):this._remote("save",t,n)}},{key:"describe",value:function(e){return this._remoteConnection.describe(e)}},{key:"query",value:function(e,t){return(new i).getRemoteConnection(t).query(e)}},{key:"_remote",value:function(e,t,r,s){var a=this._getAction()+"."+e;return s?new Promise(function(i,n){var o=this.metricsService.startServiceRequest(t);Visualforce.remoting.Manager.invokeAction(a,t,r,s,this.metricsService.canGatherMetrics(),function(e,t){this._callback(e,t,i,n,o)}.bind(this),{escape:!1,timeout:12e4})}.bind(this)):new Promise(function(i,n){var o=this.metricsService.startServiceRequest(t);Visualforce.remoting.Manager.invokeAction(a,t,r,this.metricsService.canGatherMetrics(),function(e,t){this._callback(e,t,i,n,o)}.bind(this),{escape:!1,timeout:12e4})}.bind(this))}},{key:"_getAction",value:function(){return this._getPrefix()+"ServiceRouter"}},{key:"_getPrefix",value:function(){return this.prefix?this.prefix+".":""}},{key:"_callback",value:function(e,t,i,n,o){if(!t.status)return this.metricsService.stopServiceRequest(o),void n(t.message);var r=this._parse(e),s=-1!=Object.keys(r).indexOf("spt")?r.spt:void 0;r=s||0===s?this._parse(r.response):r,this.metricsService.stopServiceRequest(o,s),i(r)}},{key:"_parse",value:function(t){try{return JSON.parse(t)}catch(e){return t}}},{key:"_isPayloadTooLarge",value:function(e){return JSON.stringify(e).length>this.VF_MAX_INPUT}}]),s=t)),e("RemoteClient",s)}}}),System.register("common/data/client/RemoteSession.js",["common/core/AppContext.js"],function(e,t){var o,r;return{setters:[function(e){o=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.sessionId=e,this.version=t||"36.0"}e("RemoteSession",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"getConnection",value:function(){var e=new jsforce.Connection({sessionId:this.sessionId,version:this.version,instanceUrl:sb.common.core.AppContext.user.inCommunity?sb.common.core.AppContext.org.orgUrl:sb.common.core.AppContext.org.orgInstanceUrl});return e.oik=o.user.oik,e}}]),r=i)),e("RemoteSession",r)}}}),System.register("common/data/client/RestClient.js",["common/oauth/OAuth.js","perfMetrics/MetricsService.js"],function(e,t){var o,r,s;return{setters:[function(e){o=e.OAuth},function(e){r=e.MetricsService}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.connection=e,this.metricsService=t||new r}e("RestClient",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"read",value:function(e,r,s){return this.prefix=e,new Promise(function(n,o){this._getApex().then(function(e){var t="&reader="+r+"&uid="+s+"&spt="+this.metricsService.canGatherMetrics(),i=this.metricsService.startServiceRequest(t);e.get(this._getEndpoint()+t).then(function(e){this._resolve(this._parse(e),n,i)}.bind(this),function(e){this._reject(o,e.message||e,i)}.bind(this))}.bind(this),function(e){o(e.message||e)})}.bind(this))}},{key:"load",value:function(e,r,s,a){return this.prefix=e,new Promise(function(n,o){this._getApex().then(function(e){var t="&loader="+r+"&uid="+s+"&spt="+this.metricsService.canGatherMetrics(),i=this.metricsService.startServiceRequest(t);e.patch(this._getEndpoint()+t,{context:JSON.stringify(a)}).then(function(e){this._resolve(this._parse(e),n,i)}.bind(this),function(e){this._reject(o,e.message||e,i)}.bind(this))}.bind(this),function(e){o(e.message||e)})}.bind(this))}},{key:"save",value:function(e,o,r){return this.prefix=e,new Promise(function(i,n){this._getApex().then(function(e){var t=this.metricsService.startServiceRequest(o);e.post(this._getEndpoint()+"&spt="+this.metricsService.canGatherMetrics(),{saver:o,model:"string"==typeof r?r:JSON.stringify(r)}).then(function(e){this._resolve(this._parse(e),i,t)}.bind(this),function(e){this._reject(n,e.message||e,t)}.bind(this))}.bind(this),function(e){n(e.message||e)})}.bind(this))}},{key:"describe",value:function(t){return this.getConnection().then(function(e){return e.describe(t)})}},{key:"query",value:function(t){return this.getConnection().then(function(e){return e.query(t)})}},{key:"streamFileContents",value:function(o,r,s){var a=this;return new Promise(function(i,n){a._getApex().then(function(e){var t=a.metricsService.startServiceRequest(r);e.post(null,{saver:"sobjects",model:"/sobjects/"+o+"/"+r+"/"+s}).then(function(e){a._resolve(a._parse(e),i,t)},function(e){a._reject(n,e.message||e,t)})},function(e){n(e.message||e)})})}},{key:"setConnection",value:function(e){this.connection=e}},{key:"getConnection",value:function(){return this.connection?Promise.resolve(this.connection):"undefined"==typeof window?Promise.reject("Connection not set"):(this.oauth=this.oauth||new o,this._getConnection(this.oauth))}},{key:"_getConnection",value:function(e){return new Promise(function(t,i){e.getConnection().then(function(e){this.connection=e,t(this.connection)}.bind(this),function(e){i(e.message||e)})}.bind(this))}},{key:"_getApex",value:function(){return this.getConnection().then(function(e){return Promise.resolve(e.apex)})}},{key:"_getEndpoint",value:function(){return this._getPrefix()+"/ServiceRouter?"+(void 0===this.connection.oik?"":"oik="+this.connection.oik)}},{key:"_getPrefix",value:function(){return this.prefix?"/"+this.prefix:""}},{key:"_resolve",value:function(e,t,i){var n=-1!=Object.keys(e).indexOf("spt")?e.spt:void 0;this.response=n||0===n?this._parse(e.response):e,this.metricsService.stopServiceRequest(i,n),t(this.response)}},{key:"_reject",value:function(e,t,i){(new r).stopServiceRequest(i),e(this._adjustErrorMessage(t))}},{key:"_adjustErrorMessage",value:function(e){return"expired access/refresh token"===e&&(e+=" - to authorize go to http://localhost:"+location.port+"/common/oauth"),e}},{key:"_parse",value:function(t){try{return JSON.parse(t)}catch(e){return t}}}]),s=i)),e("RestClient",s)}}}),System.register("common/data/client/ServiceClient.js",["common/data/client/RemoteClient.js","common/data/client/RestClient.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.RemoteClient},function(e){o=e.RestClient}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.client="undefined"!=typeof Visualforce?new i:new o}t("ServiceClient",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"read",value:function(e,t,i){return this.client.read(e,t,i)}},{key:"load",value:function(e,t,i,n){return this.client.load(e,t,i,n)}},{key:"save",value:function(e,t,i){return this.client.save(e,t,i)}},{key:"md",value:function(e,t,i){return this.client.load(e,"OAuthExtension.MetadataReader",null,{type:t,items:i})}},{key:"describe",value:function(e,t){return this.client.describe(t)}},{key:"query",value:function(e,t){return this.client.query(e,t)}},{key:"streamFileContents",value:function(e,t,i){return this.client.streamFileContents(e,t,i)}},{key:"setConnection",value:function(e){"function"==typeof this.client.setConnection&&this.client.setConnection(e)}}]),r=e)),t("ServiceClient",r)}}}),System.register("common/data/format/DataBuilder.js",["common/data/format/JsonFormatter.js"],function(e,t){var r,i;return{setters:[function(e){r=e.JsonFormatter}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.pretty=e,this.data={}}e("DataBuilder",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"addQuote",value:function(e,t,i){return this.addObject(e,t,!0,i,!1)}},{key:"addObject",value:function(e,t,i,n,o){return this.data[e]=null!=t?new r(i,n,this.pretty).format(t,o):t,this}},{key:"addInt",value:function(e,t){try{return t=parseInt(t),isNaN(t)||(this.data[e]=t),this}catch(e){return this}}},{key:"add",value:function(e,t){return this.data[e]=t,this}},{key:"build",value:function(){return this.data}}]),i=t)),e("DataBuilder",i)}}}),System.register("common/data/format/ErrorFormatter.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.message="string"==typeof e?e:e[0]}e("ErrorFormatter",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"truncate",value:function(){var e=this.message.split("\n")[0].split(":");return 1<e.length?e[0].startsWith("System")?[e.splice(1,e.length-1).join(":")]:[e.join(":")]:e}}]),i=t)),e("ErrorFormatter",i)}}}),System.register("common/data/format/JsonFormatter.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.omitNull=e,this.omitRelationships=t,this.pretty=i,this.requiredFieldSet=this.getRequiredFields(n)}e("JsonFormatter",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"getRequiredFields",value:function(e){var t=new Set;for(var i in e)for(var n=0,o=e[i].length;n<o;n++)t.add(e[i][n]);return t}},{key:"format",value:function(e,t){if(void 0!==e){if(null===e)return JSON.stringify(e);var i=this.pretty;"number"!=typeof i&&(i=i?2:null);var n=JSON.stringify(e,this._replacer.bind(this),i);return!0===t?n:JSON.parse(n)}}},{key:"_replacer",value:function(e,t){if(void 0!==t&&"_transient_"!==e&&(!this.omitNull||null!==t||this.requiredFieldSet.has(e))&&!(this.omitRelationships&&e.endsWith&&e.endsWith("__r")))return"#Error!"===t?this.omitNull?void 0:null:t}}]),i=o)),e("JsonFormatter",i)}}}),System.register("common/data/minimize/QuoteMinimizer.js",["common/aggregate/quote-line-aggregator/QuoteLineAggregator.js"],function(e,t){var c,i;return{setters:[function(e){c=e.QuoteLineAggregator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.quote=e,this.products=t,this.groupKey=i,this.stripLinesThreshold=n,this.stripLinesMessage=o}e("QuoteMinimizer",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(r,[{key:"reduceQuote",value:function(e){if(this.originalLines=this.quote.lineItems,!(this.quote.partialVO=!0)===e)return this.quote.lineItems=[],this.quote;var t=this.stripLinesMessage.replace("{0}",this.quote.record.Id).replace("{1}",this.stripLinesThreshold);console.log(t);var i=new c(this.quote);this.quote.existingProductIds=i.getExistingProductIdsFromLines();var n=i.getSegmentTemplatesByDimensionTypeForGroupKey(this.groupKey);this.quote.segmentTemplatesByDimensionTypeByGroupKey={},this.quote.segmentTemplatesByDimensionTypeByGroupKey[(this.groupKey||-1)+""]=n,this.quote.emptyGroupKeys=i.getKeysOfEmptyGroups(),this.products&&(this.requiredKeys=this._getNecessaryLineKeys());var o=[],r=!0,s=!1,a=void 0;try{for(var l,u=this.quote.lineItems[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var d=l.value;this.requiredKeys.has(d.key)&&o.push(d)}}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}return this.quote.lineItems=o,this.quote}},{key:"revertQuote",value:function(){return this.quote.partialVO=!1,this.quote.lineItems=this.originalLines,delete this.quote.existingProductIds,delete this.quote.segmentTemplatesByDimensionTypeByGroupKey,delete this.quote.emptyGroupKeys,this.quote}},{key:"getRequiredKeys",value:function(){return this.requiredKeys}},{key:"_getNecessaryLineKeys",value:function(){var a=this,l="Quote__c"==this.quote.record.attributes.type?"":this.quote.record.attributes.type.slice(0,-8),u=new Set;return this.products.forEach(function(e){if(e.configuration&&e.configuration.lineItemKey)for(var t=a.quote.lineItems.length,i=0;i<t;i++){var n=a.quote.lineItems[i];if(n.key===e.configuration.lineItemKey){a._addLineKeyWithRecursiveCallOnChildrenAndSource(l,u,n);break}}if(e.upgradedAssetId)for(var o=a.quote.lineItems.length,r=0;r<o;r++){var s=a.quote.lineItems[r];if(s.record[l+"UpgradedAsset__c"]===e.upgradedAssetId&&s.record[l+"Existing__c"]){a._addLineKeyWithRecursiveCallOnChildrenAndSource(l,u,s);break}}}),u}},{key:"_addLineKeyWithRecursiveCallOnChildrenAndSource",value:function(n,o,r){var s=this;if(!o.has(r.key)){var a=r.record[n+"Bundle__c"],l=null!=r.sourceLineKey;(a||l)&&this.quote.lineItems.forEach(function(e){var t=a&&e.parentItemKey===r.key,i=l&&e.key===r.sourceLineKey;(t||i)&&s._addLineKeyWithRecursiveCallOnChildrenAndSource(n,o,e)}),o.add(r.key)}}}]),i=r)),e("QuoteMinimizer",i)}}}),System.register("common/data/sb-describe/Describe.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Describe",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-describe",this.properties={objects:Array,fields:Array,cache:{type:String,value:"describe"},describe:{type:Object,notify:!0},error:{type:Object,notify:!0},background:{type:Boolean,value:!1}}}},{key:"describeObjects",value:function(){var s=[];this.objects.forEach(function(e){s.push(e)}),this._describe(this.objects).then(function(e){for(var t=null,i={objects:s},n=0,o=e.length;n<o;n++){var r=e[n];r&&((t=t||{})[r.name]=r)}t&&(i.md=t,this.describe=i),this.waiting=!1}.bind(this),function(e){this.waiting=!1,this.error=e||e.message}.bind(this))}},{key:"describeFields",value:function(){var c=[];this.fields.forEach(function(e){c.push(e)});for(var h={},e=0,t=this.fields.length;e<t;e++){var i=this.fields[e].split("."),n=i[0],o=i[1];h[n]=h[n]||{},h[n][o]=!0}this._describe(Object.keys(h)).then(function(e){for(var i=null,n={},t={fields:c},o=[],r=0,s=e.length;r<s;r++){var a=e[r];if(a){i=i||{};for(var l=h[a.name],u=0,d=a.fields.length;u<d;u++)n[a.name+"."+a.fields[u].name]=a.fields[u],l[a.fields[u].name]&&(i[a.name+"."+a.fields[u].name]=a.fields[u],a.fields[u].tableName=a.name,null!=a.fields[u].controllerName&&o.push(a.fields[u]))}}o.forEach(function(e){var t=e.tableName+"."+e.controllerName;e.controllingField=n[t],e.controllingField.controllingPicklist=!0,i[t]=e.controllingField}),i&&(t.md=i,this.describe=t),this.waiting=!1}.bind(this),function(e){this.waiting=!1,this.error=e||e.message}.bind(this))}},{key:"_describe",value:function(e){this.waiting=!0;for(var t=[],i=0,n=e.length;i<n;i++)t.push(this.$.service.describe({sObject:e[i]}));return Promise.all(t)}},{key:"observers",get:function(){return["describeObjects(objects)","describeFields(fields)"]}}]),i=e)),t("Describe",i),Polymer(i)}}}),System.register("common/data/sb-service/Service.js",["common/core/AppContext.js","common/data/client/ServiceClient.js","common/data/cache/Cache.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.AppContext},function(e){o=e.ServiceClient},function(e){r=e.Cache}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Service",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-service",this.properties={reader:String,loader:String,saver:String,uid:String,model:Object,context:Object,mdType:String,mdItems:Array,sObject:String,soql:String,fileType:String,fileId:String,fileContentsField:String,cache:String,waiting:{type:Boolean,notify:!0},response:{type:Object,notify:!0},error:{type:Object,notify:!0},client:{type:Object,value:function(){return new o}},transient:{type:Boolean},background:{type:Boolean,value:!1},prefix:{type:String,value:function(){return i.org.prefix?i.org.prefix:""}},ignoreCache:{type:Boolean,value:!1},version:String}}},{key:"read",value:function(e){Polymer.Base.extend(this,e);var t=this._returnPromiseIfCachedResponse();return t||this._response(this.client.read(this.prefix,this.reader,this.uid))}},{key:"load",value:function(e){Polymer.Base.extend(this,e);var t=this._returnPromiseIfCachedResponse();return t||this._response(this.client.load(this.prefix,this.loader,this.uid,this.context))}},{key:"save",value:function(e){return Polymer.Base.extend(this,e),this.transient?this._response(Promise.resolve(this.model)):this._response(this.client.save(this.prefix,this.saver,this.model))}},{key:"md",value:function(e){Polymer.Base.extend(this,e);var t=this._returnPromiseIfCachedResponse();return t||this._response(this.client.md(this.prefix,this.mdType,this.mdItems))}},{key:"describe",value:function(e){Polymer.Base.extend(this,e);var t=this._returnPromiseIfCachedResponse(this.sObject);return t||this._response(this.client.describe(this.prefix,this.sObject),this.sObject)}},{key:"streamFileContents",value:function(e){Polymer.Base.extend(this,e);var t=this._returnPromiseIfCachedResponse();return t||this._response(this.client.streamFileContents(this.fileType,this.fileId,this.fileContentsField))}},{key:"query",value:function(e){Polymer.Base.extend(this,e);var t=this._returnPromiseIfCachedResponse();return t||this._response(this.client.query(this.soql,this.version))}},{key:"_read",value:function(){this.read().then(function(){},function(e){console.error(e.message||e)})}},{key:"_load",value:function(){this.load().then(function(){},function(e){console.error(e.message||e)})}},{key:"_save",value:function(){this.save().then(function(){},function(e){console.error(e.message||e)})}},{key:"_md",value:function(){this.md().then(function(){},function(e){console.error(e.message||e)})}},{key:"_describe",value:function(){this.describe().then(function(){},function(e){console.error(e.message||e)})}},{key:"_query",value:function(){this.query().then(function(){},function(e){console.error(e.message||e)})}},{key:"_streamFileContents",value:function(){this.streamFileContents().then(function(){},function(e){console.error(e.message||e)})}},{key:"_spinner",value:function(){this.spinner=this.waiting&&!this.background}},{key:"_returnPromiseIfCachedResponse",value:function(e){if(!0===this.ignoreCache)return!1;e=e||this.uid;var t=r.get(this.cache,e);if(t)return this.response=t,Promise.resolve(this.response);var i=r.get(this.cache,e,"promise");return i?(i._services=i._services||[],-1===i._services.indexOf(this)&&i._services.push(this),i):this.transient?Promise.resolve(this.response):null}},{key:"_response",value:function(t,i){return this.waiting=!0,r.add(this.cache,i||this.uid,t,"promise"),t.then(function(e){return this.waiting=!1,null!=e&&(this.response=e,(t._services||[]).forEach(function(e){e.response=this.response}.bind(this)),r.add(this.cache,i||this.uid,this.response,"value",this)),r.remove(this.cache,i||this.uid,"promise"),Promise.resolve(this.response)}.bind(this),function(e){return this.waiting=!1,e&&(this.error=this._createError(e),(t._services||[]).forEach(function(e){e.error=this.error}.bind(this))),r.remove(this.cache,i||this.uid,"promise"),Promise.reject(this.error)}.bind(this))}},{key:"createError",value:function(e){return this._createError(e)}},{key:"_createError",value:function(e){var t,i=e.message||e,n={message:i};if(-1!=i.indexOf("ValidationException: [")||i.startsWith("[")){var o=i.indexOf("["),r=i.indexOf("]",o)+1;o<r&&(t=i.substring(o,r))}if(t)try{var s=t.replace(/\n/g,"\\n").replace(/\r/g,"\\r"),a=JSON.parse(s);n.validations=a}catch(e){}return n}},{key:"observers",get:function(){return["_read(reader, uid, prefix)","_save(saver, model, prefix)","_load(loader, uid, context, prefix)","_md(mdType, mdItems, prefix)","_describe(sObject, prefix)","_query(soql)","_streamFileContents(uid, fileType, fileId, fileContentsField)","_spinner(waiting, background)"]}}]),s=e)),t("Service",s),Polymer(s)}}}),System.register("common/filter/searcher/Searcher.js",["common/Util.js","common/data/client/ServiceClient.js","common/core/AppContext.js","common/forms/sb-lookup/map/LookupNameMapper.js"],function(e,t){var o,k,i;return{setters:[function(e){e.Util},function(e){o=e.ServiceClient},function(e){e.AppContext},function(e){k=e.LookupNameMapper}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=e,this.searchFilterData={}}e("Searcher",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"buildFields",value:function(e){return e}},{key:"getSearchTable",value:function(){return this.model.targetObjectName}},{key:"getGroupKey",value:function(e){return this.model.hasCustomSearchFilters?e.record.Id:e.targetFieldName}},{key:"setDefaultFilterValues",value:function(e,t){var c={},i=[];if(this.model.hasCustomSearchFilters){var n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=!0,d=!1,h=void 0;try{for(var p,f=this.model.searchFilters[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var g=p.value;if(g.record.Id===l){t&&this.isLookupType(t[l].model.type)&&i.push(this.queryLookupFilterName(g.stringValue,t[l].model.referenceTo[0])),c[l]={value:void 0===this.searchFilterData[l]?g.stringValue?g.stringValue:"":this.searchFilterData[l].value,field:void 0===this.searchFilterData[l]?g.targetFieldName?g.targetFieldName:"":this.searchFilterData[l].field,hidden:g.hidden};break}}}catch(e){d=!0,h=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw h}}}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}else{var y=!0,v=!1,m=void 0;try{for(var b,_=e[Symbol.iterator]();!(y=(b=_.next()).done);y=!0){var S=b.value;c[S]={value:void 0===this.searchFilterData[S]?t[S].stringValue:this.searchFilterData[S].value},this.searchFilterData[S]&&this.searchFilterData[S].label&&(c[S].label=this.searchFilterData[S].label)}}catch(e){v=!0,m=e}finally{try{!y&&_.return&&_.return()}finally{if(v)throw m}}}return new Promise(function(d){0===i.length?(this.searchFilterData=this.handleDynamicSearchFilters(c),d(c)):Promise.all(i).then(function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value.records[0];if(s){var a=new k(s.attributes.type).getNameField();for(var l in c){var u=c[l];if(u.value.substring(0,15)===s.Id.substring(0,15)){u.label=s[a];break}}}}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}this.searchFilterData=this.handleDynamicSearchFilters(c),d(c)}.bind(this))}.bind(this))}},{key:"handleDynamicSearchFilters",value:function(e){if(!this.dynamicSearchFilters)return e;var t=!0,i=!1,n=void 0;try{for(var o,r=this.dynamicSearchFilters[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;"Optional Filter"===s.type&&e[s.targetFieldName]&&(e[s.targetFieldName].value=s.stringValue)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return e}},{key:"getFilterContext",value:function(){var e={};if(this.model.hasCustomSearchFilters){for(var t in this.searchFilterData){var i=!0,n=!1,o=void 0;try{for(var r,s=this.model.searchFilters[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;if(t===a.record.Id&&this.searchFilterData[t]){if(!0===this.isBlank(this.searchFilterData[t].value))continue;e[a.targetFieldName]=this.searchFilterData[t].value}}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}}return e}for(var l in this.searchFilterData)!0!==this.isBlank(this.searchFilterData[l].value)&&(e[l]=this.searchFilterData[l].value);return e}},{key:"getAdditionalProperties",value:function(){if(this.dynamicSearchFilters){for(var e=[],t=0,i=this.dynamicSearchFilters.length;t<i;t++)"Default Filter"===this.dynamicSearchFilters[t].type&&e.push(JSON.stringify(this.dynamicSearchFilters[t]));return e}}},{key:"clearFields",value:function(){var e={};for(var t in this.searchFilterData)e[t]=JSON.parse(JSON.stringify(this.searchFilterData[t])),e[t].value="";return this.searchFilterData=e}},{key:"runOnLoad",value:function(e){this.searchFilterData=e}},{key:"isLookupType",value:function(e){return"reference"===e||"id"===e}},{key:"queryLookupFilterName",value:function(e,t){var i=new k(t).getNameField(),n=e?"'"+e+"'":null;return(new o).query(("SELECT Id, "+i+" FROM "+t+" WHERE Id = ").concat(n))}},{key:"hasSearchFilterValues",value:function(){var e=this.getFilterContext();for(var t in e)if(null!=e[t])return!0;return!1}},{key:"isBlank",value:function(e){return null===e||""===e||void 0===e}}]),i=t)),e("Searcher",i)}}}),System.register("common/forms/sb-checkbox/Checkbox.js",["common/layout/fields/FieldHider.js"],function(t,e){var i,o;return{setters:[function(e){i=e.FieldHider}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Checkbox",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-checkbox",this.properties={focusOnAttached:Boolean,applyFocus:{type:Boolean,observer:"_applyFocus"},value:{notify:!0,observer:"_boolify"},hide:{type:Object,observer:"hideShow"}}}},{key:"_boolify",value:function(){"boolean"!=typeof this.value&&(this.value=null!==this.value&&"true"===this.value.toLowerCase())}},{key:"attached",value:function(){this.focusOnAttached&&this.focus()}},{key:"focus",value:function(){this.$.checkbox.focus()}},{key:"blur",value:function(){this.fire("blur")}},{key:"hideShow",value:function(){new i(this.hide,Polymer.Base).applyTo(this.$.checkbox)}},{key:"_applyFocus",value:function(){this.applyFocus&&this.focus()}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),o=e)),t("Checkbox",o),Polymer(o)}}}),System.register("common/forms/sb-date-range/DateRange.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("DateRange",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-daterange",this.properties={formattedValue:Object}}},{key:"ready",value:function(){this.addEventListener("selected-date-changed",function(){this.fire("selected-date-range-changed",{value:this.formattedValue})}.bind(this))}}]),i=e)),t("DateRange",i),Polymer(i)}}}),System.register("common/forms/sb-discount/Discount.js",["common/forms/NumberParser.js","quotes/layout/sb-le-table-cell/DiscountConverter.js","quotes/models/UiNotifier.js"],function(t,e){var i,r,o,s,a,l;return{setters:[function(e){i=e.NumberParser},function(e){r=e.getUnitAndDisplayValue,o=e.setDiscountValue,s=e.convertDiscountValue},function(e){a=e.registerComponent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Discount",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-discount",this.properties={model:{type:Object,observer:"_modelChanged"},property:String,focusOnAttached:Boolean,applyFocus:{type:Boolean,observer:"_applyFocus"},unitChanged:Object,numberParser:{type:Object,value:function(){return new i}},formatter:Object,displayValue:String,original:Object}}},{key:"ready",value:function(){var e=this.$.discount.querySelector(".myinput");e.addEventListener("change",this.checkThenSetDiscountValue.bind(this)),e.addEventListener("focus",this.focused.bind(this)),e.addEventListener("blur",this.deferBlur.bind(this)),e.addEventListener("keydown",this.tabBlur.bind(this,!0));var t=this.$.discountUnits.querySelector(".myselect");t.addEventListener("change",this.convertDiscountValueThenUpdate.bind(this)),t.addEventListener("focus",this.focused.bind(this)),t.addEventListener("blur",this.deferBlur.bind(this)),t.addEventListener("keydown",this.tabBlur.bind(this,!1))}},{key:"attached",value:function(){this.focusOnAttached&&this.focus()}},{key:"focus",value:function(){this.$.discount.focus()}},{key:"focused",value:function(){this.blurred&&clearTimeout(this.blurred)}},{key:"deferBlur",value:function(){this.tabBlurred?this.tabBlurred=!1:this.blurred=setTimeout(function(){this.blurDiscount(!0)}.bind(this),1)}},{key:"tabBlur",value:function(e,t){27===t.keyCode&&this.renderReadOnly?this.resetToOriginal():9===t.keyCode&&(this.tabBlurred=!0,(e&&t.shiftKey||!e&&!t.shiftKey)&&this.blurDiscount(!1,t))}},{key:"blurDiscount",value:function(e,t){e?this._blur(t):setTimeout(function(){this._blur(t)}.bind(this),10)}},{key:"_blur",value:function(e){var t=""!==this.$.discount.value?this.numberParser.parse(this.$.discount.value):null;o(this.model,this.property,t),this.fire("sb-discount-blur"),e&&this.fire("sb-discount-keydown",{keyCode:9,shiftKey:e.shiftKey})}},{key:"checkThenSetDiscountValue",value:function(e){var t=r(this.model,this.property).displayValue,i=""!==e.target.value?this.numberParser.parse(e.target.value):null;t!=i&&(o(this.model,this.property,i),this.fire("sb-discount-change",{value:i}))}},{key:"convertDiscountValueThenUpdate",value:function(e){s(this.model,this.property,e.target.value),this.displayValue=void 0,this.displayValue=this.formatter.format(r(this.model,this.property).displayValue)}},{key:"resetToOriginal",value:function(){this.checkThenSetDiscountValue({target:{value:this.original.label}}),this.convertDiscountValueThenUpdate({target:{value:this.original.unitValue}}),this.checkThenSetDiscountValue({target:{value:this.original.label}}),this.convertDiscountValueThenUpdate({target:{value:this.original.unitValue}}),this.selectUnit(r(this.model,this.property).unit)}},{key:"selectUnit",value:function(e){for(var t=this.$.discountUnits.querySelector(".myselect"),i=t.options,n=0,o=i.length;n<o;n++)if(i[n].value===e){t.selectedIndex=n;break}}},{key:"_applyFocus",value:function(){this.applyFocus&&this.focus()}},{key:"_runConverter",value:function(e,t){var i=r(e,t),n=i.units,o=i.unit;this.$.discountUnits.value=o,this.$.discountUnits.options=n}},{key:"_modelChanged",value:function(){a(this)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_runConverter(model, property)"]}}]),l=e)),t("Discount",l),Polymer(l)}}}),System.register("common/forms/sb-datepicker/Datepicker.js",["common/core/AppContext.js","common/core/sb-i18n/I18n.js","common/forms/DateParser.js"],function(t,e){var s,i,o,a,r,l;return{setters:[function(e){s=e.AppContext},function(e){i=e.I18n},function(e){o=e.DateParser}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("Datepicker",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,s),r(e,[{key:"beforeRegister",value:function(){this.is="sb-datepicker",this.properties=Polymer.Base.extend({selectedDate:{type:Date,value:null,observer:"selectedDateChanged"},range:{type:Number,value:30},focusOnAttached:Boolean,applyFocus:{type:Boolean,observer:"_applyFocus"},i18n:{type:Object,value:function(){return s.properties.i18n.value()}},dateParser:{type:Object,value:function(){return new o}}},s.properties)}},{key:"ready",value:function(){var e=i.getLocaleData();this.isActive=!1,this.weeks=[],this.weekDays=e&&e.date?e.date.calendars.gregory.days.short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],this.months=e&&e.date?e.date.calendars.gregory.months.long:["January","February","March","April","May","June","July","August","September","October","November","December"],this.year=this.date.getFullYear(),this.month=this.date.getMonth(),this.monthName=this.months[this.month].toUpperCase(),this.day=this.date.getDate()}},{key:"getDate",value:function(e){return"object"!=(void 0===e?"undefined":a(e))?new Date(this.year,this.month,e):e.getDate()}},{key:"getClass",value:function(e){"object"!=(void 0===e?"undefined":a(e))&&(e=new Date(this.year,this.month,e));var t="";return e.getMonth()!==this.month?t+="notCurrent":(e.getFullYear()===this.date.getFullYear()&&e.getMonth()===this.date.getMonth()&&e.getDate()===this.date.getDate()&&(t+="selected"),e.getFullYear()===this.year&&e.getMonth()===this.month&&e.getDate()===this.date.getDate()&&(t+=" current")),t}},{key:"selectedDateChanged",value:function(e,t){if(this.initialized||this.selectedDate&&!isNaN(new Date(this.selectedDate).getTime()))return""===this.selectedDate&&""!==this.dateFormatted?void(this.dateFormatted=""):void this._selectedDateChanged(t,this.selectedDate,null==this.selectedDate);this._selectedDateChanged(t,new Date,!0,!0),this.focus()}},{key:"_selectedDateChanged",value:function(e,t,i,n){this.initialized=!0;var o=null;if(t&&"string"==typeof t){var r=void 0;(r=t.indexOf("T")<0?t.split("-"):t.split("T")[0].split("-"))&&3==r.length&&(o=new Date(r[0],r[1]-1,r[2]))}if(o=o||(null!=t?new Date(t):new Date),this.date=o,this.updateVariables(),!i)try{this.dateFormatted=this.date.toLocaleDateString(this.user.locale)}catch(e){this.dateFormatted=this.date.toLocaleDateString()}if(!n){var s=void 0===e;this.fire("selected-date-changed",{value:t,suppressImmediateCalcuation:s})}}},{key:"showCalendar",value:function(){this.disabled||this.ensureProperYearInSelectedAndShowCalendar()}},{key:"ensureProperYearInSelectedAndShowCalendar",value:function(){this.year===this.date.getFullYear()&&this.haveEnsured&&this._showCalendar(),this.haveEnsured=!0,this.date.getFullYear();for(var e=[],t=this.year-this.range,i=this.year+this.range+1,n=t;n<i;n++)e.push(n);if(s.isIE()){if(!this.yearsCreated){this.$.years.remove(0);for(var o=0,r=e.length;o<r;o++)this._createOptionElements(this.$.years,e[o]);this.yearsCreated=!0}}else this.years=e;Polymer.RenderStatus.afterNextRender(this,function(){this.yearSelection=this.$.years,this.yearSelection.selectedOptions&&(this.yearSelection.selectedOptions[0].selected=""),this.yearSelection.options[this.range].selected="selected",this._showCalendar()}.bind(this))}},{key:"_createOptionElements",value:function(e,t){var i=document.createElement("option");i.label=t,i.value=t,e.appendChild(i)}},{key:"_showCalendar",value:function(){this.isActive=!0,this.updateCalendar(),this.focus(),this.fire("datepicker-opened",{datepicker:this.$.datePicker,dateContainer:this.$.dateContainer}),document.addEventListener("click",this._clickHandler.bind(this))}},{key:"_clickHandler",value:function(e){var t=this;Polymer.dom(e).path.some(function(e){return e===t})||this.hideCalendar()}},{key:"hideCalendar",value:function(){this.isActive&&(this.isActive=!1,this.focus()),document.removeEventListener("click",this._clickHandler)}},{key:"findToday",value:function(){this.selectedDate=new Date,this.updateYearPicklist(),this.updateVariables(),this.updateCalendar(),this.focus()}},{key:"updateYearPicklist",value:function(){for(var e=this.yearSelection.options,t=0,i=e.length;t<i;t++)e[t].selected=this.year==e[t].text}},{key:"changeYear",value:function(){this.year=parseInt(this.yearSelection.selectedOptions[0].text),this.updateCalendar(),this.focus()}},{key:"decreaseMonth",value:function(){this.month=this.month-1,this.month<0&&(this.month=11,this.year=this.year-1,this.updateYearPicklist()),this.monthName=this.months&&this.months[this.month]?this.months[this.month].toUpperCase():"",this.updateCalendar()}},{key:"increaseMonth",value:function(){this.month=this.month+1,11<this.month&&(this.month=0,this.year=this.year+1,this.updateYearPicklist()),this.monthName=this.months&&this.months[this.month]?this.months[this.month].toUpperCase():"",this.updateCalendar()}},{key:"selectDay",value:function(e){this.selectedDate=e.model?e.model.day:this.date,this.hideCalendar()}},{key:"updateVariables",value:function(){this.year=this.date.getFullYear(),this.month=this.date.getMonth(),this.monthName=this.months&&this.months[this.month]?this.months[this.month].toUpperCase():"",this.day=this.date.getDate()}},{key:"updateDate",value:function(e){this.date.setDate(this.date.getDate()+e),this.updateVariables(),this.updateCalendar()}},{key:"updateCalendar",value:function(){this.weeks=[];for(var e=new Date(this.year,this.month,1),t=e.getDay(),i=[],n=0,o=0;o<42;o++){var r=new Date(e);r.setDate(e.getDate()+(o-t)),i[n]=r,n++,(o+1)%7!=0&&o+1!==42||(this.push("weeks",i),i=[],n=0)}}},{key:"validateInput",value:function(){if(!this.noblur){var e=void 0,t=!1,i=this.$.dateInput.value,n=""===i.trim();if(i!==(n?"":this.getLocaleDate())){var o=this.dateParser.parse(i,function(e){return e>=this.year-this.range&&e<=this.year+this.range}.bind(this));(t=null==o)?e=this.i18n.l("Invalid Date."):(this.selectedDate=o,this.updateVariables())}var r="object"===a(this.selectedDate)||""!==this.selectedDate.trim();n&&r&&(this.dateFormatted="",this.selectedDate=null),this.invalidInput=t,this.fire("field-change-validated",{error:e}),this.fire("sb-date-blur")}}},{key:"navigate",value:function(e){if(9!==e.keyCode)switch(e.keyCode){case 13:this.isActive?this.selectDay(e):this.validateInput();break;case 27:this.isActive?this.hideCalendar():(this.escaped=!0,this.fire("sb-date-esc",{keyCode:27}));break;case 37:this.updateDate(-1);break;case 38:this.updateDate(-7);break;case 39:this.updateDate(1);break;case 40:this.isActive?this.updateDate(7):this.showCalendar()}else this.hideCalendar()}},{key:"getLocaleDate",value:function(){try{return this.date.toLocaleDateString(this.user.locale)}catch(e){return this.date.toLocaleDateString()}}},{key:"attached",value:function(){this.focusOnAttached&&this.focus()}},{key:"focus",value:function(){this.highlight(),this.$.dateInput.focus()}},{key:"highlight",value:function(){this.dateFormatted&&this.$.dateInput.setSelectionRange(0,this.dateFormatted.length)}},{key:"preventBlur",value:function(){this.noblur=!0}},{key:"allowBlur",value:function(){this.noblur=!1}},{key:"_applyFocus",value:function(){this.applyFocus&&this.focus()}},{key:"behaviors",get:function(){return[sb.common.core.AppContext,window.CommonBehaviors.DeviceBehavior]}}]),l=e)),t("Datepicker",l),Polymer(l)}}}),System.register("common/forms/sb-dual-list-box/DualListBox.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("DualListBox",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-dual-list-box",this.properties={options:Array,availableTitle:String,chosenTitle:String,value:{type:Array,notify:!0}}}},{key:"_buildOptions",value:function(){this.value=[],this.chosenOptions=[];var t=[];this._clearSelected(),this.options.forEach(function(e){e.available=!0,t.push(e)}.bind(this)),this.availableOptions=t}},{key:"ready",value:function(){var e=this;Polymer.RenderStatus.afterNextRender(this,function(){e.$.available.addEventListener("change",function(e){this.availableOptionsSelected=e.detail.value}.bind(e)),e.$.chosen.addEventListener("change",function(e){this.chosenOptionsSelected=e.detail.value}.bind(e))})}},{key:"_updateOptions",value:function(e){var t=e.currentTarget.getAttribute("data-index"),i=new Set("right"===t?this.availableOptionsSelected.split(";"):this.chosenOptionsSelected.split(";"));this.availableOptionsSelected="",this.chosenOptionsSelected="";var n=[],o=[];this.options.forEach(function(e){"right"===t?i.has(e.value.toString())||!e.available?(e.available=!1,o.push(e)):n.push(e):i.has(e.value.toString())||e.available?(e.available=!0,n.push(e)):o.push(e)}.bind(this)),this._clearSelected(),this.availableOptions=n,this.chosenOptions=o,this.value=this.chosenOptions}},{key:"_clearSelected",value:function(){this.$.available.value=null,this.$.chosen.value=null}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_buildOptions(options)"]}}]),i=e)),t("DualListBox",i),Polymer(i)}}}),System.register("common/forms/sb-field/Field.js",["common/core/AppContext.js","common/forms/NumberParser.js","common/forms/sb-field/factory/FieldFactory.js","common/forms/DependentPicklistBuilder.js","common/layout/sb-html/Html.js"],function(t,e){var i,o,s,r,a,l,u,d,c,h,p,f;return{setters:[function(e){i=e.AppContext},function(e){o=e.NumberParser},function(e){s=e.fieldFactory},function(e){r=e.DependentPicklistBuilder},function(e){a=e.Html}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}l=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},u="keyReadOnly",d="keyDownReadOnly",c="blurReadOnly","change",h="hideField",p="refDisplay","applyFocus",t("Field",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),l(e,[{key:"beforeRegister",value:function(){this.is="sb-field",this.properties=Polymer.Base.extend({obj:Object,property:String,model:{type:Object,value:null},md:Object,type:{type:String,computed:"getType(md)"},refObjects:{type:Array,value:[]},editing:{type:Boolean,value:!1},_wasEverEditable:{type:Boolean,computed:"_setWasEverEditable(editing)"},disabled:{type:Boolean,value:!1},hidden:{type:Object,value:!1,observer:"hiddenChanged"},link:Boolean,value:{observer:"_valueChanged"},refDisplay:{type:String,notify:!0},objAndRefObjects:Object,objKey:String,refObjectsKey:String,refTable:{type:String,computed:"computeRefTable(md)"},readOnly:Boolean,renderReadOnly:{type:Boolean,value:!1},formattedValue:Object,originalFormattedValue:String,hideFormattedValue:{type:Boolean,value:!1},focus:{type:Boolean,value:!1,observer:"applyFocus"},index:Number,recordId:{type:String,value:null,observer:"recordIdChanged"},numberParser:{type:Object,value:function(){return new o}},preventNumericAlignment:{type:Boolean,value:!1},signaler:Object,record:Object,tabIndex:Number,factoryData:Object,html:Object},i.properties)}},{key:"ready",value:function(){this.addEventListener("sb-row-focus-signal",this.handleRowFocusSignal.bind(this)),this.addEventListener("sb-field-edit",this.handleFieldEditSignal.bind(this)),this.html=new a(this)}},{key:"_createObj",value:function(e,t){if(!this.obj||this.isInternalObject){this.isInternalObject=!0;var i=this.obj?this.obj:{};i[t]=e,this.obj=i}}},{key:"setObjAndRefObjects",value:function(e,t,i){this.obj=void 0,this.refObjects=void 0,this.refObjects=e[i],void 0===this.refObjects&&(this.refObjects={}),this.obj=""!==t?e[t]:e}},{key:"render",value:function(e,t,i,n,o,r,s,a){this.rendered=!0,this.isReadOnly()?this.updateTemplateData(e,t,n,a):this._render(e,t,n,a)}},{key:"_render",value:function(e,t,i,n){var o=this;if(!this.template){this.template=document.createElement("template","dom-bind");var r=this.updateTemplateData(e,t,i,n);this.createBaseElement(r.html),this.template.change=this.onChange.bind(this),this.template[u]=function(e){return o.onKeyupReadOnly(o.model,o.obj,o.md,o.html,e)},this.template[d]=this.onKeyDownReadOnly.bind(this),this.template[c]=function(e){return o.onBlurReadOnly(o.model,o.obj,o.md,o.html,e)},this.isReadOnly()||(this.hideFormattedValue=!0),Polymer.dom(this.$.f).appendChild(this.template)}}},{key:"_setOriginalFormattedValue",value:function(e,t,i){var n=this.getFormField(e,t,i);this.originalFormattedValue=this.getFormattedValue(n,t)}},{key:"onChange",value:function(e){this._onChange(e);var t=!!e.detail&&e.detail.suppressImmediateCalcuation;this.fire("sb-field-on-change-field",{suppressImmediateCalcuation:t})}},{key:"_onChange",value:function(e){if(!this.internal){var t=this.getEventTarget(e),i=void 0!==t.value?t.value:e.detail?e.detail.value:null;if(this.refDisplay=void 0!==t[p]?t[p]:e.detail&&void 0!==e.detail[p]?e.detail[p]:this.refDisplay,this.isNumericType())i=i&&0!==i?this.numberParser.parse(i,!1,this.md.scale):null;else if("date"===this.type&&i instanceof Date){var n=i.getMonth()+1;n=n<10?"0"+n:n;var o=i.getDate();o=o<10?"0"+o:o,i=i.getFullYear()+"-"+n+"-"+o}else i instanceof Date&&(i=i.toISOString());this.internal=!0,this.obj[this.property]=i,this.domHost.value=i,this.internal=!1,this.fireCustomChangeEvents(e)}}},{key:"fireCustomChangeEvents",value:function(e){!this.md||e&&!e.detail||this.fireControllingSelectChangeEvent()}},{key:"fireControllingSelectChangeEvent",value:function(){var e={tableName:this.md.tableName,fieldName:this.md.name,record:this.record},t=new CustomEvent("sb-controlling-select-changed",{bubbles:!1,detail:e});document.dispatchEvent(t)}},{key:"onKeyDownReadOnly",value:function(e){if(this.signaler&&this.isRenderReadOnly()&&9===(e.keyCode||e.detail.keyCode)){var t=e.shiftKey||e.detail.shiftKey;this.signaler.signalNextPreviousEditableTarget(this,!t)}}},{key:"onKeyupReadOnly",value:function(e,t,i,n,o){27===(o.keyCode||o.detail.keyCode)&&this.onBlurReadOnly(e,t,i,n,!1)}},{key:"onBlurReadOnly",value:function(e,t,i,n,o){if(this.isReadOnly()&&!this.template[h]){if(o)this.setPreviouslyFormattedValue(),this.updateTemplateData(e,t,i,n);else{var r={target:{value:this.previouslyFormatted?this.previouslyFormatted.value:this.formattedValue.value}};this.isLookup()&&(r.target[p]=this.previouslyFormatted?this.previouslyFormatted.label:this.formattedValue.label),this._onChange(r),this.updateTemplateData(e,t,i,n)}this.template[h]=!0,this.hideFormattedValue=!1,this.isRenderReadOnly()&&this.enableSignals()}}},{key:"updateTemplateData",value:function(e,t,i,n){var o=t[this.property],r=this.getFormField(e,o,i);if(r.defaultValue&&this.template&&this._onChange({target:{value:r.defaultValue}}),this.formattedValue=this.getFormattedValue(r,o),this.originalFormattedValue=this.originalFormattedValue||this.formattedValue,this.addFormattedValueClasses(r.numeric),this.isReadOnly()&&this.setFormattedDetails(n),this.template)return r.attachTo(this.template,u,d,c,"change",h,this.isRenderReadOnly()),r}},{key:"getFormField",value:function(e,t,i){var n=this.isEditable(!0),o=this.getSelectOptions(i),r={refDisplay:this.refDisplay,refDisplayName:p,refTable:this.refTable,refObjects:this.refObjects,property:this.property,obj:this.obj,record:this.record};return s(this.type,e,t,n,this.disabled,this.hidden,this.index,this.md,this.i18n,this.isRenderReadOnly(),o,r,this.tabIndex,this.factoryData)}},{key:"getFormattedValue",value:function(e,t){return e.formattedValue||{value:t,label:t}}},{key:"addFormattedValueClasses",value:function(e){var t=this.isEditable();this.toggleClass("editable",t,this.$.formatted),this.toggleClass("numericField",this.segmentedAlignment||!this.preventNumericAlignment&&e,this.$.formatted),this.toggleClass("firstField",0==this.index,this.$.formatted),this.toggleClass("readOnly",this.readOnly,this.$.formatted),this.isDirty=t&&this.formattedValue.value!==this.originalFormattedValue.value&&!(this.isNil(this.formattedValue.value)&&this.isNil(this.originalFormattedValue.value)),this.toggleClass("dirty",this.isDirty,this.$.formatted);var i=this.isBoolean(),n=!i&&(!1===this.formattedValue.value||this.isNil(this.formattedValue.label)&&!0!==this.formattedValue.value);this.toggleClass("empty",n,this.$.formatted),this.toggleClass("empty",n,this.$.me),this.toggleClass("link",this.link,this.$.formatted),this.toggleClass("link",this.link,this.$.me),this.toggleClass("boolean",i,this.$.formatted)}},{key:"signalRowFocus",value:function(){this.signaler&&(this.signaler.fireSignal("sb-row-focus-signal",!0),setTimeout(function(){this.signaler.disable()}.bind(this),20))}},{key:"enableSignals",value:function(){this.signaler&&this.signaler.enable()}},{key:"handleRowFocusSignal",value:function(e){this.signaler&&(this.signaler.toggleRowFocus(e),this.isEditable()&&this.toggleClass("show",e.detail.focused,this.$.formatted))}},{key:"handleFieldEditSignal",value:function(e){"richtextarea"===this.md.extraTypeInfo?this.signaler.signalNextPreviousEditableTarget(this,e.detail.next):(this.ironList=this.signaler.ironList,this.ironList&&this.ironList.lastVisibleIndex==this.ironList.items.length-1&&(this.ironList.toggleScrollListener(!1),this.scrollListenerDetached=!0),setTimeout(function(){this.scrollListenerDetached&&(this.ironList.toggleScrollListener(!0),this.scrollListenerDetached=!1),this.edit()}.bind(this),0))}},{key:"createBaseElement",value:function(e){var t=this.template.content.ownerDocument.createElement("div");t.innerHTML=e;var i=Polymer.dom(t).firstChild;Polymer.dom(this.template.content).appendChild(i)}},{key:"isNumericType",value:function(){switch(this.type){case"double":case"number":case"currency":case"percent":return!0}return!1}},{key:"getType",value:function(e){return e&&e.type?e.type.toLowerCase():""}},{key:"_valueChanged",value:function(){this.rendered&&void 0===this.value&&this.valueChanged(this.model,this.obj,this.md,this.property,this.html,this.value)}},{key:"valueChanged",value:function(e,t,i,n,o,r){void 0===r&&this.isBoolean()||(this.internal&&this.template?this.template.value=r:this.obj[n]=r,this.setPreviouslyFormattedValue(),this.updateTemplateData(e,t,i,o))}},{key:"setPreviouslyFormattedValue",value:function(){this.previouslyFormatted=void 0===this.formattedValue?null:JSON.parse(JSON.stringify(this.formattedValue))}},{key:"disabledChanged",value:function(e,t,i,n,o){this.toggleClass("disabled",o,this.$.formatted),this.template&&(this.template.disabled=o),this.isRenderReadOnly()&&this.editing&&this.updateTemplateData(e,t,i,n)}},{key:"hiddenChanged",value:function(){this.template&&(this.template.hide=this.hidden)}},{key:"recordIdChanged",value:function(){this.template&&(this.template.recordId=this.recordId)}},{key:"recordChanged",value:function(e){this.template&&e&&e.path&&"record"!==e.path&&this.template.set(e.path,e.value)}},{key:"computeRefTable",value:function(e){if(void 0!==e)return e.referenceTable?e.referenceTable:e.referenceTo&&0<e.referenceTo.length?e.referenceTo[0]:null}},{key:"linkOrEdit",value:function(){this.link?this.fire("sb-link-tapped",{value:this.value,Id:this.recordId}):this.edit(!0)}},{key:"edit",value:function(e){this.isEditable()&&(this._render(this.model,this.obj,this.md,this.html),this.hideFormattedValue=!0,this.template[h]=!1,this.template._nodes&&this.template._nodes[0].focus&&this.template._nodes[0].focus(),e&&this.invertValueIfInlineBoolean(),this.isRenderReadOnly()&&this.signalRowFocus())}},{key:"getEventTarget",value:function(t){try{return Polymer.dom(t).localTarget||t.target}catch(e){return t.target}}},{key:"isNil",value:function(e){return null==e||""===e||"number"==typeof e&&e+""=="NaN"}},{key:"applyFocus",value:function(){this.template&&(this.template.applyFocus=this.focus)}},{key:"isEditable",value:function(e){return!(!e||!this._wasEverEditable)||!(this.readOnly||this.isRenderReadOnly()&&this.disabled)&&this.editing}},{key:"isReadOnly",value:function(){return this.readOnly||this.isRenderReadOnly()||this.isFormulaHtml()}},{key:"isRenderReadOnly",value:function(){return this.renderReadOnly||this.isRichText()}},{key:"isFormulaHtml",value:function(){return this.md.htmlFormatted&&this.md.calculated}},{key:"setFormattedDetails",value:function(e){e.isDirty=this.isDirty,e.link=!!this.link,e.type=this.type,e.booleanValue=this.isBoolean()?this.obj[this.property]:null,e.value=this.formattedValue.label,this.formattedValue.unit&&(e.value+=" "+this.formattedValue.unit),e.sanitizeAndSetInnerHTML()}},{key:"isBoolean",value:function(){return"boolean"===this.type||"checkbox"===this.type}},{key:"isLookup",value:function(){return"id"===this.type||"reference"===this.type}},{key:"isRichText",value:function(){return"textarea"===this.type&&"richtextarea"===this.md.extraTypeInfo}},{key:"addControlledSelectListener",value:function(e){var t=this;e&&e.controllerName&&document.addEventListener("sb-controlling-select-changed",function(e){return t.controllerSelectHandler(t.model,t.obj,t.md,t.html,e)})}},{key:"controllerSelectHandler",value:function(e,t,i,n,o){var r=o.detail.tableName,s=o.detail.fieldName,a=o.detail.record,l="function"==typeof this.record.equals&&a?this.record.equals(a):this.record===a;r===i.tableName&&i.controllerName===s&&l&&(this.buildSelectOptions(i,!0)||this.updateTemplateData(e,t,i,n))}},{key:"getSelectOptions",value:function(e){return this._selectOptions||this.buildSelectOptions(e),this._selectOptions}},{key:"buildSelectOptions",value:function(e,t){if(!e.controllerName||!this.record)return this._selectOptions=e.picklistValues,!1;var i="function"==typeof this.record.getValue?this.record.getValue(e.controllerName):this.record[e.controllerName];return this._selectOptions=new r(e,i).build(),!!t&&this.clearValueIfNotAnOption(this._selectOptions)}},{key:"clearValueIfNotAnOption",value:function(e){if(null===this.value)return!1;var t=!0;return e.forEach(function(e){e.value==this.value&&(t=!1)}.bind(this)),!!t&&("function"==typeof this.record.setValue?this.record.setValue(this.property,null):this.record[this.property]=null,this.onChange({target:{value:null}}),!0)}},{key:"invertValueIfInlineBoolean",value:function(){this.isRenderReadOnly()&&this.isBoolean()&&(this.value=void 0,this.value=!this.obj[this.property],this.internal=!0,this.domHost.value=this.value,this.internal=!1,this.fireCustomChangeEvents(),this.fire("sb-field-on-change-field"))}},{key:"_setWasEverEditable",value:function(){return this._wasEverEditable||this.editing}},{key:"behaviors",get:function(){return[sb.common.core.AppContext,window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["render(model, obj, property, md, refObjects, editing, renderReadOnly, html)","setObjAndRefObjects(objAndRefObjects, objKey, refObjectsKey)","_setOriginalFormattedValue(model, originalValue, md)","addControlledSelectListener(md)","recordChanged(record.*)","valueChanged(model, obj, md, property, html, value)","disabledChanged(model, obj, md, html, disabled)","_createObj(value, property)"]}}]),f=e)),t("Field",f),Polymer(f)}}}),System.register("common/forms/sb-input/Input.js",["common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o;return{setters:[function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Input",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-input",this.properties={value:{type:String,observer:"changed"},focusOnAttached:Boolean,inputType:{type:String,value:"text"},renderReadOnly:Boolean,applyFocus:{type:Boolean,observer:"_applyFocus"},viewport:{type:Object,value:function(){return i.getViewport()}},showClear:{type:Boolean,computed:"_showClear(viewport, inputType, disabled)"},disabled:{type:Boolean,value:!1},focused:{type:Boolean,value:!1}}}},{key:"hideClearIfEmpty",value:function(){this.showClear&&(this.$$("#clear")?this._hideClearIfEmpty():Polymer.RenderStatus.afterNextRender(this,function(){this._hideClearIfEmpty()}.bind(this)))}},{key:"_hideClearIfEmpty",value:function(){this.toggleClass("hide",this.focused||null==this.value||""===this.value,this.$$("#clear"))}},{key:"attached",value:function(){this.focusOnAttached&&this.focus()}},{key:"focus",value:function(){this.querySelector(".myinput").focus()}},{key:"blur",value:function(){this.fireChangeOnBlur(),this.fire("blur"),this.focused=!1}},{key:"clear",value:function(){this.value=null,this.querySelector(".myinput").blur()}},{key:"highlight",value:function(){if(this.focused=!0,!this.viewport||!this.viewport.isMobile()){var e=this.value?this.value.length:0;this.querySelector(".myinput").setSelectionRange(0,e)}}},{key:"changed",value:function(e,t){void 0!==t?(this.changeOnNextBlur=!1,t!=e&&this.fireChangeEvent(e)):this.changeOnNextBlur=!0}},{key:"fireChangeEvent",value:function(e){this.fire("change",{value:e})}},{key:"fireChangeOnBlur",value:function(){this.changeOnNextBlur&&(this.fireChangeEvent(this.value),this.changeOnNextBlur=!1)}},{key:"propagateEsc",value:function(e){27===e.keyCode&&(this.renderReadOnly&&(this.querySelector(".myinput").value=this.value),this.fire("sb-input-key",{keyCode:27}))}},{key:"_applyFocus",value:function(){this.applyFocus&&this.focus()}},{key:"_showClear",value:function(){return this.viewport&&this.viewport.isMobile()&&!this.disabled&&"date"!==this.inputType&&"datetime"!==this.inputType}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["hideClearIfEmpty(value, showClear, focused)"]}}]),o=e)),t("Input",o),Polymer(o)}}}),System.register("common/forms/sb-lookup-dialog/LookupDialog.js",["common/layout/tables/TableClassBuilder.js","common/core/AppContext.js","common/core/sb-page-container/PageContainer.js","common/forms/sb-lookup/query/LookupQueryBuilder.js"],function(t,e){var p,i,o,r,s,a,l,u,c,d;return{setters:[function(e){p=e.TableClassBuilder},function(e){i=e.AppContext},function(e){o=e.PageContainer},function(e){r=e.LookupQueryBuilder}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}s=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},a="CPQ_Lookup",l="CPQ_Lookup_Search",c=(u=["string","picklist","multipicklist"]).concat(["textarea","date","datetime","int","number","currency","percent","double","reference"]),t("LookupDialog",(s(e,[{key:"beforeRegister",value:function(){this.is="sb-lookup-dialog",this.properties={value:{type:String,value:null},label:String,tableName:String,tableLabel:String,fieldLabel:String,labelName:String,selectedLabel:String,searchValue:String,metadata:Object,numResults:Number,results:Object,invoker:{type:Object,observer:"initialize"},isOAuth:{type:Boolean,value:function(){return!!i.org&&i.org.isOAuth}},openSpinner:{type:Boolean,value:!1},recordSpinner:{type:Boolean,value:!1},viewport:{type:Object,value:function(){return o.getViewport()}},isMobile:{type:Boolean,computed:"_isMobile(viewport)"},hideCancel:{type:Boolean,computed:"_hideCancel(isMobile, openSpinner, recordSpinner)"},layoutFields:{type:Array,value:[]},searchFields:{type:Array,value:[]},lookupSearchTypes:{type:Array,value:function(){return u.concat(i.org?i.org.additionalLookupSearchTypes:[])}},maxSearchFields:{type:Number,value:function(){return i.org?i.org.maxLookupSearchFields:1}},fieldSetPrefix:{type:String,value:function(){return i.org.prefix?i.org.prefix+"__":""}},i18n:{type:Object,value:function(){return i.properties.i18n.value()}}}}},{key:"ready",value:function(){this.addEventListener("sb-close-dialog",this.cancel.bind(this)),this.addEventListener("lookup-value-changed",this.setValues.bind(this)),this.$.field.addEventListener("md-changed",this.processListFields.bind(this)),this.addEventListener("sb-link-tapped",this.updateLookup.bind(this)),this.setResultsHeightHandler=this.setResultsHeight.bind(this),window.addEventListener("resize",this.setResultsHeightHandler),this.$$("#list").assignParentResizable({stopResizeNotificationsFor:function(){window.removeEventListener("resize",this.setResultsHeightHandler)}.bind(this)})}},{key:"initialize",value:function(){this.invoker&&(this.labelName=this.invoker.labelName,this.label=this.invoker.label,this.selectedLabel=this.invoker.selectedLabel,this.tableName=this.invoker.tableName,this.fieldLabel=this.invoker.fieldLabel,this.currentRecordFilters=this.invoker.currentRecordFilters,this.controllingFields=this.invoker.controllingFields,this.record=this.invoker.record,this.hasFilter=!(this.currentRecordFilters&&0<Object.keys(this.currentRecordFilters).length&&i.apiVersion<39)&&this.invoker.hasFilter,this.fieldFullName=this.invoker.fieldFullName)}},{key:"open",value:function(e){this.$.dialog.toggle(),this.invoker.dialogOpened(),this.$.lookup.$.typeahead.blurred=!0,this.$.lookup.$.typeahead.hasList=!1,this.$.lookup.$.typeahead.labelValue=e,this.invoker.$.typeahead.$.itemLabel.blur(),this.searchValue=e}},{key:"cancel",value:function(){this.close()}},{key:"saveAndDeferredClose",value:function(){this.syncSelection(),this.deferredClose()}},{key:"save",value:function(){this.syncSelection(),this.close()}},{key:"syncSelection",value:function(){this.invoker.value=void 0,this.invoker.label=this.label,this.invoker.value=this.value}},{key:"clearAndSave",value:function(){this.label="",this.value=null,this.save()}},{key:"close",value:function(){this.$.dialog.toggle(),this.$.lookup.$.typeahead.suggest({}),this.invoker.dialogClosed(),this.reset(),this.clearSelected()}},{key:"deferredClose",value:function(){setTimeout(function(){this.close()}.bind(this),350)}},{key:"reset",value:function(){this.value=null,this.label=null,this.results=null,this.tableLabel=null,this.fieldLabel=null,this.fieldFullName=void 0,this.hasFilter=!1,this.currentRecordFilters=null,this.controllingFields=null,this.record=null,this.tableName=null,this.numResults=0,this.metadata=void 0,this.layoutFields=[],this.searchFields=[],this.$.header.cols=void 0,this.$.header.$.header.destroyGroup(),this.$.fs.response=null,this.$.fs.context=void 0,this.invoker=null,this.errors=null}},{key:"setValues",value:function(e){this.value=e.detail.value,this.label=e.detail[this.labelName]}},{key:"updateLookup",value:function(e){this.label=void 0,this.value=e.detail.Id,this.label=this.getSelectedLabelValueById(e.detail.Id)}},{key:"getSelectedLabelValueById",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.results[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;if(s.Id===e)return s[this.selectedLabel]}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"getMetadata",value:function(){this.tableName&&(this.openSpinner=!0,this.$.fs.context={fieldSets:[{tableName:this.tableName,name:a},{tableName:this.tableName,name:l}]})}},{key:"initSearchFieldsAndReturnOnesNotInLayout",value:function(e,t){var i=[],n=this.getCpqLookupSearchFields(e);if(!n)return i;this.searchFields=n.names;var o=n.fields,r=!0,s=!1,a=void 0;try{for(var l,u=o[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var d=l.value;d!==this.tableName+"."+this.selectedLabel&&-1===t.indexOf(d)&&i.push(d)}}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}return i}},{key:"processCPQLayoutFields",value:function(e){if(e)if(this.tableLabel=e[0].tableLabel,this.isMobile)this.initMobileMetadata();else{var t=this.getCpqLookupLayoutFields(e);t||(t={fields:[],names:[]},this.warnUserAboutCPQLayoutFieldSet());var i=this.getNameFieldIfOmittedFrom(t.fields);i&&(t.fields=[i.field].concat(t.fields),t.names.push(i.name)),this.layoutFields=t.names;var n=this.initSearchFieldsAndReturnOnesNotInLayout(e,t.fields),o=t.fields.concat(n);this.$.field.fields=o}}},{key:"processListFields",value:function(e){for(var t=e.detail.value.fields,i=[],n=[],o={},r={},s={},a=[],l=0,u=t.length;l<u;l++){var d=t[l],c={type:d.type,link:0===l};-1!==this.layoutFields.indexOf(d.name)&&(i.push(d.name),n.push(d.label)),o[d.name]=d.type,r[d.name]=c,s[d.label.replace(/\W/g,"")]=d.type,"reference"!==d.type&&"id"!==d.type||a.push({name:d.name,table:d.referenceTo[0]})}this.headerClassMap=new p(Object.keys(s),"Th",s).build(),this.rowClassMap=new p(i,"Td",o).build();var h=this.sanitizeAdditionalSearchFields(r);this.metadata={fieldNames:i,fieldLabels:n,fieldTypeObjByName:r,fieldsOfTypeLookup:a,additionalSearchFields:h},this.querySearchResults()}},{key:"sanitizeAdditionalSearchFields",value:function(e){var t=0,i=0,n=[],o=!0,r=!1,s=void 0;try{for(var a,l=this.searchFields[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var u=a.value;if(u!==this.selectedLabel){var d=e[u].type;if(-1!==this.lookupSearchTypes.indexOf(d)&&-1!==c.indexOf(d)&&(n.push(u),++t===this.maxSearchFields))break}else i=1}}catch(e){r=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw s}}return n.length<this.searchFields.length-i&&this.warnUserAboutSanitizedCPQSearchFieldSet(n),n}},{key:"querySearchResults",value:function(){this.recordSpinner=!this.openSpinner;var e=new r(this.tableName,this.selectedLabel,this.hasFilter,this.fieldFullName,101,this.currentRecordFilters,this.record,!1,this.metadata).build(this.searchValue,!0,!0);this.$.query.query({soql:e}).then(this.handleSearchResults.bind(this,100))}},{key:"handleSearchResults",value:function(e,t){this.clearSelected();var i=t.totalSize>e?"+":"",n=Math.min(e,t.totalSize);this.numResults=n+i,this.results=this.getResults(t,e),this.recordSpinner=!1,this.openSpinner=!1,this.isMobile&&(this.$.tbody.style.overflow=null),Polymer.RenderStatus.afterNextRender(this,function(){this.setResultsHeight()}.bind(this))}},{key:"getResults",value:function(e,t){for(var i=e.records,n=e.totalSize,o=this.isMobile&&i.length>n,r=o?i.pop():null;t<n;)i.pop(),n--;return r&&i.push(r),o&&(i[n][this.selectedLabel]='<div class="sb-html '+i[n].__md__.class+'">'+i[n][this.selectedLabel]+"</div>"),i}},{key:"setResultsHeight",value:function(){var e=this.isMobile?document.documentElement.clientHeight:this.$.dialog.$$("#footer").offsetTop,t=e-this.$.tbody.offsetTop,i=t<this.$.tbody.scrollHeight?t+"px":null;this.$.tbody.style.height=i;var n=e-this.$.datatable.offsetTop+"px";this.$.datatable.style.height=n;var o=this.$.spinner.$$("#mask");o.style.height=t+"px",this.isMobile?this.$.tbody.style.overflow="auto":o.style.marginLeft="-24px",Polymer.RenderStatus.afterNextRender(this,function(){this.$$("#list").notifyResize()}.bind(this))}},{key:"getCpqLookupLayoutFields",value:function(e){return this.getCpqLookupFields(e,!1)}},{key:"getCpqLookupSearchFields",value:function(e){return this.getCpqLookupFields(e,!0)}},{key:"getCpqLookupFields",value:function(e,t){var i=[],n=[],o=!0,r=!1,s=void 0;try{for(var a,l=e[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var u=a.value;if(this.validCPQFieldSet(u,t)){var d=u.displayedFields,c=d?d.constructor===Array?d:[d]:[],h=!0,p=!1,f=void 0;try{for(var g,y=c[Symbol.iterator]();!(h=(g=y.next()).done);h=!0){var v=g.value,m=v.field||v;1===m.split(".").length&&(n.push(m),i.push(this.tableName+"."+m))}}catch(e){p=!0,f=e}finally{try{!h&&y.return&&y.return()}finally{if(p)throw f}}return{fields:i,names:n}}}}catch(e){r=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw s}}return null}},{key:"validCPQFieldSet",value:function(e,t){return!(t||e.label!==a&&e.fullName!==this.fieldSetPrefix+a)||!(!t||e.label!==l&&e.fullName!==this.fieldSetPrefix+l)}},{key:"getNameFieldIfOmittedFrom",value:function(e){if(-1===e.indexOf(this.tableName+"."+this.selectedLabel))return{field:this.tableName+"."+this.selectedLabel,name:this.selectedLabel}}},{key:"warnUserAboutCPQLayoutFieldSet",value:function(){this.errors=[this.i18n.l("FieldSetWarning",[this.tableLabel])]}},{key:"warnUserAboutSanitizedCPQSearchFieldSet",value:function(e){console.warn("The "+this.tableLabel+"."+this.fieldSetPrefix+l+" field set either contains fields of unsupported types or the field set size exceeds the max size ("+this.maxSearchFields+").\nActual: "+e.join(",")+"\nExpect: "+this.searchFields.join(","))}},{key:"initMobileMetadata",value:function(){var e={};e[this.selectedLabel]="lookupItemTd",this.rowClassMap=e,this.metadata={fieldNames:[this.selectedLabel],fieldLabels:[],fieldTypeObjByName:{},fieldsOfTypeLookup:[],additionalSearchFields:[]},this.$.lookup.lookupResultsCallback(this.searchValue)}},{key:"mobileSelection",value:function(e){if(this.isMobile){var t=Polymer.dom(e).localTarget;this.setSelected(t),t.hasAttribute("data-search")?(this.searchValue=t.getAttribute("data-search"),this.querySearchResults()):(this.value=t.getAttribute("data-id"),this.label=t.getAttribute("data-name"),this.saveAndDeferredClose())}}},{key:"getSearchValue",value:function(e){if(e&&!e.Id)return e.__md__.searchValue}},{key:"getNameValue",value:function(e){return e[this.selectedLabel]}},{key:"setSelected",value:function(e){this.selected=e.$.row.$$("sb-table-cell"),this.toggleClass("selectedLookupItem",!0,this.selected)}},{key:"clearSelected",value:function(){this.selected&&this.toggleClass("selectedLookupItem",!1,this.selected)}},{key:"_hideCancel",value:function(){return!this.isMobile||this.openSpinner||this.recordSpinner}},{key:"_isMobile",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["getMetadata(tableName, viewport)","processCPQLayoutFields(fieldSets, i18n)"]}}]),d=e)),t("LookupDialog",d),Polymer(d)}}}),System.register("common/forms/sb-lookup/Lookup.js",["common/core/AppContext.js","common/forms/sb-lookup/map/LookupNameMapper.js","common/core/sb-page-container/PageContainer.js","common/forms/sb-lookup/query/LookupQueryBuilder.js"],function(t,e){var o,i,r,s,a;return{setters:[function(e){o=e.AppContext},function(e){i=e.LookupNameMapper},function(e){r=e.PageContainer},function(e){s=e.LookupQueryBuilder}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Lookup",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-lookup",this.properties={tableName:{type:String,observer:"initTableLabel"},limit:{type:Number,value:5},value:{type:String,value:null},label:{type:String,value:null},disabled:{type:Boolean,value:!1},labelName:{type:String,value:"label"},selectedLabel:{type:String,computed:"getSelectedLabel(tableName)"},menuItemLabels:{type:Array,value:null},lookupCallback:{type:Function,value:function(){return this.lookupResultsCallback.bind(this)}},hideInputAndShowPill:{type:Boolean,value:!1},hideCancelIcon:{type:Boolean,value:!0},i18n:{type:Object,value:function(){return o.properties.i18n.value()}},inDialog:{type:Boolean,value:!1},blurDisabled:{type:Boolean,value:!1},focusDisabled:{type:Boolean,value:!1},tableLabel:{type:String,value:""},placeholder:{type:String,value:null},labels:{type:Array,computed:"getLabels(selectedLabel, menuItemLabels)"},searchText:{type:String,computed:"getSearchText(placeholder, tableLabel, i18n)"},viewport:{type:Object,value:function(){return r.getViewport()}},showSearchIcon:{type:Boolean,computed:"showSearch(viewport, inDialog)"},mobile:{type:Boolean,computed:"isMobile(viewport)"},fieldFullName:String,hasFilter:{type:Boolean,value:!1},controllingFields:{type:Array,value:[]},currentRecordFilters:Object,record:Object,dialogMetadata:Object}}},{key:"ready",value:function(){this.$.object.addEventListener("describe-changed",this.setTableLabel.bind(this)),this.$.typeahead.addEventListener("enter-without-selection",this.handleEnterPressed.bind(this)),this.$.fields.addEventListener("md-changed",this.setCurrentRecordFilters.bind(this))}},{key:"initTableLabel",value:function(){this.tableName&&(this.$.object.objects=[this.tableName])}},{key:"setTableLabel",value:function(e){this.tableLabel=e.detail.value.md[this.tableName].labelPlural}},{key:"setCallback",value:function(){this.lookupCallback=this.customCallback.bind(this)}},{key:"lookupResultsCallback",value:function(i){return new Promise(function(e,t){this.tableName?this.queryLookupResults(i,e,t):e([])}.bind(this))}},{key:"queryLookupResults",value:function(a,l,i){var n=new s(this.tableName,this.selectedLabel,this.hasFilter,this.fieldFullName,this.limit,this.currentRecordFilters,this.record,!0,this.dialogMetadata).build(a,!1,this.inDialog);this.$.q.query({soql:n,version:o.apiVersionString}).then(function(e){var t=e.records,i=null==a?"":a,n={Id:"",__md__:{class:"search",searchValue:i,clearAfterSelection:!this.inDialog,noFocusAfterSelection:this.inDialog}},o=this.tableLabel;if(!o){var r=this.tableName.split("__");o=r[1<r.length?r.length-2:0]}if(this.isMobile())n[this.selectedLabel]=i?this.i18n.l('"{0}"',[i]):"",t.push(n);else{var s=i?'"{0}" in {1}':" in {1}";n[this.selectedLabel]=this.i18n.l(s,[i,o]),t=[n].concat(t)}this.inDialog&&this.isMobile()?this.domHost.handleSearchResults(this.limit,{records:t,totalSize:e.totalSize}):l(t)}.bind(this),function(e){var t="SOQL Execution Error: "+n+" ("+(e&&e.message?e.message:e)+")";i(t)}.bind(this))}},{key:"setLabel",value:function(){this._setLabel(),null!=this.value&&null!=this.selectedLabel&&this.setSelectedItem()}},{key:"setSelectedItem",value:function(){if(!this.internal&&null!=this.label){var e=this.getLabel(),t={Id:this.value};t[this.selectedLabel]=e,this.$.typeahead.items=this.$.typeahead.items||[t],this.$.typeahead.selectedItem=t,this.setHideInputAndShowPill(this.value),this.focus(),this._handleSelectedItemChanged||(this._handleSelectedItemChanged=this.handleSelectedItemChanged.bind(this),this.$.typeahead.addEventListener("selected-item-changed",this._handleSelectedItemChanged))}}},{key:"handleSelectedItemChanged",value:function(e){if(!e.detail.path&&""!=e.detail.value){var t=e.detail.value.__md__,i=t&&void 0!==t.searchValue?t.searchValue:void 0;void 0===i?(this.setHideInputAndShowPill(e.detail.value.Id),this.focus(),this.internal=!0,this.value=e.detail.value.Id||null,this.label=e.detail.value[this.selectedLabel]||"",this.internal=!1,this._setLabel(),this.fireLookupValueChanged(this.value,this.label,e.detail.value)):this.applySearchValue(i)}}},{key:"applySearchValue",value:function(e){e&&e.detail&&(e=e.detail.value),this.inDialog?(this.domHost.searchValue=e,this.domHost.querySearchResults()):this.fire("iron-signal",{name:"sb-open-lookup-dialog",data:{lookup:this,searchValue:e}})}},{key:"handleEnterPressed",value:function(e){this.currentRecordFilters&&this.applySearchValue(e.detail.value)}},{key:"fireLookupValueChanged",value:function(e,t,i){var n={value:e,obj:i,item:this.record?this.record.item:null};n[this.labelName]=t,this.fire("lookup-value-changed",n)}},{key:"focus",value:function(e){this.isMobile()||(this.hideInputAndShowPill?this.focusDisabled||this.$.container.focus():(this.$.typeahead.focus(e||this.forceSuggest),this.forceSuggest=!1))}},{key:"getLabel",value:function(){this.labelsByValue=this.labelsByValue||{};var e=this._getLabelValueKey(),t=this.labelsByValue[e];return this.value&&!t&&(this.labelsByValue[e]=this.label,t=this.label),t}},{key:"_setLabel",value:function(){var e=this._getLabelValueKey();this.labelsByValue=this.labelsByValue||{},this.labelsByValue[e]=this.label}},{key:"_getLabelValueKey",value:function(){return this.value&&"string"==typeof this.value?this.value.substring(0,15):this.value}},{key:"setHideInputAndShowPill",value:function(e){this.hideInputAndShowPill=!this.isMobile()&&!this.isNil(e)&&!this.clearAfterSelection}},{key:"blurContainer",value:function(){this.hideInputAndShowPill&&!this.blurDisabled&&this.blur()}},{key:"blur",value:function(){this.$.typeahead.setOriginalSelected(),this.fire("sb-type-blur")}},{key:"propagateEscOrHandleDelete",value:function(e){27===e.keyCode?this.$.typeahead.suggest(e):8===e.keyCode&&(this.deletePill(),this.blurDisabled=!!this.previousBlurDisabled)}},{key:"preventBlurOnDelete",value:function(e){this.previousBlurDisabled=this.blurDisabled,8===e.keyCode&&(this.blurDisabled=!0)}},{key:"preventBlur",value:function(){this.previousBlurDisabled=this.blurDisabled,this.blurDisabled=!0}},{key:"deletePill",value:function(){this.disabled||this.$.typeahead.clear(),this.blurDisabled=this.previousBlurDisabled}},{key:"isNil",value:function(e){return null==e||""===e}},{key:"dialogOpened",value:function(){this.blurDisabled=!0,this.focusDisabled=!0}},{key:"dialogClosed",value:function(){this.blurDisabled=!1,this.focusDisabled=!1,this.focus(!0),this.fire("iron-signal",{name:"sb-lookup-dialog-closed",data:{lookup:this}})}},{key:"getSelectedLabel",value:function(){return new i(this.tableName).getNameField()}},{key:"getLabels",value:function(){return this.menuItemLabels||[this.selectedLabel]}},{key:"getSearchText",value:function(){return this.placeholder||this.buildSearchText()}},{key:"buildSearchText",value:function(){return this.i18n&&"function"==typeof this.i18n.l?this.i18n.l("Search {0}",[this.tableLabel]):"Search "+this.tableLabel}},{key:"handleMobileEvents",value:function(){this.isMobile()&&(this.inDialog?(this._clearAndSave=this._clearAndSave||(this.domHost.clearAndSave?this.domHost.clearAndSave.bind(this.domHost):null),this._clearAndSave&&(this.$.typeahead.removeEventListener("sb-type-clear",this._clearAndSave),this.$.typeahead.addEventListener("sb-type-clear",this._clearAndSave))):(this._applySearchValue=this._applySearchValue||this.applySearchValue.bind(this),this.$.typeahead.removeEventListener("sb-type-focus",this._applySearchValue),this.$.typeahead.addEventListener("sb-type-focus",this._applySearchValue)))}},{key:"showSearch",value:function(){return this.isMobile()&&!this.inDialog}},{key:"isMobile",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"initCurrentRecordFilters",value:function(){if(0!==this.controllingFields.length){var e=this.fieldFullName.split(".")[0],t=[],i=!0,n=!1,o=void 0;try{for(var r,s=this.controllingFields[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t.push(e+"."+a)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}this.$.fields.fields=t}else this.currentRecordFilters={}}},{key:"setCurrentRecordFilters",value:function(e){var t={},i=!0,n=!1,o=void 0;try{for(var r,s=e.detail.value.fields[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t[a.name]=a.type}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}this.currentRecordFilters=t}},{key:"setForceSuggest",value:function(e){if(!this.forceSuggest&&e&&e.path&&"record"!==e.path&&this.hasFilter){var t=this.currentRecordFilters?Object.keys(this.currentRecordFilters):[];if(0!==t.length){var i=e.path.split("."),n=i[i.length-1];-1!==t.indexOf(n)&&(this.forceSuggest=!0)}}}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["setSelectedItem(value, selectedLabel)","setLabel(label)","setCallback(customCallback)","handleMobileEvents(viewport, inDialog)","setForceSuggest(record.*)","initCurrentRecordFilters(hasFilter, controllingFields, fieldFullName)"]}}]),a=e)),t("Lookup",a),Polymer(a)}}}),System.register("common/forms/sb-multi-lookup/MultiLookup.js",["common/core/sb-page-container/PageContainer.js"],function(t,e){var i,s,o;return{setters:[function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t("MultiLookup",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-multi-lookup",this.properties={tableName:String,objectName:String,hideCancel:Boolean,iconName:String,iconMap:Object,results:Array,selectedItems:{type:Array,value:[]},selectedIdsByItems:{type:Object,value:{}},customCallBack:Function,viewport:{type:Object,value:function(){return i.getViewport()}},isMobile:Boolean}}},{key:"updateTable",value:function(e){this.results=e}},{key:"ready",value:function(){this.$.lookup.addEventListener("lookup-value-changed",function(e){var t=e.detail.obj;this.selectedIdsByItems[t.Id]?this._animateDuplicate(t):this._addItem(t)}.bind(this)),this.viewport&&this.viewport.isMobile()&&this._appendMobileClasses()}},{key:"_addItem",value:function(e){this.selectedIdsByItems[e.Id]=e,this.unshift("selectedItems",e),Polymer.dom.flush(),this.iconName&&this.iconMap&&this.toggleClass(this.iconMap[e[this.iconName]],!0,this.$$(".pill-icon"))}},{key:"_animateDuplicate",value:function(t){for(var i=this,n=Polymer.dom(this.$.selectedContainer).querySelectorAll(".pill"),e=function(e){if(n[e].dataValue==t.Id)return n[e].addEventListener("webkitAnimationEnd",function(){this.toggleClass("invalid-selection",!1,n[e])}.bind(i),!1),i.toggleClass("invalid-selection",!0,n[e]),{v:void 0}},o=0;o<n.length;o++){var r=e(o);if("object"===(void 0===r?"undefined":s(r)))return r.v}}},{key:"_appendMobileClasses",value:function(){this.isMobile=!0,this.toggleClass("mobile",!0,this.$.multilookup),this.toggleClass("mobile",!0,this.$.selectedContainer),this.toggleClass("mobile",!0,this.$.lookupContainer),this.toggleClass("mobile",!0,this.$.resultsTable)}},{key:"removeItem",value:function(e){this.splice("selectedItems",Polymer.dom(e.target).parentNode.dataIndex,1),delete this.selectedIdsByItems[Polymer.dom(e.target).parentNode.dataValue]}},{key:"selectRow",value:function(e){var t=this.results[e.currentTarget.index];this.selectedIdsByItems[t.Id]?this._animateDuplicate(t):this._addItem(t)}},{key:"clear",value:function(){this.selectedItems=[],this.selectedIdsByItems={}}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),o=e)),t("MultiLookup",o),Polymer(o)}}}),System.register("common/forms/sb-rte/RichTextEditor.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("RichTextEditor",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-rte",this.properties={value:{type:String,notify:!0}}}},{key:"attached",value:function(){this.renderReadOnly&&this.focus()}},{key:"focus",value:function(){this.fire("iron-signal",{name:"sb-open-rte-dialog",data:{rte:this,value:this.value}})}}]),i=e)),t("RichTextEditor",i),Polymer(i)}}}),System.register("common/forms/sb-pagination/Pagination.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Pagination",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-pagination",this.properties={pageIndex:{type:Number,value:0},pageSize:Number,numItems:Number}}},{key:"next",value:function(){this.pageIndex++,this.firePageEvent("next")}},{key:"previous",value:function(){this.pageIndex--,this.firePageEvent("previous")}},{key:"setNumberOfPages",value:function(){this.numPages=Math.ceil(this.numItems/this.pageSize)}},{key:"setPageWindow",value:function(){var e=this.pageIndex*this.pageSize,t=e+this.pageSize;t>=this.numItems&&(t=this.numItems),this.pageWindow=[e,t]}},{key:"setNextDisabled",value:function(){this.nextDisabled=this.pageIndex===this.numPages-1}},{key:"setPreviousDisabled",value:function(){this.previousDisabled=0===this.pageIndex}},{key:"setPageNum",value:function(){this.pageNum=this.pageIndex+1}},{key:"firePageEvent",value:function(e){this.fire("pagination-changed",{direction:e,page:this.pageNum,index:this.pageIndex,window:this.pageWindow})}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["setNumberOfPages(pageSize, numItems)","setPageWindow(pageIndex, pageSize, numItems)","setNextDisabled(pageIndex, numPages)","setPreviousDisabled(pageIndex)","setPageNum(pageIndex)"]}}]),i=e)),t("Pagination",i),Polymer(i)}}}),System.register("common/forms/sb-search-bar/SearchBar.js",["common/core/AppContext.js","common/data/format/DataBuilder.js","common/core/Page.js","products/localization/LocalizeFields.js"],function(t,e){var i,o,r,s,a;return{setters:[function(e){i=e.AppContext},function(e){o=e.DataBuilder},function(e){r=e.Page},function(e){s=e.LocalizeFields}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SearchBar",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-search-bar",this.properties=Polymer.Base.extend({limit:{type:Number,value:5},value:{type:String,value:"",notify:!0},searchedValue:{type:String,notify:!0},label:{type:Array,value:["DisplayName"]},hideCancelIcon:{type:Boolean,value:!1},quote:Object,searchService:String,actionId:String,searchResultCallback:Function,showResetButton:{type:Boolean,value:!1},placeholder:{type:String,computed:"getPlaceholder(i18n)"},i18n:{type:Object,value:function(){return i.properties.i18n.value()}},searcher:Object},r.properties)}},{key:"ready",value:function(){this.$.typeahead.addEventListener("enter-without-selection",this.search.bind(this)),this.$.typeahead.addEventListener("selected-item-changed",this.handleItemSelected.bind(this)),this.$.typeahead.showAllResults=!0,this.$.typeahead.itemsCallback=this.typeAheadCallback.bind(this),this.localizer=new s(this.fieldPrefix)}},{key:"valueChanged",value:function(){void 0===this.value||""===this.value?(this.fire("sb-type-clear"),this.toggleClass("disabled",!1,this.$.search)):this.toggleClass("disabled",!1===this.isSearchValid(),this.$.search)}},{key:"realign",value:function(){this.isMobile&&this.toggleClass("shiftRight",!0,this.$.buttons)}},{key:"handleItemSelected",value:function(e){this.value=e.detail.value.Name,void 0!==this.value&&this.fire("sb-search-item-selected",{item:this.getSearchResultRow(e.detail.value.Id),searchValue:this.value})}},{key:"toggleResetButton",value:function(e){!0===this.showResetButton&&this.toggleClass("disabled",!1===e,this.$$("#reset"))}},{key:"reset",value:function(){this.fire("sb-search-reset-clicked")}},{key:"search",value:function(){!1!==this.isSearchValid()?(this.spinner=!0,this.blur(),this.searchedValue=this.value,this.serviceCallout(null).then(function(e){this.fire("sb-search-invoked",{searchModel:e,searchValue:this.value}),this.spinner=!1}.bind(this))):""!==this.value&&void 0!==this.value||this.fire("sb-search-nil-search-invoked")}},{key:"getSearchResultRow",value:function(e){var t=Object.assign({},this.mostRecentResults),i=!0,n=!1,o=void 0;try{for(var r,s=t.results[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;if(a.record.Product2Id===e)return a}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}}},{key:"typeAheadCallback",value:function(){return new Promise(function(t){void 0!==this.searchService&&void 0!==this.quote&&!1!==this.isSearchValid()&&this.serviceCallout(this.limit).then(function(e){if(this.mostRecentResults=e,"function"==typeof this.searchResultCallback)return this.searchResultCallback(this.parseResults(e));t(this.parseResults(e))}.bind(this))}.bind(this))}},{key:"getFilterContextFromSearcher",value:function(){return this.searcher?this.searcher.getFilterContext():{}}},{key:"buildContext",value:function(e){return(new o).addObject("filterContext",this.getFilterContextFromSearcher(),void 0,void 0,!0).add("searchContext",this.getSearchContext()).add("resultLimit",e).add("pageNumber",null).add("actionId",this.actionId).addObject("quote",this.quote.record).build()}},{key:"serviceCallout",value:function(e){return new Promise(function(t){this.$.service.client.load(this.prefix,this.searchService,null,this.buildContext(e)).then(function(e){t(this.localizer.localizeSearchModel(e))}.bind(this))}.bind(this))}},{key:"parseResults",value:function(e){var t=[],i=this.getSearchContext();if(null===i)return t;var n=!0,o=!1,r=void 0;try{for(var s,a=e.results[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value.record.Product2,u=new RegExp(i,"i"),d=l.Name.match(u);if(d){var c=l.Name.substring(0,d.index),h=l.Name.substring(d.index,d.index+i.length),p=l.Name.substring(d.index+i.length);l.DisplayName=c+"<b>"+h+"</b>"+p}else l.DisplayName=l.Name;t.push(l)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return t}},{key:"getSearchContext",value:function(){return!0===this.isSearchValid()?this.value:null}},{key:"isSearchValid",value:function(){return void 0!==this.value&&1<this.value.replace(/ /g,"").replace(/\*/g,"").replace(/\?/g,"").replace(/\(/g,"").replace(/\)/g,"").length}},{key:"getPlaceholder",value:function(){return this.i18n&&"function"==typeof this.i18n.l?this.i18n.l("Search Products"):"Search Products"}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["valueChanged(value)","realign(reposition, isMobile)"]}},{key:"prefix",get:function(){return this.app.org.prefix}},{key:"fieldPrefix",get:function(){return void 0===this.app.org.prefix?"":this.app.org.prefix+"__"}}]),a=e)),t("SearchBar",a),Polymer(a)}}}),System.register("common/forms/sb-search-bar-dialog/SearchBarDialog.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SearchBarDialog",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-search-bar-dialog",this.properties={value:String,cols:{type:Array,value:["DisplayName"]},colsDisplay:{type:Array,value:["DisplayName"]},results:Array}}},{key:"ready",value:function(){this.attachSearchProperties(),this.attachSearchEvents()}},{key:"attachSearchProperties",value:function(){this.$.search.searchResultCallback=this.handleSearchResults.bind(this)}},{key:"attachSearchEvents",value:function(){this.$.search.addEventListener("sb-search-invoked",this.toggle.bind(this)),this.$.search.addEventListener("sb-search-nil-search-invoked",this.updateSearchResults.bind(this))}},{key:"open",value:function(){this.$.search.value=this.value,""===this.value&&(this.results=[]),this.toggle(),this.$.search.$.typeahead.focus()}},{key:"close",value:function(){this.blur(),this.toggle()}},{key:"toggle",value:function(){this.$.dialog.toggle()}},{key:"handleSearchResults",value:function(e){this.results=e}},{key:"updateSearchResults",value:function(){var e=[],t=!0,i=!1,n=void 0;try{for(var o,r=this.results[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;s.Name===this.$.search.value&&e.push(s)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}this.results=e}},{key:"mobileSelection",value:function(e){var t=Polymer.dom(e).localTarget,i=t.getAttribute("data-name");this.$.search.value=i;var n=t.getAttribute("data-id");this.fire("sb-search-item-selected",{item:this.$.search.getSearchResultRow(n),searchValue:i}),setTimeout(function(){this.toggle()}.bind(this),350),this.updateSearchResults()}},{key:"clearSearchResults",value:function(){this.results=[]}}]),i=e)),t("SearchBarDialog",i),Polymer(i)}}}),System.register("common/forms/sb-select/Select.js",["common/core/AppContext.js"],function(t,e){var b,i;return{setters:[function(e){b=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Select",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-select",this.properties={value:{type:String,value:""},options:Array,isRequired:{type:Boolean,value:!1},noneLabel:{type:String,value:""},focusOnAttached:Boolean,applyFocus:{type:Boolean,observer:"_applyFocus"},multiSelect:{type:Boolean,observer:"_multiSelectChanged"},size:Number,_multiple:{type:Boolean,computed:"_setMultiple(multiSelect)"},_options:Array}}},{key:"_multiSelectChanged",value:function(e,t){void 0===t&&e&&this.buildOptions()}},{key:"buildOptions",value:function(){if(this.options){for(var e=!0,t=[],i=this._getValues(),n=0,o=this.options.length;n<o;n++){var r=this.options[n],s=-1!==i.indexOf(r.value.toString());e=e&&!s,t.push({value:r.value,label:r.label,selected:s})}if(e&&0<i.length){var a=!0,l=!1,u=void 0;try{for(var d,c=i[Symbol.iterator]();!(a=(d=c.next()).done);a=!0){var h=d.value;t.push({value:h,label:h,selected:!0})}}catch(e){l=!0,u=e}finally{try{!a&&c.return&&c.return()}finally{if(l)throw u}}e=!1}if((!e||this.multiSelect)&&this.isRequired||(t=[{value:"",label:this.noneLabel,selected:e}].concat(t)),b.isIE()){for(var p=Polymer.dom(this.querySelector(".myselect")),f=p.childNodes,g=0,y=f.length;g<y;g++)p.removeChild(f[g]);for(var v=0,m=t.length;v<m;v++)this._createOptionElements(this.querySelector(".myselect"),t[v])}else this._options=t}}},{key:"_createOptionElements",value:function(e,t){var i=document.createElement("option");i.label=t.label,i.value=t.value,i.selected=t.selected,e.appendChild(i)}},{key:"setSelected",value:function(){if(!this.internal)for(var e=this._getValues(),t=0,i=this._options.length;t<i;t++)this._options[t].selected=-1!==e.indexOf(this._options[t].value.toString()),this.querySelector(".myselect").options[t]&&(this.querySelector(".myselect").options[t].selected=-1!==e.indexOf(this.querySelector(".myselect").options[t].value.toString()))}},{key:"change",value:function(){for(var e=this.querySelector(".myselect").options,t=null,i=0,n=e.length;i<n;i++)b.isIE()||(this._options[i].selected=e[i].selected),e[i].selected&&(this.multiSelect&&null!=t?t+=";"+e[i].value:t=e[i].value);this.internal=!0,this.value=t,this.internal=!1,this.fire("change",{value:this.value})}},{key:"attached",value:function(){this.focusOnAttached&&this.focus()}},{key:"focus",value:function(){this.querySelector(".myselect").focus()}},{key:"blur",value:function(){this.fire("blur")}},{key:"_applyFocus",value:function(){this.applyFocus&&this.focus()}},{key:"_setMultiple",value:function(){return!!this.multiSelect||void 0}},{key:"_getValues",value:function(){return e.getValues(this.value,this.multiSelect)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["buildOptions(options, isRequired)","setSelected(value, _options)"]}}],[{key:"getValues",value:function(e,t){return null!=e&&""!==e?t?e.split(";"):[e.toString()]:[]}}]),i=e)),t("Select",i),Polymer(i)}}}),System.register("common/forms/sb-textarea/Textarea.js",["common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o;return{setters:[function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Textarea",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-textarea",this.properties={value:{type:String,observer:"changed"},focusOnAttached:Boolean,applyFocus:{type:Boolean,observer:"_applyFocus"},viewport:{type:Object,value:function(){return i.getViewport()}}}}},{key:"attached",value:function(){this.focusOnAttached&&this.focus()}},{key:"focus",value:function(){this.$.textarea.focus()}},{key:"blur",value:function(){this.fireChangeOnBlur(),this.fire("blur")}},{key:"highlight",value:function(){if(!this.viewport||!this.viewport.isMobile()){var e=this.value?this.value.length:0;this.$.textarea.setSelectionRange(0,e)}}},{key:"changed",value:function(e,t){void 0!==t?(this.changeOnNextBlur=!1,t!=e&&this.fireChangeEvent(e)):this.changeOnNextBlur=!0}},{key:"fireChangeEvent",value:function(e){this.fire("change",{value:e})}},{key:"fireChangeOnBlur",value:function(){this.changeOnNextBlur&&(this.fireChangeEvent(this.value),this.changeOnNextBlur=!1)}},{key:"propagateEsc",value:function(e){27===e.keyCode&&(this.renderReadOnly&&(this.$.textarea.value=this.value),this.fire("sb-textarea-key",{keyCode:27}))}},{key:"_applyFocus",value:function(){this.applyFocus&&this.focus()}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),o=e)),t("Textarea",o),Polymer(o)}}}),System.register("common/forms/sb-typeahead/Typeahead.js",["common/core/sb-page-container/PageContainer.js","common/layout/sb-html/Html.js"],function(t,e){var i,l,o,v,r;return{setters:[function(e){i=e.PageContainer},function(e){l=e.Html}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},v=new RegExp("[*_%]+","g"),10,t("Typeahead",(o(e,[{key:"beforeRegister",value:function(){this.is="sb-typeahead",this.properties={items:{type:Array,value:[]},itemsCallback:{type:Object},debounceDelay:{type:Number,value:300},selectedItem:{type:Object,notify:!0},itemsList:{type:Array,observer:"itemsListChanged",notify:!0},labels:{type:Array,value:function(){return this.getAttribute("labels")||["label"]}},labelValue:{type:String,notify:!0},value:{type:String},delimiter:{type:String,value:function(){return this.getAttribute("delimiter")||""}},savedLabelValue:{type:String},invalidLabel:{type:Boolean,value:!1},hasList:{type:Boolean,value:!1,observer:"_calculateListPosition"},hasLabel:{type:Boolean,value:!1},optionIndex:{type:Number,value:-1},focusOnAttached:Boolean,applyFocus:{type:Boolean,observer:"_applyFocus"},hideCancelIcon:{type:Boolean,value:!1},clearAfterSelection:{type:Boolean,value:!1},blurDisabled:{type:Boolean,value:!1},focusDisabled:{type:Boolean,value:!1},revertOnEscape:{type:Boolean,value:!1},showSearchIcon:{type:Boolean,value:!1},calculateListPosition:{type:Boolean,value:!1},showListNoSuggestion:{type:Boolean,value:!1},showListOnFocus:{type:Boolean,value:!1},hideInput:{type:Boolean,value:!1},showLeftSearchIcon:{type:Boolean},noSearchItem:{type:Boolean},disjointLabel:Boolean,showAllResults:{type:Boolean,value:!1}},this.observers=["itemsChanged(items, labels)","selectedItemChanged(selectedItem, value)","setStyles(showLeftSearchIcon, hideCancelIcon)"]}},{key:"ready",value:function(){this.$.itemLabel.addEventListener("focus",this._directInputFocus.bind(this)),this.$.itemLabel.addEventListener("blur",this._directInputBlur.bind(this))}},{key:"attached",value:function(){this.isAttached=!0,this.focusOnAttached&&this.focus()}},{key:"setStyles",value:function(){this.showLeftSearchIcon&&this.toggleClass("leftSearch",!0,this.$.itemLabel),this.hideCancelIcon||this.toggleClass("cancelIcon",!0,this.$.itemLabel)}},{key:"itemsChanged",value:function(){this.items.length&&(this.itemsList=this.updateItemsList())}},{key:"selectedItemChanged",value:function(){if(this.selectedItem){var e=this.selectedItem.__md__,t=!!e&&e.clearAfterSelection;this.valueAttr=this.value?this.value:"value",this.labelValue=this.selectedItem[this.valueAttr],(this.clearAfterSelection||t)&&(this.selectedItem="",this.items=this.itemsList=[]),this.originalSelected||(this.originalSelected=JSON.parse(JSON.stringify(this.selectedItem)))}}},{key:"itemsListChanged",value:function(){Polymer.dom.flush();var e=Polymer.dom(this.$.selector).querySelectorAll(".option");if(e){var t=e.length,i=this.labels.length;if(0<t){this.optionIndex=-1;for(var n=0;n<t;n++){for(var o=this.itemsList[n],r="",s=0;s<i;s++){var a=this.labels[s];r+=(0===s?"":this.delimiter)+o[a]}e[n].innerHTML=l.sanitizeHtmlText(r),Polymer.dom(e[n]).setAttribute("data-label",r)}}}}},{key:"getSelectedItemValue",value:function(){return this.selectedItem?this.selectedItem[this.valueAttr]:""}},{key:"clear",value:function(){this.hide(),this.updateItem({},!0),this.fire("sb-type-clear")}},{key:"hide",value:function(){this.hideList(),this.invalidLabel=!1,this.optionIndex=-1}},{key:"cloneItem",value:function(e){for(var t={},i=Object.keys(e),n=i.length,o=0;o<n;o++){var r=i[o];t[r]=e[r]}return t}},{key:"updateItem",value:function(e,t){for(var i=Object.keys(e),n=i.length,o={},r=0;r<n;r++){var s=i[r];o[s]=void 0!==e[s]?e[s]:""}this.selectedItem=o;for(var a="",l=this.labels.length,u=0;u<l;u++){var d=0===u?"":this.delimiter,c=this.selectedItem[this.labels[u]];c&&(a+=d+c)}var h=this.selectedItem.__md__;this.disjointLabel||(this.labelValue=h&&!h.clearAfterSelection&&void 0!==h.searchValue?h.searchValue:a),this.clearSelection(),this.focusOrBlurAfterSelection(this.selectedItem,t)}},{key:"submitItem",value:function(e){var t=e.model.item;this.updateItem(t),this.hide(),this.focusOrBlurAfterSelection(t)}},{key:"focusOrBlurAfterSelection",value:function(e,t){e&&e.__md__&&e.__md__.noFocusAfterSelection?this.$.itemLabel.blur():this.focus(t)}},{key:"selectAdjacentItem",value:function(e){if(this.itemsList){var t=this.itemsList.length;0<=this.optionIndex&&this.optionIndex<t?(this.$.selector.children[this.optionIndex].removeAttribute("selected"),38===e?this.optionIndex=0===this.optionIndex?t-1:this.optionIndex-1:40===e&&(this.optionIndex=this.optionIndex===t-1?0:this.optionIndex+1)):-1===this.optionIndex&&(38===e?this.optionIndex=t-1:40===e&&(this.optionIndex=0)),this.$.selector.children[this.optionIndex].setAttribute("selected","")}}},{key:"updateItemsList",value:function(){if(this.searchLabels||(this.searchLabels=this.labels),!0===this.showAllResults)return this.items;var e=[],t=!1;if(this.showListNoSuggestion||this.labelValue)for(var i=(this.labelValue||"").replace(/\+/g,"\\+").replace(/\\/g,"\\\\").replace(v,".+"),n=new RegExp(i,"i"),o=this.items.length,r=this.searchLabels.length,s=0;s<o;s++){for(var a=this.items[s],l=this.cloneItem(a),u=0;u<r;u++){var d=a[this.searchLabels[u]];d&&(this.showListNoSuggestion||n.test(d))&&(l["_"+this.searchLabels[u]]=d.replace(n,'<span style="font-weight:bold;">$&</span>'),t=!0)}if(t){var c=!0,h=!0,p=!1,f=void 0;try{for(var g,y=this.labels[Symbol.iterator]();!(h=(g=y.next()).done);h=!0)l[g.value]||(c=!1)}catch(e){p=!0,f=e}finally{try{!h&&y.return&&y.return()}finally{if(p)throw f}}c&&e.push(l),t=!1}if(10<=e.length)break}return e}},{key:"suggest",value:function(e){if(this.isAttached)switch(e.keyCode){case 13:if(this.$.itemLabel.blur(),this.hasList){if(-1===this.optionIndex){if(this.noSearchItem){this.fire("enter-without-selection",{value:this.labelValue}),this.hideList();break}this.optionIndex=0}this.updateItem(this.itemsList[this.optionIndex]),this.noBlur=!1}else this.fire("enter-without-selection",{value:this.labelValue});this.hide();break;case 27:this.revertOnEscape&&(this.updateItem(this.originalSelected),this.items=void 0,this.hideList(),this.clearSelection(),this.fire("sb-type-blur"));break;case 38:case 40:this.selectAdjacentItem(e.keyCode);break;case 9:case 16:break;default:this.invalidLabel=!1,this.itemsCallback?this.debounce("itemsCallback",function(){this.itemsCallback(this.labelValue).then(function(e){e&&0<e.length?this.showList():this.hideList(),this.items=e}.bind(this),function(e){console.error(e&&e.message?e.message:e),this.items=[]}.bind(this))},this.debounceDelay):(this.showList(),this.itemsList=this.updateItemsList(),0===this.itemsList.length&&(this.labelValue?this.invalidLabel=!0:this.hasLabel=!1,this.hasList=!1))}}},{key:"showList",value:function(){this.blurred?this.hideList():(this.showListNoSuggestion||null!=this.labelValue&&""!==this.labelValue)&&(this.hasList=!0,this.hasLabel=!0)}},{key:"hideList",value:function(){this.hasList=!1,this.hasLabel=!1}},{key:"clearSelection",value:function(){var e=Polymer.dom(this.$.selector).querySelectorAll(".option"),t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this.toggleAttribute("selected",!1,s)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"tabBlur",value:function(e){9===e.keyCode&&(this.hasList=!1),38===e.keyCode&&e.preventDefault(),13===e.keyCode&&this.hasList&&this.preventBlur(),27!==e.keyCode||this.revertOnEscape||setTimeout(function(e){this.labelValue=e}.bind(this,this.labelValue),0)}},{key:"focus",value:function(e){this.focusDisabled||(this.focusing=!0,this.$.itemLabel.focus(),this._showListOnFocus(e),this.focusing=!1)}},{key:"blur",value:function(e,t){!t&&(this.hasList||this.blurDisabled)||(this.hideList(),this.fire("sb-type-blur"),this.setOriginalSelected())}},{key:"setOriginalSelected",value:function(){this.originalSelected=JSON.parse(JSON.stringify(this.selectedItem||{}))}},{key:"preventBlur",value:function(){this.noBlur=!0}},{key:"allowBlur",value:function(){this.noBlur=!1}},{key:"focused",value:function(){this.fire("sb-type-focus",{value:this.labelValue})}},{key:"_applyFocus",value:function(){this.applyFocus&&this.focus()}},{key:"_calculateListPosition",value:function(){if(this.calculateListPosition&&this.hasList){var e=i.getContainer().getBoundingClientRect().left,t=this.$.itemLabel.getBoundingClientRect().left;this.$.selector.style.left=t-e+"px"}}},{key:"_showListOnFocus",value:function(e){!this.showListOnFocus||this.hideInput||this.hasList||(e||!this.items||0===this.items.length?this.suggest({}):this.showList())}},{key:"_directInputFocus",value:function(){this.blurred=!1,this.focusing||this._showListOnFocus()}},{key:"_directInputBlur",value:function(){this.blurred=!0,this.blur(null,!this.noBlur)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),r=e)),t("Typeahead",r),Polymer(r)}}}),System.register("common/layout/data/RecordGrouper.js",[],function(e,t){var h,i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,i,n,o,r,s,a,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),this.groupField=e,t&&(this.groupedRecordFields=t.constructor!==Array?[t]:t),this.recordPath=i,this.itemProperties=n,this.itemPropertiesByGroup=o,this.groupProperties=r,this.groupCountPath=s,this.groupFieldType=a,this.groupFieldTypePath=l}h="Other",e("RecordGrouper",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(u,[{key:"group",value:function(e){for(var t=[],i={},n=0,o=e.length;n<o;n++){var r=e[n],s=this._get(r,this.recordPath)[this.groupField],a=null==s||""===s;s=a?h:s+"";var l=i[s];l||a||t.push(s),l=l||[],r.groupie=s,r.grouper=null,l.push(r),i[s]=l,this._setProperties(r,this.itemProperties),this._setProperties(r,this.itemPropertiesByGroup,s)}return i[h]&&t.push(h),this._sortItemsByGroup(t,i)}},{key:"_sortItemsByGroup",value:function(e,t){for(var i=[],n=0,o=e.length;n<o;n++){var r=e[n],s=t[r],a=s.length;if(this.groupedRecordFields){for(var l={grouper:r,groupie:null},u=this._get(l,this.recordPath),d=0,c=this.groupedRecordFields.length;d<c;d++)u[this.groupedRecordFields[d]]=r;this.groupCountPath&&(this._get(l,this.groupCountPath.path)[this.groupCountPath.property]="("+a+")"),this.groupFieldType&&this.groupFieldTypePath&&(this._get(l,this.groupFieldTypePath.path)[this.groupFieldTypePath.property]=r!==h?this.groupFieldType:"string"),this._setProperties(l,this.groupProperties),i.push(l)}i=i.concat(s)}return i}},{key:"_get",value:function(e,t){if(!t)return e;for(var i=t.split("."),n=0,o=i.length;n<o;n++)e[i[n]]||(e[i[n]]={}),e=e[i[n]];return e}},{key:"_setProperties",value:function(e,t,i){if(t){if(i){if(!t[i])return;t=t[i]}for(var n in t)e[n]=t[n]}}}]),i=u)),e("RecordGrouper",i)}}}),System.register("common/layout/fields/FieldHider.js",[],function(e,t){var o,r;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.toggle=t,"boolean"==typeof e?this.hide={hidden:e,type:"hide"}:"object"===(void 0===e?"undefined":o(e))?this.hide={hidden:!!e.hidden,type:e.type||"hide"}:this.hide={hidden:!1,type:"hide"}}o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e("FieldHider",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"applyTo",value:function(e){var t=[this.hide];"hide"===this.type?t.push({hidden:!1,type:"invisible"}):t.push({hidden:!1,type:"hide"});var i=!0,n=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;this.toggle.toggleClass(a.type,a.hidden,e)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}}},{key:"hidden",get:function(){return this.hide.hidden}},{key:"type",get:function(){return this.hide.type}}]),r=i)),e("FieldHider",r)}}}),System.register("common/layout/fields/FieldSetHandler.js",["common/core/AppContext.js"],function(e,t){var i;return{setters:[function(e){e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.fieldSets=e,this.desktopFields={name:t},i&&(this.tabletFields={name:i}),n&&(this.phoneFields={name:n})}e("FieldSetHandler",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"getByViewport",value:function(e){return e&&e.isPhone()?this._getPhoneFieldSet():e&&e.isTablet()?this._getTabletFieldSet():this._getDesktopFieldSet()}},{key:"_getPhoneFieldSet",value:function(){var e=this.phoneFields?this.fieldSets[this.phoneFields.name]:null;return e&&0!==e.length?(this.phoneFields.fields=e,this.phoneFields):this._getTabletFieldSet()}},{key:"_getTabletFieldSet",value:function(){var e=this.tabletFields?this.fieldSets[this.tabletFields.name]:null;return e&&0!==e.length?(this.tabletFields.fields=e,this.tabletFields):this._getDesktopFieldSet()}},{key:"_getDesktopFieldSet",value:function(){return this.desktopFields.fields=this.fieldSets[this.desktopFields.name],this.desktopFields}}]),i=o)),e("FieldSetHandler",i)}}}),System.register("common/layout/sb-badge/Badge.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Badge",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-badge",this.properties={for:{type:String,observer:"_changedFor"},label:{type:Number,observer:"_changedLabel"}}}},{key:"attached",value:function(){this._updateTarget(),this._setVisibility()}},{key:"_setVisibility",value:function(){this.label||this.getAttribute("hidden")?this.removeAttribute("hidden"):this.setAttribute("hidden","")}},{key:"_updateTarget",value:function(){this._target=this.target,this.updatePosition()}},{key:"attributeChanged",value:function(e){}},{key:"_changedFor",value:function(){this.isAttached&&this._updateTarget()}},{key:"_changedLabel",value:function(){this.setAttribute("aria-label",this.label),this._setVisibility()}},{key:"updatePosition",value:function(){var e,t;if(this._target){e=this._target.getBoundingClientRect();var i=(t=this.getBoundingClientRect()).top-e.top;this.style.top=0-(i+e.height/2)+"px";var n=e.right-t.left+1;this.style.left=n+"px"}}},{key:"target",get:function(){var e,t=this.parentNode;return this.for&&(e=Polymer.dom(t).querySelector("#"+this.for)),e}}]),i=e)),t("Badge",i),Polymer(i)}}}),System.register("common/layout/sb-actions/Actions.js",["common/core/AppContext.js","common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.AppContext},function(e){o=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Actions",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-actions",this.properties={rowActions:Array,position:{type:String,value:"left"},data:{type:Object,notify:!0},viewport:{type:Object,value:function(){return o.getViewport()}},i18n:{type:Object,value:function(){return i.properties.i18n.value()}}}}},{key:"ready",value:function(){this.isMobile=this._isMobileViewport()}},{key:"shouldDisable",value:function(e){if(this.data&&this.rowActions&&this.rowActions[e])return"Delete"==this.rowActions[e].title&&(this.data.required&&!this.data.addedManually||!!this.data.disabledData&&this.data.disabledData.disabled)}},{key:"_isMobileViewport",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"tapEvent",value:function(e){this.rowActions[e.currentTarget.dataIndex].onTapFunction&&!this.shouldDisable(e.currentTarget.dataIndex)&&this.rowActions[e.currentTarget.dataIndex].onTapFunction.bind(this)()}},{key:"_isVisible",value:function(e){return e?"visibilityHidden":""}},{key:"displayTitle",value:function(e,t){return this.shouldDisable(t)?"Disabled":this.i18n.l(e.title)}},{key:"_isDisabled",value:function(e){return this.shouldDisable(e)?"disabled":""}},{key:"disableActions",value:function(){if(this.$$(".sb-action-icon")&&this.rowActions)for(var e=0;e<this.rowActions.length;e++)this.toggleClass("disabled",this.shouldDisable(e),this.$$("#_"+e))}},{key:"_configurationRequired",value:function(e){if(!this.isMobile||this.data.configured)return"";for(var t=0;t<this.rowActions.length;t++)if("Configure"===e&&this.rowActions[t].configurationRequired)return"configurationRequired"}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["disableActions(data.disabledData.disabled)"]}}]),r=e)),t("Actions",r),Polymer(r)}}}),System.register("common/layout/sb-dialog/Dialog.js",["common/core/sb-page-container/PageContainer.js","common/core/AppContext.js"],function(t,e){var i,s,o;return{setters:[function(e){i=e.PageContainer},function(e){s=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Dialog",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-dialog",this.properties={show:{type:Boolean,value:!1},modal:{type:Boolean,value:!1},hideHeader:{type:Boolean,observer:"_hideHeader"},appendedClass:{type:String},cancelText:{Type:String,value:"Cancel"},closeDialog:{type:String,value:"sb-close-dialog"},hideCloseIcon:{type:Boolean,value:!1},hideCancelButton:{type:Boolean,value:!1},mobile:{type:Boolean,value:function(){if(i.getViewport())return!!i.getViewport().isMobile()}},mobileDropDown:{type:Boolean,value:!1},tapDialog:String,ignoreMaskTap:{type:Boolean,value:!1}}}},{key:"ready",value:function(){this.appendedClass&&this.$$(".sbDialog").classList.add(this.appendedClass),this.mobile&&(this._appendMobileClasses(),Polymer.dom(this).observeNodes(function(){var e=Polymer.dom(this).querySelectorAll("paper-button"),t=this.$$("#title");if(0===e.length){var i=this.$$("#title");this.toggleClass("no-buttons",!0,i)}else{this.mobileDropDown=1<e.length;var n=this.$$("#mobileButtons"),o=this.$$("#drop-down-button");this.toggleClass("no-buttons",!1,t),this.toggleClass("drop-down-menu",this.mobileDropDown,n),this.toggleClass("single-button",!this.mobileDropDown,n),this.toggleClass("hidden",!this.mobileDropDown,o)}}.bind(this))),this.toggleClass("is-ie",s.isIE(),this.$.footer)}},{key:"_appendMobileClasses",value:function(){this.toggleClass("mobile",!0,this.$$(".sbDialog"));for(var e=Polymer.dom(this).children,t=e.length,i=0;i<t;i++)this.toggleClass("mobile",!0,e[i])}},{key:"toggle",value:function(){this.show=!this.show,this.show&&this.fire("sb-open-dialog")}},{key:"open",value:function(){this.show=!0}},{key:"close",value:function(){this.show=!1}},{key:"toggleMenu",value:function(){var e=this.$$(".drop-down-menu");e&&e.classList.contains("open")?this.toggleClass("open",!1,e):this.toggleClass("open",!0,e)}},{key:"onCloseDialog",value:function(){this.fire("iron-signal",{name:"sb-panel-closed"}),this.fire(this.closeDialog)}},{key:"maskTapped",value:function(){this.ignoreMaskTap||this.onCloseDialog()}},{key:"tapEvent",value:function(){this.tapDialog&&this.fire(this.tapDialog)}},{key:"_datePickerOpened",value:function(e){var t=e.detail.dateContainer,i=e.detail.datepicker,n=this.$.content;i.style.position="fixed";var o=t.getBoundingClientRect(),r=n.getBoundingClientRect();s.isIE()?(i.style.left=o.left+"px",i.style.top=o.top+o.height+"px"):(i.style.left=o.left-r.left+"px",i.style.top=o.top+o.height-this.$.header.getBoundingClientRect().top+1+"px")}},{key:"_hideHeader",value:function(){this.$.header.setAttribute("hidden","true")}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"listeners",get:function(){return{"datepicker-opened":"_datePickerOpened"}}}]),o=e)),t("Dialog",o),Polymer(o)}}}),System.register("common/layout/sb-div/Div.js",["../../core/AppContext.js"],function(t,e){var i,o;return{setters:[function(e){i=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Div",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-div",this.properties={value:String,label:{type:String,computed:"_setLabel(value)"}}}},{key:"_setLabel",value:function(){var e=this.value;return"ja"===i.user.lang&&e&&(e=e.replace("{{data.","").replace("}}","")),e}}]),o=e)),t("Div",o),Polymer(o)}}}),System.register("common/layout/sb-field-item/FieldItem.js",["common/relationship/RelationshipFieldManager.js"],function(t,e){var i,o;return{setters:[function(e){i=e.RelationshipFieldManager}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("FieldItem",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-field-item",this.properties={value:{notify:!0},item:String,model:Object,md:Object,data:Object}}},{key:"_setFieldData",value:function(){this.md=this.model[this.item],this.label=this.md.label,this.helpText=this.md.inlineHelpText,this.$.field.editing=this.md.updateable,this.$.field.md=this.md,this.$.field.property=this.item;var e={};e[this.item]=this.value,this.$.field.obj=e}},{key:"_dataChanged",value:function(){var e=new i(this.item,this.data);e.hasRelationship()&&(this.display=e.getRelationshipName())}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_setFieldData(item, model)","_dataChanged(data, item)"]}}]),o=e)),t("FieldItem",o),Polymer(o)}}}),System.register("common/layout/sb-field-table/FieldTable.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("FieldTable",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-field-table",this.properties={numColumns:{type:Number,value:1},data:{type:Object,notify:!0},fieldNames:String,md:Object,disabled:Boolean}}},{key:"generateColumns",value:function(){for(var e=[],t=[],i=[],n=this.fieldNames.length,o=0;o<n;o++)o%this.numColumns==0?e.push(this.fieldNames[o]):o%this.numColumns==1?t.push(this.fieldNames[o]):i.push(this.fieldNames[o]);1==this.numColumns?this.columnOneWidth="td1":2==this.numColumns?(this.columnOneWidth="td2",this.columnTwoWidth="td2"):(this.columnOneWidth="td3",this.columnTwoWidth="td3",this.columnThreeWidth="td3"),this.setColumns(e,t,i)}},{key:"setColumns",value:function(e,t,i){0<e.length&&(this.$.firstColumn.model=this.md,this.$.firstColumn.group=e),0<t.length&&(this.$.secondColumn.model=this.md,this.$.secondColumn.group=t),0<i.length&&(this.$.thirdColumn.model=this.md,this.$.thirdColumn.group=i)}},{key:"observers",get:function(){return["generateColumns(md, fieldNames)"]}}]),i=e)),t("FieldTable",i),Polymer(i)}}}),System.register("common/layout/sb-filter-item/FilterItem.js",["common/relationship/RelationshipFieldManager.js","common/core/AppContext.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.RelationshipFieldManager},function(e){o=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("FilterItem",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-filter-item",this.properties={value:{notify:!0},item:String,model:Object,md:Object,hidden:{type:Boolean,value:!1},label:{type:String,reflectToAttribute:!0},display:String,factoryData:Object}}},{key:"ready",value:function(){this.handleKeyPress(),this.addEventListener("lookup-value-changed",this.handleLabelChange)}},{key:"handleLabelChange",value:function(e){var t={item:this.item.split(".")[0],value:e.detail.refDisplay};this.fire("filter-item-value-changed",t)}},{key:"handleKeyPress",value:function(){this.addEventListener("keypress",function(e){var t=this.item.split(".")[0];this.fire("filter-item-field-keypress",{keyCode:e.keyCode,item:t,itemType:this.model[t].model.type})}.bind(this))}},{key:"clear",value:function(){this.value=null}},{key:"setMd",value:function(){var e=o.org.prefix?o.org.prefix+"__":"",t=this.item.split(".")[0];this.md=this.model[t].model,this.factoryData={range:"between"===this.model[t].record[e+"Operator__c"]},this.label=this.model[t].label?this.model[t].label:this.model[t].record.Name,this.md.type&&"boolean"===this.md.type&&"string"==typeof this.value&&this.setValue(this.item,"true"===this.value),this.$.field.editing=!0,this.$.field.property=this.item,this.$.field.md=this.md}},{key:"setHidden",value:function(){var e=this.item;this.data[e]||(e=this.item.split(".")[0]),this.data[e]&&(this.hidden=this.data[e].hidden)}},{key:"dataChanged",value:function(){var e=this.item.split(".")[0];this.display=this.data[e].label,this.$.field.record=this}},{key:"_displayChanged",value:function(){var e=this.item.split(".")[0],t=new i(e,this.data).buildRelationship(this.value,this.display,this.md.referenceTo[0]);t&&(this.data[e].label=t.value.Name)}},{key:"getValue",value:function(e){if(this.data[e])return this.data[e].value;for(var t in this.data)if(this.data[t].field===e)return this.data[t].value;return null}},{key:"setValue",value:function(e,t){this.set("data."+e,t)}},{key:"equals",value:function(e){return this.data===e.data}},{key:"observers",get:function(){return["setMd(item, model)","setHidden(data.*)","dataChanged(data, item)","_displayChanged(value, display, item, data, md)"]}}]),r=e)),t("FilterItem",r),Polymer(r)}}}),System.register("common/layout/sb-filter-layout/FilterLayout.js",["common/core/Page.js","common/data/format/DataBuilder.js","common/core/sb-page-container/PageContainer.js"],function(_export,_context){var Page,DataBuilder,PageContainer,_createClass,FilterLayout;function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}return{setters:[function(e){Page=e.Page},function(e){DataBuilder=e.DataBuilder},function(e){PageContainer=e.PageContainer}],execute:function(){function X4a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}_createClass=function(e,t,i){return t&&X4a(e.prototype,t),i&&X4a(e,i),e},_export("FilterLayout",FilterLayout=function(_Page){function FilterLayout(){return _classCallCheck(this,FilterLayout),_possibleConstructorReturn(this,(FilterLayout.__proto__||Object.getPrototypeOf(FilterLayout)).apply(this,arguments))}return _inherits(FilterLayout,_Page),_createClass(FilterLayout,[{key:"beforeRegister",value:function(){this.is="sb-filter-layout",this.properties=Polymer.Base.extend({searchModel:{type:Object,notify:!0},filterPath:{type:String,value:"searchFilters"},filterKey:String,filterDelegator:Object,searchFilterData:{type:Object,notify:!0},searchFilterModel:{type:Object,notify:!0},groupItems:{type:Array,notify:!0},serviceLoader:String,quote:Object,enterCallback:Object,translationCallback:Object,serviceCallback:Object,spinner:{type:Boolean,notify:!0},sendQuoteRecord:{type:Boolean,value:!1},resultLimit:{type:Number,value:2e3},viewport:{type:Object,value:function(){return PageContainer.getViewport()}},searchContext:String},Page.properties)}},{key:"ready",value:function(){this.mdResponse(),this.handleEnterKeyPressed()}},{key:"handleEnterKeyPressed",value:function(){this.addEventListener("filter-item-field-keypress",function(e){13===e.detail.keyCode&&"function"==typeof this.enterCallback&&"reference"!==e.detail.itemType&&setTimeout(function(){this.enterCallback()}.bind(this),0)}.bind(this))}},{key:"searchModelReady",value:function searchModelReady(){if(!0!==this.searchModelInitialized){this.searchModelInitialized=!0,void 0===this.filterKey&&(this.filterKey=this.searchModel.hasCustomSearchFilters?"Id":"Name");var properties=this.filterPath.split(".");this.path="this.searchModel";var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=properties[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var property=_step.value;this.path+="."+property}}catch(e){_didIteratorError=!0,_iteratorError=e}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}var searchFilters=eval(this.path),fields=[],searchFilterModel={};if(!1!==Array.isArray(searchFilters)){var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _iterator2=searchFilters[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var filter=_step2.value;fields.push(this.getSearchTable()+"."+filter.targetFieldName);var duplicateHidden=searchFilterModel[this.filterDelegator.getGroupKey(filter)];searchFilterModel[this.filterDelegator.getGroupKey(filter)]=filter,duplicateHidden&&(searchFilterModel[this.filterDelegator.getGroupKey(filter)].hidden=duplicateHidden)}}catch(e){_didIteratorError2=!0,_iteratorError2=e}finally{try{!_iteratorNormalCompletion2&&_iterator2.return&&_iterator2.return()}finally{if(_didIteratorError2)throw _iteratorError2}}this.fields=this.filterDelegator.buildFields(fields),this.searchFilterModel=searchFilterModel}}}},{key:"mdResponse",value:function(){this.$.md.addEventListener("md-changed",function(e){var t=e.detail.value;void 0!==t&&this.setFilterValueMap(t)}.bind(this))}},{key:"setFilterValueMap",value:function(e){var t=[],i=[];if(void 0!==this.searchFilterModel){for(var n in this.searchFilterModel){var o=this.searchFilterModel[n].targetFieldName;t.push(n+".value"),i.push(n),this.searchFilterModel[n].model=e.fieldsByObject[this.getSearchTable()][o]}JSON.stringify(this.groupItems)!==JSON.stringify(t)&&(this.groupItems=t),this.filterDelegator.skipDefaults&&this.searchFilterData||this.filterDelegator.setDefaultFilterValues(i,this.searchFilterModel).then(function(e){this.searchFilterData||(this.searchFilterData=e),this.filterDelegator.searchFilterModel=this.searchFilterModel,this.filterDelegator.groupItems=this.groupItems}.bind(this))}}},{key:"getSearchTable",value:function(){if(void 0!==this.searchModel)return this.filterDelegator.getSearchTable()}},{key:"focusFirstField",value:function(){this.isMobile()||this.$.panel.applyFocusToItem(0)}},{key:"runService",value:function(){if(void 0!==this.serviceLoader&&void 0!==this.quote){this.noSpinner||(this.spinner=!0);var e=(new DataBuilder).addObject("filterContext",this.filterDelegator.getFilterContext(),void 0,void 0,!0).add("searchContext",this.getSearchContext()).add("additional",this.filterDelegator.getAdditionalProperties()).add("actionId",this.actionId).add("resultLimit",this.resultLimit);this.sendQuoteRecord?e.addObject("quote",this.quote.record):e.addQuote("quote",this.quote);var t=e.build();this.$.service.client.load(this.prefix,this.serviceLoader,null,t).then(function(e){this.spinner=!1,"function"==typeof this.serviceCallback?this.serviceCallback(e):this.searchModel=this.localizer?this.localizer.localizeSearchModel(e):e}.bind(this))}}},{key:"isMobile",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"getSearchContext",value:function(){return void 0===this.searchContext?null:1<this.searchContext.length?this.searchContext:null}},{key:"behaviors",get:function(){return[sb.common.core.Page]}},{key:"observers",get:function(){return["searchModelReady(searchModel, filterDelegator)"]}},{key:"prefix",get:function(){return this.app.org.prefix}}]),FilterLayout}(Page)),_export("FilterLayout",FilterLayout),Polymer(FilterLayout)}}}),System.register("common/layout/sb-group/Group.js",["common/core/AppContext.js"],function(t,e){var a,i;function u(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}return{setters:[function(e){e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}a="undefined"!=typeof Visualforce,t("Group",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-group",this.properties={item:String,group:Array,data:{type:Object,notify:!0},model:{type:Object,value:null},groupClass:String,itemClass:String,groupDisplay:Object,primaryItems:{type:Array,value:null},numPrimary:{type:Number,value:0},includePrimaryInSecondary:{type:Boolean,value:!1},selected:{type:Boolean,value:!1,observer:"updateSelected"},disabled:{type:Boolean,value:!1,observer:"updateDisabled"},pathPrefix:{type:String,value:""},focusIndex:{type:Number,observer:"updateFocusIndex"},itemClassMap:{type:Object,value:{}},itemEditableMap:{type:Object,observer:"toggleEditable"},columnWidths:{type:Object,value:{}},signaler:{type:Object,observer:"updateSignaler"}}}},{key:"_itemClassMapChanged",value:function(){return!this.template||null!==this.template.itemClassMap&&null===this.itemClassMap||null===this.template.itemClassMap&&null!==this.itemClassMap||Object.keys(this.template.itemClassMap).length!==Object.keys(this.itemClassMap).length}},{key:"_updateItemClasses",value:function(){var s=this;if(this.template&&this.itemClassMap){var a=this.template.itemClassMap,l=this.itemClassMap;new Set(Object.keys(a).concat(Object.keys(l))).forEach(function(e){if(a[e]!==s.itemClassMap[e]){var t=Polymer.dom(s.$.g).querySelector(s.item+"[item='"+e+"']");if(t){if(a&&a[e]){var i,n=a[e].class||a[e];n&&"string"==typeof n&&(i=t.classList).remove.apply(i,u(n.split(" ")))}if(l&&l[e]){var o,r=l[e].class||l[e];r&&"string"==typeof r&&(o=t.classList).add.apply(o,u(r.split(" ")))}}}}),this.template.itemClassMap=l}}},{key:"buildGroup",value:function(e,t,i,n,o,r,s){this.initInternalGroupAndPrimaryItems(),this.template?this.template.group===this._group?(this.template.selected=this.selected,this.template.disabled=this.disabled,this.template.data=n,this.template.model=e,s&&this.template.columnWidths!=s&&this._updateColumnWidths(),this._itemClassMapChanged()&&this._updateItemClasses()):a||console.error("Rebuilding a group is no longer supported. Called by "+this.domHost.tagName.toLowerCase()+": old group ["+this.template.group+"], new group ["+this._group+"]"):(this.expanded=!1,this.template=document.createElement("template","dom-bind"),this.template.group=this._group,this.template.selected=this.selected,this.template.disabled=this.disabled,this.template.signaler=this.signaler,this.template.model=e,this.template.data=n,this.template.columnWidths=s,this.template.tabIndex=this.tabIndex,this.template.itemClassMap=this.itemClassMap,this.buildItems(this.template),Polymer.dom(this.$.g).appendChild(this.template),Polymer.dom(this.$.g).observeNodes(function(e){e.addedNodes[0]&&this.bindElementEvents(Polymer.dom(e.addedNodes[0]).childNodes)}.bind(this)))}},{key:"destroyGroup",value:function(){if(this.template)try{this.elements=null,Polymer.dom(this.$.g).removeChild(this.template),Polymer.dom.flush(),this.template=null,this.group=void 0}catch(e){return}}},{key:"_updateColumnWidths",value:function(){if(this.columnWidths){var e=Polymer.dom(this.$.g).querySelectorAll(this.item);!e||e&&0==e.length?Polymer.RenderStatus.afterNextRender(this,function(){var e=Polymer.dom(this.$.g).querySelectorAll(this.item);this._setColumnWidths(e)}):this._setColumnWidths(e)}}},{key:"_setColumnWidths",value:function(e){for(var t=0,i=e.length;t<i;t++){var n=e[t],o=n.getAttribute("item"),r=this.columnWidths[o];if(null!=r){var s=r.width||r;if(null!=s){var a=r.properties||["minWidth","maxWidth"],l=r.unit||"px",u=!0,d=!1,c=void 0;try{for(var h,p=a[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){var f=h.value;n.style[f]=s+l}}catch(e){d=!0,c=e}finally{try{!u&&p.return&&p.return()}finally{if(d)throw c}}}}}}},{key:"_createColumnWidthStyleHtml",value:function(e){var t=' style="',i=e.width||e,n=e.properties||["min-width","max-width"],o=e.unit||"px",r=!0,s=!1,a=void 0;try{for(var l,u=n[Symbol.iterator]();!(r=(l=u.next()).done);r=!0)t+=l.value+":"+i+o+";"}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}return t}},{key:"updateSelected",value:function(){this.template&&(this.template.selected=this.selected)}},{key:"updateDisabled",value:function(){this.template&&(this.template.disabled=this.disabled)}},{key:"updateSignaler",value:function(){this.template&&(this.template.signaler=this.signaler)}},{key:"applyFocusToItem",value:function(e){this.focusIndex=void 0,this.focusIndex=e}},{key:"updateFocusIndex",value:function(){if(this.template&&this.elements&&!(void 0===this.focusIndex||this.focusIndex<0))for(var e=0,t=this.template.group.length;e<t;e++)this.template["focus_"+e]=!1,this.focusIndex===e&&(this.template["focus_"+e]=!0)}},{key:"initInternalGroupAndPrimaryItems",value:function(){if(this._group=this.group,this._primaryItems=void 0,this.primaryItems&&0!==this.primaryItems.length){var t=[].concat(this.primaryItems);if(-1===this.group.indexOf(t[0])&&(t[0]=this.group[0]),1<t.length&&(t=-1===this.group.indexOf(t[1])?[t[0]]:[t[0],t[1]]),this._primaryItems=t,this.includePrimaryInSecondary)return this._group=t.concat(this.group),void this._normalizeWithTemplateGroup();var e=this.group.filter(function(e){return-1===t.indexOf(e)});this._group=t.concat(e),this._normalizeWithTemplateGroup()}}},{key:"buildItems",value:function(e){var a=e.content.ownerDocument,l=a.createElement("div");this.groupClass&&Polymer.dom(l).setAttribute("class",this.groupClass);var u=0<this.numPrimary?this.numPrimary:this._primaryItems?this._primaryItems.length:0;this._group.forEach(function(e,t){var i="<"+this.item+' item="'+e+'" value="{{data.'+e+'}}" model="[[model]]" data="[[data]]" disabled="[[disabled]]" selected="[[selected]]" focus="[[focus_'+t+']]" index="'+t+'"',n=t<u;!n&&this.groupDisplay&&this.groupDisplay[e]?i+=' field-label="'+this.groupDisplay[e]+'"':!n&&this.groupDisplay&&this.groupDisplay[e.split(".")[1]]&&(i+=' field-label="'+this.groupDisplay[e.split(".")[1]]+'"');var o="";this.itemClass&&(o+=this.itemClass+" "),n?(o+=0===t?"primary first":"primary multi",o+=this.selected?" selected":""):0<u&&(o+="secondary"),this.itemClassMap&&this.itemClassMap[e]&&(o+=" "+(this.itemClassMap[e].class||this.itemClassMap[e]),this.itemClassMap[e].style&&(i+=' style="'+this.itemClassMap[e].style+'"')),o&&(i+=' class="'+o+'"');var r=this.columnWidths?this.columnWidths[e]:null;null!=r&&(i+=this._createColumnWidthStyleHtml(r)),null!=this.tabIndex&&(i+=' tab-index="[[tabIndex]]"'),i+=' signaler="[[signaler]]"></'+this.item+">";var s=a.createElement("div");s.innerHTML=i,Polymer.dom(l).appendChild(Polymer.dom(s).firstChild)}.bind(this)),Polymer.dom(e.content).appendChild(l)}},{key:"bindElementEvents",value:function(e){var t=(this.elements=e)?e.length:0;this.updateFocusIndex(),this.propagateValueToParent=this.propagateValueToParent||function(e){this.internal=!0,this.set("data."+e.target.item,e.detail.value),this.childToParentExtension&&this.childToParentExtension({path:"data."+e.target.item,value:e.detail.value}),this.internal=!1}.bind(this);for(var i=0;i<t;i++)e[i].removeEventListener("value-changed",this.propagateValueToParent),e[i].addEventListener("value-changed",this.propagateValueToParent)}},{key:"propagateFromParentToChild",value:function(e){this.internal||"data"!==e.path&&(this.propagateFromParentToChildOverride?this.propagateFromParentToChildOverride(e):this._propagateFromParentToChild(e))}},{key:"_propagateFromParentToChild",value:function(e){for(var t=this.elements,i=t?t.length:0,n=e.path.split("."),o=this.pathPrefix+n[n.length-1],r=0;r<i;r++)if(t[r].item===o)return void(t[r].value=e.value)}},{key:"handlePrimaryEvents",value:function(){this.primaryEventsResistered||(this.addEventListener("group-selected",function(e){for(var t=Polymer.dom(this.root).querySelectorAll(this.item+".primary"),i=0,n=t.length;i<n;i++)this.toggleClass("selected",e.detail.selected,t[i])}.bind(this)),this.addEventListener("group-expanded",function(e){var t=e.detail.path.filter(function(e){var t=Polymer.dom(e);return(t.node.tagName?t.node.tagName.toLowerCase():"")===this.item&&t.classList.contains("primary")}.bind(this));if(t&&0!==t.length){this.toggleClass("initial",!1,t[0]),this.expanded=!this.expanded,this.domHost&&(this.domHost.expanded=!this.domHost.expanded);for(var i=Polymer.dom(this.root).querySelectorAll(this.item),n=0,o=i.length;n<o;n++){var r=i[n].$$("sb-field");r&&(r.renderReadOnly=!1),this.toggleClass("expanded",this.expanded,i[n])}this.fire("expanded-changed",{expanded:this.expanded})}}.bind(this)),this.primaryEventsResistered=!0)}},{key:"navigationChanged",value:function(){this.fire("group-selected",{selected:!1},{bubbles:!1})}},{key:"overridePropagateFromParentToChild",value:function(e){"function"==typeof e&&(this.propagateFromParentToChildOverride=e)}},{key:"setFromChildToParentExtension",value:function(e){"function"==typeof e&&(this.childToParentExtension=e)}},{key:"toggleItemClass",value:function(e){var t=e.path.split(".");if(1!==t.length){var i=t[1],n=!0,o=!1,r=void 0;try{for(var s,a=this.elements[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;if(l.item===i){for(var u=0,d=e.value.length;u<d;u++)l.toggleClass(e.value[u].class,e.value[u].value);return}}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}}},{key:"toggleEditable",value:function(){if(this.itemEditableMap){var e=!0,t=!1,i=void 0;try{for(var n,o=this.elements[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value,s=this.itemEditableMap[r.item];null!=s&&(r.editable=s)}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}}},{key:"_normalizeWithTemplateGroup",value:function(){if(this.template&&this.template.group&&this.template.group.length===this._group.length){for(var e=0,t=this._group.length;e<t;e++)if(this.template.group[e]!==this._group[e])return;this._group=this.template.group}}},{key:"_datePickerOpened",value:function(e){var t=e.detail.dateContainer,i=e.detail.datepicker;i.style.position="absolute";var n=i.offsetParent.getBoundingClientRect(),o=t.getBoundingClientRect();i.style.left=-n.left+o.left+"px",i.style.top=o.bottom-n.top+"px",o.left+i.offsetWidth>window.innerWidth&&(i.style.left="",i.style.right=n.right-o.right+17+"px")}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["buildGroup(model, item, group, data, primaryItems, itemClassMap, columnWidths)","handlePrimaryEvents(template, _primaryItems)","propagateFromParentToChild(data.*)","toggleItemClass(itemClassMap.*)"]}},{key:"listeners",get:function(){return{"datepicker-opened":"_datePickerOpened"}}}]),i=e)),t("Group",i),Polymer(i)}}}),System.register("common/layout/sb-html/Html.js",["common/layout/tables/ImageCellSizer.js","common/core/sb-page-container/PageContainer.js"],function(e,t){var o,r,s,a;return{setters:[function(e){o=e.DEFAULT_WIDTH,r=e.DEFAULT_HEIGHT},function(e){s=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),e&&(this.$=e.$,this.$$=Polymer.dom(e.root).querySelector.bind(Polymer.dom(e)),this.viewport=s.getViewport())}"iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QTQ0NzJFMzhEQjQwMTFFMEJENkNCN0I0QjBBMDU3MzYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RUQyN0E5N0NEQjQzMTFFMEJENkNCN0I0QjBBMDU3MzYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpBNDQ3MkUzNkRCNDAxMUUwQkQ2Q0I3QjRCMEEwNTczNiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBNDQ3MkUzN0RCNDAxMUUwQkQ2Q0I3QjRCMEEwNTczNiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PnhkEREAAACaSURBVHjaYvz//z8DCKxdu1YLSJkBMRsDYfALiE8FBwdfA3EYQYYADZgPNeAUVAEhwAZTDzQokXHNmjUJQI49iMNAIoBafpAJSNgA8REG8gBInw3IEE4g/k6mISB9nEwMVACjhowaQqwhX4CYh0z9IH1fQIbMAuJpwMzkRGLmswfpA+mHFQUhQE4dEOuSYM5lIG4F5v6VAAEGAGkRMGla548DAAAAAElFTkSuQmCC","iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAABHNCSVQICAgIfAhkiAAAAGJ6VFh0UmF3IHByb2ZpbGUgdHlwZSBBUFAxAAB4nFXIsQ2AMAwAwd5TeIR3HBwyDkIBRUKAsn9BAQ1XnuztbKOveo9r60cTVVVVz5JrrmkBZl4GbhgJKF8t/ExEDQ8rHgYgD0i2FMl6UPBzAAAA30lEQVQ4je3OMU4CYRiE4ZnPZckmdDaewYR2KxISz+AB+G28gDHEws6ohBYKCrb2GCZU25rY2tpYQcRd5BsKbbRZWUp8+3kyxHfFMBz7iikPFKMirVlaQ3nzInsGAALAfHCeNVSmFHNQZRUCMRaVUsyb/Wngy+iqdzR/7Sb9aagc/6q4O8tceIwO3986JGbbAl+HMDOiE8Xrz8TgyzqIyZcOJgZ4nf1PbGfhH9kHJCKxcLJVZ+zGFoWF0X0CYfxx2zvZBlgNQhfCmO4TAkBxH04lXINs/1mRnsxwE19mDxtbAk/8Q+6dmAAAAABJRU5ErkJggg==","iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUY4QjA4OTVEQkY3MTFFMDgzQzJCMzYyMkRFM0JDMjgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUY4QjA4OTZEQkY3MTFFMDgzQzJCMzYyMkRFM0JDMjgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpFNjFGRUE4QURCRjMxMUUwODNDMkIzNjIyREUzQkMyOCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5RjhCMDg5NERCRjcxMUUwODNDMkIzNjIyREUzQkMyOCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpLVrhgAAAEoSURBVHjanJS9aoRAFIXnjjqykCcJpE21sJBXMA+QgIWFCoKFVbrgX2EhpEiTOqAPEUi1bSBPsrCwzeQe0SK77rp64ShX5nx3frxDWmuBaNv2ll/3LCWm48DaOo7zi4QAYcBHD9j2A6ZCDeMZ9ExN0zxxskEiZkZf/EvyY836FssCvjUgK9Z+IQS+lZzrStNUH3+bBcnzXJumKcqy/AcyrwUURaENwxBQFEU0OZPjKaOyZVlCKXUCGIVkWdZVHKZcVZWGGZAwDGms6AkkSRKSUgqsva7rDmDbtvB9n84tdXQ5cRwTIKgOgOd5dGm/zp5OEAQdyHVdmtr0i0d8DWCA7Fg3C/9Y+HaAvLPeuJkeZjbfBj74h6vgkZMX1t0Mzg/rlbv/80+AAQCVIVhcOwWhjQAAAABJRU5ErkJggg==","iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAABHNCSVQICAgIfAhkiAAAAGJ6VFh0UmF3IHByb2ZpbGUgdHlwZSBBUFAxAAB4nFXIsQ2AMAwAwd5TeIR3HBwyDkIBRUKAsn9BAQ1XnuztbKOveo9r60cTVVVVz5JrrmkBZl4GbhgJKF8t/ExEDQ8rHgYgD0i2FMl6UPBzAAABCUlEQVQ4jZ3UsUrDUBgF4HN+Y2KhTyK4dioUfAYfoDeLLyDayU1sRdcOHZLZxxA6dRV8ECm0acj/O9RiSGNu0jOf8907XC7xm+zVXWrOAc8shCdWcCfntoru0i8AIABk0zg12oDGFWg7HwJjeOhHk8Tx++12HOX5KJokzjuuJJvGqRo+AtFiaMSyK7C/EJZCDIOgsJ5AN6cgYrpRsCeAdhpuZ7EdYacAVag1Uh5ePCT0ItWTmoBapHplH1CLlIttgFqkbtAE/IuUhz6gEWkLAEBAYq1kv025GhX2aVgLVRcwzLfP4+suQP7iRjDMqbrYfwUzd2OGR5BXh5KBII5e+F/MPkXwFN6n7z9GMnsCPVgwRwAAAABJRU5ErkJggg==",e("Html",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"sanitizeAndSetInnerHTML",value:function(){if(this.isNil()){var e=!this.link&&!this.isMobile();this.$.me.innerHTML=e?'<img id="blank" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" style="width:50%; height:17px"/>':""}else{if(null!=this.booleanValue){var t=this.booleanValue?"iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6OUY4QjA4OTVEQkY3MTFFMDgzQzJCMzYyMkRFM0JDMjgiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6OUY4QjA4OTZEQkY3MTFFMDgzQzJCMzYyMkRFM0JDMjgiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpFNjFGRUE4QURCRjMxMUUwODNDMkIzNjIyREUzQkMyOCIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo5RjhCMDg5NERCRjcxMUUwODNDMkIzNjIyREUzQkMyOCIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PpLVrhgAAAEoSURBVHjanJS9aoRAFIXnjjqykCcJpE21sJBXMA+QgIWFCoKFVbrgX2EhpEiTOqAPEUi1bSBPsrCwzeQe0SK77rp64ShX5nx3frxDWmuBaNv2ll/3LCWm48DaOo7zi4QAYcBHD9j2A6ZCDeMZ9ExN0zxxskEiZkZf/EvyY836FssCvjUgK9Z+IQS+lZzrStNUH3+bBcnzXJumKcqy/AcyrwUURaENwxBQFEU0OZPjKaOyZVlCKXUCGIVkWdZVHKZcVZWGGZAwDGms6AkkSRKSUgqsva7rDmDbtvB9n84tdXQ5cRwTIKgOgOd5dGm/zp5OEAQdyHVdmtr0i0d8DWCA7Fg3C/9Y+HaAvLPeuJkeZjbfBj74h6vgkZMX1t0Mzg/rlbv/80+AAQCVIVhcOwWhjQAAAABJRU5ErkJggg==":"iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBNYWNpbnRvc2giIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QTQ0NzJFMzhEQjQwMTFFMEJENkNCN0I0QjBBMDU3MzYiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6RUQyN0E5N0NEQjQzMTFFMEJENkNCN0I0QjBBMDU3MzYiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpBNDQ3MkUzNkRCNDAxMUUwQkQ2Q0I3QjRCMEEwNTczNiIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBNDQ3MkUzN0RCNDAxMUUwQkQ2Q0I3QjRCMEEwNTczNiIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/PnhkEREAAACaSURBVHjaYvz//z8DCKxdu1YLSJkBMRsDYfALiE8FBwdfA3EYQYYADZgPNeAUVAEhwAZTDzQokXHNmjUJQI49iMNAIoBafpAJSNgA8REG8gBInw3IEE4g/k6mISB9nEwMVACjhowaQqwhX4CYh0z9IH1fQIbMAuJpwMzkRGLmswfpA+mHFQUhQE4dEOuSYM5lIG4F5v6VAAEGAGkRMGla548DAAAAAElFTkSuQmCC";return this.isDirty&&(t=this.booleanValue?"iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAABHNCSVQICAgIfAhkiAAAAGJ6VFh0UmF3IHByb2ZpbGUgdHlwZSBBUFAxAAB4nFXIsQ2AMAwAwd5TeIR3HBwyDkIBRUKAsn9BAQ1XnuztbKOveo9r60cTVVVVz5JrrmkBZl4GbhgJKF8t/ExEDQ8rHgYgD0i2FMl6UPBzAAABCUlEQVQ4jZ3UsUrDUBgF4HN+Y2KhTyK4dioUfAYfoDeLLyDayU1sRdcOHZLZxxA6dRV8ECm0acj/O9RiSGNu0jOf8907XC7xm+zVXWrOAc8shCdWcCfntoru0i8AIABk0zg12oDGFWg7HwJjeOhHk8Tx++12HOX5KJokzjuuJJvGqRo+AtFiaMSyK7C/EJZCDIOgsJ5AN6cgYrpRsCeAdhpuZ7EdYacAVag1Uh5ePCT0ItWTmoBapHplH1CLlIttgFqkbtAE/IuUhz6gEWkLAEBAYq1kv025GhX2aVgLVRcwzLfP4+suQP7iRjDMqbrYfwUzd2OGR5BXh5KBII5e+F/MPkXwFN6n7z9GMnsCPVgwRwAAAABJRU5ErkJggg==":"iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAABHNCSVQICAgIfAhkiAAAAGJ6VFh0UmF3IHByb2ZpbGUgdHlwZSBBUFAxAAB4nFXIsQ2AMAwAwd5TeIR3HBwyDkIBRUKAsn9BAQ1XnuztbKOveo9r60cTVVVVz5JrrmkBZl4GbhgJKF8t/ExEDQ8rHgYgD0i2FMl6UPBzAAAA30lEQVQ4je3OMU4CYRiE4ZnPZckmdDaewYR2KxISz+AB+G28gDHEws6ohBYKCrb2GCZU25rY2tpYQcRd5BsKbbRZWUp8+3kyxHfFMBz7iikPFKMirVlaQ3nzInsGAALAfHCeNVSmFHNQZRUCMRaVUsyb/Wngy+iqdzR/7Sb9aagc/6q4O8tceIwO3986JGbbAl+HMDOiE8Xrz8TgyzqIyZcOJgZ4nf1PbGfhH9kHJCKxcLJVZ+zGFoWF0X0CYfxx2zvZBlgNQhfCmO4TAkBxH04lXINs/1mRnsxwE19mDxtbAk/8Q+6dmAAAAABJRU5ErkJggg=="),void(this.$.me.innerHTML='<img id="checkbox" src="data:image/png;base64,'+t+'"/>')}"string"!==this.type&&"textarea"!==this.type||!i.containsMarkup(this.value)?(this.$.formatted.style.padding="2px 0",this.$.me.textContent=(this.value+"").trim()):(this.$.formatted.style.padding="2px 0",this.$.me.innerHTML=i.sanitizeHtmlText((this.value+"").trim())),this.handleDefaultSizeIfImage()}}},{key:"handleDefaultSizeIfImage",value:function(){var e=this.$$("#me img:not([style*=width])");(e=e&&this.$$("#me img:not([width])"))&&Polymer.dom(e).setAttribute("width",o);var t=this.$$("#me img:not([style*=height])");(t=t&&this.$$("#me img:not([height])"))&&Polymer.dom(t).setAttribute("height",r)}},{key:"isNil",value:function(){return(null==this.value||""===(this.value+"").trim())&&null==this.booleanValue}},{key:"isMobile",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"clearTabIndex",value:function(){this._tabindex=this.tabindex,this.tabindex=void 0}},{key:"restoreTabIndex",value:function(){this.tabindex=this._tabindex}}],[{key:"containsMarkup",value:function(e){return/(<[a-z][\s\S]*>)|(&[^\s]*;)/.test(e)}},{key:"sanitizeHtmlText",value:function(e){return e?sanitizeHtml(e,{allowedTags:sanitizeHtml.defaults.allowedTags.concat(["div","img","span","sub","sup"]),allowedAttributes:{div:["style","class"],img:["src","height","width","alt","border","align","style"],a:["href","name","target","title"],span:["style"]},parser:{decodeEntities:!1}}):e}}]),a=i)),e("Html",a)}}}),System.register("common/layout/sb-lookup-layout/LookupLayout.js",["common/layout/fields/FieldSetHandler.js","common/layout/tables/ImageCellSizer.js","common/layout/tables/TableClassBuilder.js","common/layout/data/RecordGrouper.js","common/core/sb-page-container/PageContainer.js","common/core/AppContext.js"],function(t,e){var i,p,o,h,r,s,a;return{setters:[function(e){i=e.FieldSetHandler},function(e){p=e.ImageCellSizer},function(e){o=e.TableClassBuilder},function(e){h=e.RecordGrouper},function(e){r=e.PageContainer},function(e){s=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}100,t("LookupLayout",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-lookup-layout",this.properties={selectedRows:{type:Object,value:{},notify:!0},searchModel:Object,totalCount:{type:String,notify:!0},hasTotalCount:{notify:!0},maxSelectAll:Number,selectionIdDataPath:String,parentAttributesPath:String,additionalFields:Array,fieldPrefix:{type:String,value:""},groupByField:String,groupByFieldType:String,viewport:{type:Object,value:function(){return r.getViewport()}},i18n:{type:Object,value:function(){return s.properties.i18n.value()}},primaryMobileCols:Array,_primaryMobileColumns:{type:Array,computed:"_getPrimaryMobileCols(primaryMobileCols, fieldSet)"},rowsByGrouper:Object,groups:Array,viewResultsIndexById:Object,viewResultsIds:Object,headerSelectionDisabled:{type:Boolean,computed:"_isDisableHeaderSelection(viewResults)"},headerSelectionTooltip:{type:String,computed:"_getHeaderSelectionTooltip(headerSelectionDisabled)"},mobileRowDetails:{type:Object,value:{}},keyPressed:{Type:Object,value:{}},lastClickedIndex:{Type:Number}}}},{key:"ready",value:function(){this._setupKeyPressListeners(),this.handleAllRowsSelected(),this.handleOneRowSelected(),this.handleMetaDataResponse(),this.hiddenByGroup={},this.addEventListener("sb-mobile-row-expanded",this.expandMobileRow.bind(this)),this.addEventListener("sb-mobile-row-selected",this.selectMobileRow.bind(this)),this.addEventListener("sb-row-group-tapped",this.expandRow.bind(this)),this.scrollTarget=this.$.tbody}},{key:"_setupKeyPressListeners",value:function(){window.addEventListener("keydown",function(e){this.keyPressed[e.keyCode]=!0}.bind(this)),window.addEventListener("keyup",function(e){delete this.keyPressed[e.keyCode]}.bind(this))}},{key:"handleMetaDataResponse",value:function(){this.$.md.addEventListener("md-changed",function(e){this.initRecordKeysFieldLabelsAndTypeMap(e.detail.value.fields)}.bind(this))}},{key:"initFieldMetadata",value:function(){this.deSelectAll(),this.fieldMetadataInitialized||(this.$.md.object=this.searchModel.targetObjectName,this.fieldSetHandler=new i(this.searchModel,"resultFieldNames","resultFieldNamesTablet","resultFieldNamesPhone"),this.setFieldMetadata(),this.fieldMetadataInitialized=!0)}},{key:"setFieldMetadata",value:function(){if(this.fieldSet=this.fieldSetHandler.getByViewport(this.viewport),this.$.md.name===this.fieldSet.name)return!1;this.$.md.fields=void 0,this.$.md.name=this.fieldSet.name;var e=this.fieldSet.fields;Array.isArray(this.additionalFields)&&(e=this.fieldSet.fields.concat(this.additionalFields)),this.groupByField&&-1===e.indexOf(this.groupByField)&&(e=[this.groupByField].concat(e)),this.$.md.fields=e}},{key:"initRecordKeysFieldLabelsAndTypeMap",value:function(e){var r=[],s=[],a={},l={},u={},d={},c={},h={};e.forEach(function(e){if(this.groupByField!==e.name||(this.groupByFieldType=e.type,-1!==this.fieldSet.fields.indexOf(e.name))){var t="UnitPrice"===e.name?e.name:this.fieldPrefix+e.name;r.push(t),s.push(e.label),a[t]=e.label,l[t]={type:e.type},"currency"===e.type.toLowerCase()&&(l[t].CurrencyIsoCode=this.currencyIsoCode);var i=e.type;if(!this.isMobileViewport()){var n=new p(e).getImageWidth(20);if(n){var o={width:n,properties:["width"]};c[t]=o,h[e.label.replace(/\W/g,"")]=o}}u[e.label.replace(/\W/g,"")]=i,d[t]=i}}.bind(this)),void 0===this.groupByFieldType&&(this.groupByFieldType=null),this.headerClassMap=new o(Object.keys(u),"Th",u).build(),this.rowClassMap=new o(r,"Td",d).build(),this.columnWidths=c,this.labelWidths=h,this.typeMap=l,this.recordKeys=r,this.fieldLabels=s,this.fieldLabelMap=a}},{key:"handleAllRowsSelected",value:function(){this.addEventListener("header-selection-changed",function(e){this.selectAllClicked=!0;var t=e.detail.selected;this.toggleRowSelections(t),this.selectAllClicked=!1}.bind(this))}},{key:"toggleRowSelections",value:function(e,t,i){var n=[],o=Polymer.dom(this.$.tbody).querySelectorAll("sb-table-row");if(o&&0<o.length){var r=!0,s=!1,a=void 0;try{for(var l,u=o[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var d=l.value,c=d.get("rowData."+this.selectionIdDataPath);n.push(c),i&&(d.index<i.start||d.index>i.end)||null!=t&&(d.grouper||d.groupie&&d.groupie!==t)||this._isValidViewResultId(c)&&(d.selected=e)}}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}}var h=null!=t?this.rowsByGrouper[t]:this.viewResults;if(null!=h)for(var p=(i=i||{start:0,end:h.length-1}).start;p<=i.end;p++){var f=h[p],g=this.get("record."+this.selectionIdDataPath,f);if(-1===n.indexOf(g)){var y=void 0===this.parentAttributesPath?void 0:this.get("record."+this.parentAttributesPath,f);this.selectOneRow(e,g,f.record,y,f.grouper)}}}},{key:"handleOneRowSelected",value:function(){this.addEventListener("selection-changed",function(e){document.getSelection().removeAllRanges(),this.selectAllClicked||this.handleRangeSelection(e);var t=e.detail.selected,i=e.detail.Id,n=e.detail.group,o=e.detail.autoSelectGroupRows;this.selectOneRow(t,i,e.detail.rowData,e.detail.attributes,n),null!=n&&o&&this.toggleRowSelections(t,n)}.bind(this))}},{key:"handleRangeSelection",value:function(e){if(this.keyPressed[16]&&null!=this.lastClickedIndex&&!this.internal&&!this.groupByFieldType){this.internal=!0;var t=Math.min(this.lastClickedIndex,e.detail.index),i=Math.max(this.lastClickedIndex,e.detail.index);this.toggleRowSelections(e.detail.selected,null,{start:t,end:i}),this.internal=!1}Polymer.dom(e).rootTarget._selectedChangeByParent||(this.lastClickedIndex=e.detail.index)}},{key:"selectOneRow",value:function(e,t,i,n,o){e&&(null===this.selectedRows&&(this.selectedRows={}),this.selectedRows[t]={record:{Id:t,attributes:n,UnitPrice:i.UnitPrice},index:this.viewResultsIndexById[t],invalid:null!=o}),!e&&this.selectedRows&&delete this.selectedRows[t]}},{key:"deSelectAll",value:function(){this.$.header.selected=void 0,this.$.header.selected=!1}},{key:"setViewResults",value:function(){this.selectedRows={},this.viewResultsIds=null,this.viewResultsIndexById=null;var e=this.getViewResults(this.searchModel.results);if(this.hasGroupedField=!!this.groupByField,this.isMobileViewport()&&this._resetMobileDetails(),this.hasGroupedField){if(this.viewResults&&(e=JSON.parse(JSON.stringify(this.getViewResults(this.searchModel.results)))),this.isMobileViewport())return this.expandAll(e),this.viewResults=e,void this.setGroupExpandedHandler(!1);var t=[this.fieldSet.fields[0],"Id"],i="record."+this.searchModel.targetObjectName,n={path:"record._transient_."+this.searchModel.targetObjectName+"."+t[0],property:"suffix"},o={path:"record._transient_."+this.searchModel.targetObjectName+"."+t[0]+".md",property:"type"};e=new h(this.groupByField,t,i,{hidden:!0},this.hiddenByGroup,{hidden:!1},n,this.groupByFieldType,o).group(e),this.rowsByGrouper={},this.groups=[],this.viewResultsIds=[];var r=0,s=!0,a=!(this.viewResultsIndexById={}),l=void 0;try{for(var u,d=e[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var c=u.value;this._indexViewResult(c,r++),c.grouper?(this.rowsByGrouper[c.grouper]=[],this.groups.push(c)):this.rowsByGrouper[c.groupie]&&this.rowsByGrouper[c.groupie].push(c)}}catch(e){a=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(a)throw l}}this.viewResults=e,this.setGroupExpandedHandler(!0),this.viewResults.length===this.searchModel.results.length+1?(this.expandAll(this.viewResults),Polymer.RenderStatus.afterNextRender(this,function(){var e=this.$$("sb-table-row");e.grouperExpanded=!0,this.hiddenByGroup[e.grouper]={hidden:!1},this.expandRow({path:[e],detail:{expanded:!0,group:e.grouper}})})):Polymer.RenderStatus.afterNextRender(this,function(){var e=Polymer.dom(this.$.tbody).querySelectorAll("sb-table-row.expanded"),t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0)o.value.setGrouperClasses(!1)}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}})}else this.viewResults=e}},{key:"getViewResults",value:function(e){var t=this.org.prefix?this.org.prefix+"__":"",i=[],n=!0,o=!1,r=void 0;try{for(var s,a=(e||[])[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u={record:{}};for(var d in l.record)"UnitPrice"===d&&l.record.Product2&&l.record.Product2[t+"HidePriceInSearchResults__c"]||(u.record[d]=l.record[d]);i.push(u)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}},{key:"setDisplayResults",value:function(){this.isMobileViewport()||!this.groupByField?this._viewResults=this.viewResults:this._viewResults=this.groups}},{key:"expandAll",value:function(e){for(var t=0,i=e.length;t<i;t++)e[t].hidden=!1}},{key:"isSelected",value:function(e){if(!this.selectedRows)return!1;var t=this.get(this.selectionIdDataPath,e);return!!this.selectedRows[t]}},{key:"isExpanded",value:function(e){return!(!this.hiddenByGroup[e]||!1!==this.hiddenByGroup[e].hidden)}},{key:"setGroupExpandedHandler",value:function(e){this.groupExpandedHandler=this.groupExpandedHandler||function(e){this.expandGroupedViewResults(e.detail.group,e.detail.expanded)}.bind(this),this.removeEventListener("sb-row-group-tapped",this.groupExpandedHandler),e&&this.addEventListener("sb-row-group-tapped",this.groupExpandedHandler)}},{key:"expandGroupedViewResults",value:function(e,t){for(var i=0,n=this.viewResults.length;i<n;i++)e===this.viewResults[i].groupie&&this.set("viewResults."+i+".hidden",!t);this.hiddenByGroup[e]={hidden:!t}}},{key:"isMobileViewport",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"updateTotalCount",value:function(){null!==this.searchModel.totalCount&&(this.totalCount=this.searchModel.totalCount),this.hasTotalCount=0<this.totalCount}},{key:"_getPrimaryMobileCols",value:function(){var e=[].concat(this.primaryMobileCols);if(e&&0<e.length&&this.fieldSet.name.endsWith("Phone")){var t=e[0].split("."),i=1<t.length?t[0]+".":"";e[0]=i+this.fieldSet.fields[0]}return e}},{key:"expandMobileRow",value:function(e){var t=this.$$("#list");this._setMobileExpandDetails(t,e.detail),t.notifyResize()}},{key:"selectMobileRow",value:function(e){var t=this.$$("#list");this._setMobileSelectedDetails(t,e.detail)}},{key:"_setMobileExpandDetails",value:function(e,t){var i=t.index,n=t.id,o=t.expanded,r=t.path;this._setMobileDetails(e,i,n,"expanded",o,r)}},{key:"_setMobileSelectedDetails",value:function(e,t){var i=t.index,n=t.id,o=t.selected;this._setMobileDetails(e,i,n,"selected",o)}},{key:"_setMobileDetails",value:function(e,t,i,n,o,r){var s=e._computeVidx(t)%e._physicalCount;this.mobileRowDetails[s]||(this.mobileRowDetails[s]={});var a=this.mobileRowDetails[s];r&&(a.path=r),a.ids||(a.ids={}),a.ids[i]||(a.ids[i]={}),a.ids[i][n]=o}},{key:"expandRow",value:function(e){var t=this.$$("#list");if(t&&void 0!==e.detail.expanded){var i=null,n=(e.path||Polymer.dom(e).path)[0].index+1;if(e.detail.expanded){var o=[n,0].concat(this.rowsByGrouper[e.detail.group]);this._viewResults.splice.apply(this._viewResults,o),this._notifySplice(this._viewResults,"_viewResults",n,o.length-1,[])}else t._scrollPosition=Math.ceil(t._scrollPosition),i=t.firstVisibleIndex,this.splice("_viewResults",n,this.rowsByGrouper[e.detail.group].length);Polymer.RenderStatus.afterNextRender(this,this._adjustScrollAfterExpandRow.bind(this,t,i))}}},{key:"_adjustScrollAfterExpandRow",value:function(e,t){null!=t?e.scrollToIndex(t):e._updateScrollerSize(!0)}},{key:"indexViewResults",value:function(){if(null==this.viewResultsIds){this.viewResultsIds=[];var e=0,t=!0,i=!(this.viewResultsIndexById={}),n=void 0;try{for(var o,r=this.viewResults[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this._indexViewResult(s,e++)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}}},{key:"_indexViewResult",value:function(e,t){var i=this.get("record."+this.selectionIdDataPath,e);this.viewResultsIds.push(i),this.viewResultsIndexById[i]=t}},{key:"_isValidViewResultId",value:function(e){return-1!==this.viewResultsIds.indexOf(e)}},{key:"_getMaxResultsToSelectAll",value:function(){return this.maxSelectAll||100}},{key:"_isDisableHeaderSelection",value:function(){return this.viewResults.length>this._getMaxResultsToSelectAll()}},{key:"_getHeaderSelectionTooltip",value:function(){if(this.headerSelectionDisabled)return this.i18n.l("Reduce search results to fewer than {0} to enable select all",[this._getMaxResultsToSelectAll()])}},{key:"_getExpandedDetails",value:function(e,t){return this._getMobileDetails(e,t,"expanded",!0)}},{key:"_getSelectedDetails",value:function(e,t){return this._getMobileDetails(e,t,"selected")}},{key:"_getMobileDetails",value:function(e,t,i,n){if(!this.isMobileViewport())return null;var o=this.$$("#list"),r=o._computeVidx(t)%o._physicalCount,s=this.mobileRowDetails[r]||null;if(!s)return null;var a=this.get(this.selectionIdDataPath,e),l=!(!s.ids[a]||!s.ids[a][i]),u={};return u[i]=l,n&&(u.path=s.path),u}},{key:"_resetMobileDetails",value:function(){for(var e in this.mobileRowDetails){var t=this.mobileRowDetails[e];for(var i in t.ids)t.ids[i]={}}}},{key:"_scrollHandler",value:function(){this.isMobileViewport()&&(this.expandDisabled=!0,this._enabledExpand&&clearTimeout(this._enabledExpand),this._enabledExpand=setTimeout(function(){this.expandDisabled=!1}.bind(this),200))}},{key:"test_scrollToTarget",value:function(e){if(e){var t=e.index;null==t&&(t=this._findRowIndex(e)),t<0||this.$$("#list").scrollToIndex(t)}}},{key:"_findRowIndex",value:function(e){if(!e)return-1;var t=Object.keys(e),i=t.length;if(0===i)return-1;for(var n=0,o=this.viewResults.length;n<o;n++){for(var r=this.viewResults[n].record,s=!0,a=0;a<i;a++)s=s&&r[t[a]]===e[t[a]];if(s)return n}return-1}},{key:"behaviors",get:function(){return[sb.common.core.AppContext,window.CommonBehaviors.DeviceBehavior,Polymer.IronScrollTargetBehavior]}},{key:"observers",get:function(){return["setViewResults(searchModel, fieldSet, groupByFieldType)","initFieldMetadata(searchModel)","updateTotalCount(searchModel.totalCount)","setDisplayResults(viewResults)","indexViewResults(viewResults)"]}}]),a=e)),t("LookupLayout",a),Polymer(a)}}}),System.register("common/layout/sb-popup/Popup.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Popup",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-popup",this.properties={url:String,messenger:Object,channel:{type:String,value:"sbQQ"},responseMessage:{type:Object,notify:!0},closePopup:{type:String,value:"sb-close-popup"},autoLaunched:{type:Boolean,value:!1},backOnCancelOrClose:{type:Boolean,value:!1,observer:"_appendLargeClass"}}}},{key:"ready",value:function(){this.addEventListener("sb-close-dialog",this.close.bind(this))}},{key:"open",value:function(){this._initRpc(),this._sendMessage(),this._handleAutoLaunch(),this.$.dialog.toggle()}},{key:"close",value:function(){this._close(this._getRedirectDetails(!1))}},{key:"_close",value:function(e){this.rpc&&this.rpc.destroy(),this.$.dialog.toggle();var t=this.$.dialog.$$("#content").querySelector("#easyXDM_"+this.channel+"_provider"),i={redirect:e};t&&t.remove(),this.responseMessage&&(i.featureOptionIds=this.responseMessage.featureOptionIds,i.dynamicOptions=this.responseMessage.dynamicOptions),this.fire("iron-signal",{name:"sb-navigation-changed"}),this.fire(this.closePopup,i)}},{key:"_initRpc",value:function(){this.url&&(this.rpc=new easyXDM.Rpc({remote:this.url,container:this.$.dialog.$$("#content"),channel:this.channel},{remote:{postMessage:{}},local:{postMessage:this._receiveMessage.bind(this)}}))}},{key:"_sendMessage",value:function(){var e={};this.messenger&&"function"==typeof this.messenger.getRequest&&(e=this.messenger.getRequest()),e.redirect=this._getRedirectDetails(this.autoLaunched),this.rpc.postMessage(JSON.stringify(e))}},{key:"_handleAutoLaunch",value:function(){this.autoLaunched&&this.fire("iron-signal",{name:"sb-auto-launch-popup"})}},{key:"_receiveMessage",value:function(i){this.debounce("_receiveMessage",function(){if(this.messenger&&"function"==typeof this.messenger.getResponse){var e=JSON.parse(i);this._logReceivedMessage(e),this.responseMessage=this.messenger.getResponse(e);var t=e.redirect?e.redirect:this._getRedirectDetails(this.autoLaunched);void 0===t.back&&(t.back=!t.save&&this.backOnCancelOrClose),this._close(t)}else this.close()}.bind(this),100)}},{key:"_logReceivedMessage",value:function(e){console.log("RPC Received Message:"),console.log(e)}},{key:"_getRedirectDetails",value:function(e){return{auto:!!e,save:!!e,back:this.backOnCancelOrClose}}},{key:"_appendLargeClass",value:function(){this.toggleClass("largeView",this.backOnCancelOrClose,Polymer.dom(this.$$("sb-dialog").root).querySelector(".sbDialog"))}}]),i=e)),t("Popup",i),Polymer(i)}}}),System.register("common/layout/sb-row-drawer/RowDrawer.js",["common/signal/RowFocusSignaler.js","common/core/AppContext.js"],function(t,e){var i,o;return{setters:[function(e){i=e.RowFocusSignaler},function(e){e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("RowDrawer",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-row-drawer",this.properties={item:String,fieldNames:Array,richTextFields:Array,model:{type:Object,notify:!0},highlightOnFocus:{type:Boolean,value:!1,observer:"_highlightOnFocus"}}}},{key:"generateColumns",value:function(){for(var e=[],t=[],i=[],n=this.fieldNames.length,o=this.fieldNames.slice(0),r=0;r<n;r++)-1===this.richTextFields.indexOf(o[r])&&(r%3==0?e.push(o[r]):r%3==1?t.push(o[r]):i.push(o[r]));this.columnWidth="drawer";var s=[this.richTextFields,e,t,i];this.setColumns(s)}},{key:"setColumns",value:function(e){for(var t=[this.$.rteColumn,this.$.firstColumn,this.$.secondColumn,this.$.thirdColumn],i=0;i<t.length;i++)0<e[i].length&&(t[i].destroyGroup(),t[i].model=this.model,t[i].itemClass="drawerCell",t[i].group=e[i])}},{key:"_highlightOnFocus",value:function(){this.signaler=new i(this,["rteColumn","firstColumn","secondColumn","thirdColumn"],this.item),this.signaler.signalOnFocus("sb-row-focus-signal",!this.highlightOnFocus)}},{key:"observers",get:function(){return["generateColumns(fieldNames, model, richTextFields)"]}}]),o=e)),t("RowDrawer",o),Polymer(o)}}}),System.register("common/layout/sb-side-panel/SidePanel.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SidePanel",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-side-panel",this.properties={renderHeader:{type:Boolean,value:!0},icon:String,arrows:String,sideText:String,rightSideButton:Boolean}}},{key:"closeDrawer",value:function(){this.fire("x-clicked")}},{key:"keyCheck",value:function(e){13==e.keyCode&&this.fire("enter-keypress")}},{key:"toggleDrawer",value:function(){this.fire("side-toggle-clicked")}},{key:"setIcon",value:function(){"open"===this.isOpen?this.icon="sf-icon-left":(this.icon="sf-icon-right",this.arrows="closedArrows")}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["setIcon(isOpen)"]}}]),i=e)),t("SidePanel",i),Polymer(i)}}}),System.register("common/layout/sb-swipe-container/SwipeContainer.js",["common/core/sb-page-container/PageContainer.js","../../core/AppContext.js"],function(t,e){var i,o;return{setters:[function(e){i=e.PageContainer},function(e){e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SwipeContainer",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-swipe-container",this.listeners={"expanded-changed":"onGroupExpanded"},this.properties={disableSwipe:{type:Boolean,value:!1},preventSwipe:{type:Boolean,value:!1},isRequiredRowNotSelected:{type:Boolean,value:!1},groupExpanded:{type:Boolean,value:!1,observer:"_expansionChanged"},swipeHeader:Object,swipeMenu:Object,swipeItems:{type:Array,value:[]},swipeItemWidth:{type:Number,value:58},viewport:{type:Object,value:function(){return i.getViewport()}},variant:String}}},{key:"_preventSwipe",value:function(){this.preventSwipe=this.isRequiredRowNotSelected||this.groupExpanded}},{key:"onGroupExpanded",value:function(e){this.groupExpanded=e.detail.expanded,this._preventSwipe()}},{key:"attached",value:function(){if(!this.viewport||!this.viewport.isMobile()||this.disableSwipe)return this.style.minWidth="100%",void(this.style.position="static");Polymer.dom(this.$.content).observeNodes(function(e){for(var t=0;t<e.addedNodes.length;t++)this._findSwipeHeaderAndMenu(e.addedNodes[t])}.bind(this))}},{key:"_expansionChanged",value:function(e){"ui3qle"===this.variant&&this._preventSwipe()}},{key:"_findSwipeHeaderAndMenu",value:function(e){e.nodeType!==Node.TEXT_NODE&&e.nodeType!==Node.COMMENT_NODE&&("swipe-header"!==e.id||this._initSwipeHeader(e))}},{key:"_initSwipeHeader",value:function(e){var t=(this.swipeHeader=e).style;if(this.viewport&&!this.viewport.isMobile())return t.maxWidth="100%",void(t.display="table");"ui3qle"!==this.variant&&(t.maxWidth="50%",t.position="relative"),this.listen(e,"track","_onTrack"),this.setScrollDirection("y",e)}},{key:"_closeMenuWhenTapped",value:function(e,t){e.addEventListener("tap",function(){t._animate(100,1,t.swipeHeader)})}},{key:"_initSwipeMenu",value:function(e){if(e.style.maxWidth="50%",this._closeMenuWhenTapped(e,this),this.swipeItems&&this.swipeItems.length)for(var t=0;t<this.swipeItems.length;t++){var i=this.swipeItems[t];i.style.position="",i.style.width="0px"}var n=[],o=[];(this.swipeMenu=e).children[0].shadowRoot?(Polymer.dom(e.children[0].shadowRoot).flush(),"SB-ACTIONS"===e.children[0].nodeName?(Polymer.dom(e.children[0].shadowRoot).flush(),n=e.children[0].shadowRoot.children):"SB-CUSTOM-ACTION"===e.children[0].nodeName&&(n=e.children)):"SB-ACTIONS"===e.children[0].nodeName||"SF-LINE-ACTIONS"===e.children[0].nodeName?(Polymer.dom(e.children[0]).flush(),n=e.children[0].children):"SB-CUSTOM-ACTION"===e.children[1].nodeName&&(Polymer.dom(e.children[1]).flush(),n=e.children);for(var r=0,s=n.length;r<s;r++){var a=n[r];this._isValidSwipeMenuItem(a)&&o.push(a)}this.swipeItems=o;var l=this.swipeItemWidth*this.swipeItems.length;e.style.width=l+"px";for(var u=0,d=this.swipeItems.length;u<d;u++){var c=this.swipeItems[u];this.toggleClass("swipe-menu-item",!0,c);var h=(200-20*(d-1))*d;this.style.transition="transform "+h+"ms ease-out",this._setSwipeItemStyles(c.style,h,l)}}},{key:"_setSwipeItemStyles",value:function(e,t,i){e.transition="transform "+t+"ms ease-out",e.webkitBackfaceVisibility="hidden",e.borderRadius=0,e.position="absolute",e.left=0,e.height="100%",e.width="57px"}},{key:"_onTrack",value:function(e){if(!this.swipeMenu){var t=this.querySelector("#swipe-menu");t&&this._initSwipeMenu(t)}if(!this.preventSwipe&&this.swipeItems.length){var i=e.currentTarget,n=e.detail;"track"===n.state&&this._trackMove(n,i)}}},{key:"_trackMove",value:function(e,t){this._animate(e.dx,e.dy,t)}},{key:"_animate",value:function(e,t,i){var n=0<e?1:-1;if(-1==n&&Math.abs(t)<20&&e<-60){this.fire("row-swiped",{isOpen:!0});var o=parseFloat(getComputedStyle(this.swipeItems[0]).width),r=o.toPrecision(5)*this.swipeItems.length*n;this.style.transform="translate3d("+r+"px, 0, 0)",this.style.webkitBackfaceVisibility="hidden";for(var s=this.swipeItems.length-1;0<=s;s--){var a=s*o.toPrecision(5);this.swipeItems[s].style.width=o.toPrecision(5)+"px",this.swipeItems[s].style.transform="translate3d("+a+"px, 0, 0)"}}else if(1==n&&Math.abs(t)<20&&25<e)for(this.fire("row-swiped",{isOpen:!1}),this.style.transform="translate3d(0%, 0, 0)",this.style.webkitBackfaceVisibility="hidden",s=0;s<this.swipeItems.length;s++)this.swipeItems[s].style.transform="translate3d(0%, 0, 0)"}},{key:"_isValidSwipeMenuItem",value:function(e){if("ui3qle"===this.variant)return"button"===e.nodeName.toLowerCase();if(("span"===e.nodeName.toLowerCase()||e.$$&&e.$$("span"))&&!e.classList.contains("ignore-in-mobile")){if(e.$$&&e.$$("span")){var t=e.$$("span");if(("removeFromFavBtn"===t.id||"addToFavBtn"===t.id)&&"none"===t.style.display)return!1}if(!e.classList.contains("visibilityHidden"))return!0;e.style.display="none"}return!1}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_preventSwipe(isRequiredRowNotSelected)"]}}]),o=e)),t("SwipeContainer",o),Polymer(o)}}}),System.register("common/layout/sb-table-cell/TableCell.js",["common/relationship/RelationshipFieldManager.js","common/layout/fields/FieldHider.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.RelationshipFieldManager},function(e){o=e.FieldHider}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("TableCell",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-table-cell",this.properties={item:String,disabled:Boolean,hide:Object,value:{notify:!0},data:{type:Object,value:null},model:{type:Object,value:null}}}},{key:"buildCell",value:function(){this.setDisabled(),this.setHidden(),this.setRecordId(),this.setSuffix(),this.model&&this.model[this.item]&&this.model[this.item].type?this.setFieldMetadataFromModel():this.md=this.md||{type:"string"}}},{key:"setDisabled",value:function(){this.disabled=!(!this.data||!this.data.disabled)}},{key:"setHidden",value:function(){var e=!!this.data&&this.data.hidden;this.hide=new o(e).hide}},{key:"setRecordId",value:function(){this.recordId=this.data?this.data.Id:null}},{key:"setSuffix",value:function(){this.data&&this.data._transient_&&null!=this.get(["data","_transient_",this.item,"suffix"])?this.suffix=this.get(["data","_transient_",this.item,"suffix"]):this.suffix=void 0}},{key:"overrideWidth",value:function(){this.data&&this.data.fullWidthItem&&this.classList.contains(this.data.fullWidthItem)?this.style.width="100%":"100%"==this.style.width&&(this.style.width=null)}},{key:"setFieldMetadataFromModel",value:function(){var e=this.model[this.item];this.data&&this.data._transient_&&null!=this.get(["data","_transient_",this.item,"md"])&&(e=this.get(["data","_transient_",this.item,"md"])),this.$.field.link=!!e.link,this.$.field.readOnly=!0,this.md=e}},{key:"dataChanged",value:function(){var e=new i(this.item,this.data);e.hasRelationship()&&(this.display=e.getRelationshipName())}},{key:"observers",get:function(){return["buildCell(item, value, model, data)","setDisabled(data.disabled)","setRecordId(data.Id)","overrideWidth(data.fullWidthItem)","dataChanged(data, item)"]}}]),r=e)),t("TableCell",r),Polymer(r)}}}),System.register("common/layout/sb-table-cell-select/TableCellSelect.js",["common/layout/fields/FieldHider.js"],function(t,e){var i,o;return{setters:[function(e){i=e.FieldHider}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("TableCellSelect",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-table-cell-select",this.properties={item:String,isRadio:{type:Boolean,computed:"_isRadio(item)"},value:{notify:!0},data:{type:Object,observer:"init"}}}},{key:"init",value:function(){if(this._attached)return this._setDisabled(),void this._setHidden();Polymer.dom(this.$.s).observeNodes(function(){this._setDisabled(),this._setHidden(),this._attached=!0}.bind(this))}},{key:"_isRadio",value:function(){return"radio"===this.item}},{key:"_setDisabled",value:function(){this.disabled=!(!this.data||!this.data.disabled)}},{key:"_setHidden",value:function(){var e=!!this.data&&this.data.hidden;new i(e,Polymer.Base).applyTo(this.$$("#"+this.item))}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),o=e)),t("TableCellSelect",o),Polymer(o)}}}),System.register("common/layout/sb-table-header/TableHeader.js",["common/core/sb-page-container/PageContainer.js","common/layout/fields/FieldHider.js"],function(t,e){var i,r,o;return{setters:[function(e){i=e.PageContainer},function(e){r=e.FieldHider}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("TableHeader",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-table-header",this.properties={cols:Array,selectable:Boolean,selectionType:{type:String,value:"checkbox"},selected:{type:Boolean,value:!1,notify:!0},selectionDisabled:{type:Boolean,value:!1},selectionTooltip:String,headerClassMap:{type:Object,value:{}},columnWidths:{type:Object,value:null},viewport:{type:Object,value:function(){return i.getViewport()}},headerActions:Array,hideHiddenSelectable:{type:Boolean,value:!1}}}},{key:"ready",value:function(){this.isMobile=this._isMobileViewport()}},{key:"_isMobileViewport",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport}},{key:"setIsMobile",value:function(e){if(e)return e.isMobile()}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport}},{key:"buildLabels",value:function(){var i={},n=[];this.cols.forEach(function(e){if(e){var t=e.replace(/(?![\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B)\W/g,"");n.push(t),i[t]=e}}),this.$.header.data=void 0,this.$.header.itemClassMap=this.headerClassMap,this.$.header.columnWidths=this.columnWidths,this.$.header.group||(this.$.header.group=n),this.$.header.data=i}},{key:"setSelectable",value:function(){this.selectable&&(this.registeredDataChangedHandler||(this.registeredDataChangedHandler=!0,Polymer.RenderStatus.afterNextRender(this,this.registerSelectionChangedHandler.bind(this))))}},{key:"registerSelectionChangedHandler",value:function(){this.$.selection.addEventListener("data-changed",this.selectionChangedHandler.bind(this))}},{key:"selectionChangedHandler",value:function(e){"template"!==Polymer.dom(e).rootTarget.nodeName.toLowerCase()&&(this.internal=!0,this.selected=void 0!==e.detail.value[this.selectionType]?e.detail.value[this.selectionType]:e.detail.value,this.internal=!1,this.fire("header-selection-changed",{selected:this.selected}))}},{key:"setSelected",value:function(){if(!this.internal){var e="radio"===this.selectionType?"radio":"checkbox";this.$.selection.group||(this.$.selection.group=[e]);var t={disabled:this.selectionDisabled},i=this.selected;t[e]=i;var n=new r(!this.selectable).hide;n.type="invisible",t.hidden=n,this.$.selection.data=t;var o=!!this.hideHiddenSelectable&&!this.selectable;this.toggleClass("hidden",o,this.$.selection)}}},{key:"_showHeaderActions",value:function(e){if(!this.headerActions||0===this.headerActions.length)return!1;for(var t=0,i=this.headerActions.length;t<i;t++)if(this.headerActions[t].position==e&&!this.headerActions[t].hidden)return!0;return!1}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["buildLabels(cols, headerClassMap, columnWidths)","setSelectable(selectable, selectionType)","setSelected(selected, selectable, selectionType)"]}}]),o=e)),t("TableHeader",o),Polymer(o)}}}),System.register("common/layout/sb-table-row/TableRow.js",["common/core/sb-page-container/PageContainer.js","common/layout/fields/FieldHider.js","common/signal/RowFocusSignaler.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.PageContainer},function(e){o=e.FieldHider},function(e){r=e.RowFocusSignaler}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("TableRow",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-table-row",this.listeners={"row-swiped":"onRowSwiped"},this.properties={cell:String,cols:Array,colsDisplay:Object,rowActions:Array,routeSource:String,rowData:{type:Object,notify:!0},model:{type:Object,value:null},requiresModel:{type:Boolean,value:!1},selectable:{type:Boolean,value:!1},selected:{type:Boolean,value:!1,notify:!0},selectionType:{type:String,value:"checkbox"},disabledData:{type:Object,value:{disabled:!1,constrained:!1}},selectionIdDataPath:{type:String,value:"Id"},parentIdDataPath:{type:String,value:"Parent"},parentAttributesPath:String,primaryMobileCols:{type:Array,value:[]},repeatPrimaryMobileCols:{type:Boolean,value:!1},viewport:{type:Object,value:function(){return i.getViewport()}},isMobile:{type:Boolean,value:!1,computed:"setIsMobile(viewport)"},actionId:{type:String,computed:"setActionId(isMobile)"},grouper:String,grouperExpanded:Boolean,groupie:String,ignoreViewportChange:Boolean,rowClassMap:{type:Object,value:{}},editFirstWhenSelected:{type:String,value:""},index:{type:Number,reflectToAttribute:!0},disableSwipe:{type:Boolean,value:!1},expanded:{type:Boolean,value:!1,observer:"_broadcastMobileExpanded"},expandDisabled:{type:Boolean,value:!1},rowSwiped:{type:Boolean,value:!1},hideSelection:{type:Object,value:null},selectionClass:{type:String,value:null},leftClass:{type:String,value:"",computed:"setLeftClass(routeSource, rowData, selected)"},highlightRowOnFocus:{type:Boolean,observer:"_highlightRowOnFocus"},deferGrouping:{type:Boolean,value:!1},selectionOnLoad:{type:Boolean,value:!1},columnWidths:{type:Object,value:null},forceColumnWidths:{type:Boolean,value:!1},mobileExpandedDetails:{type:Object,value:null,observer:"expandMobileRow"},mobileSelectedDetails:{type:Object,value:null,observer:"selectMobileRow"},disableSelectionTabFocus:{type:Boolean,value:!1},hasTogglePlaceholder:Boolean,hasToggle:Boolean,togglePlaceholder:{type:Boolean,computed:"_hasTogglePlaceholder(hasTogglePlaceholder, hasToggle)"}}}},{key:"onRowSwiped",value:function(e){this.rowSwiped=e.detail.isOpen}},{key:"setIsMobile",value:function(e){if(e)return e.isMobile()}},{key:"setActionId",value:function(e){return e?"swipe-menu":""}},{key:"buildRow",value:function(){this.requiresModel&&!this.model||(this.$.row.item=void 0,this.$.row.groupDisplay=void 0,this.setPrimaryMobileColumnsIfMobileViewport(),this.setFullWidthIfGroupRow(),this.$.row.columnWidths=this.forceColumnWidths?this._cloneColumnWidths():this.columnWidths,this.$.row.itemClassMap=this.rowClassMap,this.$.row.groupDisplay=this.colsDisplay,this.$.row.group||(this.$.row.group=this.cols),this.$.row.item=this.cell)}},{key:"setSelectable",value:function(){this.selectable&&(this.registeredDataChangedHandler||(this.registeredDataChangedHandler=!0,this.selectionOnLoad?this.registerSelectionChangedHandler():Polymer.RenderStatus.afterNextRender(this,this.registerSelectionChangedHandler.bind(this))))}},{key:"registerSelectionChangedHandler",value:function(){this.$.selection.addEventListener("data-changed",this.selectionChangedHandler.bind(this))}},{key:"selectionChangedHandler",value:function(e){if(!Polymer.dom(e).rootTarget||"template"!==Polymer.dom(e).rootTarget.nodeName.toLowerCase()){var t=this.selected;this.internal=!0,this.selected=void 0!==e.detail.value[this.selectionType]?e.detail.value[this.selectionType]:e.detail.value,this.$.row.selected=this.selected,this.internal=!1;var i=t!==this.selected,n="data.checkbox"===e.detail.path||"data.radio"==e.detail.path;this.editFirstWhenSelected&&this.selected&&i&&this.editFirst(),this.selectionOnLoad&&this._selectedChangeByParent?Polymer.RenderStatus.afterNextRender(this,this.fireSetSelectionEvent.bind(this,i,n)):this.fireSetSelectionEvent(i,n)}}},{key:"editFirst",value:function(){var e=this.$.row.$$(this.cell).$$(this.editFirstWhenSelected);e&&"function"==typeof e.edit&&e.edit()}},{key:"fireSetSelectionEvent",value:function(e,t){this.fire("selection-changed",{selected:this.selected,selectionType:this.selectionType,Id:this.get("rowData."+this.selectionIdDataPath),bundleId:this.get("rowData."+this.parentIdDataPath),attributes:void 0===this.parentAttributesPath?void 0:this.get("rowData."+this.parentAttributesPath),group:this.grouper,changed:e,path:t,index:this.index,rowData:this.rowData,autoSelectGroupRows:!this._selectedChangeByParent})}},{key:"setSelected",value:function(){this.selectable&&!this.internal&&(this._selectedChangeByParent=!0,this._setSelected(this.selected),this._selectedChangeByParent=!1)}},{key:"_setSelected",value:function(e){this.disabledData.constrained&&!0===e&&(this.internal=!0,this.$.row.fire("group-selected",{selected:!1}),e=!1,this.internal=!1);var t=new o("Configurator"===this.routeSource&&this.hasDeleteAction()).hide;if(null!=this.hideSelection){var i=new o(this.hideSelection).hide;Polymer.Base.extend(t,i)}this.disableSelectionTabFocus&&(this.$.selection.tabIndex="-1"),this.selectionData={hidden:t},this.selectionData[this.selectionType]=e,this.selectionData.disabled=this.disabledData.disabled||this.disabledData.constrained,this.$.selection.data=this.selectionData,void 0===this.$.selection.group&&(this.$.selection.group=[this.selectionType]),this.toggleClass("td",this.selectable&&!t.hidden||"invisible"===t.type,this.$.selectionContainer),this.toggleClass("innerTd",this.selectable&&!t.hidden||"invisible"===t.type,this.$.selection),this.toggleClass("selection",this.selectable&&!t.hidden||"invisible"===t.type,this.$.selection),this.selectionClass&&this.toggleClass(this.selectionClass,!0,this.$.selection)}},{key:"select",value:function(e){if(void 0===this.selectionData||!0!==this.selectionData.disabled){var t=Polymer.dom(e).rootTarget;"sb-group"===(t&&t.tagName?t.tagName.toLowerCase():"")&&this._setSelected(!this.selected),this._broadcastGroupSelected(this.selected),this._broadcastMobileSelected()}}},{key:"_broadcastGroupSelected",value:function(e){this._groupSelected=e,this.$.row.fire("group-selected",{selected:e,selectionDisabled:this.selectionDisabled,tableRow:this})}},{key:"expand",value:function(e){this.expandDisabled||this.rowSwiped||(this.expandPath=e.detail&&e.detail.preventer?Polymer.dom(e.detail.preventer).path:Polymer.dom(e).path,this.$.row.fire("group-expanded",{path:this.expandPath}))}},{key:"setPrimaryMobileColumnsIfMobileViewport",value:function(){this.$.row.numPrimary=this.primaryMobileCols.length,this.$.row.primaryItems=this.isMobileViewport()?this.primaryMobileCols:null,this.$.row.includePrimaryInSecondary=!!this.isMobileViewport()&&this.repeatPrimaryMobileCols}},{key:"expandMobileRow",value:function(){this.isMobileViewport()&&this.mobileExpandedDetails&&this.mobileExpandedDetails.expanded!==this.expanded&&(this.internalExpand=!0,this.$.row.fire("group-expanded",{path:this.mobileExpandedDetails.path}),this.internalExpand=!1)}},{key:"selectMobileRow",value:function(){if(this.isMobileViewport()&&this.mobileSelectedDetails){var e=this.mobileSelectedDetails.selected;e===this.selected&&e===this._groupSelected||this._broadcastGroupSelected(e)}}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport,this.ignoreViewportChange||this.setPrimaryMobileColumnsIfMobileViewport()}},{key:"setGrouper",value:function(){var e=!this.isMobileViewport()&&!!this.grouper;this.toggleClass("groupTr",e,this),this.toggleClass("groupTd",e,this.$.row),this.toggleClass("groupExpandTd",e,this.$.rowDiv),this.setGrouperToggle(e)}},{key:"setGrouperToggle",value:function(e){this._toggleGroupHandler=this._toggleGroupHandler||this.toggleGroupHandler.bind(this),this.$.rowDiv.removeEventListener("tap",this._toggleGroupHandler),e&&this.$.rowDiv.addEventListener("tap",this._toggleGroupHandler)}},{key:"toggleGroupHandler",value:function(e){var t=e.detail&&e.detail.expand,i=Polymer.dom(e).localTarget,n=Polymer.dom(i).classList.contains("expanded");t!==(n=n||!!Polymer.dom(i).querySelector(".expanded"))&&(this.setGrouperClasses(!n),this.fire("sb-row-group-tapped",{expanded:!n,group:this.grouper}))}},{key:"setGrouperClasses",value:function(e){this.toggleClass("expanded",e,this.$.row),this.toggleClass("expanded",e,this)}},{key:"toggleRowDrawer",value:function(){this.set("rowData._transient_.optionDrawerExpanded",!this.rowData._transient_.optionDrawerExpanded),this.set("rowData._transient_.drawerIconClass",this.rowData._transient_.optionDrawerExpanded?"sf-icon-chevrondown":"sf-icon-chevronright")}},{key:"isMobileViewport",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"displayRowActions",value:function(e){if(!e)return!0;if(!this.rowActions||0===this.rowActions.length)return!1;for(var t=0,i=this.rowActions.length;t<i;t++)if(this.rowActions[t].position==e&&!this.rowActions[t].hidden)return!0;return!1}},{key:"hasDeleteAction",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.rowActions[Symbol.iterator]();!(e=(n=o.next()).done);e=!0)return"Delete"===n.value.title}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"setFullWidthIfGroupRow",value:function(){this._isGrouperRow()&&(this.rowData.fullWidthItem="firstInnerTd")}},{key:"_configurationRequired",value:function(){return!("Configurator"!==this.routeSource||!this.rowData.configurationRequired||!this.selected||this.rowData.configured)}},{key:"setLeftClass",value:function(){if(this._configurationRequired()&&!this.rowData.added)return"left"}},{key:"_hasTogglePlaceholder",value:function(){return this.hasTogglePlaceholder&&!this.hasToggle}},{key:"_highlightRowOnFocus",value:function(){this.signaler=this.signaler||new r(this,"row",this.cell,"swipe-header"),this.signaler.signalOnFocus("sb-row-focus-signal",!this.highlightRowOnFocus)}},{key:"_isGrouperRow",value:function(){return!this.isMobileViewport()&&!!this.grouper}},{key:"_cloneColumnWidths",value:function(){if(!this.columnWidths)return null;if(!this._isGrouperRow())return JSON.parse(JSON.stringify(this.columnWidths));if(null==this.columnWidths[this.cols[0]])return null;var e=JSON.parse(JSON.stringify(this.columnWidths)),t=e[this.cols[0]];return t.width=100,t.unit="%",e}},{key:"_broadcastMobileExpanded",value:function(){!this.internalExpand&&this.domHost&&this.isMobileViewport()&&this.expandPath&&this.domHost.fire("sb-mobile-row-expanded",{expanded:this.expanded,path:[].concat(this.expandPath),index:this.index,id:this.get("rowData."+this.selectionIdDataPath)})}},{key:"_broadcastMobileSelected",value:function(){this.domHost&&this.isMobileViewport()&&this.domHost.fire("sb-mobile-row-selected",{selected:this.selected,index:this.index,id:this.get("rowData."+this.selectionIdDataPath)})}},{key:"notify",value:function(e){if(this.rowData){var t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value,a=this.get("rowData."+s);this.notifyPath("rowData."+s,a,!0)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["buildRow(cell, cols, colsDisplay, rowData, model, primaryMobileCols, repeatPrimaryMobileCols, requiresModel, rowClassMap, columnWidths)","setSelectable(selectable, selectionOnLoad)","setSelected(selected, selectable, selectionType, rowActions, routeSource, disabledData, hideSelection, selectionClass)","setGrouper(rowData, grouper)","setGrouperClasses(grouperExpanded, grouper)"]}}]),s=e)),t("TableRow",s),Polymer(s)}}}),System.register("common/layout/sb-tabs/Tabs.js",["common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o;return{setters:[function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Tabs",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-tabs",this.properties={tabs:Array,pageComponent:{type:String,value:null},pageData:{type:Object,value:{}},commonData:{type:Object,value:{}},selectedTabIndex:{type:Number,value:0},selectedPageIndex:{type:Number,value:0},tabsClass:{type:String,value:"horizontal layout center-justified"},usePagination:{type:Boolean,value:!1},paginationClass:{type:String,value:"horizontal layout center-justified"},viewport:{type:Object,observer:"_viewportChanged",value:function(){return i.getViewport()}},tabLimit:{type:Number,value:0},rendered:{type:Boolean,value:!1},overflowTab:Object,overflowTabClass:String,overflowTabMenuClass:String,menuMaskClass:String,bindingData:{type:Object,value:{}},bind:{type:Array,value:[]},attributes:{type:Array,value:[]},hideTabs:{type:Boolean,value:!1},contentContainerClass:String,tabContainerClass:String,pageElements:{type:Array,value:[]},overflowTabMenuDisabled:{type:Boolean,value:!1},overflowTabMenuLabelDisabled:{type:Boolean,value:!1}}}},{key:"render",value:function(){this._enforceValidTabSelected(),this._buildTabs(),Polymer.dom(this.$.paperTabs).observeNodes(function(){this.rendered=!0,!this.tabs||this.tabs.length<=0||this._viewportChanged()}.bind(this))}},{key:"destroyTabs",value:function(){if(this.template)try{for(var e=Polymer.dom(this.$.pages),t=e.childNodes,i=0,n=t.length;i<n;i++)e.removeChild(t[i]);Polymer.dom.flush(),this.template=null,this.selectedTabIndex=0}catch(e){return}}},{key:"_enforceValidTabSelected",value:function(){(isNaN(this.selectedPageIndex)||this.tabs&&this.tabs.length<=this.selectedPageIndex||this.selectedPageIndex<0||this.selectedPageIndex%1!=0)&&(this.selectedPageIndex=0)}},{key:"_buildTabs",value:function(){this.template?this._initTemplateData(this.template):(this.template=document.createElement("template","dom-bind"),this._buildPages(this.template),this._initTemplateData(this.template),Polymer.dom(this.$.pages).appendChild(this.template),Polymer.dom.flush(),Polymer.dom(this.$.pages).observeNodes(function(e){for(var t=0,i=e.addedNodes.length;t<i;t++)this.pageElements=this.pageElements.concat(Polymer.dom(e.addedNodes[t]).childNodes);this.bindElementEvents(this.pageElements)}.bind(this)))}},{key:"setPageElements",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=(e||[])[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this.pageElements.push(s)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"_initTemplateData",value:function(e){for(var t in e.pageData=this.pageData,e.commonData=this.commonData,this.bindingData)e[t]=this.bindingData[t];this.templateBindData(e)}},{key:"_buildPages",value:function(p){var f=p.content.ownerDocument;this._bind=[],this.tabs.forEach(function(e,t){var i=e.pageComponent||this.pageComponent;if(i){var n=f.createElement("div"),o=f.createElement(i);for(var r in Polymer.dom(o).setAttribute("name",e.name),Polymer.dom(o).setAttribute("label",e.label),Polymer.dom(o).setAttribute("tabs",!0),Polymer.dom(o).setAttribute("key",e.key),Polymer.dom(o).setAttribute("page-data","[[pageData."+e.name+"]]"),Polymer.dom(o).setAttribute("common-data","[[commonData]]"),this.bindingData)Polymer.dom(o).setAttribute(Polymer.CaseMap.camelToDashCase(r),"{{"+r+"}}");var s=e.attributes||this.attributes||{},a=!0,l=!1,u=void 0;try{for(var d,c=s[Symbol.iterator]();!(a=(d=c.next()).done);a=!0){var h=d.value;Polymer.dom(o).setAttribute(h.name,h.value)}}catch(e){l=!0,u=e}finally{try{!a&&c.return&&c.return()}finally{if(l)throw u}}this.usePagination&&this.set("tabs."+t+".disabled",!0),this.appendBindData(e,o),Polymer.dom(n).appendChild(o),Polymer.dom(p.content).appendChild(n)}}.bind(this))}},{key:"appendBindData",value:function(e,t){var i=e.bind||this.bind;if(i){this._bind=this._bind.concat(i.filter(function(e){return this._bind.indexOf(e)<0}.bind(this)));var n=!0,o=!1,r=void 0;try{for(var s,a=i[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;Polymer.dom(t).setAttribute(Polymer.CaseMap.camelToDashCase(l),"{{"+l+"}}"),this._addComplexObserverEffect("updateData("+l+")")}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}}},{key:"templateBindData",value:function(e){this.requiresTemplateBindData=this._bind&&0<this._bind.length;var t=!0,i=!1,n=void 0;try{for(var o,r=this._bind[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;(this.__data__[s]&&this.__data__[s]!==this[s]||void 0===this[s])&&(this[s]=this.__data__[s]),void 0!==this[s]&&(this.requiresTemplateBindData=!1,e[s]=this[s])}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"displayPage",value:function(e){var t=Polymer.dom(this.$.paperTabs).querySelectorAll("paper-tab")[e];return null!=t&&"overflowTab"===t.id&&0!=e?this.selectedPageIndex:(this.selectedPageIndex=+e,e)}},{key:"setPaginationListener",value:function(){this.usePagination&&this.addEventListener("pagination-changed",this.changeTab.bind(this))}},{key:"changeTab",value:function(e){this._changeTab(e.detail.index)}},{key:"_changeTab",value:function(e){var t=Polymer.dom(this.$.paperTabs).node,i=Polymer.dom(t.querySelector("#overflowTab")).node,n=this.tabLimit,o=this.tabs.length;this.selectedTabIndex=e,this._ensureOverflowTabMenuDisabled(i),this._ensureOverflowSelection(),this.selectedTabIndex>=n&&n<o-1?(this._displayOverflowTabName(i,this.tabs[this.selectedTabIndex].label),t.selected=t.getElementsByTagName("paper-tab").length-1,this.usePagination&&(this.$$("#pagination").pageIndex=e,this.overflowTabMenuDisabled=!1,this.overflowTabMenuLabelDisabled=!1)):n<o-2&&this._displayOverflowTabName(i,this.tabs[n].label)}},{key:"_ensureOverflowTabMenuDisabled",value:function(e){for(var t=!0,i=this.tabLimit,n=this.tabs.length;i<n;i++)if(!this.tabs[i].disabled){t=!1;break}if(this.overflowTabMenuDisabled=t,this.overflowTabMenuDisabled)this.overflowTabMenuLabelDisabled=!0;else{var o=Polymer.dom(e).firstChild.textContent,r=this._getTabIndexByLabel(o);0<=r&&(this.overflowTabMenuLabelDisabled=this.tabs[r].disabled)}}},{key:"_ensureOverflowSelection",value:function(){for(var e=Polymer.dom(this.root).querySelectorAll("li"),t=0,i=e.length;t<i;t++){var n=this.selectedPageIndex===t&&e[t].classList.contains("overflow"),o=this.tabs[t].className.replace(" selected","");n&&(o+=" selected"),this.set("tabs."+t+".className",o)}}},{key:"closeMenu",value:function(e){var t=this.selectedPageIndex;this.overflowTabMenuClass="",!(this.menuMaskClass="")!==e&&t<this.tabLimit&&(this.selectedTabIndex=t)}},{key:"updateData",value:function(e){this.template&&e&&e.path&&this.template.set(e.path,e.value)}},{key:"selectTab",value:function(e){var t=parseInt(e.currentTarget.id);if(!Number.isInteger(t)||!this.tabs[t].disabled){var i=Polymer.dom(this.$.paperTabs.querySelector("#overflowTab")).node,n=this.tabLimit;if(Number.isInteger(t)){if(this.selectedPageIndex=t,this._deselectPreviouslySelectedTab(),Polymer.dom(this.$.pages).node.selected=t,this.set("tabs."+t+".className","overflow selected"),this.overflowTab=this.tabs[t],this.tabs[t].iconId){var o=this.$$("#"+this.tabs[t].iconId+"-overflow");this.toggleClass("hideIconClass",!1,o)}this._displayOverflowTabName(i,e.currentTarget.textContent),this.overflowTabClass="overflowTab",this.closeMenu(!0)}else this.tabs.length-1>n&&(this._deselectPreviouslySelectedTab(),this._displayOverflowTabName(i,this.tabs[n].label),this._ensureOverflowTabMenuDisabled(i))}}},{key:"_handleEvent",value:function(e){var t=e.currentTarget.getAttribute("data-tap-event"),i=e.currentTarget.getAttribute("id"),n=null!=t?t:"tab-"+Polymer.CaseMap.camelToDashCase(i);this.fire(n+"-tapped",{event:t,Id:i})}},{key:"showMenu",value:function(){this.overflowTabMenuClass="showOverflowTabMenu",this.menuMaskClass="showMenuMask"}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport}},{key:"_displayOverflowTabName",value:function(e,t){Polymer.dom(e).firstChild.textContent=t,this.overflowTabClass="overflowTab"}},{key:"_handleOverFlow",value:function(){var e=Polymer.dom(this.$.paperTabs).node,t=this.selectedPageIndex,i=Polymer.dom(e.querySelector("#overflowTab")).node,n=Polymer.dom(this.$$("#pagination")).node,o=this.tabLimit,r=this.tabs.length,s=void 0,a=void 0;this.overflowTabClass="";for(var l=0;l<r;l++){if(s="noOverflow",(a=o)<=l&&o<r-1&&(l===r-1&&(o<=t&&(a=t),this.overflowTab=this.tabs[a],this._displayOverflowTabName(i,this.tabs[a].label)),s="overflow"),this.tabs[l].iconId){var u=this.$$("#"+this.tabs[l].iconId),d=!("noOverflow"==s||"overflow"==s&&o<=l&&l!=r-1);if(this.toggleClass("hideIconClass",d,u),"overflow"==s&&l===t){var c=this.$$("#"+this.tabs[l].iconId+"-overflow");this.toggleClass("hideIconClass",!1,c)}}this.tabs[l].disabled&&(s+=" disabled"),this.set("tabs."+l+".className",l===t?s+" iron-selected":s)}t<o||r-1===o&&t===o?(this.selectedTabIndex=t,this.set("tabs."+t+".className",this.tabs[t].className.replace(" selected",""))):o<=t&&(e.selected=r,this.overflowTabClass="overflowTab",this.set("tabs."+t+".className","overflow selected")),this.usePagination&&null!=n&&(n.pageIndex=t),this._ensureOverflowTabMenuDisabled(i)}},{key:"_handleSelectedChanged",value:function(){this._enforceValidTabSelected(),this.fire("selected-page-changed",this.selectedPageIndex),this.fireTabSelected()}},{key:"fireTabSelected",value:function(){this.pageElements.length>this.selectedPageIndex&&this.pageElements[this.selectedPageIndex].fire("sb-tab-selected")}},{key:"_deselectPreviouslySelectedTab",value:function(){var e=parseInt(Polymer.dom(this.$.overflowTabMenu.querySelector(".selected")).node.id);Number.isInteger(e)&&this.set("tabs."+e+".className",this.tabs[e].className.replace(" selected",""))}},{key:"_viewportChanged",value:function(){this.rendered&&(this.viewport&&this.viewport.XL.up?this.tabLimit=7:this.viewport&&this.viewport.L.up?this.tabLimit=5:this.viewport&&this.viewport.M.up?this.tabLimit=4:this.viewport&&this.viewport.S.up?this.tabLimit=3:this.viewport&&this.viewport.XS.up&&(this.tabLimit=2),this._handleOverFlow())}},{key:"bindElementEvents",value:function(i){var n=i?i.length:0;if(0!=n){for(var e in this.fireTabSelected(),this.bindingData){for(var t=Polymer.CaseMap.camelToDashCase(e),o=0;o<n;o++)i[o].addEventListener(t+"-changed",function(e){e.detail.path&&this.domHost.set(e.detail.path,e.detail.value)}.bind(this));this.domHost.addEventListener(t+"-changed",function(e){if(e.detail.path)for(var t=0;t<n;t++)i[t].set(e.detail.path,e.detail.value)}.bind(this))}var r=!0,s=!1,a=void 0;try{for(var l,u=this._bind[Symbol.iterator]();!(r=(l=u.next()).done);r=!0)for(var d=l.value,c=Polymer.CaseMap.camelToDashCase(d),h=0;h<n;h++)i[h].addEventListener(c+"-changed",function(e){e.detail.path&&this.domHost.set(e.detail.path,e.detail.value)}.bind(this))}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}this.requiresTemplateBindData&&this.templateBindData(this.template)}}},{key:"_propertyChanged",value:function(e,t){this.template&&-1!==this._bind.indexOf(e.split(".")[0])&&this.template.set(e,t)}},{key:"contentFilteredHandler",value:function(e,t){if(null!=e){var i=this._getTabIndexByLabel(e);i<0||(this.set("tabs."+i+".disabled",!t||this.usePagination),this.tabs[i]._disabled=!t,this._changeToNextEnabledTabQueued&&clearTimeout(this._changeToNextEnabledTabQueued),this._changeToNextEnabledTabQueued=setTimeout(this._changeToNextEnabledTab.bind(this),1))}}},{key:"_getTabIndexByLabel",value:function(e){for(var t=0,i=this.tabs.length;t<i;t++)if(this.tabs[t].label===e)return t;return-1}},{key:"_changeToNextEnabledTab",value:function(){var e=this._getNextEnabledPageIndex();this._changeTab(e)}},{key:"_getNextEnabledPageIndex",value:function(){for(var e=this.selectedPageIndex,t=this.tabs.length;e<t;e++)if(!this.tabs[e]._disabled)return e;for(var i=0,n=this.selectedPageIndex;i<n;i++)if(!this.tabs[i]._disabled)return i;return this.selectedPageIndex}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["render(tabs, pageComponent, pageData, commonData, bindingData, bind, attributes)","setPaginationListener(usePagination)","updateData(pageData.*)","updateData(commonData.*)","_handleSelectedChanged(selectedPageIndex, pageElements)"]}}]),o=e)),t("Tabs",o),Polymer(o)}}}),System.register("common/layout/table-layout-builder/TableLayoutBuilder.js",["common/layout/tables/ImageCellSizer.js"],function(e,t){var f,i;return{setters:[function(e){f=e.ImageCellSizer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,i,n,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.parentElWidth=e,this.md=i,this.columns=t,this.actionsOnTheLeft=n,this.hasSelection=o,this.hasStandardDrawer=r}e("TableLayoutBuilder",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(s,[{key:"build",value:function(){this.layout={},this.availableWidth=this._getAvailableWidth();for(var e=0,t=this.columns.length,i=this.availableWidth/t,n=[],o=0;o<t;o++){var r=this.columns[o],s=150,a=new f(this.md[r],0).getImageWidth(25);150<a?(s=a,n.push(r)):150<i&&(s=Math.ceil(i*this._getMultiplier(r))),e+=this.layout[r]=s}if(this.totalColsWidth=e,150<i)for(var l=e-this.availableWidth,u=t-n.length,d=0,c=this.totalColsWidth=0;c<t;c++){var h=this.columns[c],p=-1!==n.indexOf(h)?this.layout[h]:Math.ceil(this.layout[h]-l/u);d+=p,c==t-1&&(p-=d-this.availableWidth),this.layout[h]=p,this.totalColsWidth+=p}return this.layout}},{key:"_getAvailableWidth",value:function(){return this.parentElWidth-this._getStaticColsWidth()-12}},{key:"getTotalWidth",value:function(){return this.totalColsWidth+this._getStaticColsWidth()+10}},{key:"_getStaticColsWidth",value:function(){var e=135;return this.hasSelection&&(e+=30),this.hasStandardDrawer&&(e+=40),e}},{key:"getLeftOffset",value:function(){var e=40;return this.actionsOnTheLeft&&(e+=95),this.hasSelection&&(e+=30),e}},{key:"_getMultiplier",value:function(e){switch((this.md[e]?this.md[e].type:"currency").toUpperCase()){case"STRING":return 1.5;case"BOOLEAN":return 1;case"DATE":return 1.3;case"DOUBLE":case"CURRENCY":case"PERCENT":case"NUMBER":return 1.6;case"PICKLIST":case"MULTIPICKLIST":return 1.4;case"REFERENCE":case"TEXTAREA":default:return 1.6}}}]),i=s)),e("TableLayoutBuilder",i)}}}),System.register("common/layout/tables/ImageCellSizer.js",[],function(e,t){var o,r;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.metadata=e,this.labelMultiplier=null!=t?t:9}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},e("DEFAULT_WIDTH",60),e("DEFAULT_WIDTH",60),e("DEFAULT_HEIGHT",60),e("DEFAULT_HEIGHT",60),e("ImageCellSizer",(o(i,[{key:"getImageWidth",value:function(e){var t=this._getImageWidth(e,0);if(null!=t){for(var i=-1;i=Math.max(i,t.width),null!=(t=this._getImageWidth(e,t.end)););return this.hasInvalidWidth&&this._warnInvalidWidthParameter(),i}}},{key:"_getImageWidth",value:function(e,t){if(this.metadata){var i=this._getImageFunctionStart(t);if(-1!==i){var n=this._getImageFunctionEnd(i),o=this.metadata.calculatedFormula.substring(i,n).split(","),r=this._getWidthFromImageFunctionArgs(o);e=null!=e?e:0;var s=this.metadata.label.length*this.labelMultiplier;return{width:Math.max(r,s)+e,end:n}}}}},{key:"_getImageFunctionStart",value:function(e){return this.metadata.calculatedFormula?this.metadata.calculatedFormula.toLowerCase().indexOf("image(",e):-1}},{key:"_getImageFunctionEnd",value:function(e){var t=this.metadata.calculatedFormula?this.metadata.calculatedFormula.toLowerCase():null;if(!t)return-1;for(var i=0,n=0,o=e,r=t.length;o<r;o++)if("("===t.substring(o,o+1)?i++:")"===t.substring(o,o+1)&&n++,0<i&&i===n)return o;return-1}},{key:"_getWidthFromImageFunctionArgs",value:function(e){if(e.length<=3)return 60;var t=void 0;try{t=parseInt(e[3].trim())}catch(e){return this.hasInvalidWidth=!0,60}return isNaN(t)?(this.hasInvalidWidth=!0,60):t}},{key:"_warnInvalidWidthParameter",value:function(){console.warn('May not have properly sized the column to fit the image specified by this formula: "'+this.metadata.calculatedFormula+"\"\nREASON: At least one of the formula's IMAGE function(s) has its width parameter (4th argument) defined from a field.\nSOLUTION: All of the formula's IMAGE function(s) should have its width parameter either omitted or hardcoded to a number.")}}]),r=i)),e("ImageCellSizer",r)}}}),System.register("common/layout/tables/RowFieldSelector.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.row=e,this.fields=t,this.rowIndex=i,this.rowIndexAttribute=n||"index"}e("RowFieldSelector",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(s,[{key:"selectFirstEditableField",value:function(){var e=this._selectEditableFields();return this._selectNextEditableField(e,0)}},{key:"selectLastEditableField",value:function(){var e=this._selectEditableFields();return this._selectPreviousEditableField(e,e.length-1)}},{key:"selectNextEditableField",value:function(e){var t=this._selectEditableFields(),i=t.indexOf(e),n=0<=i?i+1:-1;return this._selectNextEditableField(t,n)}},{key:"selectPreviousEditableField",value:function(e){var t=this._selectEditableFields(),i=t.indexOf(e),n=0<=i?i-1:-1;return this._selectPreviousEditableField(t,n)}},{key:"_selectEditableFields",value:function(){return this.fields.filter(function(e){return e.isEditable()})||[]}},{key:"_selectNextEditableField",value:function(e,t){return 0<=t&&t<e.length?e[t]:this._selectFirstEditableNextRow()}},{key:"_selectPreviousEditableField",value:function(e,t){return 0<=t&&t<e.length?e[t]:this._selectLastEditablePreviousRow()}},{key:"_selectFirstEditableNextRow",value:function(){var e=this._selectRowByIndex(this.rowIndex+1),t=e?e.selector:null;if(t)return t.selectFirstEditableField()}},{key:"_selectLastEditablePreviousRow",value:function(){var e=this._selectRowByIndex(this.rowIndex-1),t=e?e.selector:null;if(t)return t.selectLastEditableField()}},{key:"selectFirstEditableField",value:function(){var e=this._selectEditableFields();return this._selectNextEditableField(e,0)}},{key:"selectLastEditableField",value:function(){var e=this._selectEditableFields();return this._selectPreviousEditableField(e,e.length-1)}},{key:"_selectRowByIndex",value:function(e){return s._selectTableRowByIndex(this.row.domHost,this.row.tagName.toLowerCase(),this.rowIndexAttribute,e)}}],[{key:"selectFirstEditableFieldInFirstRow",value:function(e,t,i){var n=s._selectTableRowByIndex(e,t,i,0),o=n?n.selector:null;if(o)return o.selectFirstEditableField()}},{key:"selectLastEditableFieldInLastRow",value:function(e,t,i,n){var o=s._selectTableRowByIndex(e,t,n,i-1),r=o?o.selector:null;if(r)return r.selectLastEditableField()}},{key:"_selectTableRowByIndex",value:function(e,t,i,n){return e.$$(t+"["+i+'="'+n+'"]')}}]),i=s)),e("RowFieldSelector",i)}}}),System.register("common/layout/tables/TableClassBuilder.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.columns=e,this.firstLastClassSuffix=t,this.typeByColumnMap=i,this.allColumnClasses=n||[]}e("TableClassBuilder",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"build",value:function(){var e={};return this._appendTypeClass(e),this._appendFirstAndLastColumnClasses(e),this._appendAllColumnClasses(e),this._addWidthStyles(e),e}},{key:"_appendTypeClass",value:function(e){if(this.typeByColumnMap){var t=!1,i=!0,n=!1,o=void 0;try{for(var r,s=this.columns[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l=this.typeByColumnMap[a],u=this._isNumericType(l),d=this._isBooleanType(l);u?this._appendClass(e,a,"numericCell"):d?this._appendClass(e,a,"checkboxCell"):t&&this._appendClass(e,a,"afterNumericCell"),t=u}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}}}},{key:"_appendFirstAndLastColumnClasses",value:function(e){var t="firstInner"+this.firstLastClassSuffix,i="lastInner"+this.firstLastClassSuffix,n="secondInner"+this.firstLastClassSuffix;this._appendClass(e,this.columns[0],t),this._appendClass(e,this.columns[this.columns.length-1],i),1<this.columns.length&&this._appendClass(e,this.columns[1],n)}},{key:"_appendAllColumnClasses",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.columns[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value,a=!0,l=!1,u=void 0;try{for(var d,c=this.allColumnClasses[Symbol.iterator]();!(a=(d=c.next()).done);a=!0){var h=d.value;this._appendClass(e,s,h)}}catch(e){l=!0,u=e}finally{try{!a&&c.return&&c.return()}finally{if(l)throw u}}}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"_addWidthStyles",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.columns[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value,a=this.typeByColumnMap[s].split(":");2===a.length&&this._setWidthStyle(e,s,a[1])}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"_isNumericType",value:function(e){return"double"===(e=e.split(":")[0])||"number"===e||"currency"===e||"percent"===e}},{key:"_isBooleanType",value:function(e){return"boolean"===(e=e.split(":")[0])||"checkbox"===e}},{key:"_appendClass",value:function(e,t,i){e[t]||(e[t]={});var n=e[t].class;e[t].class=n?n+" "+i:i}},{key:"_setWidthStyle",value:function(e,t,i){e[t]||(e[t]={}),e[t].style="width:"+i+"px"}}]),i=o)),e("TableClassBuilder",i)}}}),System.register("common/rules/operators/OpContains.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.opType=e}e("OpContains",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"evaluate",value:function(e,t){if(null==e||null==t)return!1;var i=String(e).toLowerCase(),n=String(t).toLowerCase();return-1!==i.indexOf(n)}}]),i=t)),e("OpContains",i)}}}),System.register("common/rules/operators/OpEndsWith.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.opType=e}e("OpEndsWith",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"evaluate",value:function(e,t){if(null==e||null==t)return!1;var i=String(e).toLowerCase(),n=String(t).toLowerCase();return-1!==i.indexOf(n,i.length-n.length)}}]),i=t)),e("OpEndsWith",i)}}}),System.register("common/rules/operators/OpEquals.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.opType=e,this.testValueCache={},this.fieldValueCache={}}e("OpEquals",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"evaluate",value:function(e,t){if(null==e||null==t)return e==t;if(e instanceof Date)return e.getTime()===new Date(t).getTime();if("boolean"==typeof e)return e===("true"===String(t).toLowerCase());if("string"!=typeof e||"string"!=typeof t)return("number"==typeof e||e instanceof Number)&&e.valueOf()==t;var i=t.toLowerCase(),n=e.toLowerCase();return null==this.testValueCache[i]&&(this.testValueCache[i]=this.valueFor(i)),null==this.fieldValueCache[n]&&(this.fieldValueCache[n]=this.valueFor(n)),this.testValueCache[i].equals(this.fieldValueCache[n])}},{key:"valueFor",value:function(e){return-1<e.indexOf(",")&&0!=e.indexOf('"')&&e.lastIndexOf('"')!=e.length-1?{valueType:"Multi",valueSet:e.split(",").map(function(e){return e.trim()}),equals:function(e){return"Multi"!==e.valueType?-1!=this.valueSet.indexOf(e.value):e.valueSet.some(function(e){return-1!=this.valueSet.indexOf(e)},this)}}:{valueType:"Single",value:e,equals:function(e){return this.value===e.value}}}}]),i=t)),e("OpEquals",i)}}}),System.register("common/rules/operators/OpGreaterThan.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.opType=e}e("OpGreaterThan",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"evaluate",value:function(e,t){if(null==e||null==t)return!1;if("number"==typeof e||e instanceof Number)return e.valueOf()>t;if(e instanceof Date)return e>new Date(t);if("string"!=typeof e)return!1;var i=Date.parse(e),n=Date.parse(t);return i==i&&n==n?n<i:e.toLowerCase()>t.toLowerCase()}}]),i=t)),e("OpGreaterThan",i)}}}),System.register("common/rules/operators/OpGreaterThanEquals.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.opType=e}e("OpGreaterThanEquals",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"evaluate",value:function(e,t){if(null==e||null==t)return!1;if("number"==typeof e||e instanceof Number)return e.valueOf()>=t;if(e instanceof Date)return e>=new Date(t);if("string"!=typeof e)return!1;var i=Date.parse(e),n=Date.parse(t);return i==i&&n==n?n<=i:t<=e}}]),i=t)),e("OpGreaterThanEquals",i)}}}),System.register("common/rules/operators/OpLessThan.js",["common/rules/operators/OpGreaterThanEquals.js"],function(e,t){var i,o;return{setters:[function(e){i=e.OpGreaterThanEquals}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.opType=e,this.gte=new i}e("OpLessThan",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"evaluate",value:function(e,t){return null!=e&&null!=t&&("number"==typeof e||"string"==typeof e||e instanceof Date||e instanceof Number)&&!this.gte.evaluate(e,t)}}]),o=t)),e("OpLessThan",o)}}}),System.register("common/rules/operators/OpLessThanEquals.js",["common/rules/operators/OpGreaterThan.js"],function(e,t){var i,o;return{setters:[function(e){i=e.OpGreaterThan}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.opType=e,this.gt=new i}e("OpLessThanEquals",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"evaluate",value:function(e,t){return null!=e&&null!=t&&("number"==typeof e||"string"==typeof e||e instanceof Date||e instanceof Number)&&!this.gt.evaluate(e,t)}}]),o=t)),e("OpLessThanEquals",o)}}}),System.register("common/rules/operators/OpNotEquals.js",["common/rules/operators/OpEquals.js"],function(e,t){var i,o;return{setters:[function(e){i=e.OpEquals}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.opType=e,this.equals=new i}e("OpNotEquals",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"evaluate",value:function(e,t){return!this.equals.evaluate(e,t)}}]),o=t)),e("OpNotEquals",o)}}}),System.register("common/rules/operators/OpStartsWith.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.opType=e}e("OpStartsWith",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"evaluate",value:function(e,t){return null!=e&&null!=t&&0===String(e).toLowerCase().indexOf(String(t).toLowerCase())}}]),i=t)),e("OpStartsWith",i)}}}),System.register("common/rules/operators/OperatorsUtils.js",["common/rules/operators/OpEquals.js","common/rules/operators/OpNotEquals.js","common/rules/operators/OpLessThan.js","common/rules/operators/OpLessThanEquals.js","common/rules/operators/OpGreaterThan.js","common/rules/operators/OpGreaterThanEquals.js","common/rules/operators/OpStartsWith.js","common/rules/operators/OpEndsWith.js","common/rules/operators/OpContains.js"],function(e,t){var i,o,r,s,a,l,u,d,c,h;return{setters:[function(e){i=e.OpEquals},function(e){o=e.OpNotEquals},function(e){r=e.OpLessThan},function(e){s=e.OpLessThanEquals},function(e){a=e.OpGreaterThan},function(e){l=e.OpGreaterThanEquals},function(e){u=e.OpStartsWith},function(e){d=e.OpEndsWith},function(e){c=e.OpContains}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.key=e,this.OP_EQ="equals",this.OP_NEQ="not equals",this.OP_LT="less than",this.OP_LTE="less or equals",this.OP_GT="greater than",this.OP_GTE="greater or equals",this.OP_SW="starts with",this.OP_EW="ends with",this.OP_CONT="contains"}e("OperatorsUtils",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"getInstance",value:function(){switch(this.key){case this.OP_EQ:return new i(this.key);case this.OP_NEQ:return new o(this.key);case this.OP_LT:return new r(this.key);case this.OP_LTE:return new s(this.key);case this.OP_GT:return new a(this.key);case this.OP_GTE:return new l(this.key);case this.OP_SW:return new u(this.key);case this.OP_EW:return new d(this.key);case this.OP_CONT:return new c(this.key);default:return null}}},{key:"getInverseInstance",value:function(){switch(this.key){case this.OP_EQ:return new i(this.key);case this.OP_NEQ:return new o(this.key);case this.OP_LT:return new a(this.key);case this.OP_LTE:return new l(this.key);case this.OP_GT:return new r(this.key);case this.OP_GTE:return new s(this.key);case this.OP_SW:return new u(this.key);case this.OP_EW:return new d(this.key);case this.OP_CONT:return new c(this.key);default:return null}}}]),h=t)),e("OperatorsUtils",h)}}}),System.register("common/services/sb-field-md/FieldMetadata.js",["common/core/AppContext.js"],function(t,e){var i,o;return{setters:[function(e){i=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("FieldMetadata",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-field-md",this.properties={fields:Array,object:String,md:{type:Object,notify:!0},error:{type:String,notify:!0},prefix:{type:String,value:function(){return i.org.prefix?i.org.prefix+"__":""}},background:{type:Boolean,value:!1},doNotFixObjectName:{type:Boolean,value:!1}}}},{key:"ready",value:function(){this.$.describe.addEventListener("describe-changed",function(e){for(var t=e.detail.value.md,i=e.detail.value.fields,n=[],o={},r=0,s=i.length;r<s;r++)if(t[i[r]]){var a=i[r].split(".")[0],l=i[r].split(".")[1];o[a]||(o[a]={}),n.push(t[i[r]]),o[a][l]=t[i[r]]}this.md={fields:n,fieldsByObject:o}}.bind(this)),this.$.describe.addEventListener("error-changed",function(e){this.error=e.detail.value}.bind(this))}},{key:"initFieldSetDescribe",value:function(){var i=[];this.fields.forEach(function(e){var t=e.split(".");2===t.length?i.push(this.buildFieldList(t[0],t[1])):i.push(this.buildFieldList(this.object,e))}.bind(this)),this.$.describe.fields=i}},{key:"buildFieldList",value:function(e,t){return this.doNotFixObjectName||!e.endsWith("__c")||e.startsWith(this.prefix)?e+"."+t:this.prefix+e+"."+t}},{key:"observers",get:function(){return["initFieldSetDescribe(fields, prefix)"]}}]),o=e)),t("FieldMetadata",o),Polymer(o)}}}),System.register("common/services/sb-job-checker/JobChecker.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}"Completed","Failed","Aborted",t("JobChecker",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-job-checker",this.properties={spinner:{type:Boolean,value:!1},useSpinner:{type:Boolean,value:!0},data:Object,status:String,result:{type:Object},error:{type:String,notify:!0},asyncNumList:{type:Array,value:[]},firstStatusTime:Number,lastStatusTime:Number}}},{key:"_useSpinner",value:function(){return this.spinner&&this.useSpinner}},{key:"ready",value:function(){this.firstStatusTime=Date.now(),this.lastStatusTime=Date.now(),this._setLoadingSpinner(!1),this.$.service.addEventListener("response-changed",function(e){this._checkStatus(e)}.bind(this)),this.$.service.addEventListener("error-changed",function(e){this.error=e.detail.value,this._setLoadingSpinner(!1)}.bind(this))}},{key:"_setLoadingSpinner",value:function(e){this.spinner=e,this.$.loadingSpinner.show=this._useSpinner()}},{key:"_ping",value:function(e){this._setLoadingSpinner(!0),this.$.service.background=!0,this.$.service.model=void 0,this.$.service.model=e}},{key:"_checkStatus",value:function(e){var t=e.detail.value;if(null!=t){var i=t.job.Id;if(this.status=t.job.Status,this._isFinished()){if(null!=t.payload){this.result=t;for(var n=0;n<this.asyncNumList.length;n++)this.cancelAsync(this.asyncNumList[n])}this._getStatusMessages(),this._setLoadingSpinner(!1),null!=t.payload&&this.fire("job-completed")}else{this.lastStatusTime=Date.now(),this.data.jobId=i,this._getStatusMessages();var o=this.async(function(){this._ping(this.data)}.bind(this),1e3);this.asyncNumList.push(o)}}}},{key:"_getStatusMessages",value:function(){var e=Date.now()-this.lastStatusTime;console.log("Record Id: "+this.data.recordId+" Job Type: "+this.data.jobType+" [Job Id: "+this.data.jobId+" - Status:"+this.status+"] Time : "+(this.lastStatusTime-this.firstStatusTime)+" [Wait Time: "+e+"]")}},{key:"_isFailure",value:function(){return this.status&&("Aborted"==this.status||"Failed"==this.status)}},{key:"_isFinished",value:function(){return this.status&&("Completed"==this.status||this._isFailure())}},{key:"observers",get:function(){return["_ping(data)"]}}]),i=e)),t("JobChecker",i),Polymer(i)}}}),System.register("common/services/sb-line-editor-cache-save/LineEditorCacheSaver.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LineEditorCacheSaver",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-line-editor-cache-save",this.properties={quote:Object,error:{type:String,notify:!0}}}},{key:"ready",value:function(){this.$.service.addEventListener("error-changed",function(e){this.error=e.detail,console.log(e.detail)}.bind(this))}},{key:"save",value:function(){this.$.service.transient=!0,this.$.service.uid=this.quote.record.Id,this.$.service.model=this.quote,this.$.service.saver=null}},{key:"observers",get:function(){return["save(quote)"]}}]),i=e)),t("LineEditorCacheSaver",i),Polymer(i)}}}),System.register("common/services/sb-line-editor-read/LineEditorReader.js",["common/data/cache/Cache.js","common/data/client/ConnectionClient.js","common/core/AppContext.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.Cache},function(e){o=e.ConnectionClient},function(e){r=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LineEditorReader",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-line-editor-read",this.properties={quoteId:String,background:{type:Boolean,value:!1},lineEditorModel:{type:Object,notify:!0},error:{type:Array,notify:!0},prefix:{type:String,value:function(){return r.org.prefix?r.org.prefix:""}}}}},{key:"ready",value:function(){this.firstStatusTime=Date.now()}},{key:"read",value:function(){this.$.loadingSpinner.show=!0,this.quoteuid=this.quoteId.substring(0,15);var e=i.get("LineEditor",this.quoteuid);e?setTimeout(function(){this.lineEditorModel=e,this.$.loadingSpinner.show=!1}.bind(this),0):window.SB&&window.SB.QuoteDAO&&new o(this.prefix).getConnection().then(function(e){var t=new window.SB.QuoteDAO(this.prefix,e).loadEditorModel(this.quoteuid,!0);t.then(function(e){this._checkStatus(e)}.bind(this)),t.catch(function(e){this.error=[e.message||e],this.$.loadingSpinner.show=!1}.bind(this))}.bind(this))}},{key:"_checkStatus",value:function(e){e&&(this.lastStatusTime=Date.now(),"Incomplete"==e?(this._getStatusMessages(),this.async(function(){this.read()}.bind(this),1e3)):(this.addToCache(this.quoteuid,e),this.lineEditorModel=e,this._setIsLastReadQuoteUnopened(),this.$.loadingSpinner.show=!1))}},{key:"clearFromCache",value:function(){i.remove("LineEditor",this.quoteuid,"value")}},{key:"addToCache",value:function(e,t){i.add("LineEditor",e.substring(0,15),t,"value",this)}},{key:"_setIsLastReadQuoteUnopened",value:function(){this.isLastReadQuoteUnopened=this.lineEditorModel.quote.record[this.lineEditorModel.settings.developerPrefix+"Unopened__c"],this.lineEditorModel.quote.record[this.lineEditorModel.settings.developerPrefix+"Unopened__c"]=!1}},{key:"_getStatusMessages",value:function(){var e=Date.now()-this.lastStatusTime;console.log("Reading: Quote Id: "+this.quoteId+" Time : "+(this.lastStatusTime-this.firstStatusTime)+" [Wait Time: "+e+"]")}},{key:"observers",get:function(){return["read(quoteId, background, prefix)"]}}]),s=e)),t("LineEditorReader",s),Polymer(s)}}}),System.register("common/services/sb-product-rules-quote-line-adder/ProductRulesQuoteLineAdder.js",["common/data/format/DataBuilder.js","common/data/minimize/QuoteMinimizer.js","common/aggregate/quote-aggregator/QuoteAggregator.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.DataBuilder},function(e){o=e.QuoteMinimizer},function(e){e.QuoteAggregator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ProductRulesQuoteLineAdder",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-product-rules-quote-line-adder",this.properties={quote:Object,productIds:Array,groupKey:{type:Number,value:-1},response:{type:Object,notify:!0},linesAddedByRules:{type:Object,notify:!0}}}},{key:"ready",value:function(){this.$.service.addEventListener("response-changed",function(e){this.linesAddedByRules=e.detail.value}.bind(this)),this.$.service.addEventListener("error-changed",function(e){e.detail.value&&(e.detail.value.validations?this.error=e.detail.value.validations:this.error=[e.detail.value.message]),console.log(e.detail)}.bind(this))}},{key:"addLines",value:function(){var e=new i;e.add("productIds",this.productIds),null!=this.quote.targetGroupKey&&0<=this.quote.targetGroupKey&&e.add("groupKey",this.quote.targetGroupKey);var t=new o(this.quote,this.productIds,this.quote.targetGroupKey);this.quote=t.reduceQuote(!1),e.addQuote("quote",this.quote),this.$.service.model=e.build(),this.quote=t.revertQuote()}},{key:"observers",get:function(){return["addLines(quote, productIds)"]}}]),r=e)),t("ProductRulesQuoteLineAdder",r),Polymer(r)}}}),System.register("common/services/sb-search-model-load/SearchModelLoader.js",["common/data/format/DataBuilder.js","common/aggregate/quote-line-aggregator/QuoteLineAggregator.js"],function(t,e){var o,r,i;return{setters:[function(e){o=e.DataBuilder},function(e){r=e.QuoteLineAggregator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SearchModelLoader",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-search-model-load",this.properties={quote:Object,sendQuoteRecord:{type:Boolean,value:!1},lineAggregationMethod:{type:String,value:null},processId:{type:String,value:null},actionId:{type:String,value:null},searchModel:{type:Object,notify:!0},filters:{type:Array},fieldSet:{type:String},error:{type:Array,notify:!0}}}},{key:"ready",value:function(){this.$.service.addEventListener("response-changed",function(e){this.searchModel=e.detail.value}.bind(this)),this.$.service.addEventListener("error-changed",function(e){e.detail.value&&(e.detail.value.validations?this.error=e.detail.value.validations:this.error=[e.detail.value.message]),console.log(e.detail)}.bind(this))}},{key:"load",value:function(){this.$.service.uid=null;var e=(new o).add("processId",this.processId).add("actionId",this.actionId).add("filters",this.filters).add("fieldSet",this.fieldSet);if(this.sendQuoteRecord?e.addObject("quote",this.quote.record):e.addQuote("quote",this.quote),this.lineAggregationMethod){var t=new r(this.quote);if(t[this.lineAggregationMethod]){var i=t[this.lineAggregationMethod]();i&&e.addObject("aggregateLineData",i,void 0,void 0,!0)}}this.$.service.context=e.build()}},{key:"observers",get:function(){return["load(quote, processId, actionId)"]}}]),i=e)),t("SearchModelLoader",i),Polymer(i)}}}),System.register("common/services/sb-search-model-select/SearchModelSelector.js",["common/data/format/DataBuilder.js"],function(t,e){var i,o;return{setters:[function(e){i=e.DataBuilder}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SearchModelSelector",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-search-model-select",this.properties={quote:Object,sendQuoteRecord:{type:Boolean,value:!1},stripQuoteLines:{type:Boolean,value:!1},selectedProducts:{type:Object,notify:!0},selectedProductList:Array,error:{type:Array,notify:!0},result:{type:Object,notify:!0},targetGroupKey:{type:Number,value:null},quoteProcess:{type:String,value:null},saver:String,background:{type:Boolean,value:!0},useCache:{type:Boolean,value:!0},usesClientCalculator:{type:Boolean,value:!1}}}},{key:"ready",value:function(){this.$.service.addEventListener("response-changed",function(e){this.result=e.detail.value}.bind(this)),this.$.service.addEventListener("error-changed",function(e){e.detail.value&&(e.detail.value.validations?this.error=e.detail.value.validations:this.error=[e.detail.value.message]),console.log(e.detail)}.bind(this))}},{key:"invokeSaver",value:function(){var e=[];for(var t in this.selectedProducts)e.push(this.selectedProducts[t]);this.selectedProductList=e}},{key:"_invokeSaver",value:function(){!0===this.useCache&&(this.$.service.uid=this.quote.record.Id.substring(0,15));var e=this.quote.lineItems,t=(new i).addObject("products",this.selectedProductList).add("targetGroupKey",this.targetGroupKey).addObject("quoteProcess",this.quoteProcess);this.sendQuoteRecord?t.addObject("quoteRecord",this.quote.record):(this.stripQuoteLines&&this.usesClientCalculator&&(this.quote.lineItems=[],this.quote.partialVO=0!=e.length),t.addQuote("quote",this.quote)),this.$.service.model=t.build(),this.quote.lineItems=e,this.quote.partialVO=!1}},{key:"observers",get:function(){return["invokeSaver(selectedProducts, quote)","_invokeSaver(selectedProductList)"]}}]),o=e)),t("SearchModelSelector",o),Polymer(o)}}}),System.register("products/config/message/ProductMessenger.js",["products/config/viewmodel/ProductViewModel.js","common/layout/fields/FieldSetHandler.js","common/core/sb-page-container/PageContainer.js"],function(e,t){var i,s,k,o;return{setters:[function(e){i=e.ProductViewModel},function(e){s=e.FieldSetHandler},function(e){k=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.quote=e,this.product=t,this.prefix=i,this.extender=o,this.currencyIsoCode=n,this.dynamicOptions=[],this.featureOptionIds=[],this.product&&!this.product.initialized&&this._initializeProduct(this.product),this.fieldSetHandler=new s(this.product.optionFieldSets,"OptionConfiguration","OptionConfigurationTablet","OptionConfigurationPhone"),this.defaultOptionPaths=["selected","record."+this.prefix+"Quantity__c"],this.additionalOptionPaths=[]}e("ProductMessenger",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(r,[{key:"getRequest",value:function(){var e={quote:this.quote.record};return this.product&&(e.product={configuredProductId:this.product.configuration.configuredProductId,lineItemId:this.product.configuration.lineItemId,lineKey:this.product.configuration.lineItemKey,configurationAttributes:this._createConfigAttributesMap(),optionConfigurations:this._createFeatureOptionsMap(),configurationData:{}},e.products=[],this._appendReadOnlyProperties(e,this.product.configuration)),e}},{key:"getResponse",value:function(e){if(e){var t=[];if(this.dynamicOptions=[],this.featureOptionIds=[],e.products)for(var i=0,n=e.products.length;i<n;i++)t.push(this._cloneProduct(i));this._extendResponseQuote(e.quote),this._extendResponseProduct(this.product,e.product);var o={quote:this.quote,product:this.product,products:this._extendResponseProducts(e.products,t),optionNotifications:this._getResponseOptionPaths()};return 0<this.dynamicOptions.length&&0<this.featureOptionIds.length&&(o.dynamicOptions=this.dynamicOptions,o.featureOptionIds=this.featureOptionIds),o}}},{key:"_appendReadOnlyProperties",value:function(e,t){e.readOnly={};var i=this._getMatchingQuoteLine(t);i&&(e.readOnly.line=i.record)}},{key:"_getMatchingQuoteLine",value:function(t){if(null==t||null==t.lineItemKey)return null;var e=this.quote.lineItems.filter(function(e){return e.key===t.lineItemKey}.bind(this));return 1===e.length?e[0]:null}},{key:"_createConfigAttributesMap",value:function(){for(var e={},t=0,i=this.product.configurationAttributes.length;t<i;t++)e[this.product.configurationAttributes[t].targetFieldName]=null;return this.extender.extend(e,this.product.configuration.configurationData),e}},{key:"_createFeatureOptionsMap",value:function(){for(var e={},t=this.product.features,i=0,n=t.length;i<n;i++){var o=t[i].record.Name;e[o]=[];var r=t[i]._transient_.optionConfigurations;delete t[i]._transient_.changedExternally,"Add"===t[i].optionSelectionMethod?this._mixInUnselectedOptionsToAdd(e[o],t[i].record.Id,r):r&&this._pushOptionConfigurations(e[o],r,"Click"===t[i].optionSelectionMethod)}return e}},{key:"_pushOptionConfigurations",value:function(e,t,i){for(var n=0,o=t.length;n<o;n++){var r=i?void 0:t[n].index;e.push(this._createPseudoOptionConfiguration(t[n],r))}i||e.push({productId:null,Quantity:1,configurationData:{}})}},{key:"_createPseudoOptionConfiguration",value:function(e,t){var i={optionId:e.record.Id,selected:e.selected,ProductCode:e.record[this.prefix+"ProductCode__c"],ProductName:e.record[this.prefix+"ProductName__c"],Quantity:e.record[this.prefix+"Quantity__c"],configurationData:{}};return void 0!==t&&(i.index=t),this._appendReadOnlyProperties(i,e),i}},{key:"_mixInUnselectedOptionsToAdd",value:function(n,o,r){var s=this;this.product.options.forEach(function(t){if((t.record[s.prefix+"Feature__c"]||"Other")===o){var e=r.filter(function(e){return e.record.Id===t.record.Id});if(e.length)for(var i=0;i<e.length;i++)n.push(s._createPseudoOptionConfiguration(e[i],e[i].index||i));else t.selected=!1,n.push(s._createPseudoOptionConfiguration(t,0))}})}},{key:"_extendResponseQuote",value:function(e){null!=e&&this.extender.extend(this.quote.record,this._sanitizeObject(e))}},{key:"_extendResponseProduct",value:function(e,t,i){t&&(this._extendResponseConfigurationData(e,t.configurationData),this._extendResponseConfigurationAttributes(e,t.configurationAttributes),this._extendResponseOptionConfigurations(e,t.optionConfigurations,i))}},{key:"_extendResponseConfigurationData",value:function(e,t){null!=t&&this.extender.extend(e.configuration.externalConfigurationData,this._sanitizeObject(t))}},{key:"_extendResponseConfigurationAttributes",value:function(e,t){null!=t&&this.extender.extend(e.configuration.configurationData,this._sanitizeObject(t))}},{key:"_extendResponseOptionConfigurations",value:function(i,e,n){var o=this,r=void 0,s={};for(var t in e){var a=e[t],l=!0,u=!1,d=void 0;try{for(var c,h=a[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var p=c.value,f=p.optionId;f?(s[f]=s[f]||[],s[f].push(p)):p.productId&&this._createDynamicOption(p,t)}}catch(e){u=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(u)throw d}}}var g=i.options,y=!0,v=!1,m=void 0;try{for(var b,_=function(){var t=b.value,e=s[t.record.Id];if(!e)return"continue";e.forEach(function(e){r||null==e.configurationData||(r=o.fieldSetHandler.getByViewport(k.getViewport()).fields),o._extendResponseOptionConfiguration(i,t,e,r,n)})},S=g[Symbol.iterator]();!(y=(b=S.next()).done);y=!0)_()}catch(e){v=!0,m=e}finally{try{!y&&S.return&&S.return()}finally{if(v)throw m}}}},{key:"_createDynamicOption",value:function(e,t){var i=this.product.features.find(function(e){return e.record.Name===t});this.featureOptionIds.push(i.record.Id+":"+e.productId),this.dynamicOptions.push({productId:e.productId,featureId:i.record.Id,Quantity:isNaN(e.Quantity)?1:e.Quantity,configurationData:e.configurationData})}},{key:"_extendResponseOptionConfiguration",value:function(e,t,i,n,o){o&&(t.parentProductKey=o);var r=t.record[this.prefix+"Feature__c"]||"Other",s=e.features.find(function(e){return e.record.Id===r});"Click"===s.optionSelectionMethod?this._setOptionDataForClickFeature(t,i,n):this._setOptionDataForNonClickFeature(t,i,n,s)}},{key:"_setOptionDataForClickFeature",value:function(e,t,i){null!=t.selected&&(e.selected=t.selected),this._extendQuantityAndConfigurationDataToOption(e,t,i)}},{key:"_setOptionDataForNonClickFeature",value:function(e,t,i,n){var o=n._transient_.optionConfigurations.find(function(e){return e.record.Id===t.optionId&&e.index===t.index});if(t.selected)if(o)this._extendQuantityAndConfigurationDataToOption(o,t,i);else{var r=this._createOptionConfigurationFromOption(e,t.index);this._extendQuantityAndConfigurationDataToOption(r,t,i),n._transient_.optionConfigurations.push(r),n._transient_.changedExternally=!0}else!t.selected&&o&&(o.selected=!1,n._transient_.changedExternally=!0)}},{key:"_createOptionConfigurationFromOption",value:function(e,t){var i=JSON.parse(JSON.stringify(e));return i.index=t,i.addedManually=!0,i.selected=!0,i.configured=!1,i}},{key:"_extendQuantityAndConfigurationDataToOption",value:function(e,t,i){null!=t.Quantity&&e.selected&&(e.record[this.prefix+"Quantity__c"]=t.Quantity),null!=t.configurationData&&this._extendConfigurationDataToOption(e,t,i)}},{key:"_extendConfigurationDataToOption",value:function(e,t,i){var n=this._sanitizeObject(t.configurationData),o={};for(var r in n){var s=n[r];if(-1!==i.indexOf(r)){e.record[r]=s;var a="record."+r;-1===this.additionalOptionPaths.indexOf(a)&&this.additionalOptionPaths.push(a)}else o[r]=s}e.externalConfigurationData=e.externalConfigurationData||{},this.extender.extend(e.externalConfigurationData,o)}},{key:"_extendResponseProducts",value:function(e,t){if(!e||0===e.length)return[];for(var i=[],n=0,o=e.length;n<o;n++){var r=t[n];this._extendResponseProduct(r,e[n],r.productKey),this._resetFeatureOptionConfiguration(r),i.push(r)}return i}},{key:"_cloneProduct",value:function(e){var t=JSON.parse(JSON.stringify(this.product));return t.productKey=this._buildProductKey(this.product.record.Id,e),this._enableSaveToLineEditor(t),t}},{key:"_buildProductKey",value:function(e,t){var i=(t<10?"00":t<100?"0":"")+t;return e.substring(0,15)+i}},{key:"_enableSaveToLineEditor",value:function(e){e.configuration.lineItemKey=null,delete e.configuration.lineItemId}},{key:"_resetFeatureOptionConfiguration",value:function(e){var t=e.features||[],i=!0,n=!1,o=void 0;try{for(var r,s=t[Symbol.iterator]();!(i=(r=s.next()).done);i=!0)r.value._transient_.optionConfigurations=[]}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}this._initializeProduct(e)}},{key:"_initializeProduct",value:function(e){var t=this.prefix.endsWith("__")?this.prefix.substring(0,this.prefix.length-2):this.prefix;new i(this.quote.record.Id,e,t,this.quote.record.CurrencyIsoCode)}},{key:"_getResponseOptionPaths",value:function(){var e=this.defaultOptionPaths.concat(this.additionalOptionPaths);return this.additionalOptionPaths=[],e}},{key:"_sanitizeObject",value:function(e){return JSON.parse(JSON.stringify(e,function(e,t){return e.endsWith("__c")&&t instanceof Object?JSON.stringify(t):t}))}}]),o=r)),e("ProductMessenger",o)}}}),System.register("products/config/search/ConfiguratorSearch.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.searchFilters=e,this.prefix=t,this.fieldTypes=i}e("ConfiguratorSearch",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"containsFeature",value:function(e){var t=this.searchFilters[this.prefix+"Feature__c"];return null==t||-1!==e.record.Name.toLowerCase().indexOf(t.toLowerCase())||void 0!==e.untranslatedRecord&&-1!==e.untranslatedRecord.Name.toLowerCase().indexOf(t.toLowerCase())}},{key:"hasVisibleOptions",value:function(e,t){if(0<e.length){for(var i=0,n=e.length;i<n;i++){if(!e[i].hidden)return!0;if(t&&t[e[i].record.Id])return!0}return!1}return!this.hasFilterValues()}},{key:"allOptionsHiddenByRule",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;if(!1===s.hiddenByRule||null==s.hiddenByRule)return!1}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return!0}},{key:"hasRequiredConfigAttributes",value:function(e,t){var i=t.configAttributesByFeatureId[e.record.Id];if(i){var n=!0,o=!1,r=void 0;try{for(var s,a=i[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)if(s.value.required)return!0}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}return!1}},{key:"hasConfigAttributes",value:function(e,t){return!!t.configAttributesByFeatureId[e.record.Id]}},{key:"setOptionVisibility",value:function(e){for(var t in this.searchFilters)""===this.searchFilters[t]&&(this.searchFilters[t]=null);for(var i=JSON.parse(JSON.stringify(e)),n=0,o=i.length;n<o;n++){var r=!1;if(void 0!==i[n].record[this.prefix+"UnitPrice__c"]){if(!i[n].isUpgrade){for(var s=Object.keys(this.searchFilters),a=0,l=s.length;a<l;a++){var u=s[a],d=this.searchFilters[u];if(u!==this.prefix+"Feature__c"&&(i[n].record[u]||r||(r=null!==d),null!==d&&i[n].record[u]&&-1===i[n].record[u].toLowerCase().indexOf(d.toLowerCase())&&(void 0===i[n].untranslatedRecord[u]||-1===i[n].untranslatedRecord[u].toLowerCase().indexOf(d.toLowerCase()))&&(r=!0,"multipicklist"===this.fieldTypes[u]))){var c=d.split(";"),h=i[n].record[u].split(";"),p=i[n].untranslatedRecord[u]?i[n].untranslatedRecord[u].split(";"):[],f=!0,g=!1,y=void 0;try{for(var v,m=c[Symbol.iterator]();!(f=(v=m.next()).done);f=!0){var b=v.value,_=!0,S=!1,k=void 0;try{for(var C,M=h[Symbol.iterator]();!(_=(C=M.next()).done);_=!0)if(-1!==C.value.indexOf(b)){r=!1;break}}catch(e){S=!0,k=e}finally{try{!_&&M.return&&M.return()}finally{if(S)throw k}}var I=!0,O=!1,E=void 0;try{for(var w,L=p[Symbol.iterator]();!(I=(w=L.next()).done);I=!0)if(-1!==w.value.indexOf(b)){r=!1;break}}catch(e){O=!0,E=e}finally{try{!I&&L.return&&L.return()}finally{if(O)throw E}}}}catch(e){g=!0,y=e}finally{try{!f&&m.return&&m.return()}finally{if(g)throw y}}}}i[n].hidden=i[n].hiddenByRule||r}}else i[n].hidden=!0}return i}},{key:"hasFilterValues",value:function(){for(var e in this.searchFilters)if(null!==this.searchFilters[e])return!0;return!1}}]),i=o)),e("ConfiguratorSearch",i)}}}),System.register("products/config/viewmodel/ProductViewModel.js",["products/localization/LocalizeFields.js","common/relationship/RelationshipFieldManager.js"],function(e,t){var S,l,i;return{setters:[function(e){S=e.LocalizeFields},function(e){l=e.RelationshipFieldManager}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.init(t,e,i,n,o)}e("ProductViewModel",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(r,[{key:"init",value:function(e,t,i,n,o){this.product=e||this.product,this.qId=t||this.qId,this.prefix=i?i+"__":this.prefix||"",this.currencyIsoCode=n||this.currencyIsoCode,this.featureLookupId=o||this.featureLookupId,this.optionsById={},this.optionIndexById={},this.optionsByFeatureId={},this.featuresWithOptionsOrConfigAttr=[],this.featureIdsWithOptionsOrConfigAttr={},this.featureIdsWithSelectionMethodAdd={},this.featureIdsWithSelectionMethodClick={},this.featureIdsWIthSelectionMethodDynamic={},this.configAttributesByFeatureId={},this.configurationAttributeValueMap={},this.configurationAttributeModelMap={},this.configurationAttributeTargetFieldMap={},this.configurationAttributeApplyToOptionMap={},this.attributeValueMap={},this.productRulesActions={},this.originalDataByOptionIds={},this.optionDataByOptionIds={},this.featureIdByOptionId={},this.productOptionConfigurationsMap={},this.initializeProduct(),this.product.initialized=!0}},{key:"getFeature",value:function(t){return void 0!==t&&"null"!==t||(t=null),this.product.features.find(function(e){return e.record.Id===t})}},{key:"getOption",value:function(e){return this.optionsById[e]}},{key:"getOptionsByFeatureId",value:function(e){if(null!==e&&"null"!==e||(e="Other"),this.isOptionLookupViewModel()){var i=[];return this.optionsByFeatureId[e].forEach(function(e){var t=JSON.parse(JSON.stringify(e));t.selected=!1,i.push(t)}),i}var t=this.getFeature(e),n=!0,o=!1,r=void 0;try{for(var s,a=t._transient_.optionConfigurations[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;this.isClickFeature(t)||(l.selected=!0)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return t._transient_.optionConfigurations}},{key:"maxOptionsMet",value:function(e){var t=this.prefix+"MaxOptionCount__c";return e._transient_.optionConfigurations.length>=e.record[t]}},{key:"setOptionSelected",value:function(e,t){var i=this.optionsById[e];this.featureIdsWithSelectionMethodClick[this.featureIdByOptionId[e]]&&!i.record[this.prefix+"Required__c"]&&(i.selected=t)}},{key:"setConfigurationAttributesToOptions",value:function(e){for(var t in this.configurationAttributeApplyToOptionMap)e.record[t]=this.product.configuration.configurationData[t]}},{key:"getOptionLayout",value:function(){var e=this.prefix+"OptionLayout__c";return this.product.record[e]||"Sections"}},{key:"getTabFeaturesMap",value:function(){var n=this,o=this.product.featureCategoryLabels,e=this.featuresWithOptionsOrConfigAttr.filter(function(e){return void 0===e.record[n.prefix+"Category__c"]}),r={};return this.featuresWithOptionsOrConfigAttr.length===e.length?this.featuresWithOptionsOrConfigAttr.forEach(function(e){r[e.record.Name]=[e]}):(this.product.featureCategories.forEach(function(i){n.featuresWithOptionsOrConfigAttr.forEach(function(e){var t=e.record[n.prefix+"Category__c"];void 0!==t&&t===o[i]&&(void 0!==r[i]?r[i].push(e):r[i]=[e])})}),0!==e.length&&(r.Other=r.Other||[],r.Other=r.Other.concat(e))),r}},{key:"checkAtLeastOneFeatureHasCategory",value:function(){var t=this;return!!this.featuresWithOptionsOrConfigAttr.find(function(e){return null!=e.record[t.prefix+"Category__c"]&&"Other"!==e.record[t.prefix+"Category__c"]})}},{key:"isAppliedImmediately",value:function(e){var t=this.prefix+"AppliedImmediately__c";return this.getOption(e).record[t]}},{key:"initializeProduct",value:function(){var n=this;this.localizer=new S(this.prefix),this.product=this.localizer.localizeProduct(this.product);var o=this.prefix+"Feature__c",e=[];this.featureLookupId||(this.initConfigAttributesById(),this.initConfigurationAttributeMap());var t=!0,i=!1,r=void 0;try{for(var s,a=this.product.options[Symbol.iterator]();!(t=(s=a.next()).done);t=!0){var l=s.value;this.initOptionInfo(l,e)}}catch(e){i=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw r}}this.buildOptionConfigurationMap();var u=!0,d=!1,c=void 0;try{for(var h,p=this.product.features[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){var f=h.value;f.optionSelectionMethod=this.getOptionSelectionMethod(f),f._transient_||(f._transient_={}),this.initFeatureOptionConfigurations(f),this.addFeaturesWithOptionsOrConfigAttr(f)}}catch(e){d=!0,c=e}finally{try{!u&&p.return&&p.return()}finally{if(d)throw c}}var g=!0,y=!1,v=void 0;try{for(var m,b=function(){var t=m.value,e=n.getFeature(t.record[o]||"Other"),i=void 0;"radio"===t.selectionType&&t.hidden&&e.visibleSelected&&(t.selected=!1),n.isAddFeature(e)&&((i=e._transient_.optionConfigurations.find(function(e){return e.record.Id===t.record.Id}))?(i.added=!0,i.configured=t.configured,n.setOptionDisabledData(i)):e._transient_.optionConfigurations.push(t),t.added=!0),n.setOptionDisabledData(t)},_=e[Symbol.iterator]();!(g=(m=_.next()).done);g=!0)b()}catch(e){y=!0,v=e}finally{try{!g&&_.return&&_.return()}finally{if(y)throw v}}}},{key:"initOptionInfo",value:function(e,t){var i=this.prefix+"Feature__c",n=this.prefix+"Quantity__c",o=this.prefix+"MinQuantity__c",r=this.prefix+"Selected__c",s=this.prefix+"Required__c",a=this.prefix+"UnitPrice__c",l=this.prefix+"ProductName__c",u=e.record[i]||"Other";this.setConfigurationAttributesToOptions(e),e.valueChanged=!1,e.record[a]=null==e.record[a]?void 0:e.record[a],e.hidden=e.hiddenByRule&&e.hidden||void 0===e.record[a],e.removed=e.removed||!1===e.selected&&e.record[r],e.selected=void 0===e.selected?e.record[r]&&!e.removed||e.record[s]:e.selected,e.name=e.record[l],e._transient_||(e._transient_={}),e.selected?null!=t&&t.push(e):this.setOptionDisabledData(e),!0===e.isUpgrade&&(e.hidden=!0),e.record[i]||this.product.mappedFeaturelessOptions||(this.product.features.push(this.createOtherOptionsFeature(this.product.virtualFeatureTitle)),this.product.mappedFeaturelessOptions=!0),void 0===e.record[n]&&(e.recordHasQuantity=!1,e.record[n]=void 0===e.record[o]?1:e.record[o]),e.record[s]&&(e.required=!0),this.product._transient_&&this.product._transient_.attributeSet&&this.product._transient_.attributeSet.attributeItemIdsByOptionId[e.record.Id]&&(this.product._transient_.hasAttributeItems=!0,this.addAttributeItems(e,this.product._transient_.attributeSet)),this.optionsById[e.record.Id]=e,this.featureIdByOptionId[e.record.Id]=u,this.addToOptionByFeatureId(u,e),this.originalDataByOptionIds[e.record.Id]={unitPrice:e.record[this.prefix+"UnitPrice__c"],discountAmount:e.record[this.prefix+"DiscountAmount__c"],discountRate:e.record[this.prefix+"Discount__c"],quantity:e.record[n]}}},{key:"createOtherOptionsFeature",value:function(e){return{addOptionButtonLabel:"Add Option",addOptionDialogTitle:"Add Option",instructionsText:null,record:{Id:"Other",Name:e},searchFilters:null}}},{key:"addAttributeItems",value:function(e,t){var i=!0,n=!(e._transient_.attributeItems={}),o=void 0;try{for(var r,s=t.attributeItemIdsByOptionId[e.record.Id][Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l=t.attributeItemById[a].targetFieldName;e._transient_.attributeItems[l]=e.record[l]}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}e._transient_.optionDrawerExpanded=!1,e._transient_.drawerIconClass="sf-icon-chevronright"}},{key:"getOptionSelectionMethod",value:function(e){return null!=e.record[this.prefix+"OptionSelectionMethod__c"]?e.record[this.prefix+"OptionSelectionMethod__c"]:null!=this.product.record[this.prefix+"OptionSelectionMethod__c"]?this.product.record[this.prefix+"OptionSelectionMethod__c"]:"Click"}},{key:"setOptionDisabledData",value:function(e,t){e.disabledData=e.disabledData||{disabled:!!e.record[this.prefix+"Required__c"]&&!e.added||!!e.record[this.prefix+"System__c"],constrained:!1},t&&(this.optionsById[e.record.Id].disabledData={disabled:!1,constrained:!1},e.disabledData.disabled=!1)}},{key:"initFeatureOptionConfigurations",value:function(e){if(null==e._transient_.optionConfigurations&&(e._transient_.optionConfigurations=[]),null!=this.optionsByFeatureId[e.record.Id]){var t=1===e.record[this.prefix+"MaxOptionCount__c"],i=0===e._transient_.optionConfigurations.length,n=e.record.Id||"Other",o=[],r=!0,s=!1,a=void 0;try{for(var l,u=this.optionsByFeatureId[n][Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var d=l.value;e.visibleSelected=e.visibleSelected||!d.hidden&&d.selected,d.selectionType=t?"radio":"checkbox",d.record[this.prefix+"ConfiguredSKU__c"]=this.product.record.Id,this.isDynamicFeature(e)&&!e._transient_.changedExternally&&(d.selected=!0,d.added=!0),this.featureLookupId?d._transient_.rowActions=[]:(null!=d._transient_.rowActions&&0!==d._transient_.rowActions.length&&!e._transient_.changedExternally||this.initOptionActions(d,!this.isClickFeature(e)),this.initReconfiguredOption(d,e,i,o))}}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}0<o.length&&this.sortAndAddOptionConfigs(e,o)}}},{key:"buildOptionConfigurationMap",value:function(){if(this.product.features[0]&&null==this.product.features[0]._transient_){var e=!0,t=!1,i=void 0;try{for(var n,o=this.product.configuration.optionConfigurations[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value,s=r.optionId;this.productOptionConfigurationsMap[s]=this.productOptionConfigurationsMap[s]||[],this.productOptionConfigurationsMap[s].push(r)}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}}},{key:"initOptionActions",value:function(e,t){var i=[];t&&i.push(this.createOptionAction("sf-icon-delete","Delete","left",!0,!1,!1,"delete-tapped")),this.addOptionConfigurationAction(e,i),e._transient_.rowActions=i}},{key:"addOptionConfigurationAction",value:function(e,t){var i=e.configurable?e.configurationRequired:void 0;t.push(this.createOptionAction("sf-icon-custom_apps","Configure","left",!1,!1,!1,"configure-tapped",i))}},{key:"createOptionAction",value:function(e,t,i,n,o,r,s,a){return{icon:e,title:t,position:i,mobileDisabled:n,hidden:o,invisible:r,configurationRequired:a,onTapFunction:function(){this.fire(s,{Id:this.data.record.Id,index:this.index})}}}},{key:"addToOptionByFeatureId",value:function(e,t){this.optionsByFeatureId[e]=this.optionsByFeatureId[e]||[],this.optionsByFeatureId[e].push(t)}},{key:"initConfigAttributesById",value:function(){for(var e=this.product.configurationAttributes,t=e.length,i=0;i<t;i++)null===e[i].featureId?this.configAttributesByFeatureId.featureless?this.configAttributesByFeatureId.featureless.push(e[i]):this.configAttributesByFeatureId.featureless=[e[i]]:this.configAttributesByFeatureId[e[i].featureId]?this.configAttributesByFeatureId[e[i].featureId].push(e[i]):this.configAttributesByFeatureId[e[i].featureId]=[e[i]]}},{key:"initConfigurationAttributeMap",value:function(){for(var e=this.product.configurationAttributes,t=e.length,i=this.product.configuration.configurationData,n=0;n<t;n++){var o=e[n].targetFieldName;this.attributeValueMap[e[n].targetFieldName]="";var r=new l(o,i).getRelationshipName()||i[o];this.configurationAttributeValueMap[e[n].myId]=void 0!==r?r:null;var s=this.product.productKey||this.product.record.Id;this.configurationAttributeModelMap[e[n].myId]={targetFieldName:e[n].targetFieldName,value:r,required:e[n].required,hidden:e[n].hidden,myId:e[n].myId,bundleId:s,autoSelect:e[n].autoSelect,shownValues:e[n].shownValues,hiddenValues:e[n].hiddenValues};var a=this.configurationAttributeTargetFieldMap[e[n].targetFieldName]||[];a.push(e[n].myId),this.configurationAttributeTargetFieldMap[e[n].targetFieldName]=a,!0===e[n].applyToProductOptions&&void 0===this.configurationAttributeApplyToOptionMap[e[n].targetFieldName]&&(this.configurationAttributeApplyToOptionMap[e[n].targetFieldName]=!0)}}},{key:"initReconfiguredOption",value:function(e,t,i,n){var o=this.productOptionConfigurationsMap[e.record.Id];if(!o||e.removed)return i&&this.isClickFeature(t)?t._transient_.optionConfigurations.push(e):void 0;if(this.isAddFeature(t))this.cloneOptionAndSyncConfiguration(e,n);else{var r=o[0];e.index=0,this.syncOptionToConfigData(e),this.setPropertiesWithConfig(e,r),i&&(this.isClickFeature(t)?t._transient_.optionConfigurations.push(e):n.push(e))}}},{key:"cloneOptionAndSyncConfiguration",value:function(e,t){for(var i=this.productOptionConfigurationsMap[e.record.Id],n={},o=0;o<i.length;o++){var r=i[o],s=JSON.parse(JSON.stringify(e));s._transient_.rowActions=e._transient_.rowActions,!0===n[s.record.Id]?s.required=!1:n[s.record.Id]=!0,s.index=o,this.syncOptionToConfigData(s),this.setPropertiesWithConfig(s,r),t.push(s)}}},{key:"linkDynamicOptionToConfig",value:function(e,t,i){return this.productOptionConfigurationsMap[t.optionId]=[t],e.record.Id=t.optionId,this.productOptionConfigurationsMap[i].shift(),0===this.productOptionConfigurationsMap[i].length&&delete this.productOptionConfigurationsMap[i],this.productOptionConfigurationsMap[t.optionId][0]}},{key:"syncOptionToConfigData",value:function(e){var t=this.getProductOptionConfigurationData(e.record.Id,e.index);if(void 0!==t)for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}},{key:"getProductOptionConfigurationData",value:function(e,t){return void 0===this.productOptionConfigurationsMap[e][t]&&this.buildOptionConfigurationMap(),this.productOptionConfigurationsMap[e][t]}},{key:"setPropertiesWithConfig",value:function(e,t){for(var i in e.selected=!1!==e.selected,t.optionData)"attributes"!==i&&(e.record[i]=t.optionData[i]);e.dynamicOptionKey=t.dynamicOptionKey}},{key:"getHasUpgradeOptions",value:function(e){if("Other"!==e.record.Id)return e.containsUpgrades;for(var t=0;t<e._transient_.optionConfigurations.length;t++)if(!0===e._transient_.optionConfigurations[t].isUpgrade)return!0;return!1}},{key:"sortAndAddOptionConfigs",value:function(e,t){var i=this,n=void 0,o=!0,r=!1,s=void 0;try{for(var a,l=function(){var t=a.value;t&&(i.isAddFeature(e)&&(t.added=!0,n=!!e._transient_.optionConfigurations.filter(function(e){return e.record.Id===t.record.Id})),i.setOptionDisabledData(t,n),e._transient_.optionConfigurations.push(t))},u=t[Symbol.iterator]();!(o=(a=u.next()).done);o=!0)l()}catch(e){r=!0,s=e}finally{try{!o&&u.return&&u.return()}finally{if(r)throw s}}}},{key:"createConstraintsHoverMessages",value:function(e){this.optionConstraintsByConstrained=e;var t=!0,i=!1,n=void 0;try{for(var o,r=this.product.options[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this.createConstraintHoverMessage(s)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"createConstraintHoverMessage",value:function(e){if(this.optionConstraintsByConstrained[e.record.Id]){var s=this.optionConstraintsByConstrained[e.record.Id],a={Requires:[],Excludes:[]},t=[];if(s.ungroupedConstraints.forEach(function(e){var t="Dependency"===e.type?"Requires":"Excludes",i="Dependency"===e.type?"or ":"and ",n=a[t].length?i:t+": ",o=this.optionsById[e.option].record[this.prefix+"ProductName__c"];a[t].push(n+o)}.bind(this)),Object.keys(s.groups).forEach(function(e,t){var i=s.groups[e],n="Dependency"===i.type?"Requires":"Excludes",o=a[n].length?0==t&&s.ungroupedConstraints[0]?"and ":"or ":n+": ",r="";i.options.forEach(function(e,t){var i=this.optionsById[e].record[this.prefix+"ProductName__c"];r+=(o=0===t?o:" and ")+i}.bind(this)),a[n].push(r)}.bind(this)),a.Requires.length){var i=!0,n=!1,o=void 0;try{for(var r,l=a.Requires[Symbol.iterator]();!(i=(r=l.next()).done);i=!0){var u=r.value;t.push(u)}}catch(e){n=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(n)throw o}}}if(a.Excludes.length){var d=!0,c=!1,h=void 0;try{for(var p,f=a.Excludes[Symbol.iterator]();!(d=(p=f.next()).done);d=!0){var g=p.value;t.push(g)}}catch(e){c=!0,h=e}finally{try{!d&&f.return&&f.return()}finally{if(c)throw h}}}e.constraintMessage=t}}},{key:"optionSystemOrRequired",value:function(e){var t=this.optionsById[e];return t.record[this.prefix+"System__c"]||t.record[this.prefix+"Required__c"]}},{key:"isOptionLookupViewModel",value:function(){return!!this.featureLookupId}},{key:"isClickFeature",value:function(e){return"Click"===e.optionSelectionMethod}},{key:"isAddFeature",value:function(e){return"Add"===e.optionSelectionMethod}},{key:"isDynamicFeature",value:function(e){return"Dynamic"===e.optionSelectionMethod}},{key:"addFeaturesWithOptionsOrConfigAttr",value:function(e){(this.optionsByFeatureId[e.record.Id]||this.configAttributesByFeatureId[e.record.Id]||this.isDynamicFeature(e))&&(this.featuresWithOptionsOrConfigAttr.push(e),this.featureIdsWithOptionsOrConfigAttr[e.record.Id]=e,this.isClickFeature(e)?this.featureIdsWithSelectionMethodClick[e.record.Id]=!0:this.isAddFeature(e)?this.featureIdsWithSelectionMethodAdd[e.record.Id]=!0:this.isDynamicFeature(e)&&(this.featureIdsWIthSelectionMethodDynamic[e.record.Id]=!0))}}]),i=r)),e("ProductViewModel",i)}}}),System.register("products/resources/optionConstraints/OptionConstraintsHandler.js",[],function(e,t){var o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.product=e,this.prefix=t,this.messages={},this.setOptionConstraints()}e("OptionConstraintsHandler",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"setOptionConstraints",value:function(){var s=this;if(!this.product.constraints)return null;var a=this.prefix+"Type__c",l=this.prefix+"ConstrainedOption__c",u=this.prefix+"ConstrainingOption__c",d=this.prefix+"OptionConstraintGroup__c",c={byConstraining:{},byConstrained:{},constrainingByConstrained:{}};this.product.constraints.forEach(function(e){var t=e.record[a],i=e.record[l],n=e.record[u],o=e.record[d]?e.record[d].split(", "):null;c.byConstraining[n]?c.byConstraining[n].push({type:t,option:i}):c.byConstraining[n]=[{type:t,option:i}],c.byConstrained[i]?o?o.forEach(function(e){c.byConstrained[i].groups[e]?c.byConstrained[i].groups[e].options.push(n):c.byConstrained[i].groups[e]={type:t,options:[n]}}):c.byConstrained[i].ungroupedConstraints.push({type:t,option:n}):(c.byConstrained[i]={ungroupedConstraints:[],groups:{}},o?o.forEach(function(e){c.byConstrained[i].groups[e]?c.byConstrained[i].groups[e].options.push(n):c.byConstrained[i].groups[e]={type:t,options:[n]}}):c.byConstrained[i].ungroupedConstraints=[{type:t,option:n}]),"Exclusion"!==t||o||(c.byConstraining[i]?c.byConstraining[i].push({type:t,option:n}):c.byConstraining[i]=[{type:t,option:n}],c.byConstrained[n]?c.byConstrained[n].ungroupedConstraints.push({type:t,option:i}):c.byConstrained[n]={ungroupedConstraints:[{type:t,option:i}],groups:{}});var r=c.constrainingByConstrained[i]||[];r.push(s.getOption(n)),c.constrainingByConstrained[i]=r}),this.optionConstraints=c}},{key:"handleOptionConstraints",value:function(r,e){var s=this;if(this.optionConstraints&&this.optionConstraints.byConstraining[r]){var a=[],l=e||this.getOption(r).added;return this.getOption(r).selected=e,this.optionConstraints.byConstraining[r].forEach(function(e){var t=s.optionIsConstrained(e,r,l),i=s.getOption(e.option),n=i.selected,o=i._transient_&&i._transient_.rendered;a.push({optionId:e.option,disabledState:t,selected:n,rendered:o})}),a}}},{key:"getUnrenderedConstraining",value:function(e){return(this.optionConstraints.constrainingByConstrained[e]||[]).filter(function(e){return!e._transient_||!e._transient_.rendered})}},{key:"optionIsConstrained",value:function(e,t,i){var n=e.type,o=this.optionConstraints.byConstrained[e.option],r=0<Object.keys(o.groups).length,s=this.isConstrainedByUngrouped(o);return!!s.constrained||(r?this.isConstrainedByGrouped(o.groups):this.getUnaffectedDisabledState(t,i,"Dependency"===n,s.requiredConditionMet))}},{key:"isConstrainedByUngrouped",value:function(e){for(var t=!1,i=!1,n=!1,o=e.ungroupedConstraints,r=o?o.length:-1,s=0;!t&&s<r;){var a=this.getOption(o[s].option),l=o[s].type;"Exclusion"===l?t=this.isSelected(a):"Dependency"!==l||n||(i=!(n=this.isSelected(a))),s++}return{constrained:t||i,requiredConditionMet:n}}},{key:"isConstrainedByGrouped",value:function(e){for(var t=!1,i=!0,n=!1,o=Object.keys(e).length,r=0;r<o;){var s=!1,a=e[Object.keys(e)[r]],l=a.type,u=a.options,d=u.length,c=0;if("Dependency"===l&&i&&!n){for(;!s&&c<d;){var h=this.getOption(u[c]);(s=!this.isSelected(h))||c!==d-1||(i=!1),c++}t=i}if("Exclusion"===l&&!n){for(;!s&&c<d;){var p=this.getOption(u[c]);(s=!this.isSelected(p))||c!==d-1||(n=!0),c++}t=n}r++}return t}},{key:"getOption",value:function(t){return this.product.options.find(function(e){return e.record.Id===t})}},{key:"isSelected",value:function(e){return e&&(e.selected||e.added||!!e.priorOptionExists)}},{key:"getUnaffectedDisabledState",value:function(e,t,i,n){return i?!n&&!(t||this.getOption(e).priorOptionExists):t||!!this.getOption(e).priorOptionExists}},{key:"optionShouldBeDisabled",value:function(t){var e,i,n,o,r=this.optionConstraints.byConstrained[t],s=void 0;if(!r)return!1;if(e=1<=r.ungroupedConstraints.length,i=1<=Object.keys(r.groups).length,e)s=r.ungroupedConstraints[0].option;else{if(!i)return!1;s=r.groups[Object.keys(r.groups)[0]].options[0]}return n=this.isSelected(this.getOption(s)),o=this.optionConstraints.byConstraining[s].find(function(e){return e.option===t}),this.optionIsConstrained(o,s,n)}}]),o=i)),e("OptionConstraintsHandler",o)}}}),System.register("products/resources/optionUpgrades/OptionUpgradeHandler.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.prefix=e,this.options=t,this.option=i}e("OptionUpgradeHandler",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"isSourceLine",value:function(){return null!=this.option.priorBundledQuantity}},{key:"getLine",value:function(){return this.option}},{key:"getLines",value:function(){return this.options}},{key:"getSourceOrUpgrade",value:function(e,t){for(var i=0;i<this.options.length;i++){var n=e||this.options[i],o=t||this.options[i];if(o.sourceProductIds&&-1!=o.sourceProductIds.indexOf(n.record[this.prefix+"OptionalSKU__c"]))return this.options[i]}}},{key:"setSourceAndUpgrade",value:function(e,t){this.sourceOption=e,this.upgradeOption=t}},{key:"getSourceIdField",value:function(){return this.prefix+"OptionalSKU__c"}},{key:"getUpgradeConversionRateField",value:function(){return this.prefix+"UpgradeConversionRate__c"}},{key:"getSourceCurrentQuantityField",value:function(e){return e.selected?e.record[this.prefix+"Quantity__c"]:0}},{key:"getUpgradeCurrentQuantityField",value:function(e){return e.selected?e.record[this.prefix+"Quantity__c"]:0}},{key:"getSourcePriorQuantity",value:function(e){return e.priorBundledQuantity}},{key:"didSourceQuantityChange",value:function(e,t,i){return i.selected&&(e||!t.selected)}},{key:"didUpgradeQuantityChange",value:function(e,t){return t.selected&&!e}},{key:"isSelected",value:function(e){return e.selected}},{key:"setUpdatedQuantity",value:function(e,t,i,n){e.selected&&(e.record[this.prefix+"Quantity__c"]=i),t.selected&&(t.record[this.prefix+"Quantity__c"]=n)}},{key:"getSourceOption",value:function(){return this.sourceOption}},{key:"getUpgradeOption",value:function(){return this.upgradeOption}},{key:"setUpgradedAssetId",value:function(){var e=this.getSourceOrUpgrade(null,this.option);this.option.upgradedAssetId=e.upgradedAssetId}}]),i=o)),e("OptionUpgradeHandler",i)}}}),System.register("products/resources/reconfigure/ProductReconfigurer.js",["../model/nestedOptions/NestedOptionsModel.js"],function(e,t){var f,i;return{setters:[function(e){f=e.NestedOptionsModel}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.product=e,this.product.quoteType=t}e("ProductReconfigurer",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"reconfigure",value:function(e){var t={};if(e?this.product.configuration=e:this.product.nestedOptionModel=this.product.nestedOptionModel||new f(this.product.configuration,!0),this.product.configuration.optionConfigurations.length){this.buildOptionConfiguration(this.product.configuration.optionConfigurations,t);var i=!0,n=!1,o=void 0;try{for(var r,s=this.product.options[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t[a.record.Id]?(a.isDynamicOption=t[a.record.Id].isDynamicOption,a.upgradedAssetId=t[a.record.Id].upgradedAssetId,a.priorBundledQuantity=t[a.record.Id].priorBundledQuantity,!0!==t[a.record.Id].configured&&!t[a.record.Id].optionConfigurations||(a.configured=!0)):a.selected=!0===a.selected}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}}else{var l=!0,u=!1,d=void 0;try{for(var c,h=this.product.options[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var p=c.value;p.configuration&&delete p.configuration}}catch(e){u=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(u)throw d}}}}},{key:"buildOptionConfiguration",value:function(e,t){for(var i={},n=0;n<e.length;n++){var o=e[n];!0!==i[o.optionId]&&(o.isSegmented&&(i[o.optionId]=!0),t[o.optionId]=this.buildStrippedOptionData(o,n))}}},{key:"buildStrippedOptionData",value:function(e,t){if(0===e.optionConfigurations.length){var i=o.newConfiguration(e.optionId,e.optionData,e.isDynamicOption,t);return i.configured=e.configured,"Amendment"===this.product.quoteType&&(i.upgradedAssetId=e.upgradedAssetId,i.priorBundledQuantity=e.priorBundledQuantity),i}var n=0<e.optionConfigurations.length;return{optionId:e.optionId,optionData:e.optionData,optionConfigurations:n,index:t}}}],[{key:"newConfiguration",value:function(e,t,i,n){return{optionId:e,optionData:t,isDynamicOption:i,index:n}}}]),i=o)),e("ProductReconfigurer",i)}}}),System.register("products/resources/rules/RuleProcessor.js",["common/core/AppContext.js","../model/nestedOptions/NestedOptionsModel.js"],function(e,t){var o,r;return{setters:[function(e){o=e.AppContext},function(e){e.NestedOptionsModel}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.prefix=o.org.prefix?o.org.prefix+"__":"",this.data=e,this.product=t,this.validationMessages=[],this.productRulesActions={},this.optionDataByOptionIdAndIndex={}}e("RuleProcessor",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"getValidationMessages",value:function(){return this.validationMessages}},{key:"getProductRulesActions",value:function(){return this.productRulesActions}},{key:"getOptionDataByOptionIdAndIndex",value:function(){return this.optionDataByOptionIdAndIndex}},{key:"init",value:function(e){this.initValidationMessages(),this.product&&(this.initProductRulesActions(),this.initDescendantTree(e),this.initOptionDataByOptionIdAndIndex())}},{key:"initValidationMessages",value:function(){if(this.data.validationMessages){var e=!0,t=!1,i=void 0;try{for(var n,o=this.data.validationMessages[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value;this.validationMessages.push(r)}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}else{var s=!0,a=!1,l=void 0;try{for(var u,d=this.data.configuredProducts[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var c=u.value,h=!0,p=!1,f=void 0;try{for(var g,y=c.configuration.validationMessages[Symbol.iterator]();!(h=(g=y.next()).done);h=!0)r=g.value,this.validationMessages.push(r)}catch(e){p=!0,f=e}finally{try{!h&&y.return&&y.return()}finally{if(p)throw f}}}}catch(e){a=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(a)throw l}}}}},{key:"initProductRulesActions",value:function(e){var t={},i={},n={},o={},r={},s={},a={},l={},u={},d=!0,c=!1,h=void 0;try{for(var p,f=this.data.optionConfigurations[Symbol.iterator]();!(d=(p=f.next()).done);d=!0){var g=p.value;t[g.optionData.Id||g.optionId]=!0}}catch(e){c=!0,h=e}finally{try{!d&&f.return&&f.return()}finally{if(c)throw h}}if(null!=this.data.disabledOptionIds){var y=!0,v=!1,m=void 0;try{for(var b,_=this.data.disabledOptionIds[Symbol.iterator]();!(y=(b=_.next()).done);y=!0)i[b.value]=!0}catch(e){v=!0,m=e}finally{try{!y&&_.return&&_.return()}finally{if(v)throw m}}}if(null!=this.data.hiddenOptionIds){var S=!0,k=!1,C=void 0;try{for(var M,I=this.data.hiddenOptionIds[Symbol.iterator]();!(S=(M=I.next()).done);S=!0)n[M.value]=!0}catch(e){k=!0,C=e}finally{try{!S&&I.return&&I.return()}finally{if(k)throw C}}}if(e)return this.assignProductRules(t,i,n);var O=!0,E=!1,w=void 0;try{for(var L,D=this.product.options[Symbol.iterator]();!(O=(L=D.next()).done);O=!0){var T=L.value;this.optionNotInPricebook(T)||(this.handleProductActions(n,T,s,a,"hiddenByRule"),this.handleProductActions(i,T,l,u,"disabled"),this.handleProductActions(t,T,r,o,"selected"))}}catch(e){E=!0,w=e}finally{try{!O&&D.return&&D.return()}finally{if(E)throw w}}this.productRulesActions={showOptions:s,hideOptions:a,selectOptions:o,deselectOptions:r,enableOptions:l,disableOptions:u}}},{key:"initOptionDataByOptionIdAndIndex",value:function(){for(var e=this.data.optionConfigurations,t=0;t<e.length;t++){var i=e[t];void 0===this.optionDataByOptionIdAndIndex[i.optionId]&&(this.optionDataByOptionIdAndIndex[i.optionId]={}),this.optionDataByOptionIdAndIndex[i.optionId][i.index]={optionData:i.optionData,listPrice:i.listPrice}}}},{key:"handleProductActions",value:function(e,t,i,n,o){return"disabled"===o?e[t.record.Id]&&t.disabledData&&!t.disabledData.disabled?n[t.record.Id]=!0:!e[t.record.Id]&&t.disabledData&&t.disabledData.disabled?i[t.record.Id]=!0:void 0:e[t.record.Id]&&!t[o]?n[t.record.Id]=!0:!e[t.record.Id]&&t[o]?i[t.record.Id]=!0:void 0}},{key:"assignProductRules",value:function(e,t,i){this.prefix;var n=this.product.rulesProcessed=!0,o=!1,r=void 0;try{for(var s,a=this.product.options[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;this.optionNotInPricebook(l)||(l.selected=l.selectedByRule=!!e[l.record.Id],t[l.record.Id]&&(l.disabledData={disabled:!0,constrained:!1}),i[l.record.Id]&&(l.hidden=!0,l.hiddenByRule=!0))}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}},{key:"initDescendantTree",value:function(e){var t=0<arguments.length&&void 0!==e?e:this.product.nestedOptionModel;if(t)for(var i={},n=0;n<this.data.optionConfigurations.length;n++){var o=this.data.optionConfigurations[n];i[o.optionId]=void 0===i[o.optionId]?0:i[o.optionId]+1;var r={optionId:this.data.optionId,index:this.data.index||0},s={optionId:o.optionId,index:i[o.optionId]};o.index=i[o.optionId],t.handleDescendantRules([r,s],o.optionConfigurations,o.hiddenOptionIds,o.disabledOptionIds)}else console.log&&console.warn("Skipped descendant level rules",this.product)}},{key:"optionNotInPricebook",value:function(e){return void 0===e.record[this.prefix+"UnitPrice__c"]||null==e.record[this.prefix+"UnitPrice__c"]}}]),r=i)),e("RuleProcessor",r)}}}),System.register("products/resources/sb-product-alert/ProductAlert.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ProductAlert",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-product-alert",this.properties={alerts:Array,continueCB:Object,cancelCB:Object,displayContinueButton:{type:Boolean,value:!1}}}},{key:"ready",value:function(){this.$.dialog.addEventListener("sb-close-dialog",this._onCancel.bind(this))}},{key:"init",value:function(){this.$.dialog.toggle()}},{key:"onRevise",value:function(){this.$.dialog.toggle()}},{key:"toggle",value:function(){this.$.dialog.toggle()}},{key:"onContinue",value:function(){"function"==typeof this.continueCB&&this.continueCB()}},{key:"_onCancel",value:function(){"function"==typeof this.cancelCB&&this.cancelCB(),this.$.dialog.toggle()}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["init(alerts)"]}}]),i=e)),t("ProductAlert",i),Polymer(i)}}}),System.register("products/resources/tree/ConfigTree.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.root=e,this.idProperties=["optionId","index"],this.buildSubtree(this.root)}e("ConfigTree",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"buildSubtree",value:function(e){var t=this,i={};this._buildNode(e),e.getChildren(e).forEach(function(e){i[e.optionId]=i[e.optionId]||e.index||0,void 0!==e.index&&i[e.optionId]!==e.index||(e.index=i[e.optionId],i[e.optionId]++),t.buildSubtree(e)})}},{key:"getFromPath",value:function(e){for(var t=this.root,i=0,n=e.length;i<n;i++)t=this._findOnLevel(e[i],t);return t}},{key:"_buildNode",value:function(e){e.nodeId=this._buildId(e),e.getChildren=function(){return this.optionConfigurations}.bind(e)}},{key:"_buildId",value:function(e){var t="",i=!0,n=!1,o=void 0;try{for(var r,s=this.idProperties[Symbol.iterator]();!(i=(r=s.next()).done);i=!0)t+="_"+e[r.value]}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t}},{key:"_findOnLevel",value:function(e,t){var i=e.constructor===String?e:this._buildId(e);return(t=t||this.root).getChildren().find(function(e){return e.nodeId===i})}}]),i=t)),e("ConfigTree",i)}}}),System.register("quotes/dialogs/sb-clone-to-group-dialog/CloneToGroupDialog.js",["../../../common/core/Page.js"],function(t,e){var i,o;return{setters:[function(e){i=e.Page}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("CloneToGroupDialog",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-clone-to-group-dialog",this.properties=Polymer.Base.extend({quoteModel:Object},i.properties)}},{key:"ready",value:function(){var e=this;Polymer.RenderStatus.afterNextRender(this,function(){e.addEventListener("sb-cancel-clone-to-group",e.onCancel)})}},{key:"open",value:function(){this.lineGroups=this.quoteModel.lineGroups,this.$.dialog.toggle();for(var e=[],t=0,i=this.lineGroups.length;t<i;t++)e.push({value:this.lineGroups[t].groupKey,label:this.lineGroups[t].groupVO.record.Name,selected:!1});this.groups=e,this.isMobile||(this.availableGroupTitle=this.i18n.l("Available Groups"),this.chosenGroupTitle=this.i18n.l("Selected Groups"))}},{key:"onSave",value:function(){this.isMobile?(this.selectedGroups=this._getSelectedGroups(),this.fire("sb-clone-to-group-selected",this.selectedGroups),this.groups=void 0):this.fire("sb-clone-to-group-selected",this.selectedGroups),this.$.dialog.toggle()}},{key:"onCancel",value:function(){this.$.dialog.toggle(),this.isMobile&&(this.groups=void 0)}},{key:"_getSelectedGroups",value:function(){for(var e=[],t=0,i=this.groups.length;t<i;t++)this.groups[t].selected&&e.push(this.groups[t]);return e}},{key:"toggleSelectedClass",value:function(e){var t=e.currentTarget,i=t.classList.contains("backgroundContainer"),n=t.dataIndex;this.set("groups."+n+".selected",!i),this.toggleClass("backgroundContainer",!i,t)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),o=e)),t("CloneToGroupDialog",o),Polymer(o)}}}),System.register("quotes/dialogs/sb-custom-segment-dialog/CustomSegmentDialog.js",["quotes/models/LineModel.js","quotes/models/DragDropModel.js","common/layout/tables/TableClassBuilder.js","common/core/sb-page-container/PageContainer.js","common/core/AppContext.js"],function(t,e){var l,d,i,s,o;function a(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}return{setters:[function(e){l=e.LineModel},function(e){e.DragDropModel},function(e){d=e.TableClassBuilder},function(e){i=e.PageContainer},function(e){s=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}410,180," visibilityHidden",t("CustomSegmentDialog",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-custom-segment-dialog",this.properties={dataLineModels:Array,lineModels:{type:Array},groupModel:{type:Object},deletedLineKeys:{type:Array,value:[]},errors:{type:Array,value:[],notify:!0},viewport:{type:Object,value:function(){return i.getViewport()}},headerActions:Array,headerSelected:{type:Boolean,value:!1}}}},{key:"ready",value:function(){this.isMobile=this._isMobileViewport()}},{key:"_findTableRowValidTarget",value:function(e){return e?this._ifParentIsValidTarget(e)?e:e.parentNode?this._findTableRowValidTarget(e.parentNode):null:null}},{key:"_ifParentIsValidTarget",value:function(e){return!!e.parentElement&&"swipe-header"==e.parentElement.id&&(this.targetRowElement=e.parentElement.parentElement,!0)}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport;var t=this.dragDrop?this.dragDrop.segmentRows:null;if(t)if(this._isMobileViewport()||!s.isDesktop)for(var i=0,n=t.length;i<n;i++)t[i].removeEventListener("track",this.onTrack.bind(this));else for(var o=0,r=t.length;o<r;o++)t[o].addEventListener("track",this.onTrack.bind(this));return this.viewport&&this.viewport.isMobile()}},{key:"_dataChanged",value:function(){if(this.dataLineModels){this.groupModel=this.dataLineModels[0].groupModel,this.editorModel=this.groupModel.quoteModel.editorModel;var e=[],t=void 0,i=this.dataLineModels.length,n={};for(t=0;t<i;t++){var o=this.dataLineModels[t],r=JSON.parse(JSON.stringify(o.lineVO)),s=new l(r,this.groupModel);s.selected=!1,n[s.lineVO.record[this.constants.START_DATE_FIELD]]=s}var a=Object.keys(n).sort();for(t=0;t<i;t++)e.push(n[a[t]]);this.lineModels=e}}},{key:"_lineModelChanged",value:function(){this.lineModels&&0<this.lineModels.length&&(this.deletedLineKeys=[],this.errors=[],this._buildDialog())}},{key:"_handleCustomSegmentsResponseChanged",value:function(e){e.partialVO&&(e=this._combinePartialQuoteWithFullQuote(e)),this.fire("segmented-changed",{quoteVO:e}),this.resetData()}},{key:"_combinePartialQuoteWithFullQuote",value:function(e){var n=this,t=this.groupModel.quoteModel.quoteVO,o=new Map,r=new Map;e.lineItems.forEach(function(e){r.set(e.key,e);var t=e.record[n.constants.SEGMENT_KEY_FIELD];if(t&&n._sentMDQKeys.has(t)){var i=o.get(t)||[];o.set(t,[].concat(a(i),[e]))}});var s=[];return t.lineItems.forEach(function(e){var t=e.record[n.constants.SEGMENT_KEY_FIELD],i=e.dimensionType;t&&n._sentMDQKeys.has(t)&&i&&"custom"===i.toLowerCase()?1==e.record[n.constants.SEGMENT_INDEX_FIELD]&&(s=[].concat(a(s),a(o.get(t)))):r.has(e.key)?s.push(r.get(e.key)):s.push(e)}),e.lineItems=s,e.partialVO=!1,e}},{key:"_handleErrorResponseChanged",value:function(){var e=this.errors||[];this.set("errors",e.push(this.errorResponse))}},{key:"_onAddByLine",value:function(e){this._onAddByIndex(e.detail.index)}},{key:"_onAdd",value:function(e){this.$.dialog.toggleMenu();var t=this.lineModels.length-1;this._onAddByIndex(t)}},{key:"_onAddByIndex",value:function(e){var t=this.lineModels[e],i=JSON.parse(JSON.stringify(t.lineVO));i.record={},i.record[this.constants.SEGMENT_LABEL_FIELD]="",i.record[this.constants.START_DATE_FIELD]=null,i.record[this.constants.END_DATE_FIELD]=null;var n=new l(i,this.groupModel);n.lineVO.record.Id=null,n.lineVO.key=null,n.selected=!1,this.splice("lineModels",e+1,0,n),this.headerSelected=!1,this.$.segmentGroup.addEventListener("dom-change",function(e){var t=this.$.segmentRows.querySelectorAll("#segmentRow");null===t[t.length-1].model.lineVO.key&&t[t.length-1].$.row.click()}.bind(this))}},{key:"_onDeleteByLine",value:function(e){this._onDeleteLineData(e.detail.index),this.headerSelected=!1}},{key:"_onDelete",value:function(){var e=void 0;for(e=this.lineModels.length-1;0<e;e--)this.lineModels[e].selected&&this._onDeleteLineData(e);this.$.dialog.toggleMenu(),this.headerSelected=!1}},{key:"_onDeleteLineData",value:function(e){var t=this.lineModels[e];null!=t.lineVO.key&&this.deletedLineKeys.push(t.lineVO.key),this.splice("lineModels",e,1)}},{key:"_onSave",value:function(){this._resetProperties(),this.$.dialog.toggleMenu(),this._validateCustomSegmentLabels(),this._validateCustomSegmentDates();var e=[];if(this.hasInvalidSegmentDates&&e.push(this.customLabels.msg_invalid_custom_segment_dates),this.hasInvalidSegmentLabels&&e.push(this.customLabels.msg_invalid_custom_segment_labels),this.hasNonConsecutiveDates&&e.push(this.customLabels.msg_nonsequential_custom_segment_dates),this.hasOverlappingSegments&&e.push(this.customLabels.msg_overlapping_custom_segment_dates),this.set("errors",[]),this.set("errors",e),0==e.length){var t=this._getCustomSegmentUpdates();t.updateCustomSegments=!0;var i={quote:this._createQuoteWithoutUnaffectedLines(this.groupModel.groupKey),updateCustomSegments:t.updateCustomSegments,updatedLineKeys:t.updatedLineKeys,deletedLineKeys:this.deletedLineKeys,startDates:t.startDates,endDates:t.endDates,segmentLabels:t.segmentLabels};this.$.UpdateCustomSegmentsService.model=i}}},{key:"_createQuoteWithoutUnaffectedLines",value:function(t){var i=this,e=this.groupModel.quoteModel.quoteVO;if(!this.editorModel.data.settings.usesClientCalculator)return e;e=JSON.parse(JSON.stringify(e));var n=new Set,o=new Set,r=new Set;e.lineItems.forEach(function(e){e.parentGroupKey==t&&e.dimensionType==i.constants.TYPE_CUSTOM_DIMENSION&&(n.add(e.key),r.add(e.record[i.constants.SEGMENT_KEY_FIELD]),e.record.Id&&o.add(e.record.Id))}),this._sentMDQKeys=r,e.lineItems.forEach(function(e){var t=e.record[i.constants.SOURCE_FIELD];t&&o.has(t)&&n.add(e.key)});var s=[];return e.lineItems.forEach(function(e){n.has(e.key)&&s.push(e)}),e.lineItems=s,e.partialVO=!0,e}},{key:"_onCancel",value:function(){this.errors=void 0,this.groupModel=void 0,this.deletedLineKeys=[],this._resetProperties(),this.$.dialog.toggle()}},{key:"_toggleAllCheckBoxes",value:function(){if(this.lineModels){var e=void 0;for(e=this.lineModels.length-1;0<e;e--)this.set("lineModels."+e+".selected",this.headerSelected)}}},{key:"resetData",value:function(){this.errors=void 0,this.deletedLineKeys=[],this._sentMDQKeys=void 0}},{key:"_isMobileViewport",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"_buildDialog",value:function(){this._buildFieldsMD(),this._toggleAllCheckBoxes(),this._buildRowData(),this._buildHeaderActions()}},{key:"_buildFieldsMD",value:function(){for(var e=this.quoteLineMD,t=[this.constants.SEGMENT_LABEL_FIELD,this.constants.START_DATE_FIELD,this.constants.END_DATE_FIELD],i=[],n=0;n<t.length;n++)i.push(e[t[n]]);this.fields=t,this.fieldsMD=i}},{key:"_buildRowData",value:function(){for(var e=[],t=[],i={},n={},o={},r=this.fields.length,s=0;s<r;s++){this.fields[s];var a=this.fieldsMD[s],l=a.name;e.push(l);var u=a.label;t.push(u),i[l]=a.label,n[a.label.replace(/\W/g,"")]=a.type,o[l]=a.type}this.headerClassMap=new d(Object.keys(n),"Th",n).build(),this.rowClassMap=new d(e,"Td",o).build(),this.recordKeys=e,this.fieldLabels=t,this.fieldLabelMap=i}},{key:"_buildHeaderActions",value:function(){var e={icon:"sf-icon-delete",position:"right",hidden:!1,invisible:!0};this.headerActions=[e,e]}},{key:"_buildRowActions",value:function(e){var t=[],i={icon:"sb-icon-plus",title:this.customLabels.lbl_add_segment,position:"right",hidden:!1,invisible:this.groupModel.quoteModel.isAmendmentOrChangeQuote,onTapFunction:function(){this.fire("add-tapped",{index:this.index})}},n={icon:"sf-icon-delete",title:this.customLabels.lbl_delete_custom_segments,position:"right",hidden:!1,invisible:0==e||this.groupModel.quoteModel.isAmendmentOrChangeQuote,onTapFunction:function(){this.fire("delete-tapped",{index:this.index})}};return t.push(i),t.push(n),t}},{key:"_hideSelection",value:function(e){return 0===e?{hidden:!0,type:"invisible"}:null}},{key:"_updateData",value:function(e){for(var t=this.lineModels.length,i=0;i<t;i++)for(var n=Object.keys(e),o=0;o<n.length;o++){var r=n[o],s=e[r],a="lineModels."+i+"."+r;this.set(a,s)}}},{key:"_updateSegmentTable",value:function(){this._updateData({selected:!1})}},{key:"_getCustomSegmentUpdates",value:function(){for(var e={updatedLineKeys:[],startDates:[],endDates:[],segmentLabels:[]},t=this.lineModels.length,i=0;i<t;i++){var n=this.lineModels[i].lineVO,o=this.lineModels[i].lineVO.record;e.updatedLineKeys.push(n.key),e.segmentLabels.push(o[this.constants.SEGMENT_LABEL_FIELD]),e.startDates.push(o[this.constants.START_DATE_FIELD]),e.endDates.push(o[this.constants.END_DATE_FIELD])}return e}},{key:"_validateCustomSegmentLabels",value:function(){this.hasInvalidSegmentLabels=!1;for(var e={},t=this.lineModels.length,i=0;i<t;i++){var n=this.lineModels[i].lineVO.record[this.constants.SEGMENT_LABEL_FIELD];if(null==n||""===n.trim())return void(this.hasInvalidSegmentLabels=!0);if(e[n])return void(this.hasInvalidSegmentLabels=!0);e[n]=!0}}},{key:"_validateCustomSegmentDates",value:function(){for(var e=this.lineModels.length,t=0;t<e;t++){var i=this.lineModels[t].lineVO,n=i.record[this.constants.START_DATE_FIELD],o=i.record[this.constants.END_DATE_FIELD],r=new Date(n),s=new Date(o);if(null==n||null==o)return void(this.hasInvalidDateFormat=!0);if(s<r)return void(this.hasInvalidSegmentDates=!0);if(0<=t-1){var a=this.lineModels[t-1].lineVO,l=new Date(a.record[this.constants.END_DATE_FIELD]),u=Date.parse(new Date(l.getFullYear(),l.getMonth(),l.getDate()+1)),d=Date.parse(new Date(r.getFullYear(),r.getMonth(),r.getDate()));if(this.editorModel.data.settings.allowsNonConsecutiveCustomSegments){if(r<=l)return void(this.hasOverlappingSegments=!0)}else if(u!=d)return void(this.hasNonConsecutiveDates=!0)}}}},{key:"_resetProperties",value:function(){this.set("errors",[]),this.headerSelected=!1,this.hasInvalidSegmentLabels=!1,this.hasInvalidSegmentDates=!1,this.hasNonConsecutiveDates=!1,this.hasOverlappingSegments=!1,this.hasInvalidDateFormat=!1}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"listeners",get:function(){return{"sb-cancel-custom-segment":"_onCancel","add-tapped":"_onAddByLine","delete-tapped":"_onDeleteByLine"}}},{key:"observers",get:function(){return["_dataChanged(dataLineModels)","_lineModelChanged(lineModels)","_handleCustomSegmentsResponseChanged(updateCustomSegmentsResponse)","_handleErrorResponseChanged(errorResponse)","_toggleAllCheckBoxes(headerSelected)"]}},{key:"constants",get:function(){return this.editorModel.constants}},{key:"quoteLineMD",get:function(){return this.editorModel.md.fieldsMap[this.constants.QUOTE_LINE]}},{key:"customLabels",get:function(){return this.editorModel.data.customLabels}}]),o=e)),t("CustomSegmentDialog",o),Polymer(o)}}}),System.register("quotes/dialogs/sb-discount-schedule-dialog/DiscountScheduleDialog.js",["common/layout/tables/TableClassBuilder.js","quotes/models/DiscountTierModel.js","quotes/models/DiscountTiersValidator.js","common/data/cache/Cache.js","common/core/sb-page-container/PageContainer.js"],function(t,e){var i,a,r,o,s;return{setters:[function(e){i=e.TableClassBuilder},function(e){a=e.DiscountTierModel},function(e){r=e.DiscountTiersValidator},function(e){e.Cache},function(e){o=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("DiscountScheduleDialog",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-discount-schedule-dialog",this.properties={discountSchedule:{type:Object},discountUnit:{type:String},lineModel:Object,schedule:{type:Object,notify:!0},error:{type:Object,notify:!0},model:{type:Object,value:{}},viewport:{type:Object,value:function(){return o.getViewport()}},isMobile:{type:Boolean,value:!1},dialogTapped:{type:Boolean,value:!1}}}},{key:"ready",value:function(){this.addEventListener("sb-cancel-ds",this.onCancel),this.addEventListener("data-changed",function(e){e.detail&&e.detail.path=="data."+this.discountUnitField&&this.discountUnit!=e.detail.value&&(this.discountUnit=e.detail.value,this._calculateDiscountAmounts(this.discountTiers),this.buildRowData())}.bind(this)),this._handleDialogTap(),this._handleDialogMouseEvents()}},{key:"_createErrorHandler",value:function(){this.error&&(this.errors=[this.error.message])}},{key:"_retrieveSchedule",value:function(e){e&&(this.showSpinner=!0,this.context={currencyCode:this.editorModel.quoteModel.quoteVO.record.CurrencyIsoCode,fieldSetName:"DiscountScheduleModal"},this.$.loadDiscountScheduleService.uid=void 0,this.$.loadDiscountScheduleService.context=this.context,this.$.loadDiscountScheduleService.uid=e,this.$.loadDiscountScheduleService.spinner=!1)}},{key:"_buildDialog",value:function(){if(this.schedule){this._setConstants(this.constants),this.discountTiers=void 0,this.currencyCode=this.editorModel.quoteModel.quoteVO.record.CurrencyIsoCode,this.editable=!!this.schedule[this.overrideBehaviorField],this.savedTiers=[],this.discountSchedule=JSON.parse(JSON.stringify(this.schedule)),this.data=this.discountSchedule,this.discountSchedule[this.discountUnitField]=this.discountSchedule[this.usePriceForAmountField]?"Price":this.discountSchedule[this.discountUnitField],this._setDSFields(),this.showRevertBtn=!!this.discountSchedule[this.originalScheduleField],this.discountUnit=this.discountSchedule[this.usePriceForAmountField]?"Price":this.discountSchedule[this.discountUnitField],this.buildRowData();var e=this.buildTiers();this._calculateDiscountAmounts(e),this.buildFieldData(),this.discountTiers=e,this._createActions(),this._toggleEditableClasses(),this.isMobile&&this._buildTabData(),this.showSpinner=!1}}},{key:"_discountScheduleResponseChanged",value:function(){var e=this.discountScheduleResponse.Id;if(this.lineModel.lineVO.record[this.discountScheduleField]=e,this.lineModel.lineVO.record[this.segmentKeyField])for(var t=this.lineModel.segments,i=0,n=t.length;i<n;i++)t[i].lineVO.record[this.discountScheduleField]=e;"save"===this.action?this.onCancel():(this.schedule=this.discountScheduleResponse,this.showRevertBtn=this.discountScheduleResponse[this.originalScheduleField]),this.domHost.onFlagCalculate()}},{key:"_discountScheduleChanged",value:function(e){e.path=="discountSchedule."+this.discountUnitField&&(this.discountUnit=e.value,this._calculateDiscountAmounts(this.discountTiers),this.buildRowData())}},{key:"buildTiers",value:function(){var t=[],e=this._retrieveRecords();return this.previousLowerBound=void 0,e.forEach(function(e){if(null!=e[this.lowerBoundField]){if("Percent"==this.discountUnit&&this.previousLowerBound!=e[this.lowerBoundField])this.previousLowerBound=e[this.lowerBoundField];else if("Percent"==this.discountUnit||e.CurrencyIsoCode!=this.currencyCode)return;t.push(new a(e,this.discountSchedule))}else t.push(new a(e,this.discountSchedule))}.bind(this)),t}},{key:"buildFieldData",value:function(){if(!this.fieldNames){var e=this.editorModel.md.fieldsMap[this.discountScheduleField];e[this.discountUnitField].required=!0,this.fieldTableData=e,this.fieldNames=["Name",this.discountUnitField]}}},{key:"buildRowData",value:function(){this.fieldsArray&&this.fire("iron-signal",{name:"delete-groups"});var e=this.editorModel.data.discountScheduleModalFieldNames,o=this.editorModel.md.fieldsMap[this.tierField],r=[],s={},a={},l={},t=this.editorModel.data.customLabels.lbl_price,u={};e.forEach(function(e){u[e]="template."+e}.bind(this)),"Price"===this.discountUnit&&(u[t]="template."+t,o[t]=JSON.parse(JSON.stringify(o[this.discountAmountField])),o[t].label=t+"("+(this.currencyCode||this.editorModel.data.currencySymbol)+")",o[t].name=t),this.fieldsArray=Object.keys(u);var d=[];this.fieldsArray.forEach(function(e){if(this._isFieldShown(e)){var t,i=o[e],n=i.name;e===this.numberField?t="#":e===this.discountAmountField?(t=i.label.replace("{0}",this.currencyCode||this.editorModel.data.currencySymbol),i.label=t):t=i.label,d.push(u[e]),r.push(t),s[n]=i.label,a[i.label.replace(/\W/g,"")]=i.type,l[u[e]]=i.type}}.bind(this)),this.set("model.fieldsMD",o),this.isMobile||(this.set("model.selected",!1),this.set("model.headerClassMap",new i(Object.keys(a),"Th",a).build()),this.set("model.fieldLabels",r)),this.set("model.rowClassMap",new i(d,"Td",l).build()),this.set("model.fieldLabelMap",s),this.set("model.recordKeys",d)}},{key:"onRevert",value:function(){this._retrieveSchedule(this.discountSchedule[this.originalScheduleField])}},{key:"onAddLine",value:function(e){var t=this._createBlankTierRecord(),i=new a(t,this.discountSchedule);i.rowActions=this._createRowActions(),e.detail&&void 0!==e.detail.index?this.splice("discountTiers",e.detail.index+1,0,i):this.push("discountTiers",i),this._renumberLines(this.discountTiers,!0)}},{key:"onDeleteLines",value:function(e){if(e.detail&&e.detail.index)this.splice("discountTiers",e.detail.index,1);else{for(var t=0,i=this.discountTiers.length;t<i&&this.discountTiers[t];t++)this.discountTiers[t].selected&&(this.splice("discountTiers",t,1),t--);this.set("model.selected",!1)}this._selectCheckboxes(!1),this._renumberLines(this.discountTiers,!0)}},{key:"onSave",value:function(e){if(this.errors=void 0,this.tiers=this._processForSaving(),this.tiers){this.errors=void 0,this.action=e.currentTarget.attributes.id.value;var t=void 0;this.discountSchedule[this.userDefinedField]&&this.lineModel.lineVO.record.Id===this.discountSchedule[this.quoteLineField]?(t={discountScheduleJSON:JSON.stringify(this.discountSchedule),tiersJSON:JSON.stringify(this.tiers),ignoreValidate:!0,context:JSON.stringify(this.context)},this.$.discountScheduleUpdaterService.uid=this.discountSchedule.Id,this.$.discountScheduleUpdaterService.model=t):(this.discountSchedule[this.quoteLineField]=this.lineModel.lineVO.record.Id,this.discountSchedule[this.userDefinedField]=!0,this.discountSchedule[this.originalScheduleField]=this.discountSchedule.Id,t={discountScheduleJSON:JSON.stringify(this.discountSchedule),tiersJSON:JSON.stringify(this.tiers),ignoreValidate:!0,context:JSON.stringify(this.context)},this.$.discountScheduleClonerService.model=t)}}},{key:"onCancel",value:function(){this.fire("iron-signal",{name:"delete-groups"}),this.dialogTapped=!1,this.dialogOverlapping=!1,this.set("model.fieldsEditable",!1),this.errors=void 0,this.schedule=void 0,this.discountSchedule=void 0,this.discountTiers=void 0,this.discountScheduleId=void 0,this.$.dialog.close()}},{key:"_processForSaving",value:function(){var e=this._sortTiers(this.savedTiers),t=this._sortTiers(this.discountTiers);if(!e||!t)return null;var i=e.concat(t);this._renumberLines(i,!1),this.set("discountTiers",t),this._updateActions(),this._calculateDiscountAmounts(i),this._createTiers(i);var n=new r(this.discountSchedule,this.editorModel).validate(i);if(0<n.size)return this._createError(n),null;var o=[];return i.forEach(function(e){e.tiers.forEach(function(e){o.push(e)}.bind(this))}.bind(this)),this.discountSchedule[this.tiersField].records=o,this.discountSchedule[this.tiersField].totalSize=o.length,"Price"===this.discountUnit?(this.discountSchedule[this.discountUnitField]="amount",this.discountSchedule[this.usePriceForAmountField]=!0):this.discountSchedule[this.usePriceForAmountField]=!1,o}},{key:"_setConstants",value:function(e){this.discountAmountField=e.DISCOUNT_AMOUNT_FIELD,this.discountScheduleField=e.DISCOUNT_SCHEDULE_FIELD,this.discountRateField=e.ADDITIONAL_DISCOUNT_RATE_FIELD,this.discountUnitField=e.DISCOUNT_UNIT_FIELD,this.lowerBoundField=e.LOWER_BOUND_FIELD,this.numberField=e.NUMBER_FIELD,this.originalScheduleField=e.ORIGINAL_SCHEDULE_FIELD,this.overrideBehaviorField=e.OVERRIDE_BEHAVIOR_FIELD,this.quantityField=e.QUANTITY_FIELD,this.quoteLineField=e.QUOTE_LINE,this.segmentKeyField=e.SEGMENT_KEY_FIELD,this.specialPriceField=e.SPECIAL_PRICE_FIELD,this.tierField=e.DISCOUNT_TIER_FIELD,this.tiersField=e.DISCOUNT_TIERS_FIELD,this.upperBoundField=e.UPPER_BOUND_FIELD,this.usePriceForAmountField=e.USE_PRICE_FOR_AMOUNT_FIELD,this.userDefinedField=e.USER_DEFINED_FIELD}},{key:"_createError",value:function(e){for(var t=[],i=0,n=this.discountTiers.length;i<n;i++){var o=this.discountTiers[i].template[this.numberField];e&&e.get(o)&&t.push(e.get(o))}0<t.length&&(this.errors=t)}},{key:"_createActions",value:function(){if(this.discountTiers){for(var e=[],t=0,i=this.discountTiers.length;t<i;t++){var n=this._createRowActions(t);this.set("discountTiers."+t+".rowActions",n)}e.push({icon:"sb-icon-plus",position:"right",hidden:!0,invisible:!0}),e.push({icon:"sf-icon-delete",position:"right",hidden:!0,invisible:!0}),this.isMobile||this.set("model.headerActions",e)}}},{key:"_createRowActions",value:function(e){return[{icon:"sb-icon-plus",title:"Add",position:"right",invisible:!1,hidden:!1,onTapFunction:function(){this.fire("add-tapped",{index:this.index})}},{icon:"sf-icon-delete",title:"Delete",position:"right",invisible:0==(0<arguments.length&&void 0!==e?e:1),hidden:!1,onTapFunction:function(){this.fire("delete-tapped",{index:this.index})}}]}},{key:"_retrieveVisibleRecords",value:function(e){var o=[],r=this.lineModel.lineVO.record[this.quantityField];if(e.forEach(function(e){var t=e[this.lowerBoundField],i=e[this.upperBoundField],n=this.discountSchedule[this.userDefinedField];if(!i)return t<=r||n?o.push(e):o;t<=r&&i<=r?this.savedTiers.push(new a(e,this.discountSchedule)):t<=r&&r<i?o.push(e):n&&r<t&&o.push(e)}.bind(this)),0==o.length&&0<e.length){var t=e.length-1,i=e[0][this.lowerBoundField],n=e[t][this.upperBoundField],s=this._createBlankTierRecord();r<i?s[this.numberField]=1:n<=r&&(s[this.numberField]=e[t][this.numberField]+1,s[this.lowerBoundField]=n),o.push(s)}return o}},{key:"_retrieveRecords",value:function(){var e=[];if(this.discountSchedule[this.tiersField])e=this.discountSchedule[this.tiersField].records,"Current Tier Only"===this.discountSchedule[this.overrideBehaviorField]?(e=this._retrieveVisibleRecords(e),0<this.savedTiers.length&&(this.editorModel.disabledDiscountTier=e[0][this.numberField])):this.editorModel.disabledDiscountTier=void 0;else{var t=this._createBlankTierRecord();t[this.numberField]=1,e.push(t)}return e}},{key:"_calculateDiscountAmounts",value:function(e){if(e){var i=this.lineModel.lineVO.record[this.specialPriceField];e.forEach(function(e){var t=e.template;"Price"===this.discountUnit?(t.Price=t.Price||0===t.Price?t.Price:i-t[this.discountAmountField],t[this.discountAmountField]=i-t.Price):(t[this.discountRateField]=t[this.discountRateField]||0,t[this.discountAmountField]=t[this.discountAmountField]||0),t[this.constants.UPPER_BOUND_FIELD]||0==t[this.constants.UPPER_BOUND_FIELD]||(t[this.constants.UPPER_BOUND_FIELD]=null)}.bind(this))}}},{key:"_renumberLines",value:function(e,t){for(var i="Current Tier Only"===this.discountSchedule[this.overrideBehaviorField]&&0<this.savedTiers.length?e[0].template[this.numberField]:1,n=0,o=e.length;n<o;n++)e[n].template[this.numberField]!=i&&(t?this.set("discountTiers."+n+".template."+this.numberField,i):e[n].template[this.numberField]=i),i++}},{key:"_sortTiers",value:function(e){var i=[],n={},o=[];return e.forEach(function(e){var t=e.template[this.lowerBoundField];if(n[t])return this.errors=[this.editorModel.data.customLabels.msg_identical_lower_bounds],null;i.push(t),n[t]=e}.bind(this)),i.sort(function(e,t){return e-t}),i.forEach(function(e){var t=n[e];o.push(t)}.bind(this)),o}},{key:"_createTiers",value:function(e){var i=this.editorModel.data.settings.currencyIsoCodes;e.forEach(function(t){t.tiers=[],i?i.forEach(function(e){if(e==this.currencyCode)return t.template.CurrencyIsoCode=e,void t.tiers.push(t.template);"Percent"!==this.discountUnit&&t.tiers.push(this._createMultiCurrencyRecord(t.template,e))}.bind(this)):t.tiers.push(t.template)}.bind(this))}},{key:"_selectCheckboxes",value:function(e){if(this.discountTiers)for(var t=1,i=this.discountTiers.length;t<i;t++)this.discountTiers[t]&&this.set("discountTiers."+t+".selected",e)}},{key:"_createMultiCurrencyRecord",value:function(e,t){var i=JSON.parse(JSON.stringify(e));return i.CurrencyIsoCode=t,i[this.discountAmountField]=0,i[this.discountRateField]=i[this.discountRateField]||0,delete i.Price,i}},{key:"_createBlankTierRecord",value:function(){var t={};return this.fieldsArray.forEach(function(e){t[e]=null,t.CurrencyIsoCode=this.currencyCode,t[this.discountAmountField]=0,t[this.discountRateField]=0}.bind(this)),t}},{key:"_handleIconAction",value:function(e){var t=e.detail.event.type,i=e.detail.model;switch(this.lineModel=this.editorModel.quoteModel.lineModelsByKey[i.serviceModel.keys[0]],this.discountScheduleId=i.serviceModel.scheduleId,t){case"mouseenter":this.isMobile||this.dialogTapped||(this._toggleDialogClasses(!0),this.$.dialog.open());break;case"mouseleave":this.debounce("closeDialog",function(){this.isMobile||this.dialogTapped||this.dialogOverlapping||this.onCancel()}.bind(this),1);break;case"tap":this._openDialog()}}},{key:"_openDialog",value:function(){this.dialogTapped||(this.dialogTapped=!0,this.$.dialog.open(),this._toggleDialogClasses(!1))}},{key:"_toggleDialogClasses",value:function(e){var t=Polymer.dom(this.$.dialog.root),i=t.querySelector(".sbDialog");this.toggleClass("boxShadow",e,i),this.toggleClass("noMarginBottom",e,t.querySelector("#content"))}},{key:"_handleDialogTap",value:function(){this.addEventListener("sb-tap-ds",function(){!this.isMobile&&this.dialogOverlapping&&this._openDialog()}.bind(this))}},{key:"_handleDialogMouseEvents",value:function(){if(!this.isMobile){var e=Polymer.dom(this.$.dialog.root).querySelector(".sbDialog");e.addEventListener("mouseenter",function(){this.dialogTapped||(this.dialogOverlapping=!0)}.bind(this)),e.addEventListener("mouseleave",function(){!this.dialogTapped&&this.dialogOverlapping&&this.onCancel()}.bind(this))}}},{key:"_toggleEditableClasses",value:function(){this.set("model.fieldsEditable",this.editable&&this.dialogTapped),this.discountTiers&&(this._setDisabled(),this._updateActions())}},{key:"_updateActions",value:function(){for(var e=0,t=this.discountTiers.length;e<t;e++){var i=this.discountTiers[e].rowActions;if(i)for(var n=0,o=i.length;n<o;n++){var r=0==e&&"sf-icon-delete"==i[n].icon;this.set("discountTiers."+e+".rowActions."+n+".hidden",!this.model.fieldsEditable),this.set("discountTiers."+e+".rowActions."+n+".invisible",r)}}if(!this.isMobile&&this.model.headerActions)for(var s=0,a=this.model.headerActions.length;s<a;s++)this.set("model.headerActions."+s+".hidden",!this.model.fieldsEditable)}},{key:"_setDisabled",value:function(){for(var e=0,t=this.discountTiers.length;e<t;e++)this.set("discountTiers."+e+".disabled",!this.model.fieldsEditable)}},{key:"_setDSFields",value:function(){var e=this.editorModel.quoteModel.quoteVO;this.discountSchedule[this.constants.QUOTE]=e.record.Id;var t=void 0;e.record[this.constants.ACCOUNT_FIELD]?t=e.record[this.constants.ACCOUNT_FIELD].Id:e.record[this.constants.OPPORTUNITY_FIELD]&&(t=e.record[this.constants.OPPORTUNITY_FIELD].AccountId),this.discountSchedule[this.constants.ACCOUNT_ID_FIELD]=t}},{key:"_isFieldShown",value:function(e){return!("Percent"===this.discountUnit&&e===this.discountAmountField||"Amount"===this.discountUnit&&e===this.discountRateField||"Price"===this.discountUnit&&(e===this.discountRateField||e===this.discountAmountField))}},{key:"_buildTabData",value:function(){var e=[],t=["Details","Tiers"];if(this.tabs!==e){for(var i=0,n=t.length;i<n;i++){var o=t[i],r="t"+i,s=void 0,a=void 0;"Details"===o?(s=["data","fieldNames","md","numColumns","disabled"],a="sb-field-table"):"Tiers"===o&&(s=["discountTiers","model","editorModel"],a="sb-ds-tiers"),e.push({name:r,label:o,bind:s,pageComponent:a})}this.tabs=e}}},{key:"viewportChanged",value:function(){this.isMobile=!(!this.viewport||!this.viewport.isMobile())}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_retrieveSchedule(discountScheduleId)","_buildDialog(schedule)","_discountScheduleResponseChanged(discountScheduleResponse)","_discountScheduleChanged(discountSchedule.*)","_createErrorHandler(error)","_toggleEditableClasses(dialogTapped)","_selectCheckboxes(model.selected)"]}},{key:"constants",get:function(){return this.editorModel.constants}},{key:"listeners",get:function(){return{"delete-tapped":"onDeleteLines","add-tapped":"onAddLine"}}}]),s=e)),t("DiscountScheduleDialog",s),Polymer(s)}}}),System.register("quotes/dialogs/sb-favorite-dialog/FavoriteDialog.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("FavoriteDialog",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-favorite-dialog",this.properties={favName:String}}},{key:"ready",value:function(){this.addEventListener("sb-cancel-fav",this.onCancel)}},{key:"onSave",value:function(){if(""!=this.favName&&void 0!==this.favName){var e=[];if(this.favoritedGroup)for(var t=this.groupLines.length,i=0;i<t;i++)this.groupLines[i].component||e.push(this.groupLines[i].lineVO.key);else e.push(this.favoritedLine[0]);this.fire("sb-favorite-saved",{keys:e,name:this.favName,groupKey:this.favoritedGroup}),this.favoritedGroup=this.favoritedLine=this.groupLines=null,this.favName="",this.$.dialog.toggle()}else this.errors=["Favorite name cannot be left blank."]}},{key:"onCancel",value:function(){this.favoritedGroup=this.favoritedLine=this.groupLines=null,this.favName="",this.$.dialog.toggle()}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),i=e)),t("FavoriteDialog",i),Polymer(i)}}}),System.register("quotes/dialogs/sb-pricebook-dialog/PricebookDialog.js",["common/data/format/DataBuilder.js"],function(t,e){var i,o;return{setters:[function(e){i=e.DataBuilder}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("PricebookDialog",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-pricebook-dialog",this.properties={pricebooks:Array,selectedPricebook:String}}},{key:"ready",value:function(){this.$.select.addEventListener("change",function(e){this.selectedPricebook=e.detail.value}.bind(this)),this.$.dialog.addEventListener("sb-close-dialog",this.onCancel.bind(this))}},{key:"open",value:function(){this.$.pricebookLoaderService.addEventListener("response-changed",function(e){for(var t=[],i=e.detail.value,n=i.length,o=0;o<n;o++)t.push({value:i[o].Id,label:i[o].Name,selected:!1});t[0].selected=!0,this.selectedPricebook=t[0].value,this.$.select.value=this.selectedPricebook,this.$.select.isRequired=!0,this.pricebooks=t,this.$.dialog.toggle()}.bind(this)),this.$.pricebookLoaderService.uid="",this.$.pricebookLoaderService.context=""}},{key:"onSave",value:function(){this.$.pricebookSaverService.addEventListener("response-changed",function(e){this.fire("pricebook-saved",e.detail.value)}.bind(this)),this.editorModel.quoteModel.quoteVO.record[this.editorModel.constants.PRICEBOOK_ID_FIELD]=this.selectedPricebook,this.editorModel.quoteModel.quoteVO.record[this.editorModel.constants.PRICEBOOK_LOOKUP_ID_FIELD]=this.selectedPricebook,this.$.pricebookSaverService.model=(new i).add("pricebookId",this.selectedPricebook).add("quoteId",this.editorModel.quoteModel.quoteVO.record.Id).add("oppId",this.editorModel.quoteModel.quoteVO.record[this.editorModel.constants.OPPORTUNITY_ID_FIELD]).build(),this.$.dialog.toggle()}},{key:"onCancel",value:function(){this.fire("le-action-tapped",{customAction:{eventHandlerName:"onCancel"}})}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),o=e)),t("PricebookDialog",o),Polymer(o)}}}),System.register("quotes/layout/sb-cse-table-cell/CSETableCell.js",["quotes/models/Constants.js","common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o;return{setters:[function(e){e.Constants},function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("CSETableCell",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-cse-table-cell",this.properties={item:String,disabled:Boolean,hidden:Boolean,value:{notify:!0},data:{type:Object,value:null},model:{type:Object,value:null},render:{type:Boolean,value:!1},index:Number,viewport:{type:Object,value:function(){return i.getViewport()}}}}},{key:"buildCell",value:function(){for(var e=[this.constants.SEGMENT_LABEL_FIELD,this.constants.START_DATE_FIELD,this.constants.END_DATE_FIELD],t=this.model.groupModel.editorModel.md.fieldsMap[this.constants.QUOTE_LINE],i=[],n=0;n<e.length;n++){var o=t[e[n]];i[e[n]]=o}this.editing=!0,this.viewport&&this.viewport.isMobile()&&(this.render=!0,0===this.index&&(this.editing=!1)),this.disabled=!1,this.md=i[this.item]}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["buildCell(item, value, model, data)"]}},{key:"constants",get:function(){return this.model.groupModel.editorModel.constants}}]),o=e)),t("CSETableCell",o),Polymer(o)}}}),System.register("quotes/layout/sb-custom-action/CustomAction.js",["common/core/sb-page-container/PageContainer.js","common/core/AppContext.js"],function(t,e){var i,o;return{setters:[function(e){i=e.PageContainer},function(e){e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("CustomAction",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-custom-action",this.properties={customAction:Object,model:Object,actionHidden:Boolean,viewport:{type:Object,value:function(){return i.getViewport()}},button:{type:Boolean,value:null},span:{type:Boolean,value:null},groupAction:{type:Boolean,value:!1},allOptional:{type:Boolean,value:!1}}}},{key:"ready",value:function(){this.customAction&&this.customAction.isSeparator&&(this.button=!1,this.span=!0),this.addEventListener("paper-dropdown-close",function(e){this.$$("#menuButton")&&this.$$("#menuButton").close()}),this.horizontalAlign||(this.horizontalAlign=this.span?"left":"right"),this.horizontalOffset=this.span?18:0,this.verticalOffset=this.span?-30:0}},{key:"triggerCustomAction",value:function(e){if("showDSModal"!==this.customAction.eventHandlerName)"tap"===e.type&&(this.fire("le-action-tapped",{customAction:this.customAction,model:this.model}),this.fire("paper-dropdown-close"));else{if(this.classList.contains("swipe-menu-item")&&"tap"!==e.type)return;this.fire("iron-signal",{name:"schedule-action",data:{event:e,model:this.model}})}}},{key:"_showAction",value:function(e,t){return!e.isHidden(t)}},{key:"_getLabel",value:function(e,t){return(!e.icon||t&&(t.isMobile()||t.S.down))&&"Line"!==e.renderLocation?e.label:null}},{key:"_hasMenu",value:function(e,t,i,n){return!i&&!n||e.hasMenu&&!(t&&(t.isMobile()||t.S.down))}},{key:"_hasMenuButton",value:function(e,t,i,n){return this._hasMenu(e,t,i,n)&&!n}},{key:"_getButtonClass",value:function(e,t,i,n,o){return(o?"groupButton ":"")+(e.icon&&!this._getLabel(e,t)?e.icon:"")+(e.first?"":" notFirst")+(e.last&&!this._hasMenu(e,t,i,n)?"":" notLast")+(e.primary?" primary":"")}},{key:"_getMenuClass",value:function(e,t,i){return!t&&i?"mobileGroupMenu":(i?"groupMenu ":"")+(e.last?"":"notLast")}},{key:"_toggleQuoteButton",value:function(e){var t=0<arguments.length&&void 0!==e&&e;this.allOptional=t,this._toggleButton()}},{key:"_toggleLineButton",value:function(){this._toggleButton()}},{key:"_toggleButton",value:function(){this.viewport&&this.viewport.isMobile()&&!this.model.favorite&&"removeFromFavBtn"===this.customAction.caClass&&this.style.transform&&this.parentElement.parentElement._initSwipeMenu(this.parentElement),this._setButtonClassAndLabel()}},{key:"_setButtonClassAndLabel",value:function(){this.viewport&&this.viewport.isMobile()&&this.model.favorite&&"removeFromFavBtn"===this.customAction.caClass&&this.parentElement&&(Polymer.dom(this.parentElement).flush(),this.parentElement.parentElement._initSwipeMenu(this.parentElement))}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport,this._setButtonClassAndLabel()}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_toggleQuoteButton(model.allOptional)","_toggleLineButton(model.favorite)"]}}]),o=e)),t("CustomAction",o),Polymer(o)}}}),System.register("quotes/layout/sb-ds-table-cell/DSTableCell.js",["quotes/models/Constants.js","common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o;return{setters:[function(e){e.Constants},function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("DSTableCell",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-ds-table-cell",this.properties={item:String,disabled:Boolean,hidden:Boolean,value:{notify:!0},data:{type:Object,value:null},model:{type:Object,value:null},index:Number,viewport:{type:Object,value:function(){return i.getViewport()}}}}},{key:"buildCell",value:function(){var e=this.model.md.fieldsMap[this.constants.DISCOUNT_TIER_FIELD],t=this.item.replace("template.","");void 0===this.value&&(this.value=""),this.handleOriginalValues(),this.editing=this.isEditable(t,e),this.md=e[t]}},{key:"isEditable",value:function(e,t){return e!==this.constants.NUMBER_FIELD&&(e!==this.constants.LOWER_BOUND_FIELD||this.data.template[this.constants.NUMBER_FIELD]!==this.model.disabledDiscountTier)&&(0!==this.index||!this.viewport||!this.viewport.isMobile())&&t[e].updateable}},{key:"handleOriginalValues",value:function(){!this.data.original&&this.data.template&&(this.data.original={},this.data.original.template=JSON.parse(JSON.stringify(this.data.template))),this.data.original&&(this.$.field.originalValue=this.get("data.original."+this.item))}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["buildCell(item, model, data, index, viewport)"]}},{key:"constants",get:function(){return this.model.constants}}]),o=e)),t("DSTableCell",o),Polymer(o)}}}),System.register("quotes/layout/sb-ds-tiers/DSTiers.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("DSTiers",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-ds-tiers",this.properties={discountTiers:{type:Array,notify:!0},model:{type:Object,notify:!0}}}},{key:"_hideSelection",value:function(e){return 0===e&&this.model.fieldsEditable?{hidden:!0,type:"invisible"}:null}},{key:"_deleteGroups",value:function(){this.$.header.$.header.destroyGroup(),Polymer.dom(this.$.tbody).querySelectorAll("sb-table-row").forEach(function(e){e.cols=void 0,e.$.row.destroyGroup()}.bind(this))}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),i=e)),t("DSTiers",i),Polymer(i)}}}),System.register("quotes/layout/sb-field-set-table/FieldSetTable.js",["common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o;return{setters:[function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("FieldSetTable",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-field-set-table",this.properties={editorModel:Object,data:{type:Object,notify:!0},numColumns:{type:Number,value:1},objectName:String,viewport:{type:Object,value:function(){return i.getViewport()}},model:Object}}},{key:"generateColumns",value:function(){this.isMobile=this.viewport&&this.viewport.isMobile();var e=[],t=void 0,i=[],n=[],o=[];if(this.objectName==this.editorModel.constants.QUOTE_LINE_GROUP){for(var r=this.editorModel.fieldsetMap.groupFieldNames.slice(),s=0,a=r.length;s<a;s++)this.isMobile||this.editorModel.constants.DESCRIPTION_FIELD!=r[s]&&"Name"!=r[s]||(r.splice(s,1),s--);t=(e=r).length}else this.objectName==this.editorModel.data.quoteObjectName&&(e=this.editorModel.fieldsetMap.quoteFieldNames,t=this.editorModel.fieldsetMap.quoteFieldNames.length);for(var l=0;l<t;l++)l%this.numColumns==0?i.push(e[l]):l%this.numColumns==1?n.push(e[l]):o.push(e[l]);1==this.numColumns?this.columnOneWidth="td1":2==this.numColumns?(this.columnOneWidth="td2",this.columnTwoWidth="td2"):(this.columnOneWidth="td3",this.columnTwoWidth="td3",this.columnThreeWidth="td3"),this.setColumns(i,n,o)}},{key:"setColumns",value:function(e,t,i){0<e.length&&(this.$.firstColumn.model=this.model,this.$.firstColumn.group||(this.$.firstColumn.group=e)),0<t.length&&(this.$.secondColumn.model=this.model,this.$.secondColumn.group||(this.$.secondColumn.group=t)),0<i.length&&(this.$.thirdColumn.model=this.model,this.$.thirdColumn.group||(this.$.thirdColumn.group=i))}},{key:"observers",get:function(){return["generateColumns(editorModel, objectName, viewport, model)"]}}]),o=e)),t("FieldSetTable",o),Polymer(o)}}}),System.register("quotes/layout/sb-field-set-table-item/FieldSetTableItem.js",["common/core/sb-page-container/PageContainer.js","common/relationship/RelationshipFieldManager.js","common/core/AppContext.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.PageContainer},function(e){o=e.RelationshipFieldManager},function(e){r=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("FieldSetTableItem",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-field-set-table-item",this.properties={value:{notify:!0},item:String,model:Object,md:Object,data:Object,display:String,viewport:{type:Object,value:function(){return i.getViewport()}},calculateImmediately:{type:Object,value:function(){return r.org.calculateImmediately}},renderReadOnly:{value:!1,type:Boolean},type:String}}},{key:"attached",value:function(){this.renderReadOnly}},{key:"_datePickerOpened",value:function(e){if(!this.renderReadOnly){var t=e.detail.dateContainer,i=Polymer.dom(t).querySelector("input"),n=e.detail.datepicker,o=e.detail.datepicker.offsetHeight,r=e.detail.datepicker.offsetWidth,s=window.innerHeight,a=window.innerWidth,l=t.getBoundingClientRect(),u=s-l.bottom-o,d=a-l.left-r;n.style.position="fixed",n.style.left=d<0?i.getBoundingClientRect().right-r+"px":l.left+"px",n.style.top=u<0?l.top-o+"px":l.bottom+"px"}}},{key:"_setFieldData",value:function(){this.md=this.model.getFieldMD(this.item),this.isMobile=this.viewport&&this.viewport.isMobile(),this.label=null==this.value&&"richtextarea"===this.md.extraTypeInfo&&this.isMobile?null:this.md.label,this.helpText=this.md.inlineHelpText,this.data.CurrencyIsoCode&&(this.md.CurrencyIsoCode=this.data.CurrencyIsoCode),this.$.field.editing=!!this.md.updateable,this.$.field.disabled=!this.md.updateable,this.$.field.md=this.md,this.$.field.property=this.item;var e={};e[this.item]=this.value,this.$.field.obj=e}},{key:"_valueChanged",value:function(){this._updateLookupDisplayValue(),this.$.field.value=this.value,this.data&&this.item&&(this.data[this.item]=this.value)}},{key:"_updateLookupDisplayValue",value:function(){if(this.data){var e=new o(this.item,this.data);e.hasRelationship()&&(this.display=e.getRelationshipName())}}},{key:"_handleFieldValueChanged",value:function(e){var t=!!e.detail&&e.detail.suppressImmediateCalcuation;this.calculateImmediately&&!t&&this.fire("calculate-immediately")}},{key:"_displayChanged",value:function(){new o(this.item,this.data).addRelationshipName(this.value,this.display,this.md.referenceTo[0])}},{key:"_updateOriginalValue",value:function(){if(this.type){this.model[this.type]._transient_=this.model[this.type]._transient_||{},this.model[this.type]._transient_.original=this.model[this.type]._transient_.original||JSON.parse(JSON.stringify(this.model[this.type].record));var e=this.get("model."+this.type+"._transient_.original");this.$.field.originalValue=e[this.item]}}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"listeners",get:function(){return{"datepicker-opened":"_datePickerOpened","sb-field-on-change-field":"_handleFieldValueChanged"}}},{key:"observers",get:function(){return["_setFieldData(item, model, data)","_displayChanged(value, display, item, data, md)","_valueChanged(value, md)","_updateOriginalValue(model, item)"]}}]),s=e)),t("FieldSetTableItem",s),Polymer(s)}}}),System.register("quotes/layout/sb-le-drawer/LEDrawer.js",["common/signal/RowFocusSignaler.js","common/core/AppContext.js"],function(t,e){var i;return{setters:[function(e){e.RowFocusSignaler},function(e){e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LEDrawer",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-drawer",this.properties={lineModel:{type:Object,notify:!0},fieldNames:Array,richTextFields:Array,dataIndex:{type:Number,reflectToAttribute:!0}}}},{key:"init",value:function(){this.itemClassMap=this.lineModel.itemClassMap;var e=[],t=!0,i=!1,n=void 0;try{for(var o,r=this.fieldNames[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this._isRichTextField(s)&&e.push(s)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}this.richTextFields=e}},{key:"_isRichTextField",value:function(e){return"richtextarea"===this.lineModel.getFieldMD(e).extraTypeInfo}},{key:"_lineRecordChanged",value:function(e){"lineModel.lineVO.fieldVisibility"===e.path?this._visibilityChanged():"lineModel.lineVO.fieldEditability"===e.path&&this._editabilityChanged()}},{key:"_visibilityChanged",value:function(){this.lineModel.setItemClassMap(),this.itemClassMap=this.lineModel.itemClassMap}},{key:"_editabilityChanged",value:function(){this.itemEditableMap=this.lineModel.lineVO.fieldEditability}},{key:"_showLineMultiActions",value:function(e){return(e.actionsOnTheLeft?"actionsOnTheLeft ":"")+(e.data.settings.multiLineDeleteEnabled?"multiDeleteEnabled":"")}},{key:"observers",get:function(){return["init(fieldNames, lineModel)","_lineRecordChanged(lineModel.*)"]}}]),i=e)),t("LEDrawer",i),Polymer(i)}}}),System.register("quotes/layout/sb-le-footer/LEFooter.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LEFooter",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-footer",this.properties={quoteModel:Object,quoteTotal:{type:Number},quoteTotalMd:Object,editorModel:{type:Object}}}},{key:"colWidthsChanged",value:function(){this._setTotalWidth()}},{key:"_setTotalWidth",value:function(){if(this.showQuoteTotal){var e=this.quoteModel.editorModel;if(this.toggleClass("largeQuote",e.largeQuoteExperienceEnabled,this.$.container),this.labelClass=e.deviceContext.isMobile?"hidden":"",!e.layout||e.deviceContext.isMobile||e.largeQuoteExperienceEnabled)return;this.totalWidth=this.quoteModel.editorModel.layout.totalWidth+"px"}}},{key:"_showQuoteTotal",value:function(){this.grouped=this.quoteModel.grouped?"grouped":"",this.showQuoteTotal="doNotDisplay"!=this.settings.lineEditorTotalsField&&this.quoteVO.lineItems&&0<this.quoteVO.lineItems.length,this._setQuoteTotal()}},{key:"_setQuoteTotal",value:function(){var e=void 0,t=void 0,i=this.quoteModel.editorModel.constants,n=this.settings.lineEditorTotalsField;e=n&&"Default"!=n?(t=this.settings.isMultiCurrencyOrg?this.quoteVO.currencyDecimalScale:this.quoteFields[n]?this.quoteFields[n].scale:0,this.quoteVO.record[n]||0):(t=this.settings.isMultiCurrencyOrg?this.quoteVO.currencyDecimalScale:this.quoteVO.applyAdditionalDiscountLast?this.quoteFields[i.CUSTOMER_AMOUNT_FIELD].scale:this.quoteFields[i.NET_AMOUNT_FIELD].scale,this.quoteVO.applyAdditionalDiscountLast?this.quoteVO.customerTotal:this.quoteVO.netTotal),this.quoteTotalMd||(this.quoteTotalMd={type:"currency",scale:t,CurrencyIsoCode:this.quoteVO.record.CurrencyIsoCode}),this.quoteTotal=e.toFixed(t)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_showQuoteTotal(quoteModel.quoteVO.*)","_setTotalWidth(quoteModel.editorModel.layout)"]}},{key:"settings",get:function(){return this.quoteModel.editorModel.data.settings}},{key:"quoteFields",get:function(){return this.quoteModel.editorModel.md.fieldsMap[this.settings.developerPrefix+"Quote__c"]}},{key:"quoteVO",get:function(){return this.quoteModel.quoteVO}}]),i=e)),t("LEFooter",i),Polymer(i)}}}),System.register("quotes/layout/sb-le-group/LEGroup.js",["common/core/sb-page-container/PageContainer.js","quotes/models/DragDropModel.js","common/core/AppContext.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.PageContainer},function(e){o=e.DragDropModel},function(e){r=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}8,150,t("LEGroup",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-group",this.properties={groupModel:{type:Object,notify:!0,observer:"_groupModelChanged"},groupClass:{type:String},subtotal:Number,subtotalMd:Object,value:{notify:!0,observer:"_descriptionChanged"},descriptionMd:Object,groupLevelTabs:{type:Array,value:[]},isMobile:{type:Boolean,value:!1},editorModel:{type:Object,notify:!0},viewport:{type:Object,value:function(){return i.getViewport()}},favorited:Boolean,ui3Enabled:Boolean,i18n:{type:Object,value:function(){return r.properties.i18n.value()}}}}},{key:"ready",value:function(){this.groupExpanded=!1,this.showSpinner=!1,this.ui3Enabled=r.org.isUI3Enabled||!1}},{key:"_createDragDropModel",value:function(){var e=new Set(["sb-droppable-mdqRows","sb-droppable-emptyTable","sb-droppable-emptyMDQTable","sb-droppable-emptyMDQSegmentTab","sb-droppable-sidePanelGroups","emptyTableMessage"]);this.dragDrop=new o(this,this.editorModel.data.settings.bundleKeptTogether,"sb-le-table-row",e,this.dragFunc.bind(this),this.trackFunc.bind(this),this.dropFunc.bind(this),8,150)}},{key:"_groupModelChanged",value:function(){this.editorModel=this.groupModel.quoteModel.editorModel,this._updateTableProperties(),this._updatePageData(),this._setIsButton(),this.isMobile=!!this.viewport&&this.viewport.isMobile(),(this.isMobile||this.editorModel.largeQuoteExperienceEnabled)&&(this.set("groupModel.groupExpanded",this.groupExpanded),this.buildGroupTabs()),this.viewport&&!this.viewport.isMobile()&&(this.set("groupModel.groupExpanded",!0),this._setTotalWidth()),this.containerClass=this.editorModel.largeQuoteExperienceEnabled?"largeQuote":""}},{key:"_setIsButton",value:function(){this.isButton=!this.viewport||this.viewport.isDesktop()&&this.viewport.M.up}},{key:"_setTotalWidth",value:function(){this.editorModel.layout&&!this.editorModel.deviceContext.isMobile&&(this.totalWidth=this.editorModel.layout.totalWidth+2+"px")}},{key:"colWidthsChanged",value:function(){this._setTotalWidth()}},{key:"_updateTableProperties",value:function(){this.groupHasStandardProducts=this.groupModel._groupHasStandardProducts(),this.groupHasSegmentedProducts=this.groupModel._groupHasSegmentedProducts(),this.groupedAndHasNoLineItems=this.groupModel.quoteModel.grouped&&!this._groupHasLineItems(),this.groupHasBothProducts=this._groupHasBothProducts(),this._showSubtotal(),this._setGroupDescription()}},{key:"_segmentedPrimaryMobileColsChanged",value:function(){this._updatePageData()}},{key:"_updatePageData",value:function(){this.$$("#leGroupTabs")&&this.$$("#leGroupTabs").destroyTabs();for(var e=[],t=this.groupModel.dimensions,i=0,n=t.length;i<n;i++){var o=t[i];if(this.groupModel.hasVisibleSegmentedLines[o]){var r="t"+i,s={name:r,key:o,label:this.groupModel.quoteModel.quoteVO.localizedDimensionNames[o],bind:["groupModel"]};"Custom"==o&&(s.iconId=r+"-"+this.groupModel.groupKey,s.iconClass="sb-icon-pencil",s.iconEvent="cseDialog"),e.push(s)}}this.tabs=e,this.groupMDQTabs||(this.groupMDQTabs=e)}},{key:"_handleCSEDialogTapped",value:function(e){this.fire("cse-tapped",{dialog:"cseDialog",groupModelKey:this.groupModel.groupKey})}},{key:"_groupHasBothProducts",value:function(){return this.groupModel._groupHasStandardProducts()&&this.groupModel._groupHasSegmentedProducts()}},{key:"_groupHasLineItems",value:function(){return this.groupModel._groupHasStandardProducts()||this.groupModel._groupHasSegmentedProducts()}},{key:"_groupRecordChanged",value:function(e){e.path=="groupModel.groupVO.record."+this.editorModel.constants.OPTIONAL_FIELD&&this.fire("iron-signal",{name:"toggle-optional-clicked",data:{toggleOptionalBoolean:e.value,groupKey:this.groupModel.groupKey}});var t=this.groupModel.groupVO.record;this.favorited=!(!t||!t[this.editorModel.constants.FAVORITE_ID_FIELD])}},{key:"_setGroupDescription",value:function(){this.groupModel.groupVO.record&&(this.value=this.groupModel.groupVO.record[this.editorModel.constants.DESCRIPTION_FIELD],this.groupModel&&this.editorModel.md&&this.editorModel.constants&&this._getDescriptionMd(),this.value||(this.value=r.properties.i18n.value().l("Click to edit description")))}},{key:"_descriptionChanged",value:function(){var e=r.properties.i18n.value().l("Click to edit description");this.value!==e&&(this.groupModel.groupVO.record[this.editorModel.constants.DESCRIPTION_FIELD]=this.value)}},{key:"_getDescriptionMd",value:function(){var e=this.editorModel.md.fieldsMap[this.groupModel.groupObjectName];this.descriptionMd=e[this.editorModel.constants.DESCRIPTION_FIELD]}},{key:"_getSegmentKeys",value:function(){return Object.keys(this.groupModel.segmentedLinesBySegmentKey)}},{key:"triggerCustomAction",value:function(e){this.fire("le-action-tapped",{customAction:{eventHandlerName:e.currentTarget.attributes.eventHandlerName.value},model:this.groupModel})}},{key:"showGroupNameEditor",value:function(e){e.stopPropagation(),this.isMobile||(this.toggleClass("hidden",!0,this.$$("#groupHeaderName")),this.toggleClass("hidden",!1,this.$$("#groupNameInput")),this.$$("#groupNameInput").focus(),this.$$("#groupNameInput").setSelectionRange(0,this.groupModel.groupVO.record.Name.length))}},{key:"checkInputValue",value:function(e){e.stopPropagation(),""!=e.target.value&&this.set("groupModel.groupVO.record.Name",e.target.value),this.toggleClass("hidden",!1,this.$$("#groupHeaderName")),this.toggleClass("hidden",!0,this.$$("#groupNameInput"))}},{key:"closeGroupNameEditor",value:function(e){e.stopPropagation(),"13"==e.keyCode&&this.$$("#groupNameInput").blur()}},{key:"_showSubtotal",value:function(){if(this.groupModel.groupVO.record){var e=this.groupModel.quoteModel.editorModel.data.settings;this.groupModel.quoteModel.grouped&&"doNotDisplay"!=e.lineEditorGroupSubtotalsField&&(0<this.groupModel.segmentedLines.length&&this.groupModel._groupHasStandardProducts()||this.viewport&&this.viewport.isMobile()||this.groupModel.editorModel.largeQuoteExperienceEnabled)?(this._getSubtotal(),this.showSubtotal=!0):this.showSubtotal=!1}}},{key:"_getSubtotal",value:function(){if(this.groupModel.quoteModel.grouped){var e=this.groupModel.quoteModel.editorModel,t=e.data.settings,i=void 0,n=void 0,o=t.lineEditorGroupSubtotalsField;n="Default"==o||null==o?(i=t.isMultiCurrencyOrg?this.groupModel.quoteModel.quoteVO.currencyDecimalScale:e.md.fieldsMap[t.developerPrefix+"QuoteLineGroup__c"][e.constants.NET_TOTAL_FIELD].scale,this.groupModel.groupVO.record[e.constants.NET_TOTAL_FIELD]||0):(i=t.isMultiCurrencyOrg?this.groupModel.quoteModel.quoteVO.currencyDecimalScale:e.md.fieldsMap[t.developerPrefix+"QuoteLineGroup__c"][o].scale,this.groupModel.groupVO.record[t.lineEditorGroupSubtotalsField]||0),this.subtotalMd||(this.subtotalMd={type:"currency",scale:i,CurrencyIsoCode:this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode}),this.subtotal=n}}},{key:"_toggleGrouping",value:function(){this.notifyPath("groupModel.quoteModel.grouped",this.groupModel.quoteModel.grouped),this.set("groupClass",this.groupModel.quoteModel.grouped?"group":"virtualGroup")}},{key:"buildGroupTabs",value:function(){if(this.editorModel){var e=[];0<this.editorModel.fieldsetMap.groupFieldNames.length&&this._groupHasLineItems()&&!this.editorModel.largeQuoteExperienceEnabled&&e.push("details"),this.groupModel._groupHasSegmentedProducts()&&e.push("segmented"),this.groupModel._groupHasStandardProducts()&&e.push("standard");var t=[];if(this.groupModel.groupMDQTabs=this.tabs,this._renderTabs(e)){this.$$("#groupTabs")&&this.$$("#groupTabs").destroyTabs();for(var i=0,n=e.length;i<n;i++){var o="t"+i,r=e[i];t.push({name:o,label:r})}this.groupLevelTabs=void 0,this.bind=["groupModel","editorModel"],this.groupMDQTabs=this.groupModel.groupMDQTabs,this.selectedTabIndex=0,this.hideTabs=1==t.length,this.groupLevelTabs=t}}}},{key:"_renderTabs",value:function(e){if(this.groupLevelTabs.length!==e.length)return!0;if(this.groupModel.groupMDQTabs&&this.groupMDQTabs.length!==this.groupModel.groupMDQTabs.length)return!0;for(var t=0,i=this.groupLevelTabs.length;t<i;t++)if(this.groupLevelTabs[t].label!==e[t])return!0;return!1}},{key:"expandGroup",value:function(e){var t=this;e.target.hasAttribute("triggersExpandGroup")&&this.isMobile&&!this.showSpinner&&(this.$$("#mobileGroupTabs")||(this.showSpinner=!0),Polymer.RenderStatus.afterNextRender(this,function(){t.set("groupModel.groupExpanded",!t.groupModel.groupExpanded),t.groupExpanded=t.groupModel.groupExpanded,Polymer.RenderStatus.afterNextRender(t,function(){t.showSpinner=!1})}))}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport,this._setIsButton(),this.viewport&&this.viewport.isMobile()?this.isMobile=!0:this.isMobile=!1}},{key:"renderNewTab",value:function(e){e.detail.groupKey===this.groupModel.groupKey&&(this._updatePageData(),(this.isMobile||this.editorModel.largeQuoteExperienceEnabled)&&this.buildGroupTabs())}},{key:"_setUpgradeQuantity",value:function(e){var t=this,i=e.detail.sourceIndex,n=e.detail.upgradeIndex,o=e.detail.sourceLineVO,r=e.detail.upgradeLineVO;this.debounce("Handle user input for automatic upgrade asset quantity changed",function(){o.invalidQuantity?t._notifyQuantityChanged(i,n,o,!0):r.invalidQuantity?t._notifyQuantityChanged(n,i,r,!0):t._notifyQuantityChanged(i,n),o.invalidQuantity=null,r.invalidQuantity=null},10)}},{key:"_notifyQuantityChanged",value:function(e,t,i,n){var o=void 0,r=void 0;this.groupModel.standardLines[e].internalUpdate=!0,this.groupModel.standardLines[t].internalUpdate=!0,n&&(o=i.invalidQuantity,r=i.validQuantity,i.record[this.editorModel.constants.QUANTITY_FIELD]=i.invalidQuantity,this.notifyPath("groupModel.standardLines."+e+".lineVO.record."+this.editorModel.constants.QUANTITY_FIELD,this.groupModel.standardLines[e].lineVO.record[this.editorModel.constants.QUANTITY_FIELD]),i.record[this.editorModel.constants.QUANTITY_FIELD]=i.validQuantity),this.notifyPath("groupModel.standardLines."+e+".lineVO.record."+this.editorModel.constants.QUANTITY_FIELD,this.groupModel.standardLines[e].lineVO.record[this.editorModel.constants.QUANTITY_FIELD]),this.groupModel.standardLines[e].internalUpdate=!1,this.notifyPath("groupModel.standardLines."+t+".lineVO.record."+this.editorModel.constants.QUANTITY_FIELD,this.groupModel.standardLines[t].lineVO.record[this.editorModel.constants.QUANTITY_FIELD]),this.groupModel.standardLines[t].internalUpdate=!1,this.fire("validate-quantity-changed",{invalidQuantity:o,validQuantity:r})}},{key:"addSegmentedLineToEmptyTable",value:function(e){var t=e.lineVO.record[this.groupModel.constants.SEGMENT_KEY_FIELD],i=this.groupModel.quoteModel.quoteVO.multiSegmentKeys?this.groupModel.quoteModel.quoteVO.multiSegmentKeys[t]:null;this.groupModel.hasVisibleSegmentedLines||(this.groupModel.hasVisibleSegmentedLines={}),this.groupModel.setDimensionProperties(i),this.groupModel.segmentedLines.push(e),this.groupModel.groupVO.multiSegmentColumns[i]=e.editorModel.data.quote.multiSegmentColumns[i],this.groupModel.groupVO.localizedMultiSegmentColumns[i]=e.editorModel.data.quote.localizedMultiSegmentColumns[i],this.groupModel.colWidth[i]=e.groupModel.colWidth[i],e.groupModel=this.groupModel,e.lineVO.parentGroupKey=this.groupModel.groupKey;for(var n=0,o=e.segments.length;n<o;n++)e.segments[n].lineVO.parentGroupKey=this.groupModel.groupKey;this.groupModel.segmentedLinesBySegmentKey[t]=e,this.push("groupModel.segmentedLinesByDimension."+i,e),this._updatePageData()}},{key:"addSegmentedLineToExistingTab",value:function(e){var t=e.lineVO.record[this.groupModel.constants.SEGMENT_KEY_FIELD],i=this.groupModel.quoteModel.quoteVO.multiSegmentKeys?this.groupModel.quoteModel.quoteVO.multiSegmentKeys[t]:null;this.groupModel.segmentedLines.push(e),e.groupModel=this.groupModel,e.lineVO.parentGroupKey=this.groupModel.groupKey;for(var n=0,o=e.segments.length;n<o;n++)e.segments[n].lineVO.parentGroupKey=this.groupModel.groupKey;this.groupModel.segmentedLinesBySegmentKey[t]=e,this.push("groupModel.segmentedLinesByDimension."+i,e)}},{key:"removeSegmentedLine",value:function(e){var t=e.lineVO,i=t.record,n=(t.key,i[this.groupModel.constants.SEGMENT_KEY_FIELD]),o=(i[this.groupModel.constants.SEGMENT_LABEL_FIELD],this.groupModel.quoteVO.multiSegmentKeys?this.groupModel.quoteVO.multiSegmentKeys[n]:null);this.groupModel.segmentedLines.splice(this.groupModel.segmentedLines.indexOf(e),1),delete this.groupModel.segmentedLinesBySegmentKey[n],this.splice("groupModel.segmentedLinesByDimension."+o,this.groupModel.segmentedLinesByDimension[o].indexOf(e),1),0===this.groupModel.segmentedLinesByDimension[o].length&&(this.groupModel.removeDimensionProperties(o),delete this.groupModel.groupVO.localizedMultiSegmentColumns[o],delete this.groupModel.groupVO.multiSegmentColumns[o],this.$$("#leGroupTabs").destroyTabs(),this._updatePageData())}},{key:"_onTrack",value:function(e){this.dragDrop._onTrack(e)}},{key:"dragFunc",value:function(e){this.dragDrop.ghost=this.dragDrop.lineEditor.$.ghost,this.linesByParentKey=this.editorModel.quoteModel.linesByParentItemKey,this.indexByGroupKey=this.groupModel.quoteModel.indexByGroupKey,this.lineModelsByKey=this.groupModel.quoteModel.lineModelsByKey,this.dragDrop.dragLineModel=[],this.dragDrop.dragGroupModel=e.lineModel.groupModel,this.dragDrop.dragKey=e.lineModel.lineVO.key,this.dragDrop.dragLineModel=e.lineModel,this.dragDrop.segment=e.domHost.dimension,this.dragDrop.dragIndex=this.groupModel.segmentedLinesByDimension[this.dragDrop.segment].indexOf(e.lineModel),this.set("groupModel.segmentedLinesByDimension."+this.dragDrop.segment+"."+this.dragDrop.dragIndex+".hidden",!0)}},{key:"trackFunc",value:function(e){var t=this.dragDrop;if(e=t._findTableRowValidTarget(e))switch("placeholder"===e.id&&(e="before"===e.getAttribute("ref")?e.previousElementSibling:e.nextElementSibling),t.targetClass){case"sb-droppable-mdqRows":if(t._updateMDQTableRowHoverOverObject(t.sourceElement,e),!t.hoverOver)return;t.targetHost=t.hoverOver.comp.domHost,t.usePlaceholder=!0,t.enableHighLight=!1;break;case"sb-droppable-emptyTable":case"sb-droppable-sidePanelGroups":t.keepBundleTogether&&t.sourceElement.lineModel.hasParent?t.hoverOver=null:t.hoverOver={comp:e},t.usePlaceholder=!1,t.enableHighLight=!0}}},{key:"dropFunc",value:function(e,t,i,n){this.dragDrop.dropKey=null,this.dragDrop.dropIndex=null,this.dragDrop.dropGroupModel=null;var o=this.dragDrop.segment,r=void 0,s=this.dragDrop.dragLineModel;if(this.set("groupModel.segmentedLinesByDimension."+o+"."+this.dragDrop.dragIndex+".hidden",!1),t){switch(e.lineModel.subscriptionScopeEditable&&(this.dragDrop.dragGroupModel._updateSegmentedSubscriptionScopeEditable(e.lineModel),e.domHost.fieldNames=e.domHost._getFields(),e.domHost._setColumnWidths()),i){case"sb-droppable-mdqRows":var a=t.lineModel.groupModel;r=t.domHost.domHost.domHost,t.domHost,this.dragDrop.dropGroupModel=a,s.subscriptionScopeEditable&&(this.dragDrop.dropGroupModel.segmentedSubscriptionScopeEditable=!0);var l=a.segmentedLinesByDimension[o].indexOf(t.lineModel);n?l=0<=l?l:0:++l,s.groupModel=a,s.lineVO.parentGroupKey=a.groupKey,s.segments.forEach(function(e){e.lineVO.parentGroupKey=a.groupKey,e.groupModel=a}.bind(this)),this.removeSegmentedLine(this.dragDrop.dragLineModel),r.splice("groupModel.segmentedLinesByDimension."+o,l,0,s);break;case"sb-droppable-emptyTable":case"emptyTableMessage":r=Polymer.dom(t).getOwnerRoot().host,this.dragDrop.dropGroupModel=r.groupModel,s.subscriptionScopeEditable&&(this.dragDrop.dropGroupModel.segmentedSubscriptionScopeEditable=!0),this.removeSegmentedLine(this.dragDrop.dragLineModel),r.addSegmentedLineToEmptyTable(s);break;case"sb-droppable-sidePanelGroups":var u="Group"+t.getAttribute("id");r=this.dragDrop._findParentCustomElement(t,"groupContainer","id").querySelector("#"+u),this.dragDrop.dropGroupModel=r.groupModel,s.subscriptionScopeEditable&&(this.dragDrop.dropGroupModel.segmentedSubscriptionScopeEditable=!0),this.removeSegmentedLine(this.dragDrop.dragLineModel),this.dragDrop.dropGroupModel.dimensions.includes(this.dragDrop.segment)?r.addSegmentedLineToExistingTab(s):r.addSegmentedLineToEmptyTable(s)}if("sb-droppable-mdqRows"===i){var d=r.groupModel.segmentedLinesByDimension[o];t.domHost.notifyPath("groupModel.segmentedLinesByDimension."+o,d.slice()),t.domHost.notifyPath("lineModels",d.slice())}this.fire("renumber-lines"),this.editorModel.data.settings.usesClientCalculator&&this.editorModel.quoteModel.renumberIndexes(!0);var c=e.domHost,h=t.domHost;c&&"SF-SEGMENTED-TABLE"===c.tagName&&c._prepareUIData(),h&&"SF-SEGMENTED-TABLE"===h.tagName&&c!==h&&h._prepareUIData()}}},{key:"_groupCustomActionsChanged",value:function(e){for(var t=e?e.length:0,i=0;i<t;i++)this.notifyPath("editorModel.groupCustomActions."+i+".children")}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_groupRecordChanged(groupModel.groupVO.record.*)","_toggleGrouping(groupModel.groupVO)","_segmentedPrimaryMobileColsChanged(groupModel.editorModel.segmentedPrimaryMobileCols)","_updateTableProperties(groupModel.standardLines.splices)","_updateTableProperties(groupModel.segmentedLinesByDimension.*)","_createDragDropModel(editorModel)","_groupCustomActionsChanged(groupModel.editorModel.groupCustomActions)","_showSubtotal(groupModel.groupVO.record.*)"]}},{key:"listeners",get:function(){return{"cseDialog-tapped":"_handleCSEDialogTapped","segmented-changed":"_customSegmentedUpdated","upgrade-asset-quantity-changed":"_setUpgradeQuantity"}}}]),s=e)),t("LEGroup",s),Polymer(s)}}}),System.register("quotes/layout/sb-le-group-layout/LEGroupLayout.js",["common/core/sb-page-container/PageContainer.js","common/core/AppContext.js","quotes/models/DragDropModel.js","common/layout/table-layout-builder/TableLayoutBuilder.js"],function(t,e){var i,o,s,c,r;return{setters:[function(e){e.PageContainer},function(e){i=e.AppContext},function(e){o=e.DragDropModel,s=e.removeTopBottomBorderClass},function(e){c=e.TableLayoutBuilder}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}8,150,t("LEGroupLayout",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-group-layout",this.properties={noHeader:{type:Boolean,value:!1},layoutLink:String,layoutWidth:Number,layoutLeft:{type:String,value:"24px"},drawerState:String,lastSelectedGroup:Object,selectedGroupKey:{type:Number,notify:!0},editorModel:Object}}},{key:"ready",value:function(){Polymer.RenderStatus.afterNextRender(this,function(){this._resize=function(){this.debounce("resize",function(e){var t=this;this.buildLayout(),Polymer.RenderStatus.afterNextRender(this,function(){t.fire("iron-signal",{name:"col-widths-changed",data:{layout:t.editorModel.layout,groupKey:t.selectedGroupKey}})})},200)}.bind(this),window.addEventListener("resize",this._resize)})}},{key:"detached",value:function(){window.removeEventListener("resize",this._resize)}},{key:"_spliceObserver",value:function(e){e&&0!=e.indexSplices[0].addedCount&&(this.addedIndex=e.indexSplices[0].index,this.addedKey=e.indexSplices[0].object[this.addedIndex].groupVO.key,this.observersAttached||this._attachObservers())}},{key:"getGroupClass",value:function(e){if(this.editorModel){var t="";return this.selectedGroupKey!=e&&(t+="hiddenGroup"),this.editorModel.largeQuoteExperienceEnabled&&(t+=" largeQuote"),t}}},{key:"getContainerClass",value:function(){return this.editorModel.largeQuoteExperienceEnabled?"largeQuote":""}},{key:"toggle",value:function(){var e=this;"open"==this.drawerState?this.closePanel():this.openPanel(),Polymer.RenderStatus.afterNextRender(this,function(){e.fire("iron-signal",{name:"group-panel-toggled",data:{drawerState:e.drawerState,groupKey:e.selectedGroupKey}})})}},{key:"openPanel",value:function(){this.isMobile?this.$.drawerPanel.style.display="block":(this.$.drawerPanel.style.left="0px",this.$.mainPanel.style.paddingLeft="280px"),this.drawerState="open"}},{key:"closePanel",value:function(){this.isMobile?this.$.drawerPanel.style.display="none":this.$.drawerPanel.style.left="-256px",this.$.mainPanel.style.paddingLeft=!this.isMobile&&this.rightSideButton?"24px":"0px",this.drawerState="closed"}},{key:"groupPanelCreated",value:function(){this.isMobile||this.debounce("resize",function(e){var t=this;this.buildLayout(),Polymer.RenderStatus.afterNextRender(this,function(){t.fire("iron-signal",{name:"col-widths-changed",data:{layout:t.editorModel.layout}})})},50)}},{key:"groupAdded",value:function(e){this.navTo(e)}},{key:"groupDeleted",value:function(e){this.navTo(e)}},{key:"pageResized",value:function(e){e.detail.isFullScreenToggleEvent&&(this.buildLayout(),this.fire("iron-signal",{name:"col-widths-changed",data:{layout:this.editorModel.layout,groupKey:this.selectedGroupKey}}))}},{key:"_groupModelsAreChanged",value:function(){var e=this;this.drawerState?"closed"==this.drawerState&&(this.$.mainPanel.style.paddingLeft=!this.isMobile&&this.rightSideButton?"24px":"0px"):this.closePanel(),this.buildLayout(),Polymer.RenderStatus.afterNextRender(this,function(){e.observersAttached||e._attachObservers()})}},{key:"buildLayout",value:function(e){var t=this;if(!this.isMobile){var i=e?e.detail.group:null,n={},o=this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName],r=this.editorModel.actionsOnTheLeft,s=this.editorModel.data.settings.multiLineDeleteEnabled,a=0<this.editorModel.quoteModel.quoteVO.lineItems.length,l=0<this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames.length;n.totalWidth=a?this._getMaxTableWidth(this._getAvailableWidth(),o,r,s,l):this._getAvailableWidth(),i?i.colWidth=this._calculateGroupWidth(n,o,r,s,i,l):(this.editorModel.quoteModel.lineGroups.forEach(function(e){e.colWidth=t._calculateGroupWidth(n,o,r,s,e,l)}),this.set("editorModel.layout",n))}}},{key:"_getAvailableWidth",value:function(){var e=document.getElementById("sbPageContainer");if(e){var t=Polymer.dom(e.root).querySelector("sb-line-editor").clientWidth;return this.editorModel.quoteModel.grouped&&(t-=32,1<this.editorModel.quoteModel.lineGroups.length&&(t-=24,this.drawerState&&"open"==this.drawerState&&(t-=256))),t}}},{key:"_getMaxTableWidth",value:function(e,t,i,n,o){this.tableLayoutBuilder=new c(e,this._getQuoteStandardFields(),t,i,n,o),this.tableLayoutBuilder.build();var r=this.tableLayoutBuilder.getTotalWidth(),s=this.editorModel.quoteModel.quoteVO.multiSegmentColumns,a=this._getQuoteSegmentedFields();for(var l in s)if(s.hasOwnProperty(l)){var u=a.concat(s[l]).concat("total");this.tableLayoutBuilder=new c(e,u,t,i,n,o),this.tableLayoutBuilder.build();var d=this.tableLayoutBuilder.getTotalWidth();r<d&&(r=d)}return r}},{key:"_calculateGroupWidth",value:function(e,t,i,n,o,r){var s=o.groupKey,a=o.quoteModel.grouped?o.groupVO.multiSegmentColumns:o.quoteModel.quoteVO.multiSegmentColumns,l={};for(var u in this.tableLayoutBuilder=new c(e.totalWidth,this._getGroupStandardFields(s),t,i,n,r),l.Standard=this.tableLayoutBuilder.build(),e.leftOffset=this.tableLayoutBuilder.getLeftOffset(),a)a.hasOwnProperty(u)&&(this.tableLayoutBuilder=new c(e.totalWidth,this._getSegmentedFieldNames(o,a[u]),t,i,n,!1),l[u]=this.tableLayoutBuilder.build());return l}},{key:"_getQuoteStandardFields",value:function(){for(var e=!1,t=this.editorModel.quoteModel.lineGroups,i=0,n=t.length;i<n;i++)if(t[i].standardSubscriptionScopeEditable){e=!0;break}return this._getStandardFields(e)}},{key:"_getGroupStandardFields",value:function(e){var t=this.editorModel.quoteModel.groupsByKey[e];return this._getStandardFields(t.standardSubscriptionScopeEditable)}},{key:"_getStandardFields",value:function(e){var t=this.editorModel.fieldsetMap.lineFieldNames;return e&&(t=[this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(t)),t}},{key:"_getQuoteSegmentedFields",value:function(){for(var e=!1,t=this.editorModel.quoteModel.lineGroups,i=0,n=t.length;i<n;i++)if(t[i].segmentedSubscriptionScopeEditable){e=!0;break}var o=this.editorModel.data.multiSegmentLineSummaryFieldNames;return e?[this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(o):o}},{key:"_getSegmentedFieldNames",value:function(e,t){for(var i=this.editorModel.data.multiSegmentLineSummaryFieldNames,n=e.segmentedSubscriptionScopeEditable?[this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(i):i.slice(),o=0,r=t.length;o<r;o++)n.push(t[o].replace(/\W/g,""));return n.push("total"),n}},{key:"_attachObservers",value:function(){(this.rightSideButton||this.isMobile)&&(this.observersAttached=!0,this._observeNodes=Polymer.dom(this.$$("#groups")).observeNodes(function(e){var t=e.addedNodes.filter(function(e){return"SB-LE-GROUP"===e.nodeName&&e.groupModel.groupVO.key==this.addedKey}.bind(this)),i=e.removedNodes.filter(function(e){return"SB-LE-GROUP"===e.nodeName});t[0]!==i[0]&&(this.processNewGroups(t),this.processRemovedGroups(i))}.bind(this)))}},{key:"processNewGroups",value:function(e){if(this.addedKey&&0<e.length){var t=this.addedKey;this.isMobile&&this.closePanel(),this.toggleSelectedAndScroll(t),Polymer.dom(this.$$("#groups")).unobserveNodes(this._observeNodes),this.observersAttached=!1,this.addedKey=null}}},{key:"processRemovedGroups",value:function(e){this.lastSelectedGroup&&1==e.length&&(this.toggleClass("selected-tab",!1,this.lastSelectedGroup),this.lastSelectedGroup=void 0,Polymer.dom(this.$$("#groups")).unobserveNodes(this._observeNodes),this.observersAttached=!1)}},{key:"toggleSelectedAndScroll",value:function(e){var t=this.$$("#_"+e);this.lastSelectedGroup&&this.toggleClass("selected-tab",!1,this.lastSelectedGroup),"open"==this.drawerState&&(this.toggleClass("selected-tab",!0,t),this.lastSelectedGroup=t),this.$$("#Group_"+e)&&(this._scrollIntoView(this.$$("#Group_"+e)),this.$$("#_"+e).scrollIntoView(!1),this.isMobile&&(this.$$("#Group_"+e).set("groupModel.groupExpanded",!0),this.$$("#Group_"+e).groupExpanded=!0))}},{key:"_scrollIntoView",value:function(e){this.$$("#mainPanel").scrollTop=this.isMobile?e.offsetTop:e.offsetTop-15}},{key:"navTo",value:function(n){var o=this;if(n.stopPropagation(),this.isMobile){var r=n.target.querySelector(".loadingSpinner");r.toggleClass("invisible",!1)}Polymer.RenderStatus.afterNextRender(this,function(){var e=n.detail.groupKey||Polymer.dom(n).rootTarget.id.split("_")[1];if(o.toggleSelectedAndScroll(e),o.editorModel.largeQuoteExperienceEnabled){var t=o.selectedGroupKey,i=parseInt(e);o.set("selectedGroupKey",i),i!=t&&o.fire("iron-signal",{name:"group-toggled",data:{groupKey:o.selectedGroupKey}})}o.isMobile&&(Polymer.RenderStatus.afterNextRender(o,function(){r.toggleClass("invisible",!0)}),o.toggle())})}},{key:"_createDragDropModel",value:function(){if(this.editorModel){var e=new Set(["sb-droppable-sidePanelGroups"]);this.dragDrop=new o(this,this.editorModel.data.settings.bundleKeptTogether,"div",e,this.dragFunc.bind(this),this.trackFunc.bind(this),this.dropFunc.bind(this),8,150)}}},{key:"onTrack",value:function(e){this.isMobile||!i.isDesktop||this.editorModel.largeQuoteExperienceEnabled||this.dragDrop._onTrack(e)}},{key:"dragFunc",value:function(e){var t=this.dragDrop;t.ghost=this.dragDrop.lineEditor.$.ghost,t.dragIndex=e.dataIndex,t.dragGroupModel=this.groupModels[t.dragIndex],this.$$("#groupLayout"),this.toggleAttribute("hidden",!0,this.$.sbDroppableSidePanelGroups.querySelectorAll(".nav-item")[t.dragIndex])}},{key:"trackFunc",value:function(e){var t=this.dragDrop;(e=this.dragDrop._findSidePanelGroupValidTarget(e))?("placeholder"===e.id&&(e="before"===e.ref?e.previousElementSibling:e.nextElementSibling),t.hoverOver={comp:e,phLoc:"both"},t.targetHost=this,t.highlightableElements=[],t.highlightableElements.push(t.hoverOver.comp),t.usePlaceholder=!0,t.enableHighLight=!1):t.hoverOver=null}},{key:"dropFunc",value:function(e,t,i,n){var o=this.dragDrop;if(this.toggleAttribute("hidden",!1,this.$.sbDroppableSidePanelGroups.querySelectorAll(".nav-item")[o.dragIndex]),t){var r=this.$.sbDroppableSidePanelGroups.querySelectorAll(".nav-item").length-1;o.dropIndex=t.dataIndex,n?o.dropIndex=0<=o.dropIndex?o.dropIndex:0:++o.dropIndex,s(t),this.splice("groupModels",o.dragIndex,1),o.dropIndex<r?this.splice("groupModels",o.dropIndex,0,o.dragGroupModel):this.push("groupModels",o.dragGroupModel),o.lineEditor.renumber(),this.editorModel.data.settings.usesClientCalculator&&o.lineEditor.editorModel.quoteModel.renumberIndexes(!0)}}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"listeners",get:function(){return{"side-toggle-clicked":"toggle"}}},{key:"observers",get:function(){return["_groupModelsAreChanged(editorModel, groupModels, rightSideButton)","_spliceObserver(groupModels.splices)","_createDragDropModel(groupModels)"]}},{key:"isMobile",get:function(){return this.editorModel.deviceContext.isMobile}}]),r=e)),t("LEGroupLayout",r),Polymer(r)}}}),System.register("quotes/layout/sb-le-list/LEList.js",["quotes/models/UiNotifier.js","common/signal/RowFocusSignaler.js"],function(t,e){var i,o;return{setters:[function(e){i=e.registerComponent},function(e){e.RowFocusSignaler}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LEList",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-list",this.properties={model:{type:Object,observer:"_modelChanged"}}}},{key:"_modelChanged",value:function(){i(this),setTimeout(this._ironListResize.bind(this),100)}},{key:"ready",value:function(){this.addEventListener("line-toggled",this._onUpdateSizeForItem),this.ironList=this.$$("iron-list")}},{key:"_onUpdateSizeForItem",value:function(e){e.detail.index&&this.$$("iron-list").updateSizeForItem(e.detail.index)}},{key:"getZIndex",value:function(e){return this.$$("iron-list").items.length+10-e}},{key:"colWidthsChanged",value:function(){this._ironListResize()}},{key:"_ironListResize",value:function(){this.$$("iron-list").fire("iron-resize")}}]),o=e)),t("LEList",o),Polymer(o)}}}),System.register("quotes/layout/sb-le-list-group-footer-row/LEListGroupFooterRow.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LEListGroupFooterRow",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-list-group-footer-row",this.properties={model:Object}}}]),i=e)),t("LEListGroupFooterRow",i),Polymer(i)}}}),System.register("quotes/layout/sb-le-list-group-header-row/LEListGroupHeaderRow.js",["common/core/sb-page-container/PageContainer.js","quotes/models/GroupModel.js","common/layout/fields/FieldSetHandler.js","common/core/AppContext.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.PageContainer},function(e){e.GroupModel},function(e){o=e.FieldSetHandler},function(e){r=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LEListGroupHeaderRow",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-list-group-header-row",this.properties={model:Object,editorModel:{type:Object,notify:!0},subtotal:Number,subtotalMd:Object,value:{notify:!0,observer:"_descriptionChanged"},descriptionMd:Object,favorited:Boolean,viewport:{type:Object,value:function(){return i.getViewport()}},fieldNames:Array,isStandard:{type:Boolean,value:!1}}}},{key:"_showTabs",value:function(e){return e&&0<e.length}},{key:"_buildRow",value:function(){this.editorModel=this.model.quoteModel.editorModel,this.isStandard="Standard"===this.model.lineType&&0<this.model.standardLines.length,this._setSubtotal(),this._setGroupDescription(),this.isStandard&&(this.quoteLineFields=this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName],this.settings=this.editorModel.data.settings,this.fieldSetHandler=new o(this.editorModel.fieldsetMap,"lineFieldNames","lineFieldNamesTablet","lineFieldNamesPhone"),this._setFieldNames(),this.columnNames=null,this.fieldLabelsMap=this.editorModel.md.fieldLabelsMap,this.columnWidths={},this._setColumnWidths())}},{key:"_setFieldNames",value:function(){this.fieldSet=this.fieldSetHandler.getByViewport(this.viewport),this.fieldSetName!=this.fieldSet.name&&(this.fieldSetName=this.fieldSet.name),this.fieldNames=this.getFields()}},{key:"getFields",value:function(){return this.model.standardSubscriptionScopeEditable?[this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(this.fieldSet.fields):this.fieldSet.fields}},{key:"_setColumnWidths",value:function(){this.columnWidths=this.model.standardLineColumnWidths}},{key:"getStandardColWidths",value:function(){return this.editorModel.deviceContext.isMobile||!this.editorModel.layout?void 0:this.model.colWidth.Standard}},{key:"_groupRecordChanged",value:function(){var e=this.model.groupVO.record;this.favorited=!(!e||!e[this.editorModel.constants.FAVORITE_ID_FIELD])}},{key:"showGroupNameEditor",value:function(e){e.stopPropagation(),this.toggleClass("hidden",!0,this.$$("#groupHeaderName")),this.toggleClass("hidden",!1,this.$$("#groupNameInput")),this.$$("#groupNameInput").focus(),this.$$("#groupNameInput").setSelectionRange(0,this.model.groupVO.record.Name.length)}},{key:"checkInputValue",value:function(e){e.stopPropagation(),""!=e.target.value&&this.set("model.groupVO.record.Name",e.target.value),this.toggleClass("hidden",!1,this.$$("#groupHeaderName")),this.toggleClass("hidden",!0,this.$$("#groupNameInput"))}},{key:"closeGroupNameEditor",value:function(e){e.stopPropagation(),"13"==e.keyCode&&this.$$("#groupNameInput").blur()}},{key:"triggerCustomAction",value:function(e){this.fire("le-action-tapped",{customAction:{eventHandlerName:e.currentTarget.attributes.eventHandlerName.value},model:this.model})}},{key:"_setSubtotal",value:function(){if(this.model.quoteModel.grouped){var e=this.editorModel.data.settings,t=void 0,i=void 0,n=e.lineEditorGroupSubtotalsField;i="Default"==n||null==n?(t=e.isMultiCurrencyOrg?this.model.quoteModel.quoteVO.currencyDecimalScale:this.editorModel.md.fieldsMap[e.developerPrefix+"QuoteLineGroup__c"][this.editorModel.constants.NET_TOTAL_FIELD].scale,this.model.groupVO.record[this.editorModel.constants.NET_TOTAL_FIELD]||0):(t=e.isMultiCurrencyOrg?this.model.quoteModel.quoteVO.currencyDecimalScale:this.editorModel.md.fieldsMap[e.developerPrefix+"QuoteLineGroup__c"][n].scale,this.model.groupVO.record[e.lineEditorGroupSubtotalsField]||0),this.subtotalMd||(this.subtotalMd={type:"currency",scale:t,CurrencyIsoCode:this.model.quoteModel.quoteVO.record.CurrencyIsoCode}),this.subtotal=i}}},{key:"_setGroupDescription",value:function(){if(this.model.groupVO.record){if(this.value=this.model.groupVO.record[this.editorModel.constants.DESCRIPTION_FIELD],this.model&&this.editorModel.md){var e=this.editorModel.md.fieldsMap[this.model.groupObjectName];this.descriptionMd=e[this.editorModel.constants.DESCRIPTION_FIELD]}this.value||(this.value=r.properties.i18n.value().l("Click to edit description"))}}},{key:"_descriptionChanged",value:function(){var e=r.properties.i18n.value().l("Click to edit description");this.value!==e&&(this.model.groupVO.record[this.editorModel.constants.DESCRIPTION_FIELD]=this.value)}},{key:"_getRecordValue",value:function(e){return this.model.groupVO.record[e]}},{key:"_groupCustomActionsChanged",value:function(e){for(var t=e?e.length:0,i=0;i<t;i++)this.notifyPath("editorModel.groupCustomActions."+i+".children")}},{key:"observers",get:function(){return["_buildRow(model)","_groupCustomActionsChanged(editorModel.groupCustomActions)","_groupRecordChanged(model.groupVO.record.*)"]}}]),s=e)),t("LEListGroupHeaderRow",s),Polymer(s)}}}),System.register("quotes/layout/sb-le-list-row/LEListRow.js",["quotes/models/UiNotifier.js"],function(t,e){var a,l,i;return{setters:[function(e){a=e.registerComponent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}l={GroupModel:{GROUP_HEADER:"sb-le-list-group-header-row",GROUP_FOOTER:"sb-le-list-group-footer-row"},LineModel:{STANDARD_LINE:"sb-le-list-standard-line-row",SEGMENTED_LINE:"sb-le-list-segmented-line-row"}},t("LEListRow",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-list-row",this.properties={rowType:String,model:Object,index:Number}}},{key:"_dataChanged",value:function(e,t,i){var n=this.$.wrapper,o=l[t.constructor.name][e],r=n.children[0],s=r;r&&r.localName===o?r.set("model",t):(r&&n.removeChild(r),(s=document.createElement(o)).model=t,s.index=i,n.appendChild(s)),a(this),a(s)}},{key:"observers",get:function(){return["_dataChanged(rowType, model, index)"]}}]),i=e)),t("LEListRow",i),Polymer(i)}}}),System.register("quotes/layout/sb-le-list-segmented-line-row/LEListSegmentedLineRow.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LEListSegmentedLineRow",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-list-segmented-line-row",this.properties={model:Object}}}]),i=e)),t("LEListSegmentedLineRow",i),Polymer(i)}}}),System.register("quotes/layout/sb-le-list-standard-line-row/LEListStandardLineRow.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LEListStandardLineRow",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-list-standard-line-row",this.properties={model:Object,index:Number}}}]),i=e)),t("LEListStandardLineRow",i),Polymer(i)}}}),System.register("quotes/layout/sb-le-summary-row/LESummaryRow.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LESummaryRow",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-summary-row",this.properties={model:{type:Object,observer:"_modelChanged"},fieldNames:Array,summaries:Object}}},{key:"_modelChanged",value:function(e){this.toggleClass("largeQuote",e.editorModel.largeQuoteExperienceEnabled,this.$.container)}},{key:"_colWidthsChanged",value:function(e){this.notifyPath("model")}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),i=e)),t("LESummaryRow",i),Polymer(i)}}}),System.register("quotes/layout/sb-le-table-cell/DiscountConverter.js",["quotes/models/UiNotifier.js"],function(e,t){var l;function u(e){var t=e.getField(e.constants.REGULAR_PRICE_FIELD),i=void 0,n=void 0;return n=e.getField(e.constants.ADDITIONAL_DISCOUNT_RATE_FIELD)?(i=t*(e.getField(e.constants.ADDITIONAL_DISCOUNT_RATE_FIELD)/100),1):e.lineVO.targetCustomerAmount?(i=t-e.lineVO.targetCustomerAmount,1):e.lineVO.targetCustomerTotal?(i=t-e.lineVO.targetCustomerTotal/d(e),1):e.getField(e.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD)?(i=e.getField(e.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD),e.lineVO.amountDiscountProrated?e.getField(e.constants.PRORATE_MULTIPLIER_FIELD):1):(i=0,1),i*n}function d(e){var t=e.lineVO.record,i=t[e.constants.QUANTITY_FIELD],n=t[e.constants.PRIOR_QUANTITY_FIELD],o=t[e.constants.EXISTING_FIELD]?i-n:i;return"Block"!=t[e.constants.PRICING_METHOD_FIELD]&&"Slab"!=t[e.constants.DISCOUNT_SCHEDULE_TYPE_FIELD]||!t[e.constants.EXISTING_FIELD]||null==n||i-n!=0?"Block"==t[e.constants.PRICING_METHOD_FIELD]||"Slab"==t[e.constants.DISCOUNT_SCHEDULE_TYPE_FIELD]?1:t[e.constants.EXISTING_FIELD]&&e.dynamicSubscription&&0!=t[e.constants.LIST_PRICE_FIELD]&&0==o?i:"Amendment"==e.groupModel.quoteModel.quoteVO.record[e.constants.TYPE_FIELD]&&!e.subscription&&o<0?0:o:0}function c(e,t){return t===e.constants.ADDITIONAL_DISCOUNT_FIELD}return{setters:[function(e){l=e.setThenNotify}],execute:function(){function a(e,t){if(c(e,t)){var i=e.editorModel.data.additionalDiscountUnitOptions;return null!==e.lineVO.targetCustomerAmount&&void 0!==e.lineVO.targetCustomerAmount?{units:i,unit:"UnitOverride",displayValue:e.lineVO.targetCustomerAmount}:null!==e.lineVO.targetCustomerTotal&&void 0!==e.lineVO.targetCustomerTotal?{units:i,unit:"TotalOverride",displayValue:e.lineVO.targetCustomerTotal}:null!=e.getField(e.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD)?{units:i,unit:"Amount",displayValue:e.getField(e.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD)}:null!=e.getField(e.constants.ADDITIONAL_DISCOUNT_RATE_FIELD)?{units:i,unit:"Percent",displayValue:e.getField(e.constants.ADDITIONAL_DISCOUNT_RATE_FIELD)}:{units:i,unit:e.editorModel.data.defaultAdditionalDiscountUnit.replace(/ /g,""),displayValue:null}}var n=e.editorModel.data.markupUnitOptions;return null!=e.getField(e.constants.MARKUP_AMOUNT_FIELD)?{units:n,unit:"Amount",displayValue:e.getField(e.constants.MARKUP_AMOUNT_FIELD)}:null!=e.getField(e.constants.MARKUP_RATE_FIELD)?{units:n,unit:"Percent",displayValue:e.getField(e.constants.MARKUP_RATE_FIELD)}:{units:n,unit:e.editorModel.data.defaultMarkupUnit.replace(/ /g,""),displayValue:null}}function r(o,e,r){var t=a(o,e).displayValue;if(r){var s=o.lineVO.record,i=c(o,e)?function(){function e(){s[o.constants.ADDITIONAL_DISCOUNT_RATE_FIELD]=null,s[o.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD]=null,o.lineVO.targetCustomerAmount&&(o.lineVO.targetCustomerAmount=null),o.lineVO.targetCustomerTotal&&(o.lineVO.targetCustomerTotal=null)}var t=s[o.constants.REGULAR_PRICE_FIELD];if(null!=t){var i=u(o);if(e(),"Percent"==r)return s[o.constants.ADDITIONAL_DISCOUNT_RATE_FIELD]=i/t*100;if("Amount"!=r)return"UnitOverride"==r?o.lineVO.targetCustomerAmount=t-i:"TotalOverride"==r?o.lineVO.targetCustomerTotal=(t-i)*d(o):void 0;var n=o.lineVO.amountDiscountProrated?s[o.constants.PRORATE_MULTIPLIER_FIELD]:1;return s[o.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD]=i/n}e()}():function(){var e=s[o.constants.UNIT_COST_FIELD];if("Percent"===r){var t=s[o.constants.MARKUP_AMOUNT_FIELD];return null==t&&(t=0),s[o.constants.MARKUP_AMOUNT_FIELD]=null,s[o.constants.MARKUP_RATE_FIELD]=null!=e?t/e*100:null}var i=s[o.constants.MARKUP_RATE_FIELD];return null==i&&(i=0),s[o.constants.MARKUP_RATE_FIELD]=null,s[o.constants.MARKUP_AMOUNT_FIELD]=null!=e?e*(i/100):null}();return{unit:r,displayValue:isNaN(i)?isNaN(t)?null:t:i}}}e("getUnitAndDisplayValue",a),e("updateUnitIfAmountInactive",function(e,t){var i=a(e,t),n=i.units;if(i.unit,i.displayValue,e.getField(e.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD)&&!n.some(function(e){return"Amount"===e.value})){var o=e.getField(e.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD)&&n.some(function(e){return"Percent"===e.value})?"Percent":n[0].value;r(e,t,o)}}),e("setDiscountValue",function(e,t,i){var n=a(e,t),o=n.unit,r=n.displayValue,s=e.lineVO.record;r=c(e,t)?("Percent"===o?s[e.constants.ADDITIONAL_DISCOUNT_RATE_FIELD]=i:"Amount"===o?s[e.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD]=i:"UnitOverride"===o?e.lineVO.targetCustomerAmount=i:"TotalOverride"===o&&(e.lineVO.targetCustomerTotal=i),u(e)/(e.lineVO.amountDiscountProrated?s[e.constants.PRORATE_MULTIPLIER_FIELD]:1)):("Percent"===o?s[e.constants.MARKUP_RATE_FIELD]=i:"Amount"===o&&(s[e.constants.MARKUP_AMOUNT_FIELD]=i),s[e.constants.MARKUP_AMOUNT_FIELD]||(s[e.constants.UNIT_COST_FIELD]?s[e.constants.UNIT_COST_FIELD]*i/100:null)),l(e,["lineVO","record",e.constants.ADDITIONAL_DISCOUNT_FIELD],isNaN(r)?0:r)}),e("convertDiscountValue",r)}}}),System.register("quotes/layout/sb-le-table-cell/LETableCell.js",["../sb-le-table-cell/Swiper.js","../sb-le-table-cell/Localizer.js","../../../common/calculate/asset-upgrade-quantity-calculator/AssetUpgradeQuantityCalculator.js","../sb-le-table-cell/QuoteLineUpgradeHandler.js","common/core/AppContext.js","common/core/sb-page-container/PageContainer.js","common/relationship/RelationshipFieldManager.js"],function(t,e){var o,i,r,s,a,l,u,d;return{setters:[function(e){e.Swiper},function(e){o=e.Localizer},function(e){i=e.AssetUpgradeQuantityCalculator},function(e){r=e.QuoteLineUpgradeHandler},function(e){s=e.AppContext},function(e){a=e.PageContainer},function(e){l=e.RelationshipFieldManager}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}u={ICON:"sf-icon-chevrondown",TOP_LEVEL:"top-level",OPTION:"option",INDENT:"sbIndent",RIGHT:"right",CENTER:"center",OVERRIDDEN:"overridden"},t("LETableCell",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-table-cell",this.properties={item:String,value:{notify:!0},model:{type:Object,notify:!0},fieldClass:String,data:Object,display:String,index:Number,detailsOnHover:{type:Boolean,value:!1},renderTooltip:{type:Boolean,value:!1},viewport:{type:Object,value:function(){return a.getViewport()}},editable:Boolean,calculateImmediately:{type:Object,value:function(){return s.org.calculateImmediately}}}}},{key:"_onTap",value:function(){}},{key:"attached",value:function(){this.isAttached=!0,this.wasModelIsChangedCalledBeforeAttached&&this._modelIsChanged(),this.model.lineVO.record[this.constants.UPGRADED_ASSET_FIELD]&&this.model.groupModel.quoteModel.isAmendmentOrChangeQuote&&this.item===this.constants.QUANTITY_FIELD&&(this.quoteLineUpgradeHandler=new r(this.model),this.quoteLineUpgradeHandler.getSourceLineVO()&&this.quoteLineUpgradeHandler.getUpgradeLineVO()&&(this.addEventListener("value-changed",this._quantityChanged),this.assetUpgradeQuantityCalculator=new i(this.quoteLineUpgradeHandler)))}},{key:"_datePickerOpened",value:function(e){var t=e.detail.dateContainer,i=e.detail.datepicker,n=i.offsetParent.getBoundingClientRect(),o=t.getBoundingClientRect(),r=this.model.groupModel.quoteModel;!r.grouped&&r.editorModel.largeQuoteExperienceEnabled&&(i.style.left=-n.left+o.left+"px",i.style.top=o.bottom-n.top+"px"),o.left+i.offsetWidth>window.innerWidth&&(i.style.left="",i.style.right=n.right-o.right+17+"px"),e.stopPropagation()}},{key:"_modelIsChanged",value:function(){if(this.wasModelIsChangedCalledBeforeAttached=!this.isAttached,this.isAttached&&this.model)if(this.item!==this.constants.SUBSCRIPTION_SCOPE_FIELD||this.model.subscriptionScopeEditable){this.isMobile=this.viewport&&this.viewport.isMobile(),this.overrideEditable=this.classList.contains("mdqSummaryRow")||this.classList.contains("primary");var e=this._setEditable(),t=this._setFieldMD();this._setFieldClassAndFieldContent(t)||(!t.defaultValue||null!=this.value||t.controllingPicklist||t.dependentPicklist||(this.value=t.defaultValue),this.data&&this.value!=this.data[this.item]&&(this.value=this.data[this.item]),void 0===this.value&&(this.value=null),this.label=t.label,this.$.field.editing=e,this.$.field.md=t,this.$.field.property=this.item,this.model.segmented&&!/__c$/.test(this.item)&&"total"!=this.item&&(this.removeEventListener("mouseenter",this._showDetails),this.removeEventListener("mouseleave",this._showDetails),this.renderTooltip=!0,this.addEventListener("mouseenter",this._showDetails),this.addEventListener("mouseleave",this._showDetails)))}else this.fieldClass+=" "+u.OVERRIDDEN}},{key:"_updateOriginalValue",value:function(){this.model.lineVO&&(this.model.lineVO._transient_=this.model.lineVO._transient_||{},this.model.lineVO._transient_.original=this.model.lineVO._transient_.original||JSON.parse(JSON.stringify(this.model.lineVO.record)));var e=this.get("model.lineVO._transient_.original");this.$.field.originalValue=e[this.item]}},{key:"_dataOrValueChanged",value:function(){this.value==this.data[this.item]&&(this.internal=!0,this.userChangedLookupValue?this._updateRelationshipName():this._updateLookupDisplayValue(),this.$.field.value=this.value,this.internal=!1,this.userChangedLookupValue=!1)}},{key:"_updateRelationshipName",value:function(){this.model&&new l(this.item,this.data).addRelationshipName(this.value,this.display,this.model.getFieldMD(this.item).referenceTo[0])}},{key:"_updateLookupDisplayValue",value:function(){var e=new l(this.item,this.data);e.hasRelationship()?this.display=e.getRelationshipName():this.display=void 0}},{key:"_displayChanged",value:function(){this.userChangedLookupValue=!this.internal}},{key:"_setEditable",value:function(){return!this.overrideEditable&&this.model.isEditable(this.item)}},{key:"_editableChanged",value:function(){this.$.field.editing=!this.overrideEditable&&this.model.isEditable(this.item)}},{key:"_setFieldMD",value:function(){var e=this.model.getFieldMD(this.item)?this.model.getFieldMD(this.item):this.model.getFieldMD(this.constants.NET_TOTAL_FIELD);return e.CurrencyIsoCode=this.model.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode,this.constants.QUANTITY_FIELDS&&this.constants.QUANTITY_FIELDS.has(this.item)&&null!=this.model.lineVO.productQuantityScale&&(e=Object.assign({},e,{scale:this.model.lineVO.productQuantityScale})),e}},{key:"_setFieldClassAndFieldContent",value:function(e){var t="";if(this.model.editorModel.data.settings.productHierarchyVisualized&&!this.model.segmented&&(this.isMobile?this.item!==this.constants.PRODUCT_NAME_FIELD&&this.item!==this.constants.NET_TOTAL_FIELD||(t+=""+u.INDENT+this.record[this.constants.OPTION_LEVEL_FIELD]):this.item===this.constants.PRODUCT_NAME_FIELD&&(this.model.isBundle?t+=u.ICON+" ":this.model.component||(t+=u.TOP_LEVEL+" "),this.model.component&&(this.model.isBundle||(t+=u.OPTION+" "),t+=""+u.INDENT+this.record[this.constants.OPTION_LEVEL_FIELD]))),!this._isSegmentedDrawer()&&"number"!=e.type&&"double"!=e.type&&"percent"!=e.type&&"currency"!=e.type||(t+=" "+u.RIGHT,this.classList.contains("drawerCell")&&this._togglePreventNumericAlignment(),this._isSegmentedDrawer()&&this._toggleSegmentedAlignment()),"boolean"==e.type&&(t+=" "+u.CENTER),this.model.bundled&&this.item===this.constants.LIST_PRICE_FIELD)return this.overrideValue=s.properties.i18n.value().l("Included"),t+=" "+u.OVERRIDDEN,this.fieldClass=t,!0;var i=o.getLocalizedValue(this.model,this.item);return i?(this.overrideValue=i,t+=" "+u.OVERRIDDEN,this.fieldClass=t,!0):(this.fieldClass=t,!1)}},{key:"_togglePreventNumericAlignment",value:function(){this.$.field.preventNumericAlignment=!this.$.field.preventNumericAlignment}},{key:"_toggleSegmentedAlignment",value:function(){this.$.field.segmentedAlignment=!0}},{key:"_isSegmentedDrawer",value:function(){return"mdqSummaryRow"===this.model.itemClassMap.attributes&&!this.classList.contains("mdqSummaryRow")}},{key:"_quantityChanged",value:function(e){if(!this.model.internalUpdate){this.assetUpgradeQuantityCalculator.setQuantitiesByRatio();var t=this.quoteLineUpgradeHandler.getIndexes(),i=this.quoteLineUpgradeHandler.getSourceLineVO(),n=this.quoteLineUpgradeHandler.getUpgradeLineVO();this.fire("upgrade-asset-quantity-changed",{sourceIndex:t.sourceIndex,upgradeIndex:t.upgradeIndex,sourceLineVO:i,upgradeLineVO:n})}}},{key:"_handleFieldValueChanged",value:function(){this.calculateImmediately&&this.fire("calculate-immediately");var e={value:this.item};this.fire("field-updated",e)}},{key:"_showDetails",value:function(e){var t=e.type;this.detailsOnHover="mouseenter"==t}},{key:"_getLineModel",value:function(){if("total"!=this.item&&null!=this.model.segmentsByLabel)for(var e=Object.keys(this.model.segmentsByLabel),t=e.length,i=0;i<t;i++)if(e[i].replace(/\W/g,"")==this.item)return this.model.segmentsByLabel[e[i]];return this.model}},{key:"_getRecord",value:function(){return this._getLineModel().lineVO.record}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_modelIsChanged(model, index, viewport)","_displayChanged(display)","_dataOrValueChanged(data, value, item)","_updateOriginalValue(model, item)","_editableChanged(editable, model, item)"]}},{key:"listeners",get:function(){return{tap:"_onTap","datepicker-opened":"_datePickerOpened","sb-field-on-change-field":"_handleFieldValueChanged"}}},{key:"constants",get:function(){return this.model.editorModel.constants}},{key:"record",get:function(){return this.model.lineVO.record},set:function(e){this.model.lineVO.record=e}}]),d=e)),t("LETableCell",d),Polymer(d)}}}),System.register("quotes/layout/sb-le-table-cell/Localizer.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("Localizer",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,null,[{key:"getLocalizedValue",value:function(e,t,i){var n=e.editorModel.constants,o=e.groupModel.quoteModel.quoteVO.localizationByFieldByProductId[e.getField(n.PRODUCT)],r=e.getFieldMD(t);if(o&&r){var s=e.editorModel.data.developerPrefix,a=r&&r.calculatedFormula&&0===r.calculatedFormula.indexOf(s+"Product__r")?r.calculatedFormula.split(".")[1].replace(s,""):r.name,l=i?o[a][i]:o[a];if(l)return l.record[n.TEXT_FIELD]||l.record[n.TEXT_AREA_FIELD]||l.record[n.LONG_TEXT_AREA_FIELD]||l.record[n.RICH_TEXT_AREA_FIELD]}}}]),i=e)),t("Localizer",i)}}}),System.register("quotes/layout/sb-le-table-cell/QuoteLineUpgradeHandler.js",[],function(e,t){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.model=e,this.indexes={}}e("QuoteLineUpgradeHandler",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"isSourceLine",value:function(){return this.model.existing}},{key:"getLine",value:function(){return this.model.lineVO}},{key:"getLines",value:function(){return this.model.groupModel.standardLines}},{key:"getSourceOrUpgrade",value:function(e){var t=void 0;if(this.model.editorModel.data.settings.bundleKeptTogether)t=this._findLineWithTargetAssetId(e,this.model.groupModel);else for(var i=this.model.groupModel.quoteModel.lineGroups,n=0,o=i.length;n<o&&!t;n++)t=this._findLineWithTargetAssetId(e,i[n]);return t}},{key:"_findLineWithTargetAssetId",value:function(e,t){for(var i=!e,n=void 0,o=this.model.lineVO.record[this.constants.UPGRADED_ASSET_FIELD],r=0,s=t.standardLines.length;r<s;r++){var a=t.standardLines[r];if(a.lineVO.record[this.constants.UPGRADED_ASSET_FIELD]===o&&a.lineVO.record[this.constants.EXISTING_FIELD]===i){var l=i?"sourceIndex":"upgradeIndex";this.indexes[l]=r,n=a.lineVO}if(this.model.lineVO.key===a.lineVO.key){var u=!this.indexes.sourceIndex&&this.model.existing?"sourceIndex":"upgradeIndex";this.indexes[u]=r}}return n}},{key:"setSourceAndUpgrade",value:function(e,t){this.sourceLineVO=e,this.upgradeLineVO=t}},{key:"getSourceIdField",value:function(){return this.constants.PRODUCT}},{key:"getUpgradeConversionRateField",value:function(){return this.constants.UPGRADE_CONVERSION_RATE}},{key:"getSourceCurrentQuantityField",value:function(e){return e.record[this.constants.QUANTITY_FIELD]}},{key:"getUpgradeCurrentQuantityField",value:function(e){return e.record[this.constants.QUANTITY_FIELD]}},{key:"getSourcePriorQuantity",value:function(e){return e.record[this.constants.PRIOR_QUANTITY_FIELD]}},{key:"didSourceQuantityChange",value:function(e){return e}},{key:"didUpgradeQuantityChange",value:function(e){return!e}},{key:"isSelected",value:function(){return!0}},{key:"setUpdatedQuantity",value:function(e,t,i,n){e.record[this.constants.QUANTITY_FIELD]=i,t.record[this.constants.QUANTITY_FIELD]=n}},{key:"getIndexes",value:function(){return this.indexes}},{key:"getSourceLineVO",value:function(){return this.sourceLineVO}},{key:"getUpgradeLineVO",value:function(){return this.upgradeLineVO}},{key:"constants",get:function(){return this.model.fieldNames}}]),i=t)),e("QuoteLineUpgradeHandler",i)}}}),System.register("quotes/layout/sb-le-table-cell/Swiper.js",[],function(e,t){var o,i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.cell=e,this.primaryCells=e.parentElement.querySelectorAll(".primary")}75,-185,o=!50,e("Swiper",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"swipe",value:function(e){this.leTableRow||(this.leTableRow=this.cell.domHost.domHost);var t=this.cell.classList.contains("open");switch(e.state){case"start":if(50<Math.abs(e.dy)||!t&&0<e.dx||t&&e.dx<0)return;o=!0,this.leTableRow.classFollows("open",null,this.leTableRow.$$(".tr"));for(var i=0,n=this.primaryCells.length;i<n;i++)this.primaryCells[i].style.position="relative";break;case"track":if(!o)return;for(i=0,n=this.primaryCells.length;i<n;i++)this.primaryCells[i].style.left=(t?-185:0)+e.dx+"px";break;case"end":if(!o)return;for(o=!1,i=0,n=this.primaryCells.length;i<this.primaryCells.length;i++)this.primaryCells[i].style.left="",this.primaryCells[i].style.position="",e.dx<-75?(this.primaryCells[i].classFollows("open",this.primaryCells[i]),t=!0):75<e.dx&&(this.primaryCells[i].classFollows("open",null,this.primaryCells[i]),t=!1);t&&this.leTableRow.classFollows("open",this.leTableRow.$$(".tr"))}}}]),i=t)),e("Swiper",i)}}}),System.register("quotes/layout/sb-le-table-header/LETableHeader.js",["common/core/sb-page-container/PageContainer.js","quotes/models/UiNotifier.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.PageContainer},function(e){o=e.setThenNotify}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LETableHeader",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-table-header",this.properties={lineModels:{type:Object,notify:!0},fieldNames:Array,fieldLabelsMap:Object,fieldClasses:{type:Object,value:{}},constants:Object,fields:Object,settings:Object,actionsOnTheLeft:{type:Boolean,default:!1,computed:"_getActionsPlacement(settings)"},viewport:{type:Object,value:function(){return i.getViewport()}}}}},{key:"_getActionsPlacement",value:function(){return"Left"==this.settings.actionsColumnPlacement}},{key:"_buildRows",value:function(){for(var e=[],t={},i=0,n=this.fieldNames.length;i<n;i++){var o=this.fieldNames[i];e.push(o);var r=this.fields[o];!r||"number"!=r.type&&"double"!=r.type&&"percent"!=r.type&&"currency"!=r.type?r&&"boolean"==r.type&&(this.fieldClasses[r.name]="center"):t[this.fieldLabelsMap[o]]=!0}if(this.columnNames){for(var s=0,a=this.columnNames.length;s<a;s++){var l=this.columnNames[s].replace(/\W/g,"");e.push(l),t[this.fieldLabelsMap[l]]=!0}e.push("total"),this.fieldClasses[this.constants.SEGMENT_LABEL_FIELD]="hiddenInMobile",t[this.fieldLabelsMap.total]=!0}this.header&&this.header.group.length!=e.length&&this.header.destroyGroup(),this.header=this.$.header,this.data=void 0,this.header.model=t,this.header.model.isStandard=!(this.columnNames&&0<this.columnNames.length),this.header.model.settings=this.settings,this.header.itemClassMap=this.fieldClasses,this.header.groupClass=this.viewport&&this.viewport.isMobile()?"tgroup":"leGroup",this.header.columnWidths=this.columnWidths,this.header.group||(this.header.group=e),this.data=this.fieldLabelsMap,this.displayDrawerIcon=this.editorModel&&0<this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames.length&&!this.columnNames,this.columnNames&&(this.expansionIconClass="sf-icon-right"),this.displayDrawerIcon&&(this.lineItemDrawerIconClass="sf-icon-chevronright")}},{key:"_columnWidthsChanged",value:function(){!this.header||this.viewport&&this.viewport.isMobile()||(this.header.columnWidths=this.columnWidths)}},{key:"toggleAllLinesExpansion",value:function(){if(this.columnNames){var e="sf-icon-right"!=this.expansionIconClass;this.expansionIconClass=e?"sf-icon-right":"sf-icon-down";for(var t=0,i=this.lineModels.length;t<i;t++)this.set("lineModels."+t+".lineVO.expanded",!e),this.set("lineModels."+t+".expandedIconClass",this.expansionIconClass)}else if(0<this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames.length){var n="sf-icon-chevronright"!=this.lineItemDrawerIconClass;this.lineItemDrawerIconClass=n?"sf-icon-chevronright":"sf-icon-chevrondown";for(var o=0,r=this.lineModels.length;o<r;o++)this.set("lineModels."+o+".lineVO.expanded",!n),this.set("lineModels."+o+".lineItemDrawerIconClass",this.lineItemDrawerIconClass)}this.editorModel.largeQuoteExperienceEnabled&&this.fire("line-toggled",{index:null})}},{key:"toggleAllCheckBoxes",value:function(){for(var e=0;e<this.lineModels.length;e++)o(this.lineModels[e],["selected"],this.selected)}},{key:"deselectCheckbox",value:function(){this.set("selected",!1)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_buildRows(fieldNames, columnNames, fieldLabelsMap, fields, constants, columnWidths, settings)","_columnWidthsChanged(columnWidths)"]}}]),r=e)),t("LETableHeader",r),Polymer(r)}}}),System.register("quotes/layout/sb-le-table-header-cell/LETableHeaderCell.js",["common/core/AppContext.js","quotes/models/Constants.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.AppContext},function(e){o=e.Constants}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LETableHeaderCell",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-table-header-cell",this.properties={byOrder:String,model:{type:Object,observer:"_modelChanged"},showSortableHeader:{type:Boolean,computed:"_showSortableHeader(model)"},prefix:{type:String,value:function(){return this.constants=new o(i.org.prefix+"__"),i.org.prefix}},overflowTrue:{type:Boolean,value:!1}}}},{key:"_modelChanged",value:function(){Polymer.dom(this.$.headerCell).observeNodes(function(){var e=this.$$("#header");this.toggleClass("right",this.model[this.value],e);var t=this.model.settings&&this.model.settings.productHierarchyVisualized&&this.model.isStandard&&this.getAttribute("item")===this.constants.PRODUCT_NAME_FIELD;this.toggleClass("bundlesVisualized",t,e)}.bind(this))}},{key:"sortLines",value:function(e){for(var t="",i=this.parentElement.children,n=0;n<i.length;n++)i[n].toggleClass("asc",!1,i[n].$$("#header")),i[n].toggleClass("desc",!1,i[n].$$("#header")),i[n].$$("#arrow")&&i[n].toggleClass("sf-icon-arrowup",!0,i[n].$$("#arrow")),i[n].$$("#arrow")&&i[n].toggleClass("sf-icon-arrowdown",!1,i[n].$$("#arrow")),Polymer.dom(i[n]).classList.remove("column-selected");this.byOrder?"asc"===this.byOrder?(t="desc",this.toggleClass("sf-icon-arrowup",!1,this.$$("#arrow")),this.toggleClass("sf-icon-arrowdown",!0,this.$$("#arrow"))):"desc"===this.byOrder&&(t=""):(t="asc",this.toggleClass("sf-icon-arrowup",!0,this.$$("#arrow"))),this.sortByField=t?this._getKeyByValue(this.value,this.data):null,this.toggleClass("column-selected",t),(this.byOrder=t)&&this.toggleClass(t,!0,this.$$("#header")),this.fire("table-header-sort-clicked",{order:this.byOrder,field:this.sortByField})}},{key:"_showSortableHeader",value:function(){return!this.model.lineVO&&this.getAttribute("item")!==this.constants.ADDITIONAL_DISCOUNT_FIELD&&!this.classList.contains("hoverFieldHeader")}},{key:"_getKeyByValue",value:function(e,t){for(var i in t)if(t.hasOwnProperty(i)&&t[i]===e)return i}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}}]),r=e)),t("LETableHeaderCell",r),Polymer(r)}}}),System.register("quotes/layout/sb-le-table-row/LETableRow.js",["../../../common/core/sb-page-container/PageContainer.js","../../../common/core/AppContext.js","common/signal/RowFocusSignaler.js","quotes/models/LineModel.js","quotes/models/UiNotifier.js"],function(t,e){var i,r,o,s,a;return{setters:[function(e){i=e.PageContainer},function(e){r=e.AppContext},function(e){o=e.RowFocusSignaler},function(e){e.LineModel},function(e){s=e.registerComponent}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LETableRow",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-table-row",this.listeners={"row-swiped":"onRowSwiped","field-updated":"handleFieldValueChanged"},this.properties={lineModel:{type:Object,notify:!0,observer:"_modelChanged"},data:Object,fieldNames:Array,fieldLabelsMap:Object,columnNames:Array,columnWidths:Object,mobileCols:Array,lineNumber:Number,viewport:{type:Object,value:function(){return i.getViewport()}},isMobile:{type:Boolean,value:!1,computed:"_setIsMobile(viewport)"},isDesktopAndHasNoActionsOnTheLeft:{type:Boolean,value:!1},isDesktopAndHasActionsOnTheLeft:{type:Boolean,value:!1},mdqFields:{type:Set,value:new Set},expandDisabled:{type:Boolean,value:!1},showCheckbox:Boolean,dataIndex:{type:Number,reflectToAttribute:!0}}}},{key:"attached",value:function(){if(!this.isMobile){var e=void 0;e=this.ironList?this.ironList:this.lineModel.editorModel.largeQuoteExperienceEnabled?this.domHost.$$("iron-list"):null,this.signaler=this.signaler||new o(this,"row","sb-le-table-cell","root",this.dataIndex,"data-index",e),this.signaler.signalOnFocus("sb-row-focus-signal")}}},{key:"onRowSwiped",value:function(e){this.expandDisabled=e.detail.isOpen}},{key:"_buildRow",value:function(){if(this.lineModel.lineVO.key){var e={},t=[];if(this.columnNames){for(var i=0,n=this.fieldNames.length;i<n;i++){var o=this.fieldNames[i];e[o]=this.record[o],t.push(o)}var r={},s=0;for(n=this.lineModel.segments.length;s<n;s++){var a=this.lineModel.segments[s];r[a.lineVO.record[this.constants.SEGMENT_LABEL_FIELD].replace(/\W/g,"")]=a.lineVO.record[this.constants.NET_TOTAL_FIELD]}if(!this.isMobile){var l=0;for(n=this.columnNames.length;l<n;l++){var u=this.columnNames[l].replace(/\W/g,"");e[u]=void 0!==r[u]?r[u]:null,t.push(u),this.mdqFields.add(u)}}e.total=this.quoteVO.multiSegmentRowTotals[this.record[this.constants.SEGMENT_KEY_FIELD]],t.push("total"),this.mdqFields.add("total")}else e=this.lineModel.lineVO.record,t=this.fieldNames;if(this.lineNumber=this.record[this.constants.NUMBER_FIELD],this.displayDrawerIconCell=0<this.lineModel.editorModel.fieldsetMap.standardLineItemDrawerFieldNames.length&&!this.columnNames&&!this.isMobile,this.toggleClass("rowWithoutDrawerIcon",this.displayDrawerIconCell&&!this.lineModel.hasStandardLineItemDrawer,this),this.invalidPricebookEntry=0==this.lineModel.lineVO.validPricebookEntryExists,this.opportunityWarning=this.lineModel.groupModel.quoteModel.isPrimary&&0==this.lineModel.lineVO.opportunityLineItemExists&&this.invalidPricebookEntry,this.invalidEntryWarning=this.invalidPricebookEntry&&!this.opportunityWarning,this.isDesktopAndHasActionsOnTheLeft=!this.isMobile&&this.lineModel.editorModel.actionsOnTheLeft,this.isDesktopAndHasNoActionsOnTheLeft=!this.isMobile&&!this.lineModel.editorModel.actionsOnTheLeft,this.$$(".tr").classList.contains("open")&&this.classFollows("open",null,this.$$(".tr")),this.row=this.$$("#row"),this.row&&void 0!==this.row.group&&this.row.group.length!=t.length&&this.row.destroyGroup(),this.data=void 0,this.groupClass=this.viewport&&this.viewport.isMobile()?"tgroup":"leGroup",this.itemClassMap=this.lineModel.itemClassMap,this.widths=this.columnWidths,this.model=this.lineModel,this.row&&this.row.template&&(this.row.template.model=this.lineModel),this.primaryItems=this.mobileCols||[],this.groupDisplay=this.fieldLabelsMap,this.row&&this.row.group||(this.group=t),this.data=e,this.isMobile&&this.row&&(this.lineModel.lineVO.expanded||!1)!=(this.expanded||!1))if(null==this.expanded)this.lineModel.lineVO.expanded=!1;else{var d=document.createEvent("HTMLEvents");d.initEvent("tap",!0,!1);var c=Polymer.dom(this.$$("#row").root).querySelectorAll("sb-le-table-cell")[0];c&&c.dispatchEvent(d)}this.isMobile||this.lineModel.editorModel.largeQuoteExperienceEnabled||this.listen(this,"track","onTrack"),this.lineModel.editorModel.largeQuoteExperienceEnabled&&this.signaler&&(this.signaler.rowIndex=this.dataIndex),this.toggleClass("largeQuote",this.lineModel.editorModel.largeQuoteExperienceEnabled,this.$.root),this.toggleClass(this.lineModel.lineTypeClass,!0)}}},{key:"_columnWidthsChanged",value:function(){this.row&&!this.row.model.editorModel.deviceContext.isMobile&&(this.widths=this.columnWidths)}},{key:"onTrack",value:function(e){if(!(this.viewport&&this.viewport.isMobile()||!r.isDesktop)){for(var t=Polymer.dom(e).path,i=0,n=t.length;i<n;i++){var o=t[i].nodeName;if("SB-DIALOG"===o||"TEXTAREA"===o)return}this.domHost.onTrack(e)}}},{key:"_lineRecordChanged",value:function(e){if("lineModel.lineVO.fieldVisibility"===e.path)this._visibilityChanged();else if("lineModel.lineVO.fieldEditability"===e.path)this._editabilityChanged();else if("lineModel.selected"===e.path)this._selectedChanged();else{var t=e.path.split(".")[e.path.split(".").length-1];if(!e.path.endsWith("__c")&&!e.path.endsWith("__r")&&!this.mdqFields.has(t))return;this._handleFieldValueChanged(t),this.lineNumber=this.record[this.constants.NUMBER_FIELD],this.set("data."+t,e.value)}}},{key:"_visibilityChanged",value:function(){this.row=this.row||this.$$("#row"),this.lineModel.setItemClassMap(),this.row.itemClassMap=this.lineModel.itemClassMap}},{key:"_editabilityChanged",value:function(){this.row=this.row||this.$$("#row"),this.row.itemEditableMap=this.lineModel.lineVO.fieldEditability}},{key:"_selectedChanged",value:function(){this.lineModel.selected?this.lineModel.groupModel.quoteModel.selectedLinesByKey[this.lineModel.lineVO.key]=this.lineModel:delete this.lineModel.groupModel.quoteModel.selectedLinesByKey[this.lineModel.lineVO.key]}},{key:"expand",value:function(e){this.viewport&&this.viewport.isMobile()&&!this.expandDisabled&&this.$$("#row").fire("group-expanded",{path:Polymer.dom(e).path})}},{key:"_expanded",value:function(){this.viewport&&this.viewport.isMobile()&&!this.expandDisabled&&(this.enableEditableFields(),this.toggleLineExpansion())}},{key:"toggleLineExpansion",value:function(e){this.lineModel.lineVO.expanded!=this.expanded&&this.set("lineModel.lineVO.expanded",!this.lineModel.lineVO.expanded),this.lineModel.segmented?this.set("lineModel.expandedIconClass",this.lineModel.lineVO.expanded?"sf-icon-down":"sf-icon-right"):this.lineModel.hasStandardLineItemDrawer&&this.set("lineModel.lineItemDrawerIconClass",this.lineModel.lineVO.expanded?"sf-icon-chevrondown":"sf-icon-chevronright"),(this.lineModel.editorModel.largeQuoteExperienceEnabled||this.lineModel.editorModel.isMultiGroupViewEnabled)&&this.fire("line-toggled",{index:this.dataIndex})}},{key:"enableEditableFields",value:function(){var e=Polymer.dom(this.$$("#row").root).querySelectorAll("sb-le-table-cell"),t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0)o.value.$$("sb-field").renderReadOnly=!1}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"handleFieldValueChanged",value:function(e){var t=e.detail.value;this._handleFieldValueChanged(t)}},{key:"_handleFieldValueChanged",value:function(e){var t=[];switch(e){case this.constants.PRICE_EDITABLE_FIELD:t.push(this.constants.LIST_PRICE_FIELD);break;case this.constants.PRICING_METHOD_FIELD:t.push(this.constants.MARKUP_FIELD),t.push(this.constants.LIST_PRICE_FIELD);break;case this.constants.PRICING_METHOD_EDITABLE_FIELD:t.push(this.constants.PRICING_METHOD_FIELD);break;case this.constants.NON_DISCOUNTABLE_FIELD:t.push(this.constants.ADDITIONAL_DISCOUNT_FIELD)}this._handleFieldEditability(t)}},{key:"_handleFieldEditability",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;if(!this.lineModel.lineVO.fieldEditability){this.row=this.row||this.$$("#row");var a={},l=this.lineModel.isEditable(s);a[s]=l,this.row.itemEditableMap=a}}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"toggleOptional",value:function(e){this.columnNames&&(e.detail.groupKey&&e.detail.groupKey!=this.lineModel.groupModel.groupVO.key||this.set("data."+this.constants.OPTIONAL_FIELD,e.detail.toggleOptionalBoolean))}},{key:"_setIsMobile",value:function(e){if(e)return e.isMobile()}},{key:"_toggleSelection",value:function(e){var t=!this.lineModel||this.lineModel.editorModel.data.settings.multiLineDeleteEnabled,i=this.isMobile&&e.detail&&"open"===e.detail.drawerState;this.showCheckbox=t&&!this.expandDisabled&&!i}},{key:"_modelChanged",value:function(){s(this,"lineModel")}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_buildRow(fieldNames, columnNames, lineModel, columnWidths, viewport, dataIndex)","_lineRecordChanged(lineModel.*)","_columnWidthsChanged(columnWidths)","_expanded(expanded)","_toggleSelection(lineModel, expandDisabled)"]}},{key:"quoteVO",get:function(){return this.lineModel.editorModel.quoteModel.quoteVO}},{key:"constants",get:function(){return this.lineModel.editorModel.constants}},{key:"record",get:function(){return this.lineModel.lineVO.record}},{key:"selector",get:function(){return this.signaler?this.signaler.selector:null}}]),a=e)),t("LETableRow",a),Polymer(a)}}}),System.register("quotes/layout/sb-segmented-detail-row/SegmentedDetailRow.js",["quotes/models/LineModel.js","../../../common/core/sb-page-container/PageContainer.js","common/signal/RowFocusSignaler.js"],function(t,e){var o,i,r,s;return{setters:[function(e){o=e.LineModel},function(e){i=e.PageContainer},function(e){r=e.RowFocusSignaler}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SegmentedDetailRow",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-segmented-detail-row",this.properties={lineModel:{type:Object,notify:!0},viewport:{type:Object,value:function(){return i.getViewport()}},itemClassMap:{type:Object,value:{}},highlightRowOnFocus:{type:Boolean,observer:"_highlightRowOnFocus"},index:{type:Number,reflectToAttribute:!0}}}},{key:"ready",value:function(){this.expanded=!1}},{key:"expand",value:function(e){this.isMobile&&this.enableEditableFields(),this.$.column.fire("group-expanded",{path:Polymer.dom(e).path})}},{key:"enableEditableFields",value:function(){var e=Polymer.dom(this.$.column.root).querySelectorAll("sb-le-table-cell"),t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0)o.value.$$("sb-field").renderReadOnly=!1}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"_lineRecordChanged",value:function(e){if(e.path){var t=e.path.indexOf("#"),i=e.path.indexOf(".",t),n=e.path.substring(t+1,i);if(this._pathRefersToMySegmentRecord(n)){var o=e.path.split("."),r=o[o.length-1];"fieldEditability"==r?this._editabilityChanged():"fieldVisibility"==r?this._visibilityChanged():this.set("segmentRecord."+r,e.value)}}}},{key:"_lineModelChanged",value:function(){this.dimension=this.lineModel.lineVO.dimensionType,this.segmentModel=this.lineModel.segmentsByLabel[this.columnName]?this.lineModel.segmentsByLabel[this.columnName]:new o({key:null,record:{}},this.lineModel.groupModel);var e=this.$$("#column");if(this.isMobile&&e&&(this.lineModel.lineVO.expanded||!1)!=(this.expanded||!1)){var t=document.createEvent("HTMLEvents");t.initEvent("tap",!0,!1);var i=Polymer.dom(e.root).querySelectorAll("sb-le-table-cell")[0];i&&i.dispatchEvent(t)}}},{key:"_setGroup",value:function(){this.$.column.group||(this._initializeFieldVisibility(),this.$.column.group=this.detailFieldNames)}},{key:"_initializeFieldVisibility",value:function(){var t=this,i={};this.detailFieldNames.forEach(function(e){t.segmentModel.isFieldRendered(e,t.isMobile)||(i[e]=t.isMobile?"hiddenInMobile":"hiddenInDesktop")}),this.$.column.itemClassMap=i}},{key:"_visibilityChanged",value:function(){var n=this;this.segmentModel.lineVO.fieldVisibility&&this.detailFieldNames.forEach(function(e){var t=n.segmentModel.isFieldRendered(e,n.isMobile),i=[{class:"hiddenInMobile",value:!t},{class:"hiddenInDesktop",value:!t}];n.$.column.set("itemClassMap."+e,i)})}},{key:"_editabilityChanged",value:function(){this.$.column.itemEditableMap=this.segmentModel.lineVO.fieldEditability}},{key:"_pathRefersToMySegmentRecord",value:function(e){if(!this.segmentRecord)return!1;if(this.lineModel.segments&&!this.lineModel.segments[e])return!1;var t=this.lineModel.segments[e].lineVO,i=t.record[this.constants.SEGMENT_KEY_FIELD],n=t.record[this.constants.SEGMENT_INDEX_FIELD],o=t.record[this.constants.SEGMENT_LABEL_FIELD],r=this.segmentRecord[this.constants.SEGMENT_KEY_FIELD],s=this.segmentRecord[this.constants.SEGMENT_INDEX_FIELD],a=this.segmentRecord[this.constants.SEGMENT_LABEL_FIELD];return i===r&&n===s&&o===a}},{key:"_highlightRowOnFocus",value:function(){this.signaler=this.signaler||new r(this,"column","sb-le-table-cell",null,this.index),this.signaler.signalOnFocus("sb-row-focus-signal",!this.highlightRowOnFocus)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_lineRecordChanged(lineModel.segments.*)","_lineModelChanged(lineModel)","_setGroup(detailFieldNames, segmentRecord, segmentModel, mobileCols, fieldLabelsMap)"]}},{key:"constants",get:function(){return this.lineModel.editorModel.constants}},{key:"selector",get:function(){return this.signaler?this.signaler.selector:null}},{key:"isMobile",get:function(){this.viewport&&this.viewport.isMobile()}}]),s=e)),t("SegmentedDetailRow",s),Polymer(s)}}}),System.register("quotes/layout/sb-segmented-line-details/SegmentedLineDetails.js",["quotes/models/LineModel.js","common/core/sb-page-container/PageContainer.js","common/signal/RowFocusSignaler.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.LineModel},function(e){o=e.PageContainer},function(e){r=e.RowFocusSignaler}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SegmentedLineDetails",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-segmented-line-details",this.properties={lineModel:{type:Object,notify:!0},groupModel:{type:Object,notify:!0},fieldNames:Array,detailFieldNames:Array,fieldLabelsMap:Object,columnNames:Array,itemClassMap:{type:Object,value:{}},viewport:{type:Object,value:function(){return o.getViewport()}},tabIndex:{type:Number,computed:"_initTabIndex(viewport)"}}}},{key:"isMobile",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"getSegmentRecord",value:function(e){return this.lineModel.segmentsByLabel[e]?this.lineModel.segmentsByLabel[e].lineVO.record:new i({key:null,record:{}},this.lineModel.groupModel).lineVO.record}},{key:"segmentExists",value:function(e){return this.lineModel.segmentsByLabel[e]?"":"desktopOnly"}},{key:"forwardFocusDown",value:function(e){9!==e.keyCode||e.shiftKey||r.signalFirstEditableTargetFirstRow(this,"sb-segmented-detail-row","index")}},{key:"forwardFocusUp",value:function(e){9===e.keyCode&&e.shiftKey&&r.signalLastEditableTargetLastRow(this,"sb-segmented-detail-row",this.columnNames.length,"index")}},{key:"_buildRow",value:function(){this._setColumnWidths(),this.$.header.itemClassMap=this.itemClassMap,this.detailFieldNamesWithLabel=this.isMobile()?[this.lineModel.editorModel.constants.SEGMENT_LABEL_FIELD].concat(this.detailFieldNames):this.detailFieldNames,this.$.header.group||(this.$.header.group=this.detailFieldNamesWithLabel)}},{key:"_isActionsOnTheLeft",value:function(e){return e.actionsOnTheLeft}},{key:"_setColumnWidths",value:function(){if(!this.isMobile()){var e=this.columnWidths;if(e&&this.columnNames){for(var t=0,i=0,n=this.fieldNames.length;i<n;i++)t+=e[this.fieldNames[i]];this.fieldNamesColWidth=t+"px";for(var o=0,r=this.columnNames.length;o<r;o++){var s=this.columnNames[o].replace(/\W/g,"");this.colWidth=e[s]+"px"}this.totalColWidth=e.total+"px"}}}},{key:"_columnWidthsChanged",value:function(){this._setColumnWidths()}},{key:"_initTabIndex",value:function(){return this.isMobile()?-1:0}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_buildRow(detailFieldNames, fieldNames, lineModel, columnWidths)","_columnWidthsChanged(columnWidths)"]}}]),s=e)),t("SegmentedLineDetails",s),Polymer(s)}}}),System.register("quotes/layout/sf-le-table-row/ControllingField.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ControllingField",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"getFieldName",value:function(){}},{key:"updateControlledFields",value:function(e,t){}}]),i=e)),t("ControllingField",i)}}}),System.register("quotes/layout/sf-le-table-row/DesktopDelegate.js",["quotes/layout/sf-le-table-row/DeviceDelegate.js","quotes/layout/template-generator/TemplateGenerator.js"],function(t,e){var i,d,o,r;return{setters:[function(e){i=e.DeviceDelegate},function(e){d=e.TemplateGenerator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("DesktopDelegate",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),o(e,[{key:"initListeners",value:function(e){e.listeners.mouseover="onHovered",e.listeners.mouseout="onUnhovered",e.listeners["rte-esc"]="onRteCancel"}},{key:"expansionChanged",value:function(e,t,i){if(i.isSegmented){var n=i.$$(".segmentedContainer");n&&(n.classList.toggle(d.classNames.DOWN_ICON,e),n.classList.toggle(d.classNames.RIGHT_ICON,!e))}else{var o=i.$$(".drawerContainer span");o&&(o.classList.toggle(d.classNames.CHEVRON_DOWN_ICON,e),o.classList.toggle(d.classNames.CHEVRON_RIGHT_ICON,!e))}}},{key:"toggleInlineEdit",value:function(e,t,i,n,o){var r=e.querySelector(".w"),s=e.querySelector(".r"),a="richtextarea"===n.extraTypeInfo;if(o.toggleClass("hidden",t&&!a,s),o.toggleClass(d.classNames.EDIT_MODE,t&&!a,e),t){var l=(r=r||o._createWritableElement(i,e)).querySelector('input:not([type="hidden"]), checkbox, select, textarea, sb-rte');l&&setTimeout(function(){l.focus()},10)}else if(r&&(a||e.removeChild(r),o.commitPendingEdit())){var u=o._formatNewValue(i,n);setTimeout(function(){o.fire("line-toggled",{index:o.dataIndex})}),o._toggleDirtyClass(u,i,s)}}},{key:"onKeyDown",value:function(e,t){var i=!1;switch(e.keyCode){case 27:i=this._onEscapePress(e,t);break;case 32:i=this._onSpaceBarPress(e,t)}return i}},{key:"_onSpaceBarPress",value:function(e,t){var i=Polymer.dom(e).path[0];if(i.classList.contains(d.classNames.EDITABLE)&&i.classList.contains(d.classNames.BOOLEAN)||i.classList.contains(d.classNames.SELECTION)){var n=i.querySelector(".checkboxcontainer");if(n)return t.toggleCheckbox(n),!0}return!1}},{key:"_onEscapePress",value:function(e,t){var i=t.findElementForEvent(e,d.classNames.EDIT_MODE);if(i&&i.getAttribute("field"))if(i.getAttribute("field")===t._getEditorModel().constants.ADDITIONAL_DISCOUNT_FIELD){var n=i.querySelector("sb-discount");n&&n.resetToOriginal()}else t.setDiscardPendingEdit(!0);return!1}},{key:"applyFocus",value:function(e,t,i){var n=i.getTableComponent(t);n&&n.applyCellFocus(e)}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}}]),r=e)),t("DesktopDelegate",r)}}}),System.register("quotes/layout/sf-le-table-row/DeviceDelegate.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("DeviceDelegate",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"initListeners",value:function(e){}},{key:"onTap",value:function(e,t){}},{key:"expansionChanged",value:function(e,t,i){}},{key:"toggleInlineEdit",value:function(e,t,i,n,o){}},{key:"onKeyDown",value:function(e,t){}},{key:"applyFocus",value:function(e,t,i){}}]),i=e)),t("DeviceDelegate",i)}}}),System.register("quotes/layout/sf-le-table-row/EditabilityControllingField.js",["quotes/layout/sf-le-table-row/ControllingField.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.ControllingField}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("EditabilityControllingField",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),o(e,[{key:"updateControlledFields",value:function(i,e){var n=this;if(this._getEditableFieldValues().includes(e)){var o=!1;this._getControlledFields().forEach(function(e){if(i.lineModel.isFieldRendered(e)&&i.lineModel.isEditable(e)){var t=i.querySelector("div[field='"+e+"']");t&&(o=!0,t.classList.add("editable"))}}),o&&i._handleEditableCellsHover(!0)}else this._getControlledFields().forEach(function(e){if(i.lineModel.isFieldRendered(e)){var t=i.querySelector("div[field='"+e+"']");t&&t.classList.remove("editable"),n._shouldClearFieldValue()&&i._clearFieldValue(e)}})}},{key:"_getControlledFields",value:function(){return[]}},{key:"_getEditableFieldValues",value:function(){return[]}},{key:"_shouldClearFieldValue",value:function(){return!0}}]),r=e)),t("EditabilityControllingField",r)}}}),System.register("quotes/layout/sf-le-table-row/MobileDelegate.js",["quotes/layout/sf-le-table-row/DeviceDelegate.js","quotes/layout/template-generator/TemplateGenerator.js"],function(t,e){var i,s,o,r;return{setters:[function(e){i=e.DeviceDelegate},function(e){s=e.TemplateGenerator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("MobileDelegate",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),o(e,[{key:"initListeners",value:function(e){e.listeners["row-swiped"]="onRowSwiped"}},{key:"onTap",value:function(e,t){if(e&&!t.expansionDisabled&&t.findElementForEvent(e,"primary")){var i=t.toggleExpanded(),n=t.querySelector("sb-swipe-container");null!==n&&(n.groupExpanded=i)}}},{key:"onRowSwiped",value:function(e,t){e&&e.detail&&(t.expansionDisabled=e.detail.isOpen)}},{key:"expansionChanged",value:function(e,t,i){if(!i.expansionDisabled){var n=i.$$(".container.first");if(n){var o=i.$$(".secondary");o||(this._loadSecondaryFields(i),o=i.$$(".secondary")),n.classList.toggle(s.classNames.EXPANDED,e),o.classList.toggle(s.classNames.EXPANDED,e)}}}},{key:"_loadSecondaryFields",value:function(i){i.templateInstance=i.hydrateTemplateFromNode(i.secondaryRowTemplate.cloneNode(!0),i.uiData),Polymer.dom(i.$.content).appendChild(i.templateInstance.root),Array.from(i.$$(".secondary").children).forEach(function(e){if(e.classList.contains(s.classNames.EDITABLE)&&!e.classList.contains(s.classNames.BOOLEAN)){var t=e.querySelector(".r");t&&i.toggleClass("hidden",!0,t),i.toggleInlineEdit(e,!0)}})}},{key:"toggleInlineEdit",value:function(e,t,i,n,o){var r=e.querySelector(".w");o.toggleClass(s.classNames.EDIT_MODE,t,e),t?r||o._createWritableElement(i,e):r&&o.commitPendingEdit()&&(o._formatNewValue(i,n),r.removeChild(r.firstChild),o._createEditField(r,e.getAttribute("index"),i))}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}}]),r=e)),t("MobileDelegate",r)}}}),System.register("quotes/layout/sf-le-table-row/NonDiscountableControllingField.js",["quotes/QuoteContext.js","quotes/layout/sf-le-table-row/EditabilityControllingField.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.QuoteContext},function(e){o=e.EditabilityControllingField}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("NonDiscountableControllingField",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,o),r(e,[{key:"getFieldName",value:function(){return i.constants.NON_DISCOUNTABLE_FIELD}},{key:"_getControlledFields",value:function(){return[i.constants.ADDITIONAL_DISCOUNT_FIELD,i.constants.ADDITIONAL_DISCOUNT_RATE_FIELD,i.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD]}},{key:"_getEditableFieldValues",value:function(){return[!1]}}]),s=e)),t("NonDiscountableControllingField",s)}}}),System.register("quotes/layout/sf-le-table-row/PriceEditableControllingField.js",["quotes/QuoteContext.js","quotes/layout/sf-le-table-row/EditabilityControllingField.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.QuoteContext},function(e){o=e.EditabilityControllingField}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("PriceEditableControllingField",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,o),r(e,[{key:"getFieldName",value:function(){return i.constants.PRICE_EDITABLE_FIELD}},{key:"_getControlledFields",value:function(){return[i.constants.LIST_PRICE_FIELD]}},{key:"_getEditableFieldValues",value:function(){return[!0]}},{key:"_shouldClearFieldValue",value:function(){return!1}}]),s=e)),t("PriceEditableControllingField",s)}}}),System.register("quotes/layout/sf-le-table-row/PricingMethodControllingField.js",["quotes/QuoteContext.js","quotes/layout/sf-le-table-row/EditabilityControllingField.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.QuoteContext},function(e){o=e.EditabilityControllingField}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("PricingMethodControllingField",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,o),r(e,[{key:"getFieldName",value:function(){return i.constants.PRICING_METHOD_FIELD}},{key:"_getControlledFields",value:function(){return[i.constants.MARKUP_FIELD,i.constants.MARKUP_AMOUNT_FIELD,i.constants.MARKUP_RATE_FIELD]}},{key:"_getEditableFieldValues",value:function(){return["Cost"]}}]),s=e)),t("PricingMethodControllingField",s)}}}),System.register("quotes/layout/sf-le-table-row/PricingMethodEditableControllingField.js",["quotes/QuoteContext.js","quotes/layout/sf-le-table-row/EditabilityControllingField.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.QuoteContext},function(e){o=e.EditabilityControllingField}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("PricingMethodEditableControllingField",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,o),r(e,[{key:"getFieldName",value:function(){return i.constants.PRICING_METHOD_EDITABLE_FIELD}},{key:"_getControlledFields",value:function(){return[i.constants.PRICING_METHOD_FIELD]}},{key:"_getEditableFieldValues",value:function(){return[!0]}},{key:"_shouldClearFieldValue",value:function(){return!1}}]),s=e)),t("PricingMethodEditableControllingField",s)}}}),System.register("quotes/layout/sf-le-table-row/SFLETableRow.js",["common/formatter/Formatter.js","quotes/sf-component-factory/SFComponentFactory.js","quotes/models/LineModel.js","quotes/tables/SFAbstractTable.js","common/behaviors/SFTableRowBehavior.js","quotes/layout/template-generator/TemplateGenerator.js","common/forms/NumberParser.js","quotes/models/UiNotifier.js","common/forms/DateParser.js","common/forms/DependentPicklistBuilder.js","common/core/AppContext.js","common/behaviors/DeviceBehavior.js","quotes/layout/sf-le-table-row/DesktopDelegate.js","quotes/layout/sf-le-table-row/MobileDelegate.js","quotes/QuoteContext.js","quotes/layout/sf-le-table-row/ControllingField.js","quotes/layout/sf-le-table-row/PricingMethodControllingField.js","quotes/layout/sf-le-table-row/NonDiscountableControllingField.js","quotes/layout/sf-le-table-row/PricingMethodEditableControllingField.js","quotes/layout/sf-le-table-row/PriceEditableControllingField.js"],function(t,e){var s,a,l,o,i,r,u,d,c,h,p,f,g,y,v,m,b,_,S,k;return{setters:[function(e){s=e.Formatter},function(e){a=e.SFComponentFactory},function(e){l=e.LineModel},function(e){o=e.SFAbstractTable},function(e){i=e.SFTableRowBehavior},function(e){r=e.TemplateGenerator},function(e){u=e.NumberParser},function(e){d=e.registerComponent},function(e){c=e.DateParser},function(e){h=e.DependentPicklistBuilder},function(e){p=e.AppContext},function(e){f=e.DeviceBehavior},function(e){g=e.DesktopDelegate},function(e){y=e.MobileDelegate},function(e){v=e.QuoteContext},function(e){e.ControllingField},function(e){m=e.PricingMethodControllingField},function(e){b=e.NonDiscountableControllingField},function(e){_=e.PricingMethodEditableControllingField},function(e){S=e.PriceEditableControllingField}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SFLETableRow",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sf-le-table-row",this.properties=Polymer.Base.extend({lineModel:{type:Object,notify:!0,observer:"_modelChanged"},uiData:{type:Object,observer:"_populateContent"},isSegmented:{type:Boolean,value:!1},columnWidths:{type:Object,observer:"_columnsResized"},originalFieldValues:{type:Object,value:{}},secondaryRowTemplate:{type:Object},isDirty:Boolean,dataIndex:{type:Number,reflectToAttribute:!0},expansionDisabled:{type:Boolean,value:!1}},i.properties),this.listeners={tap:"onTap",change:"onChange","selected-date-changed":"onChange","rte-value-changed":"onChange","lookup-value-changed":"onChange"},this.observers=["_recordChanged(lineModel.lineVO.record.*)","_expansionChanged(lineModel.lineVO.expanded)","_selectionChanged(lineModel.selected)"]}},{key:"created",value:function(){this._deviceDelegate=p.isMobile?y.getInstance():g.getInstance(),this._deviceDelegate.initListeners(this)}},{key:"ready",value:function(){this.shadyRoot&&this.scopeSubtree(this.$.content,!0),this.deviceClasses="";var e=(new f).getDeviceClasses(),t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this.deviceClasses+=s+" "}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"getControllingFields",value:function(){return[new m,new b,new _,new S]}},{key:"_rowTemplateChanged",value:function(e,t){this.templateInstance&&(Polymer.dom(this.$.content).innerHTML="",this.templateInstance=null),this._populateContent()}},{key:"_populateContent",value:function(){var t=this;this.rowTemplate&&this.uiData&&(this.templateInstance?Object.keys(this.uiData).forEach(function(e){t.templateInstance[e]=t.uiData[e]}):(this.templateInstance=this.hydrateTemplateFromNode(this.rowTemplate.cloneNode(!0),this.uiData),Polymer.dom(this.$.content).appendChild(this.templateInstance.root)),this._resetPencilLoaded(),this._refreshDirtyIndicators(),this.uiData.hasLineWarning&&this._loadLineWarning())}},{key:"_loadLineWarning",value:function(){var e=this.querySelector("#itemNumber .warning");if(e&&!e.hasChildNodes()){var t=document.createElement("sf-line-warning");t.key=this.uiData.lineWarningKey,t.message=this.uiData.lineWarningMsg,e.appendChild(t)}}},{key:"_recordChanged",value:function(e,t){if(this.templateInstance){var i=e.path;if(i!==l.recordPath){var n=i.substring(l.recordPath.length+1),o=e.value,r=this._getFieldMetadata(n);r&&(this.templateInstance[n]=s.formatFieldData(this.lineModel,o,r,this._getRecord()),this._handleChangeControllingField(r.name,e.value))}else this.templateInstance.lineModel=this.lineModel}}},{key:"_createEditField",value:function(e,t,i){var n=this._getFieldMetadata(i),o=a.getFieldComponent(n,this.lineModel,t),r={};o.attachTo(r);var s=this.hydrateTemplate(o.html,r);e.appendChild(s.root)}},{key:"onChange",value:function(e){var t=o.findCell(e);if(t){var i=t.getAttribute("field"),n=this._getFieldMetadata(i);e.detail&&(this._pendingEdit={field:i,eventDetail:e.detail,eventType:e.type},"richtextarea"===n.extraTypeInfo&&(this.toggleInlineEdit(t,!1),t.removeChild(t.querySelector(".w")),this._applyFocus(t,e)))}}},{key:"setDiscardPendingEdit",value:function(e){this._discardPendingEdit=e}},{key:"commitPendingEdit",value:function(){var e=!1;if(this._pendingEdit&&!this._discardPendingEdit){var t=this._pendingEdit.field,i=this._pendingEdit.eventDetail,n=this._pendingEdit.eventType;this._preserveOriginalValue(t);var o=this._getFieldMetadata(t);this._getRecord()[t]=this._parseFieldData(o,i.value),o&&(o.controllingPicklist?this._updateDependentPicklist(t):o.relationshipName&&"lookup-value-changed"===n?this._getRecord()[o.relationshipName]=null==i.value?void 0:{Id:i.value,Name:i.refDisplay}:this._handleChangeControllingField(o.name,i.value)),e=!0,this._calculateImmediately(t)&&this.fire("calculate-immediately")}return this._discardPendingEdit=!1,this._pendingEdit=null,e}},{key:"onRteCancel",value:function(e){var t=o.findCell(e);this.toggleInlineEdit(t,!1),t.removeChild(t.querySelector(".w")),this._applyFocus(t,e)}},{key:"_updateDependentPicklist",value:function(o){var r=this,e=this._getEditorModel().getDependentFields(o);e&&0<e.length&&e.forEach(function(e){var t=r._getFieldValue(e);if(null!==t){var i=r._getFieldMetadata(e),n=new h(i,r._getFieldValue(o)).build();("multipicklist"===i.type?t.split(";"):[t]).some(function(t){return!n.some(function(e){return e.value===t})&&(r._clearFieldValue(e),r._updateDependentPicklist(e),!0)})}})}},{key:"_handleChangeControllingField",value:function(t,i){var n=this;this.getControllingFields().forEach(function(e){e.getFieldName()==t&&e.updateControlledFields(n,i)})}},{key:"_parseFieldData",value:function(e,t){if(""===t||null===t)return null;switch(e.type){case"currency":case"double":case"percent":return(new u).parse(t,!1,e.scale);case"date":case"datetime":var i=(new c).parse(t);return"date"===e.type?s.toApexDate(i):s.toApexDateTime(i);default:return t}}},{key:"toggleInlineEdit",value:function(e,t,i){var n=2<arguments.length&&void 0!==i&&i;if(e&&e.classList.contains("editable")){var o=e.getAttribute("field"),r=this._getFieldMetadata(o);"boolean"!==r.type&&"checkbox"!==r.type&&(t&&n&&"richtextarea"===r.extraTypeInfo||(v.isDiscountField(o)&&t&&(this._preserveOriginalValue(v.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD),this._preserveOriginalValue(v.constants.ADDITIONAL_DISCOUNT_RATE_FIELD),this._preserveOriginalValue(v.constants.ADDITIONAL_DISCOUNT_FIELD)),this._deviceDelegate.toggleInlineEdit(e,t,o,r,this)))}}},{key:"_formatNewValue",value:function(e,t){var i=this._getFieldValue(e),n=s.formatFieldData(this.lineModel,i,t,this._getRecord());return this.templateInstance[e]=n,i}},{key:"_createWritableElement",value:function(e,t){var i=document.createElement("div");i.className="w";var n=t.getAttribute("index");return this._createEditField(i,n,e),t.appendChild(i),i}},{key:"hook_onHovered",value:function(e){this.isSegmented&&this._handleSegmentedCellHover(e),this._handleEditableCellsHover()}},{key:"hook_onTap",value:function(e,t,i){var n=this._getEditorModel();this._deviceDelegate.onTap(e,this),t||!n.hasDrawerFields()||this.findElementForEvent(e,"drawerContainer")&&this.toggleDrawer();var o=this.findElementForEvent(e,"checkboxcontainer");o&&this.toggleCheckbox(o),t||!this.lineModel.segments||this.findElementForEvent(e,"segmentedContainer")&&this.toggleDrawer()}},{key:"onKeyDown",value:function(e){this._deviceDelegate.onKeyDown(e,this)}},{key:"onRowSwiped",value:function(e){this._deviceDelegate.onRowSwiped(e,this)}},{key:"toggleCheckbox",value:function(e){if(e&&e.parentElement){var t=e.parentElement.parentElement,i=e.querySelector("input[type=checkbox]");if(t&&i)if(t.classList.contains(r.classNames.EDITABLE)){var n=t.getAttribute("field");n&&this.set("lineModel.lineVO.record."+n,!i.checked)}else e.parentElement.classList.contains(r.classNames.SELECTION)&&this._getEditorModel().data.settings.multiLineDeleteEnabled&&(this.set("lineModel.selected",!i.checked),i.checked?this.lineModel.groupModel.quoteModel.selectedLinesByKey[this.lineModel.lineVO.key]=this.lineModel:delete this.lineModel.groupModel.quoteModel.selectedLinesByKey[this.lineModel.lineVO.key])}}},{key:"findElementForEvent",value:function(e,i){return Polymer.dom(e).path.find(function(e){var t=e.classList;return t&&t.contains(i)})}},{key:"toggleDrawer",value:function(){this.toggleExpanded(),(this._getEditorModel().largeQuoteExperienceEnabled||this._getEditorModel().isMultiGroupViewEnabled)&&this.fire("line-toggled",{index:this._getLineNumber()-1})}},{key:"toggleExpanded",value:function(){var e=!this.lineModel.lineVO.expanded;return this.set("lineModel.lineVO.expanded",e),e}},{key:"_expansionChanged",value:function(e,t){this._deviceDelegate.expansionChanged(e,t,this)}},{key:"_selectionChanged",value:function(){var e=this.$$(".checkboxcontainer");e&&!e.classList.contains(r.classNames.DISABLED)&&(e.querySelector("input[type=checkbox]").checked=this.lineModel.selected)}},{key:"_getFieldMetadata",value:function(e){return this._getEditorModel().getFieldMetadata(e)}},{key:"_getEditorModel",value:function(){return this.lineModel.editorModel}},{key:"_getLineNumber",value:function(){return this.uiData.lineNumber}},{key:"_getRecord",value:function(){return this.uiData.lineModel.lineVO.record}},{key:"_getFieldValue",value:function(e){return this._getRecord()[e]}},{key:"_clearFieldValue",value:function(e){this._preserveOriginalValue(e),this.set("lineModel.lineVO.record."+e,null),this.templateInstance&&(this.templateInstance[e]=null)}},{key:"_modelChanged",value:function(){d(this,"lineModel"),this.unlisten(this,"track","onTrack"),this._isDragAndDropEnabled()&&this.listen(this,"track","onTrack")}},{key:"_isDragAndDropEnabled",value:function(){return p.isDesktop&&!this.lineModel.editorModel.largeQuoteExperienceEnabled}},{key:"_handleSegmentedCellHover",value:function(e){var t=this.findElementForEvent(e,"container");if(t){var i=t.getAttribute("field");if(i&&!i.endsWith("__c")&&"total"!==i&&!t.querySelector("paper-tooltip")){var n=document.createElement("paper-tooltip");n.position="bottom",n.animationDelay=0,t.appendChild(n);var o=document.createElement("sf-segmented-cell-tooltip");o.lineModel=this.lineModel,o.field=i,Polymer.dom(n).appendChild(o)}}}},{key:"_handleEditableCellsHover",value:function(e){var t=this;if(!this._pencilLoaded||e){var i=this.querySelectorAll(".container.editable");if(i&&0<i.length){var n=Array.from(i);n.forEach(function(e){if(!e.querySelector("span.pencil")){var t=document.createElement("span");if(t.classList.add(r.classNames.EDIT_ICON),e.classList.contains(r.classNames.RIGHT)||e.classList.contains(r.classNames.CENTER)){var i=e.querySelector("div.r");i.insertBefore(t,i.firstChild)}else e.querySelector("div.r").appendChild(t)}}),setTimeout(function(){t.fire("line-toggled",{index:t.dataIndex})})}this._pencilLoaded=!0}}},{key:"_preserveOriginalValue",value:function(e){var t=this._getRecordOrSourceId();this.originalFieldValues[t]||(this.originalFieldValues[t]={}),this.originalFieldValues[t].hasOwnProperty(e)||(this.originalFieldValues[t][e]=this._getRecord()[e])}},{key:"_toggleDirtyClass",value:function(e,t,i){if(i){var n=this._getRecordOrSourceId(),o=this.originalFieldValues[n];o&&((v.isDiscountField(t)?this._isAdditionalDiscountUpdated(o):o.hasOwnProperty(t)&&o[t]!==e)?(i.classList.contains(r.classNames.DIRTY)||i.classList.add(r.classNames.DIRTY),this.isDirty=!0):i.classList.remove(r.classNames.DIRTY))}}},{key:"_isAdditionalDiscountUpdated",value:function(e){var t=v.constants.ADDITIONAL_DISCOUNT_RATE_FIELD,i=v.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD,n=v.constants.ADDITIONAL_DISCOUNT_FIELD,o=void 0!==this._getRecord()[i]&&void 0!==e[i]&&e[i]!==this._getRecord()[i],r=void 0!==this._getRecord()[n]&&void 0!==e[n]&&e[n]!==this._getRecord()[n],s=void 0!==this._getRecord()[t]&&void 0!==e[t]&&e[t]!==this._getRecord()[t];return o||r||s}},{key:"_resetPencilLoaded",value:function(){this._pencilLoaded&&(Array.from(this.querySelectorAll(".container.editable span.pencil")).forEach(function(e){e.parentNode.removeChild(e)}),this._pencilLoaded=!1)}},{key:"_refreshDirtyIndicators",value:function(){var i=this;if(0!==Object.keys(this.originalFieldValues).length){this.isDirty&&(Array.from(this.querySelectorAll("div.groupDetails div.r")).forEach(function(e){e.classList.toggle("dirty",!1)}),this.isDirty=!1);var e=this._getRecordOrSourceId(),n=this.originalFieldValues[e];n&&Object.keys(n).forEach(function(e){if(v.isDiscountField(e)?i._isAdditionalDiscountUpdated(n):n[e]!==i._getRecord()[e]){var t=i.querySelector("div.td[field='"+e+"'] div.r");i._enableDirtyClass(t)}})}}},{key:"_enableDirtyClass",value:function(e){e&&(e.classList.toggle("dirty",!0),this.isDirty=!0)}},{key:"_getRecordOrSourceId",value:function(){return this._getRecord().Id||this._getRecord()[this._getEditorModel().constants.SOURCE_FIELD]}},{key:"_columnsResized",value:function(i,e){var n=this;null!=i&&null!=e&&Object.keys(i).forEach(function(e){var t=n.$$("div.container[field='"+e+"']");t&&(t.style.minWidth=i[e]+"px",t.style.maxWidth=i[e]+"px")})}},{key:"onTrack",value:function(e){if(e){for(var t=Polymer.dom(e).path,i=0,n=t.length;i<n;i++){var o=t[i].nodeName;if("SB-DIALOG"===o||"TEXTAREA"===o)return}this.domHost.onTrack(e)}}},{key:"deepCloneNode",value:function(){var e=this.cloneNode(!0),t=this.$$("#content div:first-child").cloneNode(!0);return e.querySelector("#content").appendChild(t),e}},{key:"_applyFocus",value:function(e,t){this._deviceDelegate.applyFocus(e,t,this)}},{key:"_calculateImmediately",value:function(e){if(p.org.calculateImmediately){if(null===this.lineModel.quoteModel.quoteVO.record[v.constants.TARGET_CUSTOMER_AMOUNT])return!0;for(var t=[v.constants.ADDITIONAL_DISCOUNT_AMOUNT_FIELD,v.constants.ADDITIONAL_DISCOUNT_RATE_FIELD,v.constants.ADDITIONAL_DISCOUNT_FIELD],i=0;i<t.length;i++)if(t[i]===e)return!1;return!0}return!1}},{key:"behaviors",get:function(){return[Polymer.Templatizer,window.CommonBehaviors.SFTableRowBehavior]}}]),k=e)),t("SFLETableRow",k),Polymer(k)}}}),System.register("quotes/layout/sf-line-actions/SFLineActions.js",["quotes/models/LineModel.js","common/core/AppContext.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.LineModel},function(e){o=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SFLineActions",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sf-line-actions",this.properties={lineModel:{Object:Object,observer:"_modelChanged"},actions:Array,showInfoIcon:{type:Boolean,computed:"_isShowInfoIcon(lineModel)"}}}},{key:"ready",value:function(){this.toggleClass("mobile",o.isMobile)}},{key:"_modelChanged",value:function(){var t=this;this.lineModel&&this.lineModel instanceof i&&(this.actions=this.lineModel.editorModel.lineCustomActions.filter(function(e){return!e.isHidden(t.lineModel)}))}},{key:"handleAction",value:function(e){var t=e.model.get("action");if(t){if("showDSModal"===t.eventHandlerName)return void this.fire("iron-signal",{name:"schedule-action",data:{event:e,model:this.lineModel}});"tap"===e.type&&this.fire("le-action-tapped",{customAction:t,model:this.lineModel})}}},{key:"_isShowInfoIcon",value:function(e){return!o.isMobile&&e&&e.hasParent}}]),r=e)),t("SFLineActions",r),Polymer(r)}}}),System.register("quotes/layout/sf-line-warning/SFLineWarning.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SFLineWarning",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sf-line-warning",this.properties={key:String,message:String}}}]),i=e)),t("SFLineWarning",i),Polymer(i)}}}),System.register("quotes/layout/sf-segmented-cell-tooltip/SFSegmentedCellTooltip.js",["quotes/ui-data-manager/UIDataManager.js","common/behaviors/SFTableRowBehavior.js","quotes/layout/template-generator/TemplateGenerator.js"],function(t,e){var o,a,i;return{setters:[function(e){o=e.UIDataManager},function(e){e.SFTableRowBehavior},function(e){a=e.TemplateGenerator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SFSegmentedCellTooltip",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sf-segmented-cell-tooltip",this.properties={lineModel:Object,field:String},this.observers=["_init(lineModel, field)"]}},{key:"ready",value:function(){this.shadyRoot&&this.scopeSubtree(this.$.content,!0)}},{key:"_init",value:function(){if(this.lineModel&&this.field){var e=this._getSegmentedLine(),t=this.lineModel.editorModel,i=t.data.multiSegmentLineFieldNames,n=t.md.fieldsMap[t.data.quoteLineObjectName],o=t.md.fieldLabelsMap,r=this._prepareLineData(e,i,n),s=(new a).generateSegmentedTooltipFieldSetTemplate(i,o,t);this.templateInstance=this.hydrateTemplate(s,r),Polymer.dom(this.$.content).appendChild(this.templateInstance.root)}}},{key:"_prepareLineData",value:function(e,t,i){return o.prepareLineData([e],t,i)[0]}},{key:"_getSegmentedLine",value:function(){var t=this,e=this.lineModel;if(this.lineModel&&null!=this.lineModel.segmentsByLabel){var i=Object.keys(this.lineModel.segmentsByLabel).find(function(e){return t.field===e.replace(/\W/g,"")});i&&(e=this.lineModel.segmentsByLabel[i])}return e}},{key:"behaviors",get:function(){return[Polymer.Templatizer,window.CommonBehaviors.SFTableRowBehavior]}}]),i=e)),t("SFSegmentedCellTooltip",i),Polymer(i)}}}),System.register("quotes/layout/template-generator/LETemplateGenerator.js",["quotes/layout/template-generator/TemplateGenerator.js","quotes/QuoteContext.js"],function(e,t){var r,s,i,d,o;return{setters:[function(e){r=e.TemplateGenerator},function(e){s=e.QuoteContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t,i,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(u.__proto__||Object.getPrototypeOf(u)).call(this));return r.editorModel=e,r.groupModel=t,r.segmentedColumns=i,r.dimension=n,r.isSecondary=o,r}i=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},d=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(n):void 0},e("LETemplateGenerator",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(u,r),i(u,[{key:"generateRowNode",value:function(e,t){var i=this.generateRow(e),n=document.createElement("div");return t&&Object.keys(t).forEach(function(e){n.setAttribute(e,t[e])}),n.innerHTML=i,n}},{key:"generateRow",value:function(e){var t=void 0,i=!1;if(this.segmentedColumns){i=!0;var n=[];this.segmentedColumns.forEach(function(e){var t=e.replace(/\W/g,"");n.push(t)}),n.push("total"),t=d(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"generateSegmentedFieldSetTemplate",this).call(this,e,n,this.dimension,this.groupModel,this.editorModel,this.isSecondary)}else t=d(u.prototype.__proto__||Object.getPrototypeOf(u.prototype),"generateFieldSetTemplate",this).call(this,e,this.groupModel,this.editorModel,this.isSecondary);var o=this.generateActionsTemplate(),r=this.generateItemNumberTemplate(i),s=this.generateCheckboxTemplate("",this.editorModel,this.isSecondary),a=this.generateDrawerCellTemplate(),l="";return l+=s+r+t,l=this.addLineActionsToTemplate(l,o),l+=a}},{key:"generateActionsTemplate",value:function(){return'<div id="swipe-menu" class="td actionsContainer lineActions sf-le-table-row"><sf-line-actions line-model="[[lineModel]]"></sf-line-actions></div>'}},{key:"generateItemNumberTemplate",value:function(e){return'<div tabindex="0" class="td focusable sf-le-table-row" id="itemNumber"><span>[[lineNumber]]</span><span class="warning"></span>'+(e?'<span id="expandCollapseIcon" class="sf-icon-right segmentedContainer" ></span>':"")+"</div>"}},{key:"generateDrawerCellTemplate",value:function(){return!this.segmentedColumns&&this.editorModel.hasDrawerFields()?'<div class="td focusable drawerContainer sf-le-table-row"><span class="sf-icon-chevronright"></span></div>':""}},{key:"getColumnClass",value:function(e){var t=this.editorModel.getFieldMetadata(e);null!=t&&null!=t||!this.segmentedColumns||(t=this.editorModel.getFieldMetadata(s.constants.NET_TOTAL_FIELD));var i="",n=t.type,o=r.classNames;return"number"==n||"double"==n||"percent"==n||"currency"==n?i=o.RIGHT+" ":"boolean"==n&&(i=o.CENTER+" "+o.BOOLEAN+" "),i}},{key:"addLineActionsToTemplate",value:function(e,t){return this.editorModel.actionsOnTheLeft?t+e:e+t}}]),o=u)),e("LETemplateGenerator",o)}}}),System.register("quotes/layout/template-generator/MobileLETemplateGenerator.js",["quotes/layout/template-generator/LETemplateGenerator.js"],function(e,t){var i,o,a,r;return{setters:[function(e){i=e.LETemplateGenerator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(s.__proto__||Object.getPrototypeOf(s)).apply(this,arguments))}o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},a=function e(t,i,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,i);if(void 0===o){var r=Object.getPrototypeOf(t);return null===r?void 0:e(r,i,n)}if("value"in o)return o.value;var s=o.get;return void 0!==s?s.call(n):void 0},e("MobileLETemplateGenerator",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,i),o(s,[{key:"getPrimaryClass",value:function(e,t){return t?"":0===e?"primary first":"primary multi"}},{key:"generateInnerFieldSetTemplate",value:function(e,t,i,n,o){var r=4<arguments.length&&void 0!==o?o:0;return n?a(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"generateInnerFieldSetTemplate",this).call(this,e,t,i,n,r):"<div id='swipe-header'>"+a(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"generateInnerFieldSetTemplate",this).call(this,e,t,i,n,r)+"</div>"}},{key:"generateRow",value:function(e){return this.isSecondary?a(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"generateRow",this).call(this,e):'<sb-swipe-container variant="ui3qle">'+a(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"generateRow",this).call(this,e)+"</sb-swipe-container>"}},{key:"addLineActionsToTemplate",value:function(e,t){return e+t}},{key:"generateActionsTemplate",value:function(){return this.isSecondary?"":a(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"generateActionsTemplate",this).call(this)}},{key:"getFieldLabel",value:function(e,t){return t?'<span class="field-label">'+e.label+"</span>":""}},{key:"getColWidths",value:function(e,t){return null}},{key:"generateItemNumberTemplate",value:function(e){return""}},{key:"generateDrawerCellTemplate",value:function(){return""}}]),r=s)),e("MobileLETemplateGenerator",r)}}}),System.register("quotes/layout/template-generator/TemplateGenerator.js",["quotes/QuoteContext.js","common/core/AppContext.js"],function(t,e){var l,o,i;return{setters:[function(e){e.QuoteContext},function(e){l=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}o={CHEVRON_DOWN_ICON:"sf-icon-chevrondown",CHEVRON_RIGHT_ICON:"sf-icon-chevronright",RIGHT_ICON:"sf-icon-right",DOWN_ICON:"sf-icon-down",OPTION:"option",RIGHT:"right",CENTER:"center",OVERRIDDEN:"overridden",TOP_LEVEL:"top-level",INDENT:"sbIndent",EDITABLE:"editable",DISABLED:"disabled",BOOLEAN:"boolean",HAS_FOCUS:"sf-has-focus",EDIT_ICON:"pencil",SECONDARY:"secondary",EXPANDED:"expanded",EDIT_MODE:"editMode",SELECTION:"selection",DIRTY:"dirty",HIDE_CHECKBOX:"hideCheckbox"},t("TemplateGenerator",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"generateFieldSetTemplate",value:function(e,t,i,n){var o=this.getColWidths(t);return this.generateInnerFieldSetTemplate(e,o,i,n)}},{key:"generateSegmentedTooltipFieldSetTemplate",value:function(e,t,i){var n=this,o="<table><tbody>";return e.forEach(function(e){o+="<tr><th>"+t[e]+"</th><td>","boolean"===i.getFieldMetadata(e).type?o+=n.generateCheckboxTemplate(e,i):o+="[["+e+"]]",o+="</td>"}),o+="</tbody></table>"}},{key:"generateSegmentedFieldSetTemplate",value:function(e,t,i,n,o,r){var s=this.getColWidths(n,i),a=this.generateInnerFieldSetTemplate(e,s,o,r);return l.isMobile||(a+=this.generateInnerFieldSetTemplate(t,s,o,r,e.length)),a}},{key:"generateInnerFieldSetTemplate",value:function(e,r,s,a,t){var l=this,u="",d=4<arguments.length&&void 0!==t?t:0;return e.forEach(function(e){var t=s.getFieldMetadata(e),i=l.getColumnClass(e),n=t?t.type:null,o=l.getPrimaryClass(d,a);switch(t&&"richtextarea"===t.extraTypeInfo&&(n="richtextarea"),t&&t.calculatedFormula&&t.calculatedFormula.includes("IMAGE")&&(n="image"),t&&t.calculated&&t.htmlFormatted&&(n="formulaHtml"),u+='<div tabindex="0" class$="container td sf-le-table-row focusable '+o+" "+i+" {{computeCellClass(rowIndex, '"+e+"', _cellClasses)}}\"",r&&(u+='style="min-width:'+r[e]+"px;max-width:"+r[e]+'px"'),u+=' index="'+d+'" field="'+e+'" >',u+=l.getFieldLabel(t,a),u+='<div class="r">',e=isNaN(e)?e:"TimeSegment"+e,n){case"boolean":u+=l.generateCheckboxTemplate(e,s,a);break;case"image":u+='<div class="imgFormula" inner-h-t-m-l="[['+e+']]"></div>';break;case"richtextarea":case"formulaHtml":u+='<div class="htmlField" inner-h-t-m-l="[['+e+']]"></div>';break;case"url":u+='<a href="[['+e+']]" target="_blank">[['+e+"]]</a>";break;default:u+="[["+e+"]]"}u+="</div>",u+="</div>",d++}),u}},{key:"generateCheckboxTemplate",value:function(e,t,i){var n="";return(""!==e||t.data.settings.multiLineDeleteEnabled&&""===e&&!i)&&(n+=""!==e?'<div class="checkboxcontainer"><input type="checkbox" class="hidden" checked="[['+e+']]">':'<div tabindex="0" class="td focusable '+o.SELECTION+' sf-le-table-row"><div class$="checkboxcontainer sf-le-table-row {{computeCellClass(rowIndex, \'_selectionCB\', _cellClasses)}}"><input type="checkbox" class="hidden">',n+='<div class="paper-checkbox"><div class="checkmark"></div></div></div>',""===e&&(n+="</div>")),n}},{key:"getColumnClass",value:function(e){return""}},{key:"getPrimaryClass",value:function(e,t){return""}},{key:"getFieldLabel",value:function(e,t){return""}},{key:"getColWidths",value:function(e,t){return t?e.colWidth[t]:e.colWidth.Standard}}],[{key:"classNames",get:function(){return o}}]),i=e)),t("TemplateGenerator",i)}}}),System.register("quotes/md/sb-le-field-md/LEFieldMD.js",["common/core/AppContext.js","quotes/models/Constants.js"],function(t,e){var i,d,o;return{setters:[function(e){i=e.AppContext},function(e){d=e.Constants}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LEFieldMD",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-field-md",this.properties={data:{type:Object},prefix:{type:String,value:function(){return i.org.prefix?i.org.prefix+"__":""}},md:{type:Object,notify:!0},error:{type:Object,notify:!0}}}},{key:"ready",value:function(){this.$.describe.addEventListener("describe-changed",function(e){var t=e.detail.value.md,i={},n={};this.constants||(this.constants=new d(this.prefix));var o=this.constants.UNIT_PRICE_FIELDS,r=this.constants.QUANTITY_FIELDS;for(var s in t){var a=s.split("."),l=a[0],u=a[1];i[l]||(i[l]={}),o.has(t[s].name)?t[s].scale=this.settings.priceScale:"currency"==t[s].type&&this.settings.isMultiCurrencyOrg?t[s].scale=this.currencyDecimalScale:r.has(t[s].name)&&(t[s].scale=this.settings.quantityScale||0===this.settings.quantityScale?this.settings.quantityScale:t[s].scale),i[l][u]=t[s],n[u]=t[s].label}this.md={fieldsMap:i,fieldLabelsMap:n}}.bind(this)),this.$.describe.addEventListener("error-changed",function(e){this.error=e.detail.value}.bind(this))}},{key:"getFieldNames",value:function(){var e=[];for(var t in this.data)for(var i=0,n=this.data[t].length;i<n;i++){var o=this.data[t][i];e.push(t+"."+o)}this.$.describe.fields=e}},{key:"observers",get:function(){return["getFieldNames(data, prefix)"]}}]),o=e)),t("LEFieldMD",o),Polymer(o)}}}),System.register("quotes/pages/sb-line-editor/LineEditor.js",["../../../common/Util.js","../../../common/core/Page.js","../../../common/core/Navigator.js","../../models/EditorModel.js","quotes/models/GroupModel.js","quotes/models/DragDropModel.js","quotes/precaching/JSQCPrecacheWorkerManager.js","common/data/client/ConnectionClient.js","common/core/AppContext.js","common/rules/QuoteRuleExecutor.js"],function(t,e){var i,o,r,s,a,l,u,d,c,h;return{setters:[function(e){e.Util},function(e){i=e.Page},function(e){o=e.Navigator},function(e){r=e.EditorModel},function(e){e.GroupModel},function(e){e.DragDropModel,e.isComponent,e.removeTopBottomBorderClass},function(e){s=e.JSQCPrecacheWorkerManager},function(e){a=e.ConnectionClient},function(e){l=e.AppContext},function(e){u=e.QuoteRuleExecutor}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},53,77,t("LineEditor",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),c(e,[{key:"beforeRegister",value:function(){this.is="sb-line-editor",this.properties=Polymer.Base.extend({rawData:{type:Object},data:{type:Object,observer:"_dataIsChanged"},md:{type:Object,notify:!0},editorModel:{type:Object,notify:!0},groupModels:{type:Array},errors:{type:Array,notify:!0},quoteLevelTabs:{type:Array,value:[]},pageLoaded:{type:Boolean,value:!1},rules:Array},i.properties)}},{key:"_updateIronList",value:function(){this.editorModel.largeQuoteExperienceEnabled&&this.fire("iron-signal",{name:"update-iron-list",data:{index:null}})}},{key:"_loadObjectMD",value:function(){var e=this.app.org.prefix?this.app.org.prefix+"__":"";this.mdObjects=[e+"QuoteLineGroup__c",e+"QuoteLine__c",e+"Quote__c",e+"DiscountTier__c",e+"DiscountSchedule__c"]}},{key:"_loadProductRules",value:function(){var e=l.org.hasQuoteSelectionProductRules&&l.org.isJSProductRulesEnabled;return!1===e&&(this.rules={}),e}},{key:"_executeCustomAction",value:function(e){var t=!0;switch(e.detail.customAction.eventHandlerName){case"onAddProducts":case"onSave":case"onQuickSave":case"onFlagCalculate":t=l.user.hasQuoteEditPermission}!1!==t?this.eventDetail=e.detail:this.errors=[this.i18n.l("Insufficient privileges to perform that action")]}},{key:"attached",value:function(){document.addEventListener("LineEditor-cached",function(){this.needsInit=!0}.bind(this))}},{key:"_createEditorModel",value:function(){if(this.ctx.params&&"onFlagCalculate"==this.ctx.params.cmd&&(this.data.quote.calculationRequired=!0,this.ctx.params.cmd=null),this.data.quote.calculationRequired)this.$.customActionServices.onFlagCalculate(this.pageLoaded);else{if(this.editorModel=new r(this.data,this.md,this),this._updateFieldLabelsMap(),this._handleGroupCustomActions(),this.groupModels=this._getGroupModels(),this.rightSideButton=!this.editorModel.deviceContext.isMobile&&1<this.groupModels.length&&this.editorModel.quoteModel.grouped,this.quoteId=this.editorModel.quoteModel.quoteVO.record.Id,this.hasQuoteFieldSet=0<this.editorModel.fieldsetMap.quoteFieldNames.length,this._viewportChanged(this.editorModel.deviceContext.isMobile),this.renumber(),this.quoteHasNoLines(),this.ctx.params&&null!=this.ctx.params.cmd?(this._executeCmd(this.ctx.params.cmd),this.ctx.params.cmd=null):this.$.sbLineEditorRead.isLastReadQuoteUnopened&&this.editorModel.quoteModel.quoteVO.isCoTermPrompted?this._navigateToContractLookupPage():this.editorModel.quoteModel.quoteVO.record[this.editorModel.constants.PRICEBOOK_ID_FIELD]?this._executeDefaultCustomAction():this._handleMissingPricebook(),this._loadProductRules()&&this._redirectToLineEditor()?this.executeProductRules():this.pageLoaded=!0,(this.editorModel.deviceContext.isMobile||this.editorModel.largeQuoteExperienceEnabled)&&(this.quoteTotalDisplayed=!0),this.editorModel.largeQuoteExperienceEnabled){this.quoteDetailsIconClass="sf-icon-chevrondown";var e=this.returnGroupKeyAfterQuickSave?this.returnGroupKeyAfterQuickSave:this.ctx.params.groupKey,t=e&&this.editorModel.quoteModel.groupsByKey[e]?e:this.groupModels[0].groupKey}this.selectedGroupKey=this.editorModel.largeQuoteExperienceEnabled?t:null,this._isSubtitleCombined()}}},{key:"_isSubtitleCombined",value:function(){this.subtitleCombined=this.editorModel.largeQuoteExperienceEnabled&&"doNotDisplay"!=this.data.settings.lineEditorTotalsField&&0<this.data.quote.lineItems.length}},{key:"_handleGroupCustomActions",value:function(e){if(this.editorModel){var t=this.viewport&&this.viewport.isDesktop()&&this.viewport.M.up;if(this.editorModel.groupCustomActions=t?this.editorModel.customActionsByLocation.Group:[this.editorModel.groupMobileMenuButtonAction],e||t||(this.editorModel.groupCustomActions[0].label=this.editorModel.customActionsByLocation.Group[0].label,this.editorModel.groupCustomActions[0].first=this.editorModel.customActionsByLocation.Group[0].first,this.editorModel.groupCustomActions[0].eventHandlerName=this.editorModel.customActionsByLocation.Group[0].eventHandlerName,this.editorModel.groupCustomActions[0].record=this.editorModel.customActionsByLocation.Group[0].record),e&&this.groupModels)for(var i=0,n=this.groupModels.length;i<n;i++)this.notifyPath("groupModels."+i+".editorModel.groupCustomActions")}}},{key:"_handleMissingPricebook",value:function(){if(this.addEventListener("pricebook-saved",function(e){this._executeDefaultCustomAction()}.bind(this)),-1<window.location.href.indexOf("cp=1"))document.location.assign(this.editorModel.communityPrefix+"/"+this.editorModel.quoteModel.quoteVO.record.Id);else{var e=this.data.userType;"Standard"==e||"PowerPartner"==e?this.$.pricebookDialog.open():this.errors=["A PriceBook Id is missing. Please contact your administrator to resolve the issue."]}}},{key:"_updateFieldLabelsMap",value:function(){var e=this.editorModel.md.fieldLabelsMap,t=this.editorModel.data.quote.localizedMultiSegmentColumns,i=this.editorModel.data.quote.multiSegmentColumns;for(var n in i)for(var o=i[n],r=t[n],s=0,a=o.length;s<a;s++)e[o[s].replace(/\W/g,"")]=r[s];e.total="Total"}},{key:"_navigateToContractLookupPage",value:function(){this.nav("#",{qId:this.editorModel.quoteModel.quoteVO.record.Id},["contract","lookup"],!1)}},{key:"renumber",value:function(){this.editorModel.quoteModel.renumber(),this.fire("iron-signal",{name:"rows-renumbered"})}},{key:"_updateFieldValidations",value:function(e){this.errors=e.detail.error?[e.detail.error]:null}},{key:"_calculateImmediately",value:function(e,t){var i=!(0<arguments.length&&void 0!==e)||e,n=1<arguments.length&&void 0!==t&&t;this.debounce("calculateImmediately",function(){this.$.customActionServices.onFlagCalculate(i,!1,function(){n&&(this.pageLoaded=!0)}.bind(this))}.bind(this),50)}},{key:"_executeCmd",value:function(e){var t=this.editorModel.customActionsByLocation.Quote;if(t&&0!==t.length)for(var i=0,n=t.length;i<n;i++)t[i].eventHandlerName===e&&this._executeCustomAction({detail:{customAction:t[i],model:this.editorModel.quoteModel}})}},{key:"_executeDefaultCustomAction",value:function(){var e=this.editorModel.defaultCustomActions;if(!(!e||0===e.length||0<this.data.quote.lineItems.length||1<this.data.quote.lineItemGroups.length||this.editorModel.quoteModel.grouped))for(var t=this.editorModel.quoteModel.isRenewal?"onRenewSubscriptions":"onAddProducts",i=0,n=e.length;i<n;i++)e[i].eventHandlerName===t&&this._executeCustomAction({detail:{customAction:e[i],model:this.editorModel.quoteModel}})}},{key:"viewportChanged",value:function(){this._handleGroupCustomActions(!0),this.viewport.isMobile()?this.isMobile=!0:this.isMobile=!1}},{key:"buildQuoteTabs",value:function(){if(this.editorModel){var e=[];if(0<this.editorModel.fieldsetMap.quoteFieldNames.length&&e.push("details"),this.editorModel.quoteModel.grouped)this.toggleClass("maxHeight",!0,this.$$("#quoteTabs")),0<this.groupModels.length&&e.push("groups");else{if(!this.groupModels.length)return;this.toggleClass("maxHeight",!1,this.$$("#quoteTabs")),this.groupModels[0]._groupHasSegmentedProducts()&&(this.buildUngroupedSegmentedTabs(),e.push("segmented")),this.groupModels[0]._groupHasStandardProducts()&&e.push("standard")}if(this._renderTabs(e)){this.$$("#quoteTabs")&&this.$$("#quoteTabs").destroyTabs();for(var t=[],i=0,n=e.length;i<n;i++){var o="t"+i,r=e[i],s=void 0;switch(r){case"details":s=["groupModels","editorModel"];break;case"groups":s=["groupModels","rightSideButton","editorModel"];break;case"standard":case"segmented":s=["groupModels"]}t.push({name:o,label:r,bind:s})}this.ungroupedMDQTabs=this.groupModels[0]?this.groupModels[0].quoteMDQTabs:null,this.selectedTabIndex=0,this.hideTabs=1==t.length,this.quoteLevelTabs=t}}}},{key:"_renderTabs",value:function(e){if(this.quoteLevelTabs.length!==e.length)return!0;if(this.groupModels[0]&&this.groupModels[0].quoteMDQTabs&&this.ungroupedMDQTabs.length!==this.groupModels[0].quoteMDQTabs.length)return!0;for(var t=0,i=this.quoteLevelTabs.length;t<i;t++)if(this.quoteLevelTabs[t].label!==e[t])return!0;return!1}},{key:"_getGroupModels",value:function(){return this.editorModel.quoteModel.lineGroups}},{key:"quoteHasNoLines",value:function(){if(0==this.data.quote.lineItems.length){var e=this.editorModel.quoteModel;this.groupedQuoteHasNoGroups=e.grouped&&0==e.lineGroups.length,this.ungroupedQuoteHasNoLines=!e.grouped}}},{key:"updateQuote",value:function(e,t){if(null!=e){if(e.partialVO&&this.data.quote&&t&&((e=t(e,this.data.quote)).partialVO=!1),this.set("data.quote",e),this.data.settings.usesClientCalculator&&this.data.quote.calculationRequired)return void this.$.customActionServices.onFlagCalculate(!0,!0);this.editorModel||this._createEditorModel(),this.editorModel.createQuoteModel(e),this.editorModel.styleQuoteAndGroupActionButtons();var i=this._getGroupModels();if(this._updateFieldLabelsMap(),this.set("groupModels",i),this.rightSideButton=this.viewport&&!this.viewport.isMobile()&&1<this.groupModels.length&&this.editorModel.quoteModel.grouped,this.notifyPath("editorModel.quoteModel.lineGroups.length",this.editorModel.quoteModel.lineGroups.length),this.set("editorModel.quoteModel",this.editorModel.quoteModel),this.renumber(),this.editorModel.largeQuoteExperienceEnabled){var n=this.editorModel.quoteModel,o=n.lineGroups;n.grouped&&1==o.length&&this.selectedGroupKey!=o[0].groupKey&&(this.selectedGroupKey=o[0].groupKey),this._isSubtitleCombined()}this.isMobile&&this.buildQuoteTabs()}this.quoteHasNoLines(),this.data.settings.multiLineDeleteEnabled&&this.fire("iron-signal",{name:"deselect-checkbox"})}},{key:"updateAfterJSQC",value:function(r,s){r&&(Object.keys(r.pathsToNotify).forEach(function(e){var t=r.originalPathValues[e],i=r.pathsToNotify,n=r.pathsToNotify[e].value,o=i[e].root;t!=n&&(!s||s&&"QuoteLineModel"!=o)&&(this.notifyPath(e,void 0),this.notifyPath(e,n))}.bind(this)),Object.keys(r.pathsToSet).forEach(function(e){var t=r.originalPathValues[e],i=r.pathsToSet,n=i[e].value,o=i[e].root;t!=n&&(!s||s&&"QuoteLineModel"!=o)&&(this.set(e,void 0),this.set(e,n))}.bind(this)))}},{key:"_init",value:function(){if(this.needsInit&&("undefined"!=typeof Visualforce&&this.rawData.settings.usesClientCalculator&&this.rawData.settings.orgUrl&&window.Worker&&new s(this.rawData).beginPrecaching(),this.needsInit=!1),this.rawData.settings.usesClientCalculator&&"undefined"!=typeof SB&&SB.JSQC){var e=new a(this.app.org.prefix),t=new SB.JSQC(this.rawData.settings,this.rawData.quote,null),i=[e.getConnection(),e.getConnection()];Promise.all(i).then(function(e){t.setConnection(e[0]),t.setCustomerOnlyConnection(e[1]),this.rawData.settings.displayedLookupMap=this.$.customActionServices.getDisplayedLookupNames(this.rawData),t.onLoad().then(function(){this.data=this.rawData}.bind(this),this._setError.bind(this)).catch(this._setError.bind(this))}.bind(this),this._setError.bind(this))}else this.data=this.rawData}},{key:"executeProductRules",value:function(){var t=this,e=new u(this.rawData.quote,this.rules,this.rawData.settings.developerPrefix,this.rawData.settings.jsprLabels),i=void 0;try{i=e.execute()}catch(e){var n=void 0;n="object"===(void 0===e?"undefined":d(e))&&"info"===e.type?[e]:[{msg:e.toString(),type:"warning"}],Polymer.RenderStatus.afterNextRender(this,function(){t.errors=n})}i&&0<i.requiredProductIds.length?(this.handleLinesAddedByProductRules(),this.$.quoteLineAdder.quote=this.rawData.quote,this.$.quoteLineAdder.productIds=i.requiredProductIds):this.pageLoaded=!0}},{key:"_setError",value:function(e){this.error={message:e.message||e}}},{key:"_dataIsChanged",value:function(){var e=new CustomEvent("sf-qle-data-changed",{bubbles:!1,detail:this.data});document.dispatchEvent(e);var t=this.data.developerPrefix,i={};this._removeDuplicateLineFieldsInDrawer();for(var n=[],o=new Set,r=["lineFieldNames","lineFieldNamesTablet","lineFieldNamesPhone","standardLineItemDrawerFieldNames","multiSegmentLineFieldNames","multiSegmentLineSummaryFieldNames"],s=0,a=r.length;s<a;s++){var l=this.data[r[s]],u=l&&l.length;if(u)for(var d=0;d<u;d++){var c=l[d];o.has(c)||(o.add(c),n.push(c))}}for(var h=[t+"SubscriptionScope__c",t+"SegmentLabel__c",t+"StartDate__c",t+"EndDate__c",t+"PriceEditable__c"],p=0,f=h.length;p<f;p++){var g=h[p];o.has(g)||(o.add(g),n.push(g))}i[this.data.quoteLineObjectName]=[].concat(n);var y=this.data.settings.lineEditorSubtotalsField;y&&"Default"!=y?(i[this.data.quoteLineObjectName].push(y),o.add(y)):(i[this.data.quoteLineObjectName].push(t+"NetTotal__c"),o.add(t+"NetTotal__c")),i[this.data.quoteObjectName]=[].concat(this.data.quoteFieldNames);for(var v=0,m=this.data.quoteFieldNames.length;v<m;v++)o.add(this.data.quoteFieldNames[v]);var b=this.data.settings.lineEditorTotalsField;b&&"Default"!=b?(i[this.data.quoteObjectName].push(b),o.add(b)):this.data.quote.applyAdditionalDiscountLast?(i[this.data.quoteObjectName].push(t+"CustomerAmount__c"),o.add(t+"CustomerAmount__c")):(i[this.data.quoteObjectName].push(t+"NetAmount__c"),o.add(t+"NetAmount__c")),i[t+"QuoteLineGroup__c"]=[].concat(this.data.groupFieldNames);for(var _=0,S=this.data.groupFieldNames.length;_<S;_++)o.add(this.data.groupFieldNames[_]);var k=this.data.settings.lineEditorGroupSubtotalsField;k&&"Default"!=k?(i[t+"QuoteLineGroup__c"].push(k),o.add(k)):(i[t+"QuoteLineGroup__c"].push(t+"NetTotal__c"),o.add(t+"NetTotal__c")),i[t+"DiscountTier__c"]=this.data.discountScheduleModalFieldNames,i[t+"DiscountSchedule__c"]=["Name",t+"DiscountUnit__c"],this.fieldNameSet=o,this.$.md.data=i}},{key:"_removeDuplicateLineFieldsInDrawer",value:function(){var e=this.data.standardLineItemDrawerFieldNames;if(e&&0!=e.length){var r=this.data.developerPrefix,t=this.app.deviceContext,i=function(e,t){for(var i=new Set(e),n=0,o=t.length;n<o;n++)!i.has(t[n])&&t[n]!=r+"Number__c"||(t.splice(n,1),n--)};this.data.lineFieldNamesPhone&&t.isPhone?i(this.data.lineFieldNamesPhone,e):this.data.lineFieldNamesTablet&&(t.isTablet||t.isPhone)?i(this.data.lineFieldNamesTablet,e):i(this.data.lineFieldNames,e)}}},{key:"_errorEventHandled",value:function(){this.error&&(this.error.validations?(this.errors=this.error.validations,this.$.customActionServices.updateUIAfterCalculate(this.editorModel.quoteModel.quoteVO)):this.errors=[this.error.message]),this.$.customActionServices.showSpinner=!1}},{key:"_handleMobileCSE",value:function(e){this._openDialog({dialog:"cseDialog",groupModelKey:null})}},{key:"_handleCSE",value:function(e){this._openDialog(e.detail)}},{key:"_handleCSEResponse",value:function(e){this.updateQuote(e.detail.quoteVO),this.$.cseDialog.$.dialog.toggle()}},{key:"_openDialog",value:function(e){if("cseDialog"===e.dialog){var t=this.$.cseDialog,i=this.editorModel.quoteModel.groupsByKey[e.groupModelKey].segmentedLinesByDimension.Custom[0].segmentsByLabel,n=[];Object.keys(i).forEach(function(e){var t=i[e];t.lineVO.dimensionType==t.groupModel.editorModel.constants.CUSTOM_VALUE&&n.push(t)}),t.dataLineModels=n}this.$[e.dialog].$.dialog.toggle()}},{key:"toggleGroupPanel",value:function(){this.viewport.isMobile()&&this.fire("iron-signal",{name:"toggle-panel-clicked"})}},{key:"updateQuoteDetails",value:function(){this.quoteDetailsHidden=!this.quoteDetailsHidden,this.toggleQuoteDetails(!1)}},{key:"toggleQuoteDetails",value:function(e){this.set("quoteDetailsIconClass",this.quoteDetailsHidden?"sf-icon-chevronright":"sf-icon-chevrondown"),this.fire("iron-signal",{name:"page-resized",data:{isFullScreenToggleEvent:e}})}},{key:"toggleFullScreenMode",value:function(e){this._toggleFullscreen(e),this.quoteDetailsHidden=this.inFullScreenMode,this.toggleQuoteDetails(!0)}},{key:"_toggleFullscreen",value:function(e){this.inFullScreenMode?this.exitFullScreenMode():this.enterFullScreenMode(),e.stopPropagation()}},{key:"enterFullScreenMode",value:function(){var e=document.querySelector("sb-page-container");e.requestFullScreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(),this.inFullScreenMode=!0}},{key:"exitFullScreenMode",value:function(){var e=document.querySelector("sb-page-container");e.requestFullScreen?document.cancelFullScreen():e.msRequestFullscreen?document.msExitFullScreen():e.mozRequestFullScreen?document.mozCancelFullScreen():e.webkitRequestFullscreen&&document.webkitCancelFullScreen(),this.inFullScreenMode=!1}},{key:"_viewportChanged",value:function(e){if(this.editorModel){this.toggleClass("hidden",!e,Polymer.dom(this.root).querySelector(".fixedActions"));var t=this.editorModel.standardPrimaryMobileCols.length;this.editorModel.standardPrimaryMobileCols=e?[this.editorModel.constants.PRODUCT_NAME_FIELD,this.editorModel.constants.NET_TOTAL_FIELD]:[];var i=this.editorModel.segmentedPrimaryMobileCols.length;if(this.editorModel.segmentedPrimaryMobileCols=e?[this.editorModel.constants.PRODUCT_NAME_FIELD,"total"]:[],this.editorModel.segmentedDetailsPrimaryMobileCols=e?[this.editorModel.constants.SEGMENT_LABEL_FIELD,this.editorModel.constants.NET_TOTAL_FIELD]:[],this.groupModels&&(t!==this.editorModel.standardPrimaryMobileCols.length||i!==this.editorModel.segmentedPrimaryMobileCols.length))for(var n=0;n<this.groupModels.length;n++)this.notifyPath("groupModels."+n+".editorModel.standardPrimaryMobileCols"),this.notifyPath("groupModels."+n+".editorModel.segmentedPrimaryMobileCols"),this.notifyPath("groupModels."+n+".editorModel.segmentedDetailsPrimaryMobileCols");e&&this.buildQuoteTabs(),this.isMobileRendered=e,this.isDesktopRendered=!e}}},{key:"buildUngroupedSegmentedTabs",value:function(){if(this.groupModels&&0!=this.groupModels.length){for(var e=[],t=this.groupModels[0].dimensions,i=0,n=t.length;i<n;i++){var o=t[i];if(this.groupModels[0].hasVisibleSegmentedLines[o]){var r="t"+i,s={name:r,key:o,label:this.groupModels[0].quoteModel.quoteVO.localizedDimensionNames[o],bind:["groupModel"]};"Custom"==o&&(s.iconId=r+"-"+this.groupModels[0].groupKey,s.iconClass="sb-icon-pencil",s.iconEvent="cseMobile"),e.push(s)}}this.groupModels[0].quoteMDQTabs=e,this.ungroupedMDQTabs||(this.ungroupedMDQTabs=e)}}},{key:"_openCSE",value:function(){event.currentTarget.attributes.dialog.value,this.$.cseDialog.$.dialog.toggle()}},{key:"_displayUpgradeQuantityToast",value:function(e){var t=e.detail.invalidQuantity,i=e.detail.validQuantity;if(this.errors=null,0<t){var n=this.i18n.l("Exceeded maximum quantity available. Value has been reduced to {0}",[i]);this.errors=[{type:"warning",msg:n}]}}},{key:"destampGroups",value:function(){this.isMobileRendered=!1,this.isDesktopRendered=!1}},{key:"handleProductRuleAlertModal",value:function(e,c){var h=this,t=c.guidedMessages;t&&0!==t.length&&("saveService"===e?(this.$.productAlertModal.cancelCB=function(){if(h.editorModel.data.settings.usesClientCalculator){for(var e=h.editorModel.data.quote,t=c.quote,i=e.lineItems.length,n=function(e,t){for(var i in t)e[i]=t[i]},o=0;o<i;o++){var r=e.lineItems[o],s=t.lineItems[o];r.record.Id=s.record.Id,delete s.record,n(r,s)}for(var a=e.lineItemGroups.length,l=0;l<a;l++){var u=e.lineItemGroups[l],d=t.lineItemGroups[l];u.record.Id=d.record.Id}e.record.Id=t.record.Id,delete t.lineItems,delete t.lineItemGroups,delete t.record,n(e,t),h.updateQuote(e),h.$.customActionServices.notifier&&h.updateAfterJSQC(h.$.customActionServices.notifier)}else h.updateQuote(c.quote)},this.$.productAlertModal.displayContinueButton=!0,this.$.productAlertModal.continueCB=function(){h.$.customActionServices.navigateToReturnUrl(!0)}):this.$.productAlertModal.cancelCB=null,this.$.productAlertModal.alerts=t)}},{key:"_groupModelsChanged",value:function(e){if(this.editorModel.isMultiGroupViewEnabled){var t=e.path.split(".");t[0]="lineGroups",this.editorModel.quoteModel.notifyUi(t)}}},{key:"_redirectToLineEditor",value:function(){if(!this.ctx.params||!this.ctx.params.jspr)return!1;var e=o.getPreviousRoute();return"product/pc"===e||"product/lookup"===e||"favorite/lookup"===e||"asset/lookup"===e||"subscription/lookup"===e}},{key:"handleLinesAddedByProductRules",value:function(){this.$.quoteLineAdder.addEventListener("lines-added-by-rules-changed",function(e){var t=JSON.parse(JSON.stringify(this.data));t.quote.lineItems=t.quote.lineItems.concat(e.detail.value),this.updateQuote(t.quote),this._calculateImmediately(!1,!0)}.bind(this))}},{key:"toggleOptional",value:function(e){var t=e.detail.groupKey,i=e.detail.toggleOptionalBoolean;this.editorModel.quoteModel.toggleOptional(i,t)}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior]}},{key:"listeners",get:function(){return{"le-action-tapped":"_executeCustomAction","cseMobile-tapped":"_handleMobileCSE","cse-tapped":"_handleCSE","segmented-changed":"_handleCSEResponse","change-ghost":"_handleGhostChanges","renumber-lines":"renumber","validate-quantity-changed":"_displayUpgradeQuantityToast","field-change-validated":"_updateFieldValidations","calculate-immediately":"_calculateImmediately","rte-saved":"_updateIronList"}}},{key:"observers",get:function(){return["_createEditorModel(data, md)","_errorEventHandled(error)","_loadObjectMD(app.org)","_groupModelsChanged(groupModels.*)","_init(rawData, rules)"]}}]),h=e)),t("LineEditor",h),Polymer(h)}}}),System.register("quotes/precaching/PrecacheSequenceRunners/DiscountScheduleSequenceRunner.js",[],function(e,t){var u;function i(i,n,o,l,r){return{executeSequence:function(){var e=function(){var e="SBQQ"==n?"SBQQ__":"",o={},r=e+"DiscountSchedule__c",s=e+"TermDiscountSchedule__c",a=e+"Product__c";return l.lineItems.forEach(function(e){var t=e.record[r],i=e.record[s],n=e.costScheduleId;null!=t&&(null==o[t]&&(o[t]=[]),o[t].push(e.record[a])),null!=i&&(null==o[i]&&(o[i]=[]),o[i].push(e.record[a])),null!=n&&(null==o[u(n)]&&(o[u(n)]=[]),o[u(n)].push(e.record[a]))}),o}();if(0==Object.keys(e).length)return Promise.resolve();var t={schedules:e,overrides:{},account:r};return i.load(n,"DiscountAndAccountCallout","AllDiscountsAndAccounts",t).then(function(e){o({successful:!0,provider:"DiscountAndAccountCallout",uid:"AllDiscountsAndAccounts",results:e})},function(e){self.postMessage({err:!0,sequence:"DiscountScheduleSequence",msg:e.message||e})})}}}return{setters:[],execute:function(){module.exports=i,u=require("../IdConverter.js")}}}),System.register("quotes/precaching/PrecacheSequenceRunners/MetadataSequenceRunner.js",[],function(e,t){function i(e,a,n,l){return{executeSequence:function(){var i=function(){if(null==l)return[];var e="SBQQ"==a?"SBQQ__":"",t=[],i=e+"QuoteLine__c",n=e+"Quote__c",o=e+"QuoteLineGroup__c";for(var r in l){var s;s="Quote Line"===r?i:"Group"===r?o:"Quote"===r?n:r,l.hasOwnProperty(r)&&l[r].forEach(function(e){t.push(s+"."+e)})}return t}();return 0==i.length?Promise.resolve():e.md("CustomField",i,a).then(function(e){var t=i.join(",");n({successful:!0,provider:"CustomField",uid:t,results:e})},function(e){self.postMessage({err:!0,sequence:"MetadataSequence",msg:e.msg||e})})}}}return{setters:[],execute:function(){module.exports=i}}}),System.register("quotes/precaching/PrecacheSequenceRunners/OptionSequenceRunner.js",[],function(e,t){function i(t,i,n,r,o){var s=""==i?"":"SBQQ__";return{executeSequence:function(){var e={requiredIds:function(){var i={},n=[],o=s+"ProductOption__c";return r.lineItems.forEach(function(e){var t=e.record[o];t&&!i[t]&&(i[t]=!0,n.push(t))}),n}(),requiredFields:o||[]};return t.setOptions({escape:!1,timeout:12e4}),t.load(i,"ProductOptionServiceProvider.ProductOptionLoader","AllOptions",e).then(function(e){n({successful:!0,provider:"ProductOptionServiceProvider.ProductOptionLoader",uid:"AllOptions",results:e})},function(e){n({err:!0,sequence:"OptionSequence",msg:e.message||e})})}}}return{setters:[],execute:function(){module.exports=i}}}),System.register("quotes/precaching/PrecacheSequenceRunners/PriceRuleSequenceRunner.js",[],function(e,t){function i(c,h,t,p){return{executeSequence:function(){return c.read(h,"PriceRuleServiceProvider.PriceRuleReader","PriceRules").then(function(e){return t({successful:!0,provider:"PriceRuleServiceProvider.PriceRuleReader",uid:"PriceRules",results:e}),function(e){var t={svIds:function(e){function t(e){e[o]&&u.push(e[o]),e[r]&&u.push(e[r])}function i(e){e[s]&&u.push(e[s])}var n=""==h?"":"SBQQ__",o=n+"FilterVariable__c",r=n+"TestedVariable__c",s=n+"SourceVariable__c",a=n+"PriceConditions__r",l=n+"PriceActions__r",u=[];0<e.length&&e.forEach(function(e){e[a]&&0<e[a].records.length&&e[a].records.forEach(t),e[l]&&0<e[l].records.length&&e[l].records.forEach(i)});return u}(e)};return c.load(h,"SummaryVariableServiceProvider.SummaryVariableLoader","SummaryVariables",t)}(e)}).then(function(e){return t({successful:!0,provider:"SummaryVariableServiceProvider.SummaryVariableLoader",uid:"SummaryVariables",results:e}),function(e){if(!p)return Promise.resolve([]);var t=""==h?"":"SBQQ__",i=t+"TargetObject__c",n=t+"FilterField__c",o=t+"ConstraintField__c",r=t+"AggregateField__c",s=[],a=[];for(var l in e)if(e.hasOwnProperty(l)){var u=e[l];"Asset"==u[i]?(null!=u[n]&&s.push(u[n]),null!=u[o]&&s.push(u[o]),null!=u[r]&&s.push(u[r])):"Subscription"==u[i]&&(null!=u[n]&&a.push(u[n]),null!=u[o]&&a.push(u[o]),null!=u[r]&&a.push(u[r]))}var d={accountId:p,assetFields:s,subscriptionFields:a};return c.load(h,"AssetAndSubscriptionServiceProvider.AssetAndSubLoader","AssetsAndSubs",d)}(e)}).then(function(e){t({successful:!0,provider:"AssetAndSubscriptionServiceProvider.AssetAndSubLoader",uid:"AssetsAndSubs",results:e})}).catch(function(e){self.postMessage({err:!0,sequence:"Price Rule Sequence",msg:e.msg||e})})}}}return{setters:[],execute:function(){module.exports=i}}}),System.register("quotes/precaching/PrecacheSequenceRunners/ProductSequenceRunner.js",[],function(e,t){function i(o,r,s,a,l){var u=""==r?"":"SBQQ__";return{executeSequence:function(){var e=function(){var i={},n=[],o=u+"Product__c";return a.lineItems.forEach(function(e){var t=e.record[o];null!=t&&null==i[t]&&(i[t]=!0,n.push(t))}),n}(),t=[];a.record[u+"PricebookId__c"]&&t.push(a.record[u+"PricebookId__c"]);var i=[];a.record.CurrencyIsoCode&&i.push(a.record.CurrencyIsoCode);var n={requiredIds:e,productFields:l,pricebookFilter:t,currencyFilter:i};return o.setOptions({escape:!1,timeout:12e4}),o.load(r,"ProductServiceProvider.ProductLoader","AllProducts",n).then(function(e){s({successful:!0,provider:"ProductServiceProvider.ProductLoader",uid:"AllProducts",results:e})},function(e){s({err:!0,sequence:"ProductSequence",msg:e.message||e})})}}}return{setters:[],execute:function(){module.exports=i}}}),System.register("quotes/precaching/PrecacheSequenceRunners/RelatedRecordSequenceRunner.js",[],function(e,t){var u;function i(t,i,n,o,r,a){function s(n,e,t){if(e&&t&&0<t.length)for(var o in e)if(e.hasOwnProperty(o)){var r=e[o],s=l(r);t.forEach(function(e){var t=e.record[o];if(t){var i=u(t);if(!i)return;n.queryInfo[r]?n.queryInfo[r].referencedIds.push(i):n.queryInfo[r]={referencedFields:a[s],referencedIds:[i]}}})}}function l(e){switch(e){case"SBQQ__Quote__c":case"Quote__c":return"Quote";case"SBQQ__QuoteLineGroup__c":case"QuoteLineGroup__c":return"Group";case"SBQQ__QuoteLine__c":case"QuoteLine__c":return"Quote Line";default:return e}}return{executeSequence:function(){var e={queryInfo:{}};return s(e,r.quoteLookups,[o]),s(e,r.groupLookups,o.lineItemGroups),s(e,r.lineLookups,o.lineItems),t.load(i,"JSQCLookupFieldServiceProvider.JSQCLookupFieldLoader","AllAdditionalLookups",e).then(function(e){n({successful:!0,provider:"JSQCLookupFieldServiceProvider.JSQCLookupFieldLoader",uid:"AllAdditionalLookups",results:e})},function(e){n({err:!0,sequence:"RelatedRecordSequence",msg:e.message||e})})}}}return{setters:[],execute:function(){module.exports=i,u=require("../IdConverter.js")}}}),System.register("quotes/tables/sb-segmented-lines/SegmentedLines.js",["quotes/models/LineModel.js","quotes/sb-line-sort/QuoteLineSort.js","quotes/models/DragDropModel.js","common/layout/table-layout-builder/TableLayoutBuilder.js","common/core/sb-page-container/PageContainer.js","common/relationship/RelationshipFieldManager.js"],function(t,e){var l,i,u,o;return{setters:[function(e){e.LineModel},function(e){l=e.depthFirstLineItemsTreeSort},function(e){e.DragDropModel},function(e){e.TableLayoutBuilder},function(e){i=e.PageContainer},function(e){u=e.RelationshipFieldManager}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SegmentedLines",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-segmented-lines",this.properties={fieldNames:{type:Object},quoteLineFields:{type:Object},columnNames:{type:Array},currencyMd:{type:Object,computed:"_getNetTotalFieldMd(groupModel)"},viewport:{type:Object,value:function(){return i.getViewport()}}}}},{key:"ready",value:function(){this.addEventListener("table-header-sort-clicked",this._onSortLinesByHeader),this.addEventListener("line-toggled",this._onUpdateSizeForItem)}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport}},{key:"groupPanelToggled",value:function(e){this.drawerState=e.detail.drawerState,this._setColumnWidths(e)}},{key:"groupPanelCreated",value:function(e){this._setColumnWidths(e)}},{key:"groupToggled",value:function(e){this._ironListResize(e)}},{key:"_segmentedLinesByDimensionChanged",value:function(e){var t,i=void 0;if(t=0<=(i=e.path.split(".")).indexOf(this.dimension),"splices"==i[i.length-1]&&t){var n=e.value.indexSplices;n[0].removed&&0===n[0].object.length?this.hasVisibleSegmentedLines=!1:0<n[0].addedCount&&(this.hasVisibleSegmentedLines=!0)}}},{key:"_render",value:function(){if(this.groupModel){this.toggleClass("largeQuote",this.editorModel.largeQuoteExperienceEnabled,this),this.dimension=this.attributes.key.value,this.hasVisibleSegmentedLines=this.groupModel.hasVisibleSegmentedLines[this.dimension],this.fieldNames=this._getFields(),this.lineModels=this.groupModel.segmentedLinesByDimension[this.dimension],this.linkPaths("groupModel.segmentedLinesByDimension."+this.dimension,"lineModels"),this.fieldLabelsMap=this.editorModel.md.fieldLabelsMap,this.quoteLineFields=this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName],this.settings=this.editorModel.data.settings,this.detailFieldNames=this.editorModel.fieldsetMap.multiSegmentLineFieldNames;var e=this.groupModel.groupVO.multiSegmentColumns;e&&0<Object.keys(e).length?(this.columnNames=e[this.dimension],this.headerColumnNames=this.groupModel.groupVO.localizedMultiSegmentColumns[this.dimension]):(this.columnNames=this.groupModel.quoteModel.quoteVO.multiSegmentColumns[this.dimension],this.headerColumnNames=this.editorModel.quoteModel.quoteVO.localizedMultiSegmentColumns[this.dimension]),this.netMultiSegmentTotalField=this.editorModel.constants.NET_TOTAL_FIELD,this.columnWidths={},this._setColumnWidths()}}},{key:"_getFields",value:function(){var e=this.editorModel.fieldsetMap.multiSegmentLineSummaryFieldNames;return this.groupModel.segmentedSubscriptionScopeEditable?[this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(e):e}},{key:"_setColumnWidths",value:function(e){var t=null;if(!this.editorModel.deviceContext.isMobile&&this.editorModel.layout&&this.groupModel.segmentedLinesByDimension[this.dimension]){if(!(t=this.groupModel.colWidth[this.dimension]))return;this._setSubtotalColumnWidth(t,this.editorModel.layout.leftOffset)}this.set("columnWidths",t),this._ironListResize(e)}},{key:"_setSubtotalColumnWidth",value:function(e,t){if(e){for(var i=t,n=0,o=this.fieldNames.length;n<o;n++)i+=e[this.fieldNames[n]];this.labelColWidth=i+"px";for(var r=0,s=this.columnNames.length;r<s;r++){var a=this.columnNames[r].replace(/\W/g,"");this.subtotalColWidth=e[a]+"px"}this.totalColWidth=e.total+"px"}}},{key:"colWidthsChanged",value:function(e){this._setColumnWidths(e)}},{key:"_ironListResize",value:function(e){this.$$("iron-list")&&e&&e.detail&&e.detail.groupKey===this.groupModel.groupKey&&this.$$("iron-list").fire("iron-resize")}},{key:"onTrack",value:function(e){this.domHost.domHost._onTrack(e)}},{key:"getMultiSegmentColumnTotal",value:function(e){if(this.groupModel.multiSegmentColumnTotals[this.dimension])return[this.groupModel.multiSegmentColumnTotals[this.dimension][e]]}},{key:"getMultiSegmentTotalField",value:function(){if(this.groupModel.netMultiSegmentTotal)return this.groupModel.netMultiSegmentTotal[this.dimension]}},{key:"_showSubtotal",value:function(){this.currencyMd||(this.currencyMd={type:"currency",scale:this._getPriceScale(),CurrencyIsoCode:this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode}),"doNotDisplay"!=this.editorModel.data.settings.lineEditorSubtotalsField?(this._getNetTotalFieldMd(),this.showSubtotal=!0):this.showSubtotal=!1}},{key:"_getNetTotalFieldMd",value:function(){var e=this.editorModel.data.settings,t=e.lineEditorSubtotalsField;return{type:"currency",scale:e.isMultiCurrencyOrg?this.quoteVO.currencyDecimalScale:"Default"==t||"doNotDisplay"==t||null==t?this.editorModel.md.fieldsMap[e.developerPrefix+"QuoteLine__c"][this.editorModel.constants.NET_TOTAL_FIELD].scale:this.editorModel.md.fieldsMap[e.developerPrefix+"QuoteLine__c"][t].scale,CurrencyIsoCode:this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode}}},{key:"_onSortLinesByHeader",value:function(e){this.sortLines(this.groupModel.segmentedLinesByDimension[this.dimension],e.detail.field,e.detail.order,!1,!0)}},{key:"sortLinesRequired",value:function(e){var t=e.detail.notify,i=e.detail.lineSortField;this.sortLines(this.groupModel.segmentedLinesByDimension[this.dimension],i,"asc",!1,t)}},{key:"sortLines",value:function(e,t,i,n,o){var r=void 0;if(t&&this.settings.lineLookups&&this.settings.lineLookups[t]){var s=u.getRelationshipField(t,this.settings.lineLookups[t]).split(".");r=s[1],t=s[0]}var a=l(e,t,i,n,r);o?(this.set("groupModel.segmentedLinesByDimension."+this.dimension,a.slice()),this.notifyPath("lineModels",a.slice())):this.groupModel.segmentedLinesByDimension[this.dimension]=a}},{key:"getZIndex",value:function(e){return this.lineModels.length+10-e}},{key:"_onUpdateSizeForItem",value:function(e){if(e.detail.index)this.$$("iron-list").updateSizeForItem(e.detail.index);else for(var t=0,i=this.lineModels.length;t<i;t++)this.$$("iron-list").updateSizeForItem(t)}},{key:"toggleOptional",value:function(e){if(!e.detail.groupKey||e.detail.groupKey==this.groupModel.groupVO.key)for(var t=0,i=this.groupModel.segmentedLinesByDimension[this.dimension].length;t<i;t++)for(var n=0,o=this.groupModel.segmentedLinesByDimension[this.dimension][t].segments.length;n<o;n++){var r=this.groupModel.segmentedLinesByDimension[this.dimension][t].segments[n];r.lineVO._transient_||(r.lineVO._transient_={},r.lineVO._transient_.original=r.lineVO._transient_.original||JSON.parse(JSON.stringify(r.lineVO.record))),this.set("groupModel.segmentedLinesByDimension."+this.dimension+"."+t+".segments."+n+".lineVO.record."+this.constants.OPTIONAL_FIELD,e.detail.toggleOptionalBoolean)}}},{key:"_resetOnAction",value:function(e){Array.from(this.lineModels).forEach(function(e){e.lineVO.expanded=!1})}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_render(groupModel)","_segmentedLinesByDimensionChanged(groupModel.segmentedLinesByDimension.*)","_showSubtotal(groupModel.*)"]}},{key:"editorModel",get:function(){return this.groupModel.quoteModel.editorModel}},{key:"quoteVO",get:function(){return this.editorModel.quoteModel.quoteVO}},{key:"constants",get:function(){return this.editorModel.constants}}]),o=e)),t("SegmentedLines",o),Polymer(o)}}}),System.register("quotes/tables/sb-standard-lines/StandardLines.js",["quotes/sb-line-sort/QuoteLineSort.js","common/core/sb-page-container/PageContainer.js","quotes/models/DragDropModel.js","common/layout/fields/FieldSetHandler.js","common/layout/table-layout-builder/TableLayoutBuilder.js","common/signal/RowFocusSignaler.js","common/relationship/RelationshipFieldManager.js"],function(t,e){var l,i,o,r,s,u,a;return{setters:[function(e){l=e.depthFirstLineItemsTreeSort},function(e){i=e.PageContainer},function(e){o=e.DragDropModel,e.isComponent,e.ifLineElementsShareParent,e.ifLineElementsAreParentChild,e.removeTableRowBorderClass},function(e){r=e.FieldSetHandler},function(e){e.TableLayoutBuilder},function(e){s=e.RowFocusSignaler},function(e){u=e.RelationshipFieldManager}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}9,147,t("StandardLines",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-standard-lines",this.properties={groupModel:{type:Object,notify:!0},settings:Object,fieldNames:Array,quoteLineFields:Object,fieldLabelsMap:{type:Object,notify:!0},subtotal:{type:Number},subtotalMd:Object,dragDrop:Object,viewport:{type:Object,value:function(){return i.getViewport()}},visibleLines:{type:Array,computed:"_initVisibleLines(groupModel)"},tabIndex:{type:Number,computed:"_initTabIndex(viewport)"}}}},{key:"ready",value:function(){this.addEventListener("table-header-sort-clicked",this._onSortLinesByHeader),this.addEventListener("line-toggled",this._onUpdateSizeForItem),this.summaries=this.groupModel.quoteModel.grouped?this.groupModel.groupVO.summaries:this.groupModel.quoteModel.quoteVO.summaries;var e=new Set(["sb-droppable-standardRows","sb-droppable-emptyTable","sb-droppable-sidePanelGroups","emptyTableMessage"]);this.editorModel.largeQuoteExperienceEnabled||(this.dragDrop=new o(this,this.editorModel.data.settings.bundleKeptTogether,"sb-le-table-row",e,this.dragFunc.bind(this),this.trackFunc.bind(this),this.dropFunc.bind(this),9,147))}},{key:"_buildRows",value:function(){this.toggleClass("largeQuote",this.editorModel.largeQuoteExperienceEnabled,this),this.actionsOnTheLeft=this.editorModel.actionsOnTheLeft,this.multiLineDeleteEnabled=this.editorModel.data.settings.multiLineDeleteEnabled,this.fieldSetHandler=new r(this.editorModel.fieldsetMap,"lineFieldNames","lineFieldNamesTablet","lineFieldNamesPhone"),this._setFieldNames(),this.columnWidths={},this._setColumnWidths(),this.columnNames=null,this.fieldLabelsMap=this.editorModel.md.fieldLabelsMap,this.quoteLineFields=this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName],this._setDrawerFields(),this.settings=this.editorModel.data.settings,this.$$("iron-list")&&this.groupModel.groupKey&&1==this.editorModel.quoteModel.quoteVO.lineItemGroups.length&&this.$$("iron-list").notifyResize()}},{key:"_setColumnWidths",value:function(e){var t=null;!this.editorModel.deviceContext.isMobile&&this.editorModel.layout&&(t=this.groupModel.colWidth.Standard,this._setSubtotalColumnWidth(t,this.editorModel.layout.leftOffset)),this.set("columnWidths",t),this._ironListResize(e)}},{key:"_setSubtotalColumnWidth",value:function(e,t){for(var i=t,n=this.fieldNames.length,o=0;o<n-1;o++)i+=e[this.fieldNames[o]];this.labelColWidth=i+6+"px";var r=e[this.editorModel.constants.NET_TOTAL_FIELD];this.subtotalColWidth=r+6+"px"}},{key:"colWidthsChanged",value:function(e){this._setColumnWidths(e)}},{key:"_ironListResize",value:function(e){this.$$("iron-list")&&e&&e.detail&&e.detail.groupKey===this.groupModel.groupKey&&this.$$("iron-list").fire("iron-resize")}},{key:"_setDrawerFields",value:function(){var e=this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames,t=this.editorModel.deviceContext.isMobile;e&&!t?this.drawerFieldNames=e:e&&t&&(this.fieldNames=this.fieldNames.concat(e))}},{key:"_showSubtotal",value:function(){var e=this.editorModel.data.settings;this.subtotalMd||(this.subtotalMd={type:"currency",scale:this._getPriceScale(),CurrencyIsoCode:this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode}),"doNotDisplay"!=e.lineEditorSubtotalsField&&0<this.groupModel.standardLines.length?(this._getSubtotal(),this.showSubtotal=!0):this.showSubtotal=!1}},{key:"_getPriceScale",value:function(){var e=this.editorModel.data.settings,t=e.lineEditorSubtotalsField;return e.isMultiCurrencyOrg?this.groupModel.quoteModel.quoteVO.currencyDecimalScale:"Default"==t||"doNotDisplay"==t||null==t?this.editorModel.md.fieldsMap[this.prefix+"QuoteLine__c"][this.editorModel.constants.NET_TOTAL_FIELD].scale:this.editorModel.md.fieldsMap[this.prefix+"QuoteLine__c"][t].scale}},{key:"_getSubtotal",value:function(){var e=void 0,t=void 0,i=this.editorModel.data.settings,n=this.groupModel.standardLines;e="Default"==i.lineEditorSubtotalsField||null==i.lineEditorSubtotalsField?this.editorModel.constants.NET_TOTAL_FIELD:i.lineEditorSubtotalsField;for(var o=t=0,r=n.length;o<r;o++){var s=n[o];isNaN(s.lineVO.record[e])||(t+=s.lineVO.record[e])}this.subtotal=t}},{key:"onTrack",value:function(e){this.dragDrop._onTrack(e)}},{key:"dragFunc",value:function(e){var i=this.dragDrop;i.ghost=i.lineEditor.$.ghost,this.lineModelsByKey=this.groupModel.quoteModel.lineModelsByKey,i.dragKeys=[],i.dragStandardIndexes=[],i.dragMdqIndexesByDim={},i.dragLineModels=[],i.dragGroupModel=e.lineModel.groupModel,i.dragKeys.push(e.lineModel.lineVO.key),i.keepBundleTogether&&this._getBundleWithChildren(i.dragKeys[0],i.dragKeys),i.dragKeys.forEach(function(e){var t=this.lineModelsByKey[e];i.dragLineModels.push(t),this.lineModelsByKey[e].segmented?i.dragMdqIndexesByDim[t.dimensionType]?i.dragMdqIndexesByDim[t.dimensionType].push(this._getLineIndexFromKey(this.groupModel.segmentedLinesByDimension[t.dimensionType],e)):i.dragMdqIndexesByDim[t.dimensionType]=[this._getLineIndexFromKey(this.groupModel.segmentedLinesByDimension[t.dimensionType],e)]:i.dragStandardIndexes.push(this._getLineIndexFromKey(this.groupModel.standardLines,e))}.bind(this)),i.dragTargetElementIndex=this._getLineIndexFromKey(this.groupModel.standardLines,e.lineModel.lineVO.key);for(var t,n=0;n<i.dragStandardIndexes.length;n++)t=i.dragStandardIndexes[n],this.set("groupModel.standardLines."+t+".hidden",!0);if(0!=Object.keys(i.dragMdqIndexesByDim).length)for(var o in i.dragMdqIndexesByDim)for(var r,s=0;s<i.dragMdqIndexesByDim[o].length;s++)r=i.dragMdqIndexesByDim[o][s],this.set("groupModel.segmentedLinesByDimension."+o+"."+r+".hidden",!0);i.ghostField=e.lineModel.lineVO.record[this.editorModel.constants.PRODUCT_CODE_FIELD]}},{key:"trackFunc",value:function(e){var t=this.dragDrop,i=this.groupModel.editorModel.data.settings.bundleKeptTogether,n=this.groupModel.standardLines.length-1;if(e=t._findTableRowValidTarget(e))switch(t.targetClass){case"sb-droppable-standardRows":if(t._updateTableRowHoverOverObject(e,n),!t.hoverOver)return;t.targetHost=t.hoverOver.comp.domHost,t.usePlaceholder=!0,t.enableHighLight=!0;break;case"sb-droppable-emptyTable":i&&t.sourceElement.lineModel.hasParent?t.hoverOver=null:t.hoverOver={comp:e},t.usePlaceholder=!1,t.enableHighLight=!0;break;case"sb-droppable-sidePanelGroups":i&&t.sourceElement.lineModel.hasParent?t.hoverOver=null:t.hoverOver={comp:e},t.targetHost=t.hoverOver.comp.parentNode.parentNode,t.usePlaceholder=!1,t.enableHighLight=!0}else t.hoverOver=null}},{key:"dropFunc",value:function(e,t,i,n){var o=void 0,r=e.domHost.domHost,s=this.dragDrop;s.dropKey=null,s.dropIndex=null,s.dropGroupModel=null;for(var a,l=0,u=s.dragStandardIndexes?s.dragStandardIndexes.length:0;l<u;l++)a=s.dragStandardIndexes[l],this.set("groupModel.standardLines."+a+".hidden",!1);if(0!=Object.keys(s.dragMdqIndexesByDim).length)for(var d in s.dragMdqIndexesByDim)for(var c,h=0;h<s.dragMdqIndexesByDim[d].length;h++)c=s.dragMdqIndexesByDim[d][h],this.set("groupModel.segmentedLinesByDimension."+d+"."+c+".hidden",!1);if(t){switch(e.lineModel.subscriptionScopeEditable&&(t.domHost.groupModel.colWidth=e.lineModel.groupModel.colWidth,s.dragGroupModel._updateStandardSubscriptionScopeEditable(e.lineModel),this._setFieldNames(),this._setColumnWidths()),this._removeLinesByIndex(s.dragStandardIndexes),i){case"sb-droppable-standardRows":s.dropKey=t.lineModel.lineVO.key,s.dropGroupModel=t.lineModel.groupModel,s.dropIndex=this._getLineIndexFromKey(s.dropGroupModel.standardLines,s.dropKey),o=t.domHost.domHost,n?s.dropIndex=0<=s.dropIndex?s.dropIndex:0:++s.dropIndex;break;case"sb-droppable-emptyTable":case"emptyTableMessage":o=Polymer.dom(t).getOwnerRoot().host,s.dropGroupModel=o.groupModel;break;case"sb-droppable-sidePanelGroups":var p="Group"+t.getAttribute("id"),f=s._findParentCustomElement(t,"groupContainer","id");o=f.querySelector("#"+p),s.dropGroupModel=o.groupModel}for(var g=0;g<s.dragLineModels.length;g++)if(s.dragLineModels[g].segmented){if(s.dragGroupModel.groupKey===s.dropGroupModel.groupKey)continue;s.dropGroupModel.dimensions.includes(s.dragLineModels[g].segmentType)?o.addSegmentedLineToExistingTab(s.dragLineModels[g]):o.addSegmentedLineToEmptyTable(s.dragLineModels[g])}else{if(s.dragLineModels[g].subscriptionScopeEditable&&(s.dropGroupModel.standardSubscriptionScopeEditable=!0,Polymer.RenderStatus.afterNextRender(Polymer.dom(o.root).querySelector("#standardLines"),function(){Polymer.dom(o.root).querySelector("#standardLines")._setFieldNames(),Polymer.dom(o.root).querySelector("#standardLines")._setColumnWidths()})),s.dragLineModels[g].visible)switch(i){case"sb-droppable-standardRows":t.domHost.splice("groupModel.standardLines",s.dropIndex,0,s.dragLineModels[g]);break;case"sb-droppable-emptyTable":case"emptyTableMessage":case"sb-droppable-sidePanelGroups":o.push("groupModel.standardLines",s.dragLineModels[g])}else o.push("groupModel.standardLines",s.dragLineModels[g]);s.dragLineModels[g].groupModel=s.dropGroupModel,s.dragLineModels[g].lineVO.parentGroupKey=s.dropGroupModel.groupKey,s.dropIndex++}if(0!=Object.keys(s.dragMdqIndexesByDim).length)for(var y in s.dragMdqIndexesByDim){s.dragMdqIndexesByDim[y].reverse();for(var v,m=0;m<s.dragMdqIndexesByDim[y].length;m++)if(v=s.dragMdqIndexesByDim[y][m],this.set("groupModel.segmentedLinesByDimension."+y+"."+v+".hidden",!1),s.dragGroupModel.groupKey!==s.dropGroupModel.groupKey){var b=r.groupModel.segmentedLinesByDimension[y][v];r.removeSegmentedLine(b)}}this.fire("renumber-lines"),this.editorModel.data.settings.usesClientCalculator&&this.editorModel.quoteModel.renumberIndexes(!0)}}},{key:"_removeLinesByIndex",value:function(e){e.sort(function(e,t){return e-t});for(var t=0;t<e.length;t++)this.splice("groupModel.standardLines",e[t],1),e=e.map(function(e){return--e})}},{key:"_getBundleWithChildren",value:function(e,t){var i=void 0;if(this.dragDrop.linesByParentKey[e]){i=this.dragDrop.linesByParentKey[e].length;for(var n=0;n<i;n++){var o=this.dragDrop.linesByParentKey[e][n].lineVO.key;t.push(o),this.dragDrop.linesByParentKey[o]&&this._getBundleWithChildren(o,t)}}}},{key:"_getLineIndexFromKey",value:function(e,t){for(var i=0;i<e.length;i++)if(e[i].lineVO.key===t)return i}},{key:"_getStandardLineIndexesFromKeys",value:function(e,t){for(var i=[],n=0;n<t.length;n++)i.push(this._getStandardLineIndexFromKey(e,t[n]));return i}},{key:"_setFieldNames",value:function(){this.fieldSet=this.fieldSetHandler.getByViewport(this.viewport),this.fieldSetName!=this.fieldSet.name&&(this.fieldSetName=this.fieldSet.name),this.fieldNames=this._getFields()}},{key:"_getFields",value:function(){return this.groupModel.standardSubscriptionScopeEditable?[this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(this.fieldSet.fields):this.fieldSet.fields}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport,this._setFieldNames()}},{key:"groupPanelToggled",value:function(e){this.drawerState=e.detail.drawerState,this._setColumnWidths(e)}},{key:"groupPanelCreated",value:function(e){this._setColumnWidths(e)}},{key:"groupToggled",value:function(e){this._ironListResize(e)}},{key:"_onSortLinesByHeader",value:function(e){var t=this.editorModel.data.settings.bundleKeptTogether;this.sortLines(this.groupModel.standardLines,e.detail.field,e.detail.order,t,!0)}},{key:"sortLinesRequired",value:function(e){var t=e.detail.notify,i=e.detail.lineSortField;this.sortLines(this.groupModel.standardLines,i,"asc",!1,t)}},{key:"sortLines",value:function(e,t,i,n,o){var r=void 0;if(t&&this.settings.lineLookups&&this.settings.lineLookups[t]){var s=u.getRelationshipField(t,this.settings.lineLookups[t]).split(".");r=s[1],t=s[0]}var a=l(e,t,i,n,r);o?this.set("groupModel.standardLines",a.slice()):this.groupModel.standardLines=a}},{key:"_updatePrimaryMobileColumns",value:function(){this.groupModel.editorModel.standardPrimaryMobileCols&&0<this.groupModel.editorModel.standardPrimaryMobileCols.length&&this.fieldSet.name.endsWith("Phone")&&(this.groupModel.editorModel.standardPrimaryMobileCols[0]=this.fieldSet.fields[0])}},{key:"_lineSplicesListener",value:function(e){e&&(this.set("groupModel.hasVisibleStandardLines",this.groupModel._groupHasStandardProducts()),this._showSubtotal())}},{key:"toggleOptional",value:function(e){if(!e.detail.groupKey||e.detail.groupKey==this.groupModel.groupVO.key)for(var t=0,i=this.groupModel.standardLines.length;t<i;t++)this.set("groupModel.standardLines."+t+".lineVO.record."+this.editorModel.constants.OPTIONAL_FIELD,e.detail.toggleOptionalBoolean)}},{key:"getZIndex",value:function(e){return this.groupModel.standardLines.length+10-e}},{key:"updateIronList",value:function(){var e=this.$$("iron-list");e&&e.fire("iron-resize")}},{key:"_onUpdateSizeForItem",value:function(e){if(e.detail.index)this.$$("iron-list").updateSizeForItem(e.detail.index);else for(var t=0,i=this.groupModel.standardLines.length;t<i;t++)this.$$("iron-list").updateSizeForItem(t)}},{key:"forwardFocusDown",value:function(e){9!==e.keyCode||e.shiftKey||s.signalFirstEditableTargetFirstRow(this,"sb-le-table-row","data-index")}},{key:"forwardFocusUp",value:function(e){9===e.keyCode&&e.shiftKey&&s.signalLastEditableTargetLastRow(this,"sb-le-table-row",this.visibleLines.length,"data-index")}},{key:"_initVisibleLines",value:function(){return this.groupModel.standardLines.filter(function(e){return e.visible}.bind(this))}},{key:"_initTabIndex",value:function(){return this.viewport&&this.viewport.isMobile()?-1:0}},{key:"_updateDragDropParentKey",value:function(e){this.dragDrop&&e&&(this.dragDrop.linesByParentKey=e)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_buildRows(groupModel)","_updatePrimaryMobileColumns(fieldSet, groupModel.editorModel.standardPrimaryMobileCols)","_lineSplicesListener(groupModel.standardLines.splices)","_showSubtotal(groupModel.*)","_updateDragDropParentKey(groupModel.editorModel.quoteModel.linesByParentItemKey)"]}},{key:"editorModel",get:function(){return this.groupModel.quoteModel.editorModel}},{key:"md",get:function(){return this.editorModel.md}},{key:"prefix",get:function(){return this.editorModel.data.developerPrefix}}]),a=e)),t("StandardLines",a),Polymer(a)}}}),System.register("quotes/tables/sf-segmented-table/SFSegmentedTable.js",["quotes/models/LineModel.js","quotes/sb-line-sort/QuoteLineSort.js","quotes/tables/SFAbstractTable.js","quotes/models/DragDropModel.js","common/layout/table-layout-builder/TableLayoutBuilder.js","common/core/sb-page-container/PageContainer.js","common/relationship/RelationshipFieldManager.js","common/forms/NumberFormatter.js","quotes/layout/template-generator/LETemplateGenerator.js","quotes/layout/template-generator/TemplateGenerator.js","quotes/ui-data-manager/UIDataManager.js","quotes/QuoteContext.js"],function(t,e){var l,i,u,o,r,s,a;return{setters:[function(e){e.LineModel},function(e){l=e.depthFirstLineItemsTreeSort},function(e){e.SFAbstractTable},function(e){e.DragDropModel},function(e){e.TableLayoutBuilder},function(e){i=e.PageContainer},function(e){u=e.RelationshipFieldManager},function(e){e.NumberFormatter},function(e){e.LETemplateGenerator},function(e){o=e.TemplateGenerator},function(e){r=e.UIDataManager},function(e){s=e.QuoteContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("SFSegmentedTable",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sf-segmented-table",this.properties={fieldNames:{type:Object},quoteLineFields:{type:Object},columnNames:{type:Array},currencyMd:{type:Object,computed:"_getNetTotalFieldMd(groupModel)"},viewport:{type:Object,value:function(){return i.getViewport()}},rowTemplate:{type:Object},secondaryRowTemplate:Object,uiData:Object,originalFieldValues:{type:Object,value:{}},expansionIconClass:{type:String}}}},{key:"ready",value:function(){this.addEventListener("table-header-sort-clicked",this._onSortLinesByHeader),this.editorModel.largeQuoteExperienceEnabled&&(this.addEventListener("line-toggled",this._onUpdateSizeForItem),Polymer.RenderStatus.afterNextRender(this,function(){this.$$("iron-list").fire("iron-resize")})),s.constants=this.editorModel.constants,this._prepareUIData(),this.rowTemplate=this.getTemplateGenerator(this.editorModel,this.groupModel,this.columnNames,this.dimension).generateRowNode(this._getFieldsForTemplate()),this.editorModel.deviceContext.isMobile&&(this.secondaryRowTemplate=this.getTemplateGenerator(this.editorModel,this.groupModel,null,null,!0).generateRowNode(this._getFields(),{class:o.classNames.SECONDARY+" "+o.classNames.EXPANDED}))}},{key:"_prepareUIData",value:function(){this.uiData=r.prepareLineData(this.groupModel.segmentedLinesByDimension[this.dimension],this._getFields(),this.quoteLineFields)}},{key:"getUIData",value:function(e){return this.uiData[e]}},{key:"computeCellClass",value:function(e,t){if(this.groupModel.standardLines[e]&&this.uiData[e]&&this.uiData[e]._cellClasses)return this.uiData[e]._cellClasses[t]||""}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport}},{key:"groupPanelToggled",value:function(e){this.drawerState=e.detail.drawerState,this._setColumnWidths(e)}},{key:"groupPanelCreated",value:function(e){this._setColumnWidths(e)}},{key:"groupToggled",value:function(e){this._ironListResize(e)}},{key:"_segmentedLinesByDimensionChanged",value:function(e){var t,i=void 0;if(t=0<=(i=e.path.split(".")).indexOf(this.dimension),"splices"==i[i.length-1]&&t){var n=e.value.indexSplices;n[0].removed&&0===n[0].object.length?this.hasVisibleSegmentedLines=!1:0<n[0].addedCount&&(this.hasVisibleSegmentedLines=!0),this._prepareUIData()}else"segmentedLinesByDimension"!=i[i.length-1]&&t&&this._prepareUIData()}},{key:"_render",value:function(){if(this.groupModel){this.toggleClass("largeQuote",this.editorModel.largeQuoteExperienceEnabled,this),this.dimension=this.attributes.key.value,this.hasVisibleSegmentedLines=this.groupModel.hasVisibleSegmentedLines[this.dimension],this.fieldNames=this._getFields(),this.lineModels=this.groupModel.segmentedLinesByDimension[this.dimension],this.linkPaths("groupModel.segmentedLinesByDimension."+this.dimension,"lineModels"),this.fieldLabelsMap=this.editorModel.md.fieldLabelsMap,this.quoteLineFields=this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName],this.settings=this.editorModel.data.settings,this.detailFieldNames=this.editorModel.fieldsetMap.multiSegmentLineFieldNames;var e=this.groupModel.groupVO.multiSegmentColumns;e&&0<Object.keys(e).length?(this.columnNames=e[this.dimension],this.headerColumnNames=this.groupModel.groupVO.localizedMultiSegmentColumns[this.dimension]):(this.columnNames=this.groupModel.quoteModel.quoteVO.multiSegmentColumns[this.dimension],this.headerColumnNames=this.editorModel.quoteModel.quoteVO.localizedMultiSegmentColumns[this.dimension]),this.netMultiSegmentTotalField=this.editorModel.constants.NET_TOTAL_FIELD,this.columnWidths={},this._setColumnWidths(),this.expansionIconClass="sf-icon-right"}}},{key:"_getFields",value:function(){var e=this.editorModel.fieldsetMap.multiSegmentLineSummaryFieldNames;return this.groupModel.segmentedSubscriptionScopeEditable?[this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(e):e}},{key:"_getFieldsForTemplate",value:function(){return this.editorModel.deviceContext.isMobile?this.editorModel.segmentedPrimaryMobileCols:this._getFields()}},{key:"_setColumnWidths",value:function(e){var t=null;if(!this.editorModel.deviceContext.isMobile&&this.editorModel.layout&&this.groupModel.segmentedLinesByDimension[this.dimension]){if(!(t=this.groupModel.colWidth[this.dimension]))return;this._setSubtotalColumnWidth(t,this.editorModel.layout.leftOffset)}this.set("columnWidths",t),this._ironListResize(e)}},{key:"_setSubtotalColumnWidth",value:function(e,t){if(e){for(var i=t,n=0,o=this.fieldNames.length;n<o;n++)i+=e[this.fieldNames[n]];this.labelColWidth=i+"px";for(var r=0,s=this.columnNames.length;r<s;r++){var a=this.columnNames[r].replace(/\W/g,"");this.subtotalColWidth=e[a]+"px"}this.totalColWidth=e.total+"px"}}},{key:"colWidthsChanged",value:function(e){this._setColumnWidths(e)}},{key:"_ironListResize",value:function(e){this.$$("iron-list")&&e&&e.detail&&e.detail.groupKey===this.groupModel.groupKey&&this.$$("iron-list").fire("iron-resize")}},{key:"onTrack",value:function(e){this.domHost.domHost._onTrack(e)}},{key:"getMultiSegmentColumnTotal",value:function(e){if(this.groupModel.multiSegmentColumnTotals[this.dimension])return[this.groupModel.multiSegmentColumnTotals[this.dimension][e]]}},{key:"getMultiSegmentTotalField",value:function(){if(this.groupModel.netMultiSegmentTotal)return this.groupModel.netMultiSegmentTotal[this.dimension]}},{key:"_showSubtotal",value:function(){this.currencyMd||(this.currencyMd={type:"currency",scale:this._getPriceScale(),CurrencyIsoCode:this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode}),"doNotDisplay"!=this.editorModel.data.settings.lineEditorSubtotalsField?(this._getNetTotalFieldMd(),this.showSubtotal=!0):this.showSubtotal=!1}},{key:"_getNetTotalFieldMd",value:function(){var e=this.editorModel.data.settings,t=e.lineEditorSubtotalsField;return{type:"currency",scale:e.isMultiCurrencyOrg?this.quoteVO.currencyDecimalScale:"Default"==t||"doNotDisplay"==t||null==t?this.editorModel.md.fieldsMap[e.developerPrefix+"QuoteLine__c"][this.editorModel.constants.NET_TOTAL_FIELD].scale:this.editorModel.md.fieldsMap[e.developerPrefix+"QuoteLine__c"][t].scale,CurrencyIsoCode:this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode}}},{key:"_onSortLinesByHeader",value:function(e){this.sortLines(this.groupModel.segmentedLinesByDimension[this.dimension],e.detail.field,e.detail.order,!1,!0)}},{key:"sortLinesRequired",value:function(e){var t=e.detail.notify,i=e.detail.lineSortField;this.sortLines(this.groupModel.segmentedLinesByDimension[this.dimension],i,"asc",!1,t)}},{key:"sortLines",value:function(e,t,i,n,o){var r=void 0;if(t&&this.settings.lineLookups&&this.settings.lineLookups[t]){var s=u.getRelationshipField(t,this.settings.lineLookups[t]).split(".");r=s[1],t=s[0]}var a=l(e,t,i,n,r);o?(this.set("groupModel.segmentedLinesByDimension."+this.dimension,a.slice()),this.notifyPath("lineModels",a.slice()),this._prepareUIData(),this.rowTemplate=this.getTemplateGenerator(this.editorModel,this.groupModel,this.columnNames,this.dimension).generateRowNode(this._getFields())):this.groupModel.segmentedLinesByDimension[this.dimension]=a}},{key:"getZIndex",value:function(e){return this.lineModels.length+10-e}},{key:"_onUpdateSizeForItem",value:function(e){if(e.detail.index)this.$$("iron-list").updateSizeForItem(e.detail.index);else for(var t=0,i=this.lineModels.length;t<i;t++)this.$$("iron-list").updateSizeForItem(t)}},{key:"toggleOptional",value:function(e){if(!e.detail.groupKey||e.detail.groupKey==this.groupModel.groupVO.key)for(var t=0,i=this.groupModel.segmentedLinesByDimension[this.dimension].length;t<i;t++)for(var n=0,o=this.groupModel.segmentedLinesByDimension[this.dimension][t].segments.length;n<o;n++){var r=this.groupModel.segmentedLinesByDimension[this.dimension][t].segments[n];r.lineVO._transient_||(r.lineVO._transient_={},r.lineVO._transient_.original=r.lineVO._transient_.original||JSON.parse(JSON.stringify(r.lineVO.record))),this.set("groupModel.segmentedLinesByDimension."+this.dimension+"."+t+".segments."+n+".lineVO.record."+this.constants.OPTIONAL_FIELD,e.detail.toggleOptionalBoolean)}}},{key:"toggleLineExpansion",value:function(e){this.lineModel.lineVO.expanded!=this.expanded&&this.set("lineModel.lineVO.expanded",!this.lineModel.lineVO.expanded),this.lineModel.segmented?this.set("lineModel.expandedIconClass",this.lineModel.lineVO.expanded?"sf-icon-down":"sf-icon-right"):this.lineModel.hasStandardLineItemDrawer&&this.set("lineModel.lineItemDrawerIconClass",this.lineModel.lineVO.expanded?"sf-icon-chevrondown":"sf-icon-chevronright"),(this.lineModel.editorModel.largeQuoteExperienceEnabled||this.lineModel.editorModel.isMultiGroupViewEnabled)&&this.fire("line-toggled",{index:this.dataIndex})}},{key:"_resetOnAction",value:function(e){Array.from(this.lineModels).forEach(function(e){e.lineVO.expanded=!1})}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.SFAbstractTable]}},{key:"observers",get:function(){return["_render(groupModel)","_segmentedLinesByDimensionChanged(groupModel.segmentedLinesByDimension.*)","_showSubtotal(groupModel.*)"]}},{key:"editorModel",get:function(){return this.groupModel.quoteModel.editorModel}},{key:"quoteVO",get:function(){return this.editorModel.quoteModel.quoteVO}},{key:"constants",get:function(){return this.editorModel.constants}}]),a=e)),t("SFSegmentedTable",a),Polymer(a)}}}),System.register("quotes/tables/sf-standard-table/SFStandardTable.js",["quotes/sb-line-sort/QuoteLineSort.js","quotes/tables/SFAbstractTable.js","common/core/sb-page-container/PageContainer.js","quotes/models/DragDropModel.js","common/layout/fields/FieldSetHandler.js","common/layout/table-layout-builder/TableLayoutBuilder.js","common/signal/RowFocusSignaler.js","common/relationship/RelationshipFieldManager.js","common/forms/NumberFormatter.js","quotes/layout/template-generator/LETemplateGenerator.js","quotes/layout/template-generator/TemplateGenerator.js","quotes/ui-data-manager/UIDataManager.js","quotes/QuoteContext.js","common/core/AppContext.js"],function(t,e){var l,i,o,r,s,u,a,d,c,h,p;return{setters:[function(e){l=e.depthFirstLineItemsTreeSort},function(e){e.SFAbstractTable},function(e){i=e.PageContainer},function(e){o=e.DragDropModel,e.isComponent,e.ifLineElementsShareParent,e.ifLineElementsAreParentChild,e.removeTableRowBorderClass},function(e){r=e.FieldSetHandler},function(e){e.TableLayoutBuilder},function(e){s=e.RowFocusSignaler},function(e){u=e.RelationshipFieldManager},function(e){e.NumberFormatter},function(e){e.LETemplateGenerator},function(e){a=e.TemplateGenerator},function(e){d=e.UIDataManager},function(e){c=e.QuoteContext},function(e){h=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}9,147,t("SFStandardTable",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sf-standard-table",this.properties={groupModel:{type:Object,notify:!0},settings:Object,fieldNames:Array,quoteLineFields:Object,fieldLabelsMap:{type:Object,notify:!0},subtotal:{type:Number},subtotalMd:Object,dragDrop:Object,viewport:{type:Object,value:function(){return i.getViewport()}},visibleLines:{type:Array,computed:"_initVisibleLines(groupModel)"},tabIndex:{type:Number,computed:"_initTabIndex(viewport)"},rowTemplate:{type:Object},secondaryRowTemplate:Object,uiData:Object,originalFieldValues:{type:Object,value:{}}}}},{key:"ready",value:function(){this.addEventListener("table-header-sort-clicked",this._onSortLinesByHeader),this.summaries=this.groupModel.quoteModel.grouped?this.groupModel.groupVO.summaries:this.groupModel.quoteModel.quoteVO.summaries;var e=new Set(["sb-droppable-standardRows","sb-droppable-emptyTable","sb-droppable-sidePanelGroups","emptyTableMessage"]);this.editorModel.largeQuoteExperienceEnabled?(this.addEventListener("line-toggled",this._onUpdateSizeForItem),Polymer.RenderStatus.afterNextRender(this,function(){this.$$("iron-list").fire("iron-resize")})):this.dragDrop=new o(this,this.editorModel.data.settings.bundleKeptTogether,"sf-le-table-row",e,this.dragFunc.bind(this),this.trackFunc.bind(this),this.dropFunc.bind(this),9,147),c.constants=this.editorModel.constants,this._prepareUIData(),this.rowTemplate=this.getTemplateGenerator(this.editorModel,this.groupModel,null).generateRowNode(this._getFieldsForTemplate(),{class:"row"}),h.isMobile&&(this.secondaryRowTemplate=this.getTemplateGenerator(this.editorModel,this.groupModel,null,null,!0).generateRowNode(this._getAllFields(),{class:a.classNames.SECONDARY+" "+a.classNames.EXPANDED}))}},{key:"_prepareUIData",value:function(){var e=h.isMobile?this._getAllFields():this._getFields();this.uiData=d.prepareLineData(this.groupModel.standardLines,e,this.quoteLineFields)}},{key:"getUIData",value:function(e){return this.uiData[e]}},{key:"computeCellClass",value:function(e,t){if(this.groupModel.standardLines[e]&&this.uiData[e]&&this.uiData[e]._cellClasses)return this.uiData[e]._cellClasses[t]||""}},{key:"_buildRows",value:function(){this.toggleClass("largeQuote",this.editorModel.largeQuoteExperienceEnabled,this),this.actionsOnTheLeft=this.editorModel.actionsOnTheLeft,this.multiLineDeleteEnabled=this.editorModel.data.settings.multiLineDeleteEnabled,this.fieldSetHandler=new r(this.editorModel.fieldsetMap,"lineFieldNames","lineFieldNamesTablet","lineFieldNamesPhone"),this._setFieldNames(),this.columnWidths={},this._setColumnWidths(),this.columnNames=null,this.fieldLabelsMap=this.editorModel.md.fieldLabelsMap,this.quoteLineFields=this.editorModel.md.fieldsMap[this.editorModel.data.quoteLineObjectName],this._setDrawerFields(),this.settings=this.editorModel.data.settings,this.uiData&&(this._prepareUIData(),this.rowTemplate=this.getTemplateGenerator(this.editorModel,this.groupModel,null).generateRowNode(this._getFieldsForTemplate())),this.$$("iron-list")&&this.groupModel.groupKey&&1==this.editorModel.quoteModel.quoteVO.lineItemGroups.length&&this.$$("iron-list").notifyResize()}},{key:"_setColumnWidths",value:function(e){var t=null;!this.editorModel.deviceContext.isMobile&&this.editorModel.layout&&(t=this.groupModel.colWidth.Standard,this._setSubtotalColumnWidth(t,this.editorModel.layout.leftOffset)),this.set("columnWidths",t),this._ironListResize(e)}},{key:"_setSubtotalColumnWidth",value:function(e,t){for(var i=t,n=this.fieldNames.length,o=0;o<n-1;o++)i+=e[this.fieldNames[o]];this.labelColWidth=i+6+"px";var r=e[this.editorModel.constants.NET_TOTAL_FIELD];this.subtotalColWidth=r+6+"px"}},{key:"colWidthsChanged",value:function(e){this._setColumnWidths(e)}},{key:"_ironListResize",value:function(e){this.$$("iron-list")&&e&&e.detail&&e.detail.groupKey===this.groupModel.groupKey&&this.$$("iron-list").fire("iron-resize")}},{key:"_getAllFields",value:function(){return this._getFields().concat(this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames)}},{key:"_setDrawerFields",value:function(){var e=this.editorModel.fieldsetMap.standardLineItemDrawerFieldNames,t=this.editorModel.deviceContext.isMobile;e&&!t?this.drawerFieldNames=e:e&&t&&(this.fieldNames=this.fieldNames.concat(e))}},{key:"_showSubtotal",value:function(){var e=this.editorModel.data.settings;this.subtotalMd||(this.subtotalMd={type:"currency",scale:this._getPriceScale(),CurrencyIsoCode:this.groupModel.quoteModel.quoteVO.record.CurrencyIsoCode}),"doNotDisplay"!=e.lineEditorSubtotalsField&&0<this.groupModel.standardLines.length?(this._getSubtotal(),this.showSubtotal=!0):this.showSubtotal=!1}},{key:"_getPriceScale",value:function(){var e=this.editorModel.data.settings,t=e.lineEditorSubtotalsField;return e.isMultiCurrencyOrg?this.groupModel.quoteModel.quoteVO.currencyDecimalScale:"Default"==t||"doNotDisplay"==t||null==t?this.editorModel.md.fieldsMap[this.prefix+"QuoteLine__c"][this.editorModel.constants.NET_TOTAL_FIELD].scale:this.editorModel.md.fieldsMap[this.prefix+"QuoteLine__c"][t].scale}},{key:"_getSubtotal",value:function(){var e=void 0,t=void 0,i=this.editorModel.data.settings,n=this.groupModel.standardLines;e="Default"==i.lineEditorSubtotalsField||null==i.lineEditorSubtotalsField?this.editorModel.constants.NET_TOTAL_FIELD:i.lineEditorSubtotalsField;for(var o=t=0,r=n.length;o<r;o++){var s=n[o];isNaN(s.lineVO.record[e])||(t+=s.lineVO.record[e])}this.subtotal=t}},{key:"onTrack",value:function(e){this.dragDrop._onTrack(e)}},{key:"dragFunc",value:function(e){var i=this.dragDrop;i.ghost=i.lineEditor.$.ghost,this.lineModelsByKey=this.groupModel.quoteModel.lineModelsByKey,i.dragKeys=[],i.dragStandardIndexes=[],i.dragMdqIndexesByDim={},i.dragLineModels=[],i.dragGroupModel=e.lineModel.groupModel,i.dragKeys.push(e.lineModel.lineVO.key),i.keepBundleTogether&&this._getBundleWithChildren(i.dragKeys[0],i.dragKeys),i.dragKeys.forEach(function(e){var t=this.lineModelsByKey[e];i.dragLineModels.push(t),this.lineModelsByKey[e].segmented?i.dragMdqIndexesByDim[t.dimensionType]?i.dragMdqIndexesByDim[t.dimensionType].push(this._getLineIndexFromKey(this.groupModel.segmentedLinesByDimension[t.dimensionType],e)):i.dragMdqIndexesByDim[t.dimensionType]=[this._getLineIndexFromKey(this.groupModel.segmentedLinesByDimension[t.dimensionType],e)]:i.dragStandardIndexes.push(this._getLineIndexFromKey(this.groupModel.standardLines,e))}.bind(this)),i.dragTargetElementIndex=this._getLineIndexFromKey(this.groupModel.standardLines,e.lineModel.lineVO.key);for(var t,n=0;n<i.dragStandardIndexes.length;n++)t=i.dragStandardIndexes[n],this.set("groupModel.standardLines."+t+".hidden",!0);if(0!=Object.keys(i.dragMdqIndexesByDim).length)for(var o in i.dragMdqIndexesByDim)for(var r,s=0;s<i.dragMdqIndexesByDim[o].length;s++)r=i.dragMdqIndexesByDim[o][s],this.set("groupModel.segmentedLinesByDimension."+o+"."+r+".hidden",!0);i.ghostField=e.lineModel.lineVO.record[this.editorModel.constants.PRODUCT_CODE_FIELD]}},{key:"trackFunc",value:function(e){var t=this.dragDrop,i=this.groupModel.editorModel.data.settings.bundleKeptTogether,n=this.groupModel.standardLines.length-1;if(e=t._findTableRowValidTarget(e))switch(t.targetClass){case"sb-droppable-standardRows":if(t._updateTableRowHoverOverObject(e,n),!t.hoverOver)return;t.targetHost=t.hoverOver.comp.domHost,t.usePlaceholder=!0,t.enableHighLight=!0;break;case"sb-droppable-emptyTable":i&&t.sourceElement.lineModel.hasParent?t.hoverOver=null:t.hoverOver={comp:e},t.usePlaceholder=!1,t.enableHighLight=!0;break;case"sb-droppable-sidePanelGroups":i&&t.sourceElement.lineModel.hasParent?t.hoverOver=null:t.hoverOver={comp:e},t.targetHost=t.hoverOver.comp.parentNode.parentNode,t.usePlaceholder=!1,t.enableHighLight=!0}else t.hoverOver=null}},{key:"dropFunc",value:function(e,t,i,n){var o=void 0,r=e.domHost.domHost,s=this.dragDrop;s.dropKey=null,s.dropIndex=null,s.dropGroupModel=null;for(var a,l=0,u=s.dragStandardIndexes?s.dragStandardIndexes.length:0;l<u;l++)a=s.dragStandardIndexes[l],this.set("groupModel.standardLines."+a+".hidden",!1);if(0!=Object.keys(s.dragMdqIndexesByDim).length)for(var d in s.dragMdqIndexesByDim)for(var c,h=0;h<s.dragMdqIndexesByDim[d].length;h++)c=s.dragMdqIndexesByDim[d][h],this.set("groupModel.segmentedLinesByDimension."+d+"."+c+".hidden",!1);if(t){switch(e.lineModel.subscriptionScopeEditable&&(t.domHost.groupModel.colWidth=e.lineModel.groupModel.colWidth,s.dragGroupModel._updateStandardSubscriptionScopeEditable(e.lineModel),this._setFieldNames(),this._setColumnWidths()),this._removeLinesByIndex(s.dragStandardIndexes),i){case"sb-droppable-standardRows":s.dropKey=t.lineModel.lineVO.key,s.dropGroupModel=t.lineModel.groupModel,s.dropIndex=this._getLineIndexFromKey(s.dropGroupModel.standardLines,s.dropKey),o=t.domHost.domHost,n?s.dropIndex=0<=s.dropIndex?s.dropIndex:0:++s.dropIndex;break;case"sb-droppable-emptyTable":case"emptyTableMessage":o=Polymer.dom(t).getOwnerRoot().host,s.dropGroupModel=o.groupModel;break;case"sb-droppable-sidePanelGroups":var p="Group"+t.getAttribute("id"),f=s._findParentCustomElement(t,"groupContainer","id");o=f.querySelector("#"+p),s.dropGroupModel=o.groupModel}for(var g=0;g<s.dragLineModels.length;g++)if(s.dragLineModels[g].segmented){if(s.dragGroupModel.groupKey===s.dropGroupModel.groupKey)continue;s.dropGroupModel.dimensions.includes(s.dragLineModels[g].segmentType)?o.addSegmentedLineToExistingTab(s.dragLineModels[g]):o.addSegmentedLineToEmptyTable(s.dragLineModels[g])}else{if(s.dragLineModels[g].subscriptionScopeEditable&&(s.dropGroupModel.standardSubscriptionScopeEditable=!0,Polymer.RenderStatus.afterNextRender(Polymer.dom(o.root).querySelector("#standardLines"),function(){Polymer.dom(o.root).querySelector("#standardLines")._setFieldNames(),Polymer.dom(o.root).querySelector("#standardLines")._setColumnWidths()})),s.dragLineModels[g].visible)switch(i){case"sb-droppable-standardRows":t.domHost.splice("groupModel.standardLines",s.dropIndex,0,s.dragLineModels[g]);break;case"sb-droppable-emptyTable":case"emptyTableMessage":case"sb-droppable-sidePanelGroups":o.push("groupModel.standardLines",s.dragLineModels[g])}else o.push("groupModel.standardLines",s.dragLineModels[g]);s.dragLineModels[g].groupModel=s.dropGroupModel,s.dragLineModels[g].lineVO.parentGroupKey=s.dropGroupModel.groupKey,s.dropIndex++}if(0!=Object.keys(s.dragMdqIndexesByDim).length)for(var y in s.dragMdqIndexesByDim){s.dragMdqIndexesByDim[y].reverse();for(var v,m=0;m<s.dragMdqIndexesByDim[y].length;m++)if(v=s.dragMdqIndexesByDim[y][m],this.set("groupModel.segmentedLinesByDimension."+y+"."+v+".hidden",!1),s.dragGroupModel.groupKey!==s.dropGroupModel.groupKey){var b=r.groupModel.segmentedLinesByDimension[y][v];r.removeSegmentedLine(b)}}this.fire("renumber-lines"),this.editorModel.data.settings.usesClientCalculator&&this.editorModel.quoteModel.renumberIndexes(!0);var _=e.domHost,S=t.domHost;_&&"SF-STANDARD-TABLE"===_.tagName&&_._prepareUIData(),S&&"SF-STANDARD-TABLE"===S.tagName&&_!==S&&S._prepareUIData()}}},{key:"_removeLinesByIndex",value:function(e){e.sort(function(e,t){return e-t});for(var t=0;t<e.length;t++)this.splice("groupModel.standardLines",e[t],1),e=e.map(function(e){return--e})}},{key:"_getBundleWithChildren",value:function(e,t){var i=void 0;if(this.dragDrop.linesByParentKey[e]){i=this.dragDrop.linesByParentKey[e].length;for(var n=0;n<i;n++){var o=this.dragDrop.linesByParentKey[e][n].lineVO.key;t.push(o),this.dragDrop.linesByParentKey[o]&&this._getBundleWithChildren(o,t)}}}},{key:"_getLineIndexFromKey",value:function(e,t){for(var i=0;i<e.length;i++)if(e[i].lineVO.key===t)return i}},{key:"_getStandardLineIndexesFromKeys",value:function(e,t){for(var i=[],n=0;n<t.length;n++)i.push(this._getStandardLineIndexFromKey(e,t[n]));return i}},{key:"_setFieldNames",value:function(){this.fieldSet=this.fieldSetHandler.getByViewport(this.viewport),this.fieldSetName!=this.fieldSet.name&&(this.fieldSetName=this.fieldSet.name),this.fieldNames=this._getFields()}},{key:"_getFields",value:function(){return this.groupModel.standardSubscriptionScopeEditable?[this.editorModel.constants.SUBSCRIPTION_SCOPE_FIELD].concat(this.fieldSet.fields):this.fieldSet.fields}},{key:"_getFieldsForTemplate",value:function(){return this.editorModel.deviceContext.isMobile?this.groupModel.editorModel.standardPrimaryMobileCols:this._getFields()}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport,this._setFieldNames()}},{key:"groupPanelToggled",value:function(e){this.drawerState=e.detail.drawerState,this._setColumnWidths(e)}},{key:"groupPanelCreated",value:function(e){this._setColumnWidths(e)}},{key:"groupToggled",value:function(e){this._ironListResize(e),this._prepareUIData()}},{key:"_onSortLinesByHeader",value:function(e){var t=this.editorModel.data.settings.bundleKeptTogether;this.sortLines(this.groupModel.standardLines,e.detail.field,e.detail.order,t,!0)}},{key:"sortLinesRequired",value:function(e){var t=e.detail.notify,i=e.detail.lineSortField;this.sortLines(this.groupModel.standardLines,i,"asc",!1,t)}},{key:"sortLines",value:function(e,t,i,n,o){var r=void 0;if(t&&this.settings.lineLookups&&this.settings.lineLookups[t]){var s=u.getRelationshipField(t,this.settings.lineLookups[t]).split(".");r=s[1],t=s[0]}this._hasNumberField()&&this._preserveNumberValues(e);var a=l(e,t,i,n,r);o?(this.set("groupModel.standardLines",a.slice()),this._prepareUIData(),this.rowTemplate=this.getTemplateGenerator(this.editorModel,this.groupModel,null).generateRowNode(this._getFields())):this.groupModel.standardLines=a}},{key:"onRowsRenumbered",value:function(){this._prepareUIData()}},{key:"_preserveNumberValues",value:function(e){var o=this;e.forEach(function(e){var t=e.lineVO.record,i=t.Id||t[o.editorModel.constants.SOURCE_FIELD],n=o.editorModel.constants.NUMBER_FIELD;o.originalFieldValues[i]||(o.originalFieldValues[i]={}),o.originalFieldValues[i].hasOwnProperty(n)||(o.originalFieldValues[i][n]=t[n])})}},{key:"_hasNumberField",value:function(){return-1<this._getFields().indexOf(this.editorModel.constants.NUMBER_FIELD)}},{key:"_updatePrimaryMobileColumns",value:function(){this.groupModel.editorModel.standardPrimaryMobileCols&&0<this.groupModel.editorModel.standardPrimaryMobileCols.length&&this.fieldSet.name.endsWith("Phone")&&(this.groupModel.editorModel.standardPrimaryMobileCols[0]=this.fieldSet.fields[0])}},{key:"_lineSplicesListener",value:function(e){e&&(this.set("groupModel.hasVisibleStandardLines",this.groupModel._groupHasStandardProducts()),this._showSubtotal(),this._hasNumberField()&&this._preserveNumberValues(this.groupModel.standardLines),this.rowTemplate=this.getTemplateGenerator(this.editorModel,this.groupModel,null).generateRowNode(this._getFieldsForTemplate(),{class:"row"}))}},{key:"toggleOptional",value:function(e){if(!e.detail.groupKey||e.detail.groupKey==this.groupModel.groupVO.key)for(var t=0,i=this.groupModel.standardLines.length;t<i;t++)this.set("groupModel.standardLines."+t+".lineVO.record."+this.editorModel.constants.OPTIONAL_FIELD,e.detail.toggleOptionalBoolean)}},{key:"clearOriginalFieldValues",value:function(){var t=this;this.originalFieldValues&&Object.keys(this.originalFieldValues).forEach(function(e){delete t.originalFieldValues[e]})}},{key:"getZIndex",value:function(e){return this.groupModel.standardLines.length+10-e}},{key:"_onUpdateSizeForItem",value:function(e){if(e.detail.index)this.$$("iron-list").updateSizeForItem(e.detail.index);else for(var t=0,i=this.groupModel.standardLines.length;t<i;t++)this.$$("iron-list").updateSizeForItem(t)}},{key:"forwardFocusDown",value:function(e){9!==e.keyCode||e.shiftKey||s.signalFirstEditableTargetFirstRow(this,"sf-le-table-row","data-index")}},{key:"forwardFocusUp",value:function(e){9===e.keyCode&&e.shiftKey&&s.signalLastEditableTargetLastRow(this,"sf-le-table-row",this.visibleLines.length,"data-index")}},{key:"_initVisibleLines",value:function(){return this.groupModel.standardLines.filter(function(e){return e.visible}.bind(this))}},{key:"_initTabIndex",value:function(){return this.viewport&&this.viewport.isMobile()?-1:0}},{key:"_updateDragDropParentKey",value:function(e){this.dragDrop&&e&&(this.dragDrop.linesByParentKey=e)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.SFAbstractTable]}},{key:"observers",get:function(){return["_buildRows(groupModel)","_updatePrimaryMobileColumns(fieldSet, groupModel.editorModel.standardPrimaryMobileCols)","_lineSplicesListener(groupModel.standardLines.splices)","_showSubtotal(groupModel.*)","_updateDragDropParentKey(groupModel.editorModel.quoteModel.linesByParentItemKey)"]}},{key:"editorModel",get:function(){return this.groupModel.quoteModel.editorModel}},{key:"md",get:function(){return this.editorModel.md}},{key:"prefix",get:function(){return this.editorModel.data.developerPrefix}}]),p=e)),t("SFStandardTable",p),Polymer(p)}}}),System.register("assets/selection/routes/sb-asset-lookup/AssetLookup.js",["common/core/Page.js","common/filter/searcher/Searcher.js","common/data/format/ErrorFormatter.js"],function(t,e){var i,o,r,s,a;return{setters:[function(e){i=e.Page},function(e){o=e.Searcher},function(e){r=e.ErrorFormatter}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}s=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("AssetLookup",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),s(e,[{key:"beforeRegister",value:function(){this.is="sb-asset-lookup",this.properties=Polymer.Base.extend({selectedProducts:{type:Object,value:{}},lineEditorModel:Object,totalCount:String,hasTotalCount:Boolean,quote:Object,errors:{type:Array,value:[],notify:!0},error:{type:Array,value:[]},groupKey:{type:String,computed:"getGroupKey(ctx.params)"}},i.properties)}},{key:"ready",value:function(){this.preLoadObjects()}},{key:"handleProductsLoadServerResponse",value:function(){this.$.qo.addEventListener("line-editor-model-changed",function(e){this.lineEditorModel=e.detail.value,this.$.smLoadService.quote=this.quote=e.detail.value.quote}.bind(this)),this.$.smLoadService.addEventListener("search-model-changed",function(e){this.searchModel=e.detail.value,this.primaryMobileColumn=this.searchModel.resultFieldNames[0],this.searcher=new o(this.searchModel),this.hasTotalCount=0<this.searchModel.totalCount,this.totalCount=this.searchModel.totalCount}.bind(this))}},{key:"toggleFilter",value:function(){this.$$("sb-page-header")._closeMenu(),this.$.drawer.togglePanel()}},{key:"closeDrawer",value:function(){this.refocus(),this.$.drawer.closeDrawer()}},{key:"refocus",value:function(){this.$.pf.focusFirstField()}},{key:"removeFilter",value:function(){this.$$(".actions").removeChild(this.$$("#fb"))}},{key:"deSelectAll",value:function(){this.$.lookupLayout.deSelectAll()}},{key:"onSelect",value:function(){if(this.selectedProducts&&0<Object.keys(this.selectedProducts).length)return this.navigateToAssetUpgradeRoute();this.onCancel()}},{key:"navigateToAssetUpgradeRoute",value:function(){var e={qId:this.lineEditorModel.quote.record.Id,pIds:Object.keys(this.selectedProducts)};return 0<Object.keys(this.selectedProducts).length&&(e.jspr=!0),void 0!==this.groupKey&&(e.groupKey=this.groupKey),this.nav("#",e,["asset","upgrade"],!1)}},{key:"onCancel",value:function(){this.spinner=!0;var e={qId:this.lineEditorModel.quote.record.Id};null!=this.ctx.params.groupKey&&(e.groupKey=this.ctx.params.groupKey),this.nav("#",e,["quote","le"],!1)}},{key:"runSearcher",value:function(){this.$$("#submit").focus(),this.$.af.runService(),this.closeDrawer()}},{key:"bindFilterEnterCallBacks",value:function(){this.$.af.enterCallback=this.runSearcher.bind(this)}},{key:"clearFilterFields",value:function(){this.filterData=this.searcher.clearFields()}},{key:"preLoadObjects",value:function(){this.assetLookupObjects=["Asset"]}},{key:"getGroupKey",value:function(){return this.ctx.params.groupKey}},{key:"getGroupKey",value:function(){return this.ctx.params.groupKey}},{key:"clearStackTrace",value:function(){this.errors[0]&&(this.error=new r(this.errors).truncate())}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.LookupBehavior]}},{key:"listeners",get:function(){return{"errors-changed":"clearStackTrace"}}}]),a=e)),t("AssetLookup",a),Polymer(a)}}}),System.register("assets/upgrade/routes/sb-asset-upgrade/AssetUpgrade.js",["common/layout/tables/TableClassBuilder.js","common/layout/data/RecordGrouper.js","common/core/Page.js","common/data/format/ErrorFormatter.js"],function(t,e){var l,i,o,r;return{setters:[function(e){l=e.TableClassBuilder},function(e){e.RecordGrouper},function(e){i=e.Page},function(e){o=e.ErrorFormatter}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("AssetUpgrade",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-asset-upgrade",this.properties=Polymer.Base.extend({upgrades:Array,upgradeSourceMap:Object,upgradeTargetMap:Object,errors:{type:Array,value:[],notify:!0},validationMessages:{type:Array,value:[]},assetHeaderSelectable:{type:Boolean,value:!1}},i.properties)}},{key:"ready",value:function(){this.initializeServiceSpinners(),this.initializeProperties(),this.preLoadObjects(),this.handleUpgradeSelected(),this.handleMetaDataResponse(),this.handleAddProductResponse(),this.handleLineEditorModelResponse(),this.handleSelectionResponse()}},{key:"initializeProperties",value:function(){this.upgradeSourceMap={},this.upgradeTargetMap={}}},{key:"initializeServiceSpinners",value:function(){this.$.addProducts.background=!1,this.$.smSelectService.background=!1}},{key:"onSelect",value:function(){var e=this.getSelectedUpgrades();!1!==e&&(this.$.addProducts.products=e)}},{key:"navigateToLineEditor",value:function(){var e=this.lineEditorModel?this.lineEditorModel.quote.record.Id:this.ctx.params.qId;this.nav("#",{qId:e},["quote","le"],!1)}},{key:"renderUpgrades",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=this.upgrades[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value;this.upgradeSourceMap[r.record.Product2Id]=this.upgradeSourceMap[r.record.Product2Id]||[],this.upgradeSourceMap[r.record.Product2Id].push({upgradeSelected:!1,Id:r.record.Id,name:r.record.Name}),r._transient_=r._transient_||{},r._transient_.index=this.upgradeSourceMap[r.record.Product2Id].length-1;var s=!0,a=!1,l=void 0;try{for(var u,d=r.availableUpgrades[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var c=u.value;this.setUpgradeTargetMap(r,c)}}catch(e){a=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(a)throw l}}}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}this.upgradeResults=this.upgrades}},{key:"setUpgradeTargetMap",value:function(e,t){var i=e.record.Product2Id;this.upgradeTargetMap[t.record.Id]=this.upgradeTargetMap[t.record.Id]||{},this.upgradeTargetMap[t.record.Id][i]=this.upgradeTargetMap[t.record.Id][i]||[],this.upgradeTargetMap[t.record.Id][i].push({upgradeSelected:!1})}},{key:"getUpgrades",value:function(){void 0===this.ctx.params.pIds&&this.navigateToLineEditor(),this.$.smSelectService.selectedProducts=this.ctx.params.pIds.split(",")}},{key:"getSelectedProducts",value:function(){var e=this.getSelectedUpgrades(),t={},i=!0,n=!1,o=void 0;try{for(var r,s=(e||[])[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t[a.record.Id]={record:a.record,upgradedAssetId:a.upgradedAssetId}}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t}},{key:"applyUpgrades",value:function(){var e=this.$.upgrades.getUpgrades();!1!==e&&(this.$.addProducts.products=e)}},{key:"getSelectedUpgrades",value:function(){var e=[],t=[],i=!0,n=!1,o=void 0;try{for(var r,s=this.upgrades[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l=a._transient_.index,u=!0,d=!1,c=void 0;try{for(var h,p=a.availableUpgrades[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){var f=h.value.record.Id,g=a.record.Product2Id,y=this.upgradeTargetMap[f][g][l],v=this.upgradeSourceMap[g][l];!0!==v.upgradeSelected&&(v.upgradeSelected=y.upgradeSelected,v.upgrade=y.rowData,v.index=l)}}catch(e){d=!0,c=e}finally{try{!u&&p.return&&p.return()}finally{if(d)throw c}}}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}for(var m in this.upgradeSourceMap){var b=!0,_=!1,S=void 0;try{for(var k,C=this.upgradeSourceMap[m][Symbol.iterator]();!(b=(k=C.next()).done);b=!0){var M=k.value;!1!==M.upgradeSelected?e.push({record:M.upgrade,upgradedAssetId:M.Id,index:M.index}):t.push("You must select an upgrade for "+M.name)}}catch(e){_=!0,S=e}finally{try{!b&&C.return&&C.return()}finally{if(_)throw S}}}if(!(0<(this.validationMessages=t).length))return e}},{key:"handleUpgradeSelected",value:function(){this.addEventListener("selection-changed",function(e){this.ifRadioSelectedClearOtherRadioSelections(e);var t=e.detail.selected,i=e.detail.rowData._transient_.sourceProduct,n=this.upgradeTargetMap[e.detail.rowData.Id][i][e.detail.index];n.upgradeSelected=t,n.rowData=!0===t?e.detail.rowData:void 0}.bind(this))}},{key:"handleMetaDataResponse",value:function(){this.$.md.addEventListener("md-changed",function(e){var i=[],n=[],o={},r={},s={},a={};e.detail.value.fields.forEach(function(e){var t=e.name;i.push(t),n.push(e.label),o[t]=e.label,r[t]={type:e.type},s[e.label.replace(/\W/g,"")]=e.type,a[t]=e.type}.bind(this)),this.headerClassMap=new l(Object.keys(s),"Th",s).build(),this.rowClassMap=new l(i,"Td",a).build(),this.typeMap=r,this.recordKeys=i,this.fieldLabels=n,this.fieldLabelMap=o}.bind(this))}},{key:"handleAddProductResponse",value:function(){this.$.addProducts.addEventListener("psm-response-changed",function(e){void 0!==e.detail.value.quote&&(this.lineEditorModel.quote=e.detail.value.quote,void 0!==e.detail.value.configuredProducts&&0<e.detail.value.configuredProducts.length?this.handleConfigurableProducts(e):this.navigateToLineEditor())}.bind(this))}},{key:"handleConfigurableProducts",value:function(e){var t=e.detail.value,i={},n=this.getConfigProductIds(t);i.qId=e.detail.value.quote.record.Id,void 0!==this.ctx.params.groupKey&&(i.groupKey=this.ctx.params.groupKey),i.pId=n,t.selectedProducts=this.getSelectedProducts(),this.nav("#",i,["product","pc"],!1)}},{key:"getConfigProductIds",value:function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e.configuredProducts[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t.push(a.record.Id)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t.join(",")}},{key:"handleLineEditorModelResponse",value:function(){this.$.qo.addEventListener("line-editor-model-changed",function(e){this.lineEditorModel=e.detail.value,this.$.addProducts.stripLinesThreshold=this.lineEditorModel.settings.largeQuoteThreshold,this.$.addProducts.stripLinesMessage=this.lineEditorModel.customLabels.msg_large_quote_sent_without_lines,this.$.addProducts.quote=this.$.smSelectService.quote=this.quote=e.detail.value.quote}.bind(this))}},{key:"handleSelectionResponse",value:function(){this.$.smSelectService.useCache=!1,this.$.smSelectService.addEventListener("result-changed",function(e){if(void 0===e.detail.value[0]||!1===Array.isArray(e.detail.value[0].availableUpgrades))return this.navigateToLineEditor();this.upgrades=e.detail.value}.bind(this))}},{key:"preLoadObjects",value:function(){this.assetUpgradeObjects=["Product2"]}},{key:"ifRadioSelectedClearOtherRadioSelections",value:function(e){if(!1!==e.detail.selected&&void 0!==e.detail.selected){var t=Polymer.dom(e).rootTarget,i=Polymer.dom(t.parentElement).querySelectorAll("sb-table-row"),n=!0,o=!1,r=void 0;try{for(var s,a=i[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;"radio"===l.selectionType&&l!==t&&(l.selected=!1)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}}},{key:"clearStackTrace",value:function(){this.errors[0]&&(this.validationMessages=new o(this.errors).truncate())}},{key:"buildRowDataArray",value:function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var r,s=(e.availableUpgrades||[])[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;a.record._transient_=a.record._transient_||{},Object.assign(a.record._transient_,{sourceProduct:e.record.Product2Id,sourceProductIndex:e._transient_.index}),t.push(a)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["renderUpgrades(upgrades, recordKeys)","getUpgrades(ctx.params.pIds)"]}},{key:"listeners",get:function(){return{"errors-changed":"clearStackTrace"}}},{key:"fieldPrefix",get:function(){return this.app.org.prefix?this.app.org.prefix+"__":""}}]),r=e)),t("AssetUpgrade",r),Polymer(r)}}}),System.register("common/forms/sb-checkbox/factory/CheckboxFactory.js",["common/forms/sb-field/factory/FormField.js"],function(e,t){var r;return{setters:[function(e){r=e.FormField}],execute:function(){e("checkboxFactory",function(e,t,i,n){var o=new r("sb-checkbox");return o.addAttribute("value",2,"value",e),o.addAttribute("disabled",1,"disabled",t),o.addAttribute("hide",1,"hide",i),o.addAttribute("tab-index",1,"tabIndex",n),o.formattedValue={value:e,label:""},o})}}}),System.register("common/forms/sb-discount/factory/DiscountFactory.js",["common/forms/sb-field/factory/FormField.js","quotes/layout/sb-le-table-cell/DiscountConverter.js"],function(e,t){var g,y,v,m;function b(e,t,i){if(!e||function(e){return null==e||""===e||isNaN(e)}(i))return{label:"",value:""};var n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;if(l.value===t)return{label:l.label,value:l.value}}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}return{setters:[function(e){g=e.FormField},function(e){y=e.getUnitAndDisplayValue,v=e.setDiscountValue,m=e.updateUnitIfAmountInactive}],execute:function(){e("discountFactory",function(e,t,i,n,o,r,s){m(e,s);var a=y(e,s),l=a.units,u=a.unit,d=a.displayValue;v(e,s,d);var c=e.lineVO.record[e.constants.ADDITIONAL_DISCOUNT_FIELD],h=new g("sb-discount");h.addAttribute("model",1,"model",e),h.addAttribute("property",1,"property",s),h.addAttribute("disabled",1,"disabled",t),h.addAttribute("render-read-only",1,"renderReadOnly",i),h.addAttribute("input-type",1,"inputType",n),h.addAttribute("pattern",1,"pattern",o),h.addAttribute("formatter",1,"formatter",r),h.readOnlyBlurEvent="sb-discount-blur",h.changeEvent="sb-discount-change",h.readOnlyKeyDownEvent="sb-discount-keydown";var p=r.format(d),f=b(l,u,c);return u=null!=p&&""!==p?f.label:"",h.formattedValue={value:c,label:p,unit:u,unitValue:f.value},h.addAttribute("display-value",1,"displayValue",p),h.addAttribute("original",1,"original",h.formattedValue),h})}}}),System.register("common/forms/sb-datepicker/factory/DatePickerFactory.js",["common/forms/sb-field/factory/SimpleFieldFactory.js","common/core/sb-page-container/PageContainer.js","common/forms/sb-input/factory/InputFactory.js","common/forms/sb-field/factory/FormField.js"],function(e,t){var a,l,u,d;function c(e,t){return t.format(e,{date:!0})}function h(e,t,i){t.formattedValue={value:e,label:i}}return{setters:[function(e){a=e.simpleFieldFactory},function(e){l=e.PageContainer},function(e){u=e.inputFactory},function(e){d=e.FormField}],execute:function(){e("datePickerFactory",function(e,t,i,n,o,r){var s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:{range:!1};return t?(7<arguments.length&&void 0!==arguments[7]?arguments[7]:l).isMobile()?function(e,t,i,n){return u(e,t,i,"dateInput",n)}(e,t,i,r):!0===s.range?function(e,t,i){var n=new d("sb-daterange");null===e&&(e="");var o=void 0!==e.start,r=void 0!==e.end;return n.addAttribute("formatted-value",2,"value",{start:o?e.start:e,end:r?e.end:e}),n.addAttribute("disabled",1,"disabled",t),n.addAttribute("use-mask",1,"useMask",!i),n.readOnlyKeyEvent="sb-date-esc",n.readOnlyBlurEvent="sb-date-blur",n.changeEvent="selected-date-range-changed",n}(e,i,o):function(e,t,i){var n=new d("sb-datepicker");return n.addAttribute("selected-date",2,"value",e),n.addAttribute("disabled",1,"disabled",t),n.readOnlyKeyEvent="sb-date-esc",n.readOnlyBlurEvent="sb-date-blur",n.changeEvent="selected-date-changed",h(e,n,c(e,i)),n}(e,i,n):function(e,t){var i=c(e,t),n=a(i);return h(e,n,i),n}(e,n)})}}}),System.register("common/forms/sb-field/factory/FieldFactory.js",["common/forms/sb-checkbox/factory/CheckboxFactory.js","common/forms/sb-datepicker/factory/DatePickerFactory.js","common/forms/sb-field/factory/NumericFieldFactory.js","common/forms/sb-field/factory/SimpleFieldFactory.js","common/forms/sb-lookup/factory/LookupFactory.js","common/forms/sb-select/factory/SelectFactory.js","common/forms/sb-field/factory/TextFieldFactory.js"],function(e,t){var f,g,y,v,m,b,_;return{setters:[function(e){f=e.checkboxFactory},function(e){g=e.datePickerFactory},function(e){y=e.numericFieldFactory},function(e){v=e.simpleFieldFactory},function(e){m=e.lookupFactory},function(e){b=e.selectFactory},function(e){_=e.textFieldFactory}],execute:function(){e("fieldFactory",function(e,t,i,n,o,r,s,a,l,u,d,c,h,p){switch(e){case"boolean":case"checkbox":return f(i,o,r,h);case"date":case"datetime":return g(i,n,o,l,u,e,p);case"discount":case"double":case"number":case"currency":case"percent":return y(t,i,n,o,a,l,u,0==s?"first numberInput":"numberInput",e);case"id":case"reference":return m(i,n,o,a,c,u);case"picklist":case"multipicklist":return b(i,n,o,e,a,l,!u,d);case"string":case"textarea":case"phone":case"url":case"email":return _(i,n,o,a,u,e);default:return v(i)}})}}}),System.register("common/forms/sb-field/factory/FormField.js",[],function(e,t){var l,u,i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.attributes=[],this.events=[]}l={0:"",1:"[[",2:"{{"},u={0:"",1:"]]",2:"}}"},e("FormField",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"addAttribute",value:function(e,t,i,n,o){this.attributes.push({name:e,binding:t,variable:i,value:n,equals:o||"="})}},{key:"addEvent",value:function(e,t,i){this.events.push({event:e,variable:t,handler:i})}},{key:"setInnerText",value:function(e,t,i){this.innerText={variable:e,binding:t,value:i}}},{key:"attachTo",value:function(t,e,i,n,o,r,s){var a=this;this._html="<"+this.name,this.attributes.forEach(function(e){a._html+=" "+e.name+e.equals+'"'+l[e.binding]+e.variable+u[e.binding]+'"',t[e.variable]=e.value}),this.events.forEach(function(e){a._html+=" on-"+e.event+'="'+e.variable+'"',t[e.variable]=e.handler}),e&&(this._html+=" on-"+this.readOnlyKeyEvent+'="'+e+'"'),i&&(this._html+=" on-"+this.readOnlyKeyDownEvent+'="'+i+'"'),n&&(this._html+=" on-"+this.readOnlyBlurEvent+'="'+n+'"'),o&&(this._html+=" on-"+this.changeEvent+'="'+o+'"'),r&&(this._html+=' hidden$="[['+r+']]"'),s&&(this._html+=' focus-on-attached="true"'),this._html+=' apply-focus="[[applyFocus]]"',this._html+=">",this.innerText&&(this._html+=""+l[this.innerText.binding]+this.innerText.variable+u[this.innerText.binding],t[this.innerText.variable]=this.innerText.value),this._html+="</"+this.name+">"}},{key:"formattedValue",get:function(){return this._formattedValue},set:function(e){this._formattedValue=null!=e&&-1!==Object.keys(e).indexOf("label")?e:{value:e,label:e}}},{key:"defaultValue",get:function(){return this._defaultValue},set:function(e){this._defaultValue=e}},{key:"readOnlyKeyEvent",get:function(){return this._readOnlyKeyEvent||"keyup"},set:function(e){this._readOnlyKeyEvent=e}},{key:"readOnlyKeyDownEvent",get:function(){return this._readOnlyKeyDownEvent||"keydown"},set:function(e){this._readOnlyKeyDownEvent=e}},{key:"readOnlyBlurEvent",get:function(){return this._readOnlyBlurEvent||"blur"},set:function(e){this._readOnlyBlurEvent=e}},{key:"changeEvent",get:function(){return this._changeEvent||"change"},set:function(e){this._changeEvent=e}},{key:"numeric",get:function(){return!!this._numeric},set:function(e){this._numeric=e}},{key:"html",get:function(){return this._html}}]),i=t)),e("FormField",i)}}}),System.register("common/forms/sb-field/factory/NumericFieldFactory.js",["common/forms/sb-discount/factory/DiscountFactory.js","common/forms/sb-input/factory/InputFactory.js","common/forms/NumberFormatter.js","common/core/sb-page-container/PageContainer.js","common/forms/Locale.js"],function(e,t){var y,v,m,b,_;return{setters:[function(e){y=e.discountFactory},function(e){v=e.inputFactory},function(e){m=e.NumberFormatter},function(e){b=e.PageContainer},function(e){_=e.Locale}],execute:function(){e("numericFieldFactory",function(e,t,i,n,o,r,s,a,l){var u=9<arguments.length&&void 0!==arguments[9]?arguments[9]:b,d=u.isMobile()&&!_.isCommaDecimal()?"number":"text",c=new m(i,o,r,l,u.getViewport());if(e&&(e.constants.ADDITIONAL_DISCOUNT_FIELD===o.name||e.constants.MARKUP_FIELD===o.name)){var h=y(e,n,s,d,null,c,o.name);return h.numeric=!0,h}var p=c.format(t,!0),f=i?c.format(t,!1):p,g=v(f,i,n,a,d,s);return g.formattedValue={value:t,label:p},g.numeric=!0,g})}}}),System.register("common/forms/sb-field/factory/SimpleFieldFactory.js",["common/forms/sb-field/factory/FormField.js"],function(e,t){var n;return{setters:[function(e){n=e.FormField}],execute:function(){e("simpleFieldFactory",function(e,t){var i=new n("sb-div");return i.addAttribute("value",1,"value",e),t&&i.addAttribute("class",1,"fieldClass",t,"$="),i})}}}),System.register("common/forms/sb-field/factory/TextFieldFactory.js",["common/forms/sb-textarea/factory/TextareaFactory.js","common/forms/sb-input/factory/InputFactory.js","common/forms/sb-rte/factory/RichTextEditorFactory.js","common/Util.js"],function(e,t){var a,l,u,d;return{setters:[function(e){a=e.textareaFactory},function(e){l=e.inputFactory},function(e){u=e.richTextEditorFactory},function(e){d=e.Util}],execute:function(){e("textFieldFactory",function(e,t,i,n,o,r){return"richtextarea"===n.extraTypeInfo?u(e,t,o,n):((s=255<n.maxLength||"multiline"===n.format||"textarea"===r?a(e,t,i,o):l(e,t,i,"textInput","text",o)).formattedValue=d.toHTML(e),s);var s})}}}),System.register("common/forms/sb-input/factory/InputFactory.js",["common/forms/sb-field/factory/SimpleFieldFactory.js","common/forms/sb-field/factory/FormField.js"],function(e,t){var a,l;return{setters:[function(e){a=e.simpleFieldFactory},function(e){l=e.FormField}],execute:function(){e("inputFactory",function(e,t,i,n,o,r,s){return t?function(e,t,i,n,o,r){var s=new l("sb-input");return s.addAttribute("value",2,"value",e),s.addAttribute("disabled",1,"disabled",t),s.addAttribute("input-class",1,"inputClass",i),s.addAttribute("input-type",1,"inputType",n),s.addAttribute("render-read-only",1,"renderReadOnly",o),s.addAttribute("pattern",1,"pattern",r),s.readOnlyKeyEvent="sb-input-key",s}(e,i,n,o||"text",r,s):a(e)})}}}),System.register("common/forms/sb-lookup/factory/LookupFactory.js",["common/core/sb-page-container/PageContainer.js","common/forms/sb-field/factory/FormField.js","common/forms/sb-lookup/map/LookupNameMapper.js"],function(e,t){var a,l;function u(e,t,i,n){var o=n[n.refDisplayName];if(o)return o;if(e&&(o=function(e,t){var i=t.property,n=t.obj,o=t.refObjects,r=i.Name?i.Name:e.name;if(r){var s=r.lastIndexOf("Id"),a=0<=s?r.substring(0,s):0<=r.lastIndexOf("__c")?r.replace("__c","__r"):null,l=n[a]?n[a].attributes.type:null;if(a&&n[a]&&o&&l&&o[l]){var u=o[l].nameField.fieldName;return n[a][u]?n[a][u]:n[a].Id}}}(i,n)),!o&&n.refTable&&i.relationshipName&&n.record){var r=new l(n.refTable).getNameField(),s=n.record[i.relationshipName];s&&(o=s[r])}return o||t||""}return{setters:[function(e){e.PageContainer},function(e){a=e.FormField},function(e){l=e.LookupNameMapper}],execute:function(){e("lookupFactory",function(e,t,i,n,o,r){return t?function(e,t,i,n,o){var r=new a("sb-lookup"),s=u(!1,e,i,n);return r.formattedValue={value:e,label:s},r.addAttribute("id",0,"lookup"),r.addAttribute("value",2,"value",e),r.addAttribute("label",1,n.refDisplayName,r.formattedValue.label),r.addAttribute("label-name",1,"labelName",n.refDisplayName),r.addAttribute("table-name",1,"refTable",n.refTable),r.addAttribute("disabled",1,"disabled",t),r.addAttribute("field-full-name",1,"fieldFullName",i.tableName+"."+i.name),r.addAttribute("field-label",1,"fieldLabel",i.label),r.addAttribute("revert-on-escape",1,"revertOnEscape",o),r.addAttribute("calculate-list-position",1,"calculateListPosition",!1),r.addAttribute("has-filter",1,"hasFilter",!!i.filteredLookupInfo),r.addAttribute("record",1,"record",n.record),i.filteredLookupInfo&&i.filteredLookupInfo.controllingFields&&r.addAttribute("controlling-fields",1,"controllingFields",i.filteredLookupInfo.controllingFields),r.readOnlyKeyEvent="sb-type-esc",r.readOnlyBlurEvent="sb-type-blur",r.changeEvent="lookup-value-changed",r}(e,i,n,o,r):function(e,t,i){var n=new a("span"),o=u(!0,e,t,i);return n.addAttribute("value",2,"_value_",e),n.addAttribute("class",1,"link","link","$="),n.setInnerText(i.refDisplayName,1,o),n.formattedValue={value:e,label:o},n.addEvent("tap","refClick",function(e){window.open(window.location.origin+"/"+e.target.value)}),n}(e,n,o)})}}}),System.register("common/forms/sb-lookup/map/LookupNameMapper.js",[],function(e,t){var i,o;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.tableName=e}i={Contract:"ContractNumber",Case:"CaseNumber"},e("LookupNameMapper",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(t,[{key:"getNameField",value:function(){return i[this.tableName]||"Name"}}]),o=t)),e("LookupNameMapper",o)}}}),System.register("common/forms/sb-lookup/query/LookupQueryBuilder.js",["common/relationship/RelationshipFieldManager.js","common/core/AppContext.js","common/forms/NumberParser.js","common/forms/DateParser.js"],function(e,t){var d,o,u,c,i;return{setters:[function(e){d=e.RelationshipFieldManager},function(e){o=e.AppContext},function(e){u=e.NumberParser},function(e){c=e.DateParser}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,i,n,o,r,s,a,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y),this.tableName=e,this.searchField=t,this.hasFilter=i,this.lookupFieldFullName=n,this.resultsLimit=o,this.currentRecordFields=r,this.currentRecord=s,this.applyMruOptimization=a,this.fields=l,this.fieldTypeByName=l&&l.fieldTypeObjByName?l.fieldTypeObjByName:null,this.numberParser=new u,this.dateParser=new c(!0)}e("LookupQueryBuilder",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(y,[{key:"build",value:function(e,t,i){var n=0<arguments.length&&void 0!==e?e:"",o=1<arguments.length&&void 0!==t&&t,r=2<arguments.length&&void 0!==i&&i,s="%",a="";null!=n&&""!==n&&(s=n.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/'/g,"\\'").replace(/%/g,"\\%").replace(/[*]+/g,"%"),a=n.replace(/\*/g,""),s.endsWith("%")||(s+="%"));var l=this.getScope(a),u="";this.hasFilter?u=" USING SCOPE "+l+", LOOKUP "+this.lookupFieldFullName:"mru"===l&&(u=" USING SCOPE mru");var d=this.getSelectClause(o),c=this.getWhereClause(s,n,r),h="mru"===l?"ORDER BY LastViewedDate DESC":"ORDER BY "+this.searchField,p=d+" FROM "+this.tableName+u+" WHERE "+c+" "+h+" LIMIT "+this.resultsLimit;if(this.hasFilter&&this.currentRecordFields&&0<Object.keys(this.currentRecordFields).length&&this.currentRecord){var f=0;for(var g in this.currentRecordFields){var y="function"==typeof this.currentRecord.getValue?this.currentRecord.getValue(g):this.currentRecord[g],v=this.currentRecordFields[g];this.omitField(y,v)||(0===f&&(p+=" BIND "),0<f++&&(p+=", "),p+=g+" = "+this.getBindValue(y,v))}}return p}},{key:"getScope",value:function(e){if(!this.applyMruOptimization)return"everything";var t=null==e?0:e.length;if(2<t)return"everything";var i=o.user.lang;return 0<t&&("zh_CN"===i||"zh_TW"===i||"ja"===i||"ko"===i||"th"===i)?"everything":"mru"}},{key:"omitField",value:function(e,t){return null==e&&(this.isNumericType(t)||this.isLookupType(t))}},{key:"getBindValue",value:function(e,t){return null==e?"''":!0===e||!1===e?e:this.isNumericType(t)?e:"'"+e+"'"}},{key:"isNumericType",value:function(e){switch(e){case"double":case"number":case"currency":case"percent":case"int":return!0}return!1}},{key:"isLookupType",value:function(e){switch(e){case"id":case"reference":return!0}return!1}},{key:"isDateType",value:function(e){switch(e){case"date":case"datetime":return!0}return!1}},{key:"getSelectClause",value:function(e){return"SELECT Id, "+(e&&this.fields&&this.fields.fieldNames?y._buildFields(this.fields):[this.searchField]).join(",")}},{key:"getWhereClause",value:function(e,t,i){var n=[this.searchField+" LIKE '"+e+"'"];if(!(i&&this.fields&&this.fields.additionalSearchFields&&this.fieldTypeByName))return n[0];var o=void 0,r=void 0,s=y._buildFields(this.fields,"additionalSearchFields"),a=!0,l=!1,u=void 0;try{for(var d,c=s[Symbol.iterator]();!(a=(d=c.next()).done);a=!0){var h=d.value,p=this.fieldTypeByName[h];if(null!=p&&null!=p.type&&(p=p.type),!this.isLookupType(p))if(this.isDateType(p)){if(null==t||""===t)continue;if(void 0===o&&(o=this.dateParser.parse(t)),null==o)continue;var f=o.toISOString().split("T")[0];"datetime"===p&&(f+="T00:00:00.000+0000"),n.push(h+" >= "+f)}else if(this.isNumericType(p)){if(null==t||""===t)continue;if(void 0===r&&(r=this.numberParser.parse(t,!0)),isNaN(r))continue;var g=r;"int"===p&&(g=parseInt(g)),n.push(h+" >= "+g)}else n.push(h+" LIKE '"+e+"'")}}catch(e){l=!0,u=e}finally{try{!a&&c.return&&c.return()}finally{if(l)throw u}}return n.join(" OR ")}}],[{key:"_buildFields",value:function(e,t){var i=[].concat(e[1<arguments.length&&void 0!==t?t:"fieldNames"]),n=[],o=!0,r=!1,s=void 0;try{for(var a,l=e.fieldsOfTypeLookup[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var u=a.value;-1!==i.indexOf(u.name)&&n.push(d.getRelationshipField(u.name,u.table))}}catch(e){r=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw s}}return 0<n.length&&(i=i.concat(n)),i}}]),i=y)),e("LookupQueryBuilder",i)}}}),System.register("common/forms/sb-rte/dialog/RichTextEditorDialog.js",["common/core/AppContext.js"],function(t,e){var i,o,r,s,a;return{setters:[function(e){i=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}r={inline:!(o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}),font_formats:"Arial=Arial,sans-serif;Courier=Courier,monospace;Dosis=Dosis,sans-serif;Droid Sans=Droid Sans,sans-serif;Droid Serif=Droid Serif,serif;Helvetica=Helvetica,sans-serif;Merriweather=Merriweather,sans-serif;Montserrat=Montserrat,sans-serif;Noto Sans JP=Noto Sans JP,sans-serif;Noto Sans KR=Noto Sans KR,sans-serif;Noto Sans SC=Noto Sans SC,sans-serif;Noto Sans TC=Noto Sans TC,sans-serif;Open Sans=Open Sans,sans-serif;Play=Play,sans-serif;PT Sans=PT Sans,sans-serif;PT Serif=PT Serif,serif;Roboto=Roboto,sans-serif;Roboto Light=Roboto:300,sans-serif;Times=Times,serif;Titillium Web=Titillium Web,sans-serif;Ubuntu=Ubuntu,sans-serif;",forced_root_block:"",menubar:!1,toolbar1:"cut copy paste | undo redo | styleselect formatselect fontselect fontsizeselect | link image table",toolbar2:"bold italic underline strikethrough subscript superscript removeformat | numlist bullist | outdent indent | blockquote | alignleft aligncenter alignright alignjustify | code",plugins:"link image code table"},s="//fonts.googleapis.com/css?family=Dosis|Droid+Sans|Droid+Serif|Merriweather|Montserrat|Open+Sans|Play|PT+Sans|PT+Serif|Roboto:300,400|Titillium+Web|Ubuntu",tinymce.baseURL="/common/staticresources/tinymce",tinymce.suffix=".min",t("RichTextEditorDialog",(o(e,[{key:"beforeRegister",value:function(){this.is="sb-rte-dialog",this.properties={value:{type:String,observer:"_valueChanged",notify:!0}}}},{key:"ready",value:function(){for(var e=document.querySelectorAll("head > link[rel=stylesheet]"),t=e?e.length:0,i=0;i<t;i++)if(e[i].getAttribute("href")==s)return;var n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("href",s),document.head.appendChild(n)}},{key:"_initialize",value:function(){r.inline=!0,r.target=Polymer.dom(this.root).querySelector("#rte"),this.tinymceInitCalled=!0,tinymce.init(r).then(function(e){this.editor=e[0];try{this.editor.setContent(this.value)}catch(e){}this.$.rte.focus(),this.editor.on("blur",function(e){this.internal||(this.internal=!0,this.$.rte.blur(),this.$.dialog.show&&this.$.rte.focus(),this.internal=!1)}.bind(this))}.bind(this)).catch(function(e){console.error(e)})}},{key:"onSave",value:function(){var e=i.properties.i18n.value().l("Click to edit description"),t=this.editor.getContent({format:"raw"});this.value=t!==e?t:null,this.rte.value=this.value,this.rte.fire("rte-value-changed",{value:this.value}),this.rte.fire("rte-saved"),this.close()}},{key:"onCancel",value:function(){this.rte.fire("rte-esc",{keyCode:27}),this.close()}},{key:"open",value:function(){var e=i.properties.i18n.value().l("Click to edit description");this.$.dialog.open(),this.value!==e&&null!=this.value||(this.value=null),this.$.rte.focus(),Polymer.dom(this.root).querySelector(".title").innerHTML=i.properties.i18n.value().l("Edit "+this.rte.label),this.tinymceInitCalled||this._initialize(),this.addEventListener("sb-rte-cancel",this.onCancel)}},{key:"close",value:function(){var e=i.properties.i18n.value().l("Click to edit description");this.rte.fire("rte-blur"),this.$.dialog.close(),this.value===e&&(this.value=null),tinymce.remove(),this.tinymceInitCalled=!1,this.removeEventListener("sb-rte-cancel",this.onCancel)}},{key:"_valueChanged",value:function(){Polymer.dom(this.$.rte).innerHTML=this.value}}],[{key:"setBaseUrl",value:function(e){e&&(tinymce.baseURL=e)}}]),a=e)),t("RichTextEditorDialog",a),Polymer(a)}}}),System.register("common/forms/sb-rte/factory/RichTextEditorFactory.js",["common/forms/sb-field/factory/FormField.js","common/core/sb-page-container/PageContainer.js","common/forms/sb-field/factory/SimpleFieldFactory.js"],function(e,t){var o,r,s;return{setters:[function(e){o=e.FormField},function(e){r=e.PageContainer},function(e){s=e.simpleFieldFactory}],execute:function(){e("richTextEditorFactory",function(e,t,i,n){return t&&!(4<arguments.length&&void 0!==arguments[4]?arguments[4]:r).isMobile()?function(e,t,i){null===e&&(e="");var n=new o("sb-rte");return n.addAttribute("value",2,"value",e),n.addAttribute("render-read-only",1,"renderReadOnly",t),n.addAttribute("label",1,"label",i.label),n.readOnlyKeyEvent="rte-esc",n.readOnlyBlurEvent="rte-blur",n.changeEvent="rte-value-changed",n}(e,i,n):s(e)})}}}),System.register("common/forms/sb-select/factory/SelectFactory.js",["common/forms/sb-field/factory/SimpleFieldFactory.js","common/forms/sb-field/factory/FormField.js","common/forms/sb-select/Select.js"],function(e,t){var u,d,c;function h(e,t,i){if(!t)return e;var n=c.getValues(e,i);if(0===n.length)return e;var o=null,r=!0,s=!1,a=void 0;try{for(var l,u=t[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var d=l.value;-1!==n.indexOf(d.value)&&(i&&null!=o?o+=";"+d.label:o=d.label)}}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}return o||e}return{setters:[function(e){u=e.simpleFieldFactory},function(e){d=e.FormField},function(e){c=e.Select}],execute:function(){e("selectFactory",function(e,t,i,n,o,r,s,a){var l="multipicklist"===n;return t?function(e,t,i,n,o,r,s){var a=new d("sb-select");return!i.defaultValue||e||i.controllerName||i.restrictedPicklist||(e=i.defaultValue,a.defaultValue=e),a.addAttribute("id",0,"picklist"),a.addAttribute("value",2,"value",e),a.addAttribute("md",1,"md",i),a.addAttribute("disabled",1,"disabled",t),a.addAttribute("options",1,"options",r),a.addAttribute("is-required",1,"isRequired",!!i.required),a.addAttribute("multi-select",1,"multiSelect",s),o&&a.addAttribute("none-label",1,"noneLabel","--"+n.l("None")+"--"),null!=i.precision&&a.addAttribute("size",1,"size",i.precision),a.formattedValue={value:e,label:h(e,r,s)},a}(e,i,o,r,s,a,l):u(h(e,a,l))})}}}),System.register("common/forms/sb-textarea/factory/TextareaFactory.js",["common/forms/sb-field/factory/SimpleFieldFactory.js","common/forms/sb-field/factory/FormField.js"],function(e,t){var o,r;return{setters:[function(e){o=e.simpleFieldFactory},function(e){r=e.FormField}],execute:function(){e("textareaFactory",function(e,t,i,n){return t?function(e,t,i){null===e&&(e="");var n=new r("sb-textarea");return n.addAttribute("value",2,"value",e),n.addAttribute("disabled",1,"disabled",t),n.addAttribute("render-read-only",1,"renderReadOnly",i),n.readOnlyKeyEvent="sb-textarea-key",n}(e,i,n):o(e)})}}}),System.register("contracts/selection/routes/sb-contract-lookup/ContractLookup.js",["common/core/Page.js","common/data/format/DataBuilder.js","common/layout/tables/TableClassBuilder.js","common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o,l,r,s,a;return{setters:[function(e){i=e.Page},function(e){o=e.DataBuilder},function(e){l=e.TableClassBuilder},function(e){r=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}s=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("ContractLookup",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),s(e,[{key:"beforeRegister",value:function(){this.is="sb-contract-lookup",this.properties=Polymer.Base.extend({prefix:{type:String,computed:"getPrefix(app.org)"},contracts:Array,lineEditorModel:Object,selectedContract:Object,action:String,accountId:String,selectedAssetIds:String,validationMessages:{type:Array,value:[]}},i.properties)}},{key:"ready",value:function(){this.$.header.selectable=!1,this.prefetchObjects(),this.handleMetaDataResponse(),this.setPropertyFromUrl(),this.setSkipActionClass(),this.handleLineEditorModelResponse(),this.handleContractModelLoadResponse(),this.handleContractSelected(),this.handleContractModelSaveResponse(),this.action&&this.handleContractModelLoadRequest({uid:this.accountId,action:this.action})}},{key:"getPrefix",value:function(){return this.app.org.prefix?this.app.org.prefix+"__":""}},{key:"prefetchObjects",value:function(){this.contractLookupObjects=["Contract"]}},{key:"handleMetaDataResponse",value:function(){this.$.md.addEventListener("md-changed",function(e){var i=[],n=[],o={},r={},s={},a={};e.detail.value.fields.forEach(function(e){var t=e.name;i.push(t),n.push(e.label),o[t]=e.label,r[t]={type:e.type},s[e.label.replace(/\W/g,"")]=e.type,a[t]=e.type}.bind(this)),this.headerClassMap=new l(Object.keys(s),"Th",s).build(),this.rowClassMap=new l(i,"Td",a).build(),this.typeMap=r,this.recordKeys=i,this.fieldLabels=n,this.fieldLabelMap=o}.bind(this))}},{key:"setPropertyFromUrl",value:function(){this.action=this.ctx.params.action,this.accountId=this.ctx.params.accId,this.selectedAssetIds=this.ctx.params.selectedAssetIds}},{key:"setSkipActionClass",value:function(){var e=Polymer.dom(this.$.skip).node,t=void 0;this.action?"Amend"===this.action&&(t="skipActionAmend"):t="skipActionAddOn",this.toggleClass(t,!0,e)}},{key:"handleLineEditorModelResponse",value:function(){this.$.qo.addEventListener("line-editor-model-changed",function(e){this.lineEditorModel=e.detail.value,this.handleContractModelLoadRequest({uid:this.lineEditorModel.quote.record.Id})}.bind(this))}},{key:"handleContractModelLoadRequest",value:function(e){this.$.contractModelLoadService.uid=null,this.$.contractModelLoadService.context=e}},{key:"handleContractModelLoadResponse",value:function(){this.$.contractModelLoadService.addEventListener("response-changed",function(e){this.contracts=e.detail.value,0!=this.contracts.length&&this.setFieldSet()}.bind(this))}},{key:"setFieldSet",value:function(){var e=[],t=!0,i=!1,n=void 0;try{for(var o,r=this.contracts[0].activeContractFieldSets[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;e.push(this.contractLookupObjects[0]+"."+s)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}this.$.md.fields=e}},{key:"handleContractSelected",value:function(){this.addEventListener("selection-changed",function(e){if(e.detail.selected){for(var t=0;t<this.contracts.length;t++)if(e.detail.Id===this.contracts[t].record.Id){this.selectedContract=this.contracts[t];break}this.ifRadioSelectedClearOtherRadioSelections(e)}}.bind(this))}},{key:"ifRadioSelectedClearOtherRadioSelections",value:function(e){if(!1!==e.detail.selected&&void 0!==e.detail.selected){var t=Polymer.dom(e).rootTarget,i=Polymer.dom(t.parentElement).querySelectorAll("sb-table-row"),n=!0,o=!1,r=void 0;try{for(var s,a=i[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;l!==t&&(l.selected=!1)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}}},{key:"handleContractModelSaveResponse",value:function(){this.$.contractModelSaveService.addEventListener("response-changed",function(e){e.detail.value&&(this.quoteId=e.detail.value.quote.record.Id,this.lineEditorModel=e.detail.value,this.$.qo.addToCache(this.quoteId,this.lineEditorModel)),this.navigateToLineEditor()}.bind(this))}},{key:"navigateToLineEditor",value:function(){var e=this.lineEditorModel?this.lineEditorModel.quote.record.Id:this.quoteId;this.nav("#",{qId:e},["quote","le"],!1)}},{key:"onSkip",value:function(){this.action?this.$.contractModelSaveService.model={quote:null,selectedContractId:null,action:this.action,accountId:this.accountId,selectedAssetIds:this.selectedAssetIds}:this.navigateToLineEditor()}},{key:"onSelect",value:function(){if(this.validationMessages=[],this.selectedContract){var e=void 0;e=this.action?{quote:null,selectedContractId:this.selectedContract.record.Id,action:this.action,accountId:this.accountId,selectedAssetIds:this.selectedAssetIds}:(new o).addObject("quote",this.lineEditorModel.quote.record).add("selectedContractId",this.selectedContract.record.Id).build(),this.$.contractModelSaveService.model=e}else this.validationMessages=[this.i18n.l("You must make a selection. Or use Skip if you do not want to co-terminate")]}},{key:"onCancel",value:function(){this.showSpinner=!0,this.navigateToDetailPage()}},{key:"navigateToDetailPage",value:function(){var e=void 0;if(e=this.action?this.accountId:this.lineEditorModel.quote.record.Id,this.isLightningExperience())!0===r.getViewport().isMobile()?this.navigateToURL("#/sObject/"+this.prefix+"Quote__c/home"):sforce.one.navigateToSObject(e);else{var t="/"+e;window.parent?window.parent.location.href=t:window.location.href=t}}},{key:"isLightningExperience",value:function(){return"undefined"!=typeof sforce&&sforce&&!!sforce.one}},{key:"navigateToURL",value:function(e){sforce.one.navigateToURL(e)}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior]}}]),a=e)),t("ContractLookup",a),Polymer(a)}}}),System.register("products/config/actions/sb-custom-actions/CustomActions.js",["common/Util.js","common/core/AppContext.js","common/core/sb-page-container/PageContainer.js","common/core/sb-page-header/PageHeader.js","products/config/message/ProductMessenger.js"],function(t,e){var u,i,o,r,d,s;return{setters:[function(e){u=e.Util},function(e){e.AppContext},function(e){i=e.PageContainer},function(e){o=e.PageHeader},function(e){r=e.ProductMessenger}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}d={"Product Code":"ProductCode"},t("CustomActions",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-custom-actions",this.properties={customActions:Array,products:Array,isClassic:Boolean,productIndex:Number,firstItem:Object,remainingItems:Array,prefix:String,customActionsExist:Boolean,moreThanOneCustomActionsExist:{type:Boolean,value:!1},menuClosed:{type:Boolean,value:!0},viewport:{type:Object,observer:"_viewportChanged",value:function(){return i.getViewport()}},buttonsCollapsed:{type:Boolean,notify:!0},messenger:{type:Object,computed:"_newMessenger(quote, products, productIndex, prefix)"},quote:{type:Object,notify:!0},popupResponse:{type:Object,notify:!0,observer:"_updateQuoteFromPopupResponse"},launchExternalName:{type:String,value:"Launch External"}}}},{key:"init",value:function(){var i=this;if(this.isClassic&&1<this.products.length)return this.classList.add("hide"),void(this.customActionsExist=!1);var n=this.products[this.productIndex].record[this.prefix+"ExternallyConfigurable__c"],o=this.prefix+"URL__c",r=this.prefix+"Label__c",s=this.prefix+"Page__c",a=this.prefix+"URLTarget__c",l=this.prefix+"BrandButton__c",u=[];if(this.customActions.forEach(function(e){if(void 0!==e[o]&&"Product Configurator"===e[s]&&i.checkCustomActionsConditionsMet(e,n)){var t="";!0===e[l]&&(t="primary"),u.push({label:e[r],url:e[o],target:e[a],brandButtonClass:t})}}),0==u.length)return this.classList.add("hide"),void(this.customActionsExist=!1);this.firstItem=u[0],1<u.length&&(this.remainingItems=u.slice(1),this.moreThanOneCustomActionsExist=!0),this.customActionsExist=!0,this.buttonsCollapsed=!(this.viewport&&!this.viewport.isMobile()&&this.viewport.M.up),this.classList.remove("hide")}},{key:"_itemSelected",value:function(e){var t=e.target.id,i="firstItem"===t?this.firstItem:this.remainingItems[t];"Popup"===i.target?this.handlePopup(i.url):this.handleNav(i.url)}},{key:"handlePopup",value:function(e,t,i){var n=1<arguments.length&&void 0!==t&&t,o=2<arguments.length&&void 0!==i&&i;this.$.popup.url=e,this.$.popup.autoLaunched=n,this.$.popup.backOnCancelOrClose=o,this.$.popup.messenger=this.messenger,this.$.popup.open()}},{key:"handleNav",value:function(e){this._isLightningExperience()?sforce.one.navigateToURL(e):window.location.href=e}},{key:"_isLightningExperience",value:function(){return"undefined"!=typeof sforce&&sforce&&!!sforce.one}},{key:"checkCustomActionsConditionsMet",value:function(e,t){var o=this,i=this.prefix+"Custom_Action_Conditions__r",r=this.prefix+"Field__c",s=this.prefix+"Operator__c",a=this.prefix+"FilterValue__c",l=this.prefix+"TargetObject__c";return!(e.Name===this.launchExternalName&&!t)&&(void 0===e[i]||e[i].records.some(function(e){if(void 0===e[r]||void 0===e[a]||void 0===e[s])return!1;var t="Product";e[l]&&(t=e[l]);var i=d[e[r]]||e[r],n="Quote"===t?o.quote.record:o.products[o.productIndex].record;return u.arithmeticOperatorConversion(n[i],e[a],e[s])}))}},{key:"_changeMenu",value:function(e){this.menuClosed=o.changeMenu(e,this.menuClosed,this.$$("#remainingItems"),"open",this)}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport}},{key:"_viewportChanged",value:function(){this.buttonsCollapsed=!(this.viewport&&!this.viewport.isMobile()&&this.viewport.M.up)}},{key:"_newMessenger",value:function(){return new r(this.quote,this.products[this.productIndex],this.prefix,this.currencyIsoCode,Polymer.Base)}},{key:"_updateQuoteFromPopupResponse",value:function(){this.quote=this.popupResponse.quote}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["init(customActions, products, prefix, productIndex, isClassic, menuClosed)"]}}]),s=e)),t("CustomActions",s),Polymer(s)}}}),System.register("products/config/attribute/sb-attribute-item/AttributeItem.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("AttributeItem",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-attribute-item",this.properties={value:{notify:!0,observer:"_notifyAttributeChanged"},item:String,model:Object,md:Object,data:{type:Object,notify:!0},label:{type:String,reflectToAttribute:!0}}}},{key:"setRequired",value:function(){!1!==this.attributeMD.required&&!0!==this.attributeMD.autoSelect&&this.toggleClass("mandatory-no-value",!1===this.isValidValue(),this.$.attributeField)}},{key:"isValidValue",value:function(){return!(void 0===this.value||null===this.value||""===this.value)}},{key:"setAttributeMD",value:function(){if(this.model.fields){this.attributeMD=this.model.attributeMD[this.item],this.$.field.disabled=this.attributeMD.autoSelect,this.hidden=this.attributeMD.hidden;var e=JSON.parse(JSON.stringify(this.model.fields[this.targetField]));"picklist"===e.type&&(e.picklistValues=this.getPicklistValues(e.picklistValues),e.required=this.attributeMD.required),this.md=e}}},{key:"setTargetField",value:function(){(this.$.field.record=this).targetField=this.model.attributeMD[this.item].targetFieldName}},{key:"setLabel",value:function(){this.label=this.md.label}},{key:"getPicklistValues",value:function(e){if(void 0===this.attributeMD)return e;if(!this.attributeMD.shownValues&&!this.attributeMD.hiddenValues)return e;var t=this.attributeMD.shownValues||[];if(!this.attributeMD.shownValues){var i=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t.push(a.value)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}}var l=this.attributeMD.hiddenValues||[];return e.filter(function(e){return-1!==t.indexOf(e.value)&&-1===l.indexOf(e.value)})}},{key:"_notifyAttributeChanged",value:function(e){this.model&&this.fire("sb-config-attribute-changed",{Id:this.item,bundleId:this.model.attributeMD[this.item].bundleId,changed:!0,path:!0})}},{key:"getValue",value:function(e){var t=this.model.attributeFieldMD[e];if(t&&0<t.length)return this.data[t[0]]}},{key:"setValue",value:function(e,t){this.set("data."+e,t)}},{key:"equals",value:function(e){return this.data===e.data}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["setAttributeMD(item, model, targetField)","setTargetField(item, model)","setRequired(value, model, attributeMD)","setLabel(md)"]}}]),i=e)),t("AttributeItem",i),Polymer(i)}}}),System.register("products/config/attribute/sb-attribute-table/AttributeTable.js",["common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o;return{setters:[function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("AttributeTable",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-attribute-table",this.properties={featureId:String,position:String,model:Object,configAttributes:Object,addedClass:String,md:Object,showTable:{type:Boolean,value:!1},viewport:{type:Object,value:function(){return i.getViewport()}},spinner:{type:Boolean,notify:!0}}}},{key:"ready",value:function(){this.$.optionFieldMetadata.addEventListener("md-changed",function(e){this.setMD(e),this.spinner=!1}.bind(this)),this.addEventListener("lookup-value-changed",this._setReferencedData.bind(this))}},{key:"getMD",value:function(){this.spinner=!0;var e={},t=this.model.configurationAttributeModelMap;for(var i in t)e[t[i].targetFieldName]=null;this.$.optionFieldMetadata.fields=Object.keys(e)}},{key:"setMD",value:function(e){this.md={fields:e.detail.value.fieldsByObject[this.model.prefix+"ProductOption__c"],attributeMD:this.model.configurationAttributeModelMap,attributeFieldMD:this.model.configurationAttributeTargetFieldMap}}},{key:"generateColumns",value:function(){for(var e=[],t=[],i=[],n=this.model.configAttributesByFeatureId[this.featureId]||[],o=n.length,r={},s=0;s<o;s++){var a=n[s].myId;this.md.attributeMD[a].processed=!0;var l=n[s].targetFieldName,u=r[l]||[];u.push(a),r[l]=u,n[s].position!=this.position&&this.position||(1==n[s].columnOrder?e.push(a):2==n[s].columnOrder?t.push(a):i.push(a))}this.normalizeData(r),this.setColumns(e,t,i)}},{key:"normalizeData",value:function(e){for(var t in e){var i=e[t],n=this.md.attributeFieldMD[t];if(n.length<=i.length)return;var o=!0,r=!1,s=void 0;try{for(var a,l=n[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var u=a.value;if(-1===i.indexOf(u)&&this.md.attributeMD[u].processed){var d=!0,c=!1,h=void 0;try{for(var p,f=i[Symbol.iterator]();!(d=(p=f.next()).done);d=!0){var g=p.value;this.configAttributes[g]=this.configAttributes[u]}}catch(e){c=!0,h=e}finally{try{!d&&f.return&&f.return()}finally{if(c)throw h}}break}}}catch(e){r=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw s}}}}},{key:"setColumns",value:function(e,t,i){0<e.length&&(this.showTable=!0,this.$.firstColumn.overridePropagateFromParentToChild(this.captureCallBack),this.$.firstColumn.setFromChildToParentExtension(this.captureCallBack),this.$.firstColumn.model=this.md,this.$.firstColumn.group||(this.$.firstColumn.group=e)),0<t.length&&(this.showTable=!0,this.$.secondColumn.overridePropagateFromParentToChild(this.captureCallBack),this.$.secondColumn.setFromChildToParentExtension(this.captureCallBack),this.$.secondColumn.model=this.md,this.$.secondColumn.group||(this.$.secondColumn.group=t)),0<i.length&&(this.showTable=!0,this.$.thirdColumn.overridePropagateFromParentToChild(this.captureCallBack),this.$.thirdColumn.setFromChildToParentExtension(this.captureCallBack),this.$.thirdColumn.model=this.md,this.$.thirdColumn.group||(this.$.thirdColumn.group=i))}},{key:"captureCallBack",value:function(e){var t=this.elements,i=e.path.split(".")[1];if(void 0!==i)for(var n=this.model.attributeMD[i].targetFieldName,o=0,r=t.length;o<r;o++)t[o].item.split(".")[0]!==i&&this.model.attributeMD[t[o].item].targetFieldName===n&&(t[o].value=e.value)}},{key:"bindDataToModel",value:function(e){if(void 0!==e.path&&"configAttributes"!==e.path){var t=this._getTargetFieldNameFromModel(e.path.split(".")[1]);this.model.product.configuration.configurationData[t]=e.value}}},{key:"_setReferencedData",value:function(e){if(e&&e.detail&&e.detail.obj&&e.detail.item){var t=this._getTargetFieldNameFromModel(e.detail.item),i=this.md.fields[t].relationshipName;if(null!==i){var n=null===e.detail.value?null:{attributes:e.detail.obj.attributes,Id:e.detail.obj.Id,Name:e.detail.obj.Name};this.model.product.configuration.configurationData[i]=n}}}},{key:"_getTargetFieldNameFromModel",value:function(e){return this.model.configurationAttributeModelMap[e].targetFieldName}},{key:"isMobile",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["generateColumns(featureId, model, configAttributes, md)","getMD(configAttributes, model)","bindDataToModel(configAttributes.*)"]}}]),o=e)),t("AttributeTable",o),Polymer(o)}}}),System.register("products/config/bundles/sb-product-bundles-filter-item/ProductBundlesFilterItem.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ProductBundlesFilterItem",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-product-bundles-filter-item",this.properties={value:{notify:!0},item:String,model:Object,label:String}}},{key:"setFieldData",value:function(){for(var e=void 0,t=0,i=this.model.length;t<i;t++)if(this.model[t].name===this.item){this.label=this.model[t].label,e="picklist"===this.model[t].type||"multipicklist"===this.model[t].type?this.model[t]:{type:"string"};break}this.$.field.editing=!0,this.$.field.property=this.item,this.$.field.md=e}},{key:"clear",value:function(){this.value=null}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["setFieldData(model)"]}}]),i=e)),t("ProductBundlesFilterItem",i),Polymer(i)}}}),System.register("products/config/bundles/sb-product-bundles-layout/ProductBundlesLayout.js",["../../search/ConfiguratorSearch.js","../../../../common/core/sb-page-container/PageContainer.js"],function(t,e){var a,i,o;return{setters:[function(e){a=e.ConfiguratorSearch},function(e){i=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ProductBundlesLayout",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-product-bundles-layout",this.properties={productIndex:{type:Number,notify:!0},selectedTabIndex:{type:Number,value:0},configuredProducts:Array,setToSections:{type:Boolean,value:!0},isClassic:Boolean,noHeader:{type:Boolean,value:!1},hasSelected:{type:Boolean,value:!1},hasMultipleBundles:{type:Boolean,value:!1,observer:"formatBundlesLayout"},drawerState:String,qId:String,searchFilters:Array,searchValuesByFilter:Object,searchFieldMD:Object,searchFilterTypeMap:Object,configSearch:Object,viewport:{type:Object,value:function(){return i.getViewport()}},isMobile:{type:Boolean,value:!1,computed:"_setIsMobile(viewport)"}}}},{key:"_resize",value:function(){this.resize()}},{key:"initSearchFilter",value:function(){this.$.group.group=this.searchFilters,this.$.group.model=this.searchFieldMD,this.$.group.data=this.searchValuesByFilter;var e={},t=!0,i=!1,n=void 0;try{for(var o,r=this.searchFieldMD[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;e[s.name]=s.type}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}this.searchFilterTypeMap=e,this.configSearch=new a(this.searchValuesByFilter,this.prefix,this.searchFilterTypeMap)}},{key:"ready",value:function(){this.handleResize(),this.handlePanelSlide(),this.handlePanelEvents(),this.handleMD()}},{key:"handlePanelEvents",value:function(){this.addEventListener("side-toggle-clicked",function(){this.toggle()}.bind(this)),this.addEventListener("iron-select",function(){"drawer"==this.$.drawer.selected?this.drawerState="open":this.drawerState="closed"}.bind(this)),this.addEventListener("x-clicked",function(){this.$.search.closeDrawer()}.bind(this)),this.addEventListener("enter-keypress",function(){this.searchFilters&&this.applyFilters()}.bind(this))}},{key:"handleMD",value:function(){this.$.md.addEventListener("md-changed",function(e){this.searchFieldMD=e.detail.value.fields}.bind(this))}},{key:"navTo",value:function(e){for(var t=Polymer.dom(e).rootTarget.id.split("_")[1],i=this.configuredProducts.length,n=this.productIndex,o=0;o<i;o++)this.getProductId(o)===t&&(n=o);this.setSelected(t),!this.isMobile&&this.isClassic?this.$$("#Bundle"+t).scrollIntoView():this.fire("bundle-panel-clicked",n)}},{key:"toggle",value:function(){this.toggleTransition(!0),this.$.drawer.togglePanel()}},{key:"classicOrSelectedIndex",value:function(e,t){return this.isClassic&&!this.isMobile||this.configuredProducts[this.productIndex]===e||!this.productIndex&&0===t||this.productIndex>=this.configuredProducts.length&&0===t}},{key:"handleResize",value:function(){var e=document.querySelector("#sidebarCell");e&&e.addEventListener("click",this.resize.bind(this)),window.addEventListener("resize",this.resize.bind(this))}},{key:"resize",value:function(){this.toggleTransition(!1),"drawer"===this.$.drawer.selected?this._setBundleContainerWidth(!1):this._setBundleContainerWidth(!0)}},{key:"handlePanelSlide",value:function(){this.isMobile||this.addEventListener("iron-select",function(){"drawer"===this.$.drawer.selected?this._setBundleContainerWidth(!1):this._setBundleContainerWidth(!0)}.bind(this)),this.isMobile&&this.addEventListener("iron-deselect",function(e){"drawer"===e.detail.item.id&&document.activeElement.blur()}.bind(this))}},{key:"selectBundle",value:function(){if(this.$.search.$$("#scrim").style.width="100%",this.isMobile&&(this.navWidth=0,this.$.drawer.$$("#scrim").style.width="100%"),1===this.configuredProducts.length&&(this.navWidth=0),this.buildPanelIfMultipleBundesAndNotMobile(),!this.isClassic||this.isMobile){var e=this.getProductId(this.productIndex);this.fire("bundle-name-changed",{name:this.configuredProducts[this.productIndex].record.Name}),Polymer.dom(this.$.panel).observeNodes(function(){this.setSelected(e)}.bind(this))}this.resize()}},{key:"buildPanelIfMultipleBundesAndNotMobile",value:function(){1===this.configuredProducts.length||this.isMobile||(this.panelWidth=256,this.navWidth=24,this.$.panel.rightSideButton=!0,this.toggleTransition(!1),"1"===this.isOpen?(this.$.drawer.selected="drawer",this.drawerState="open",this._setBundleContainerWidth(!1)):(this.$.drawer.selected="main",this.drawerState="closed",this._setBundleContainerWidth(!0)))}},{key:"_setBundleContainerWidth",value:function(e){this.configuredProducts&&this.configuredProducts.length<2||(this.toggleClass("open",!e,this.$.bundleContainer),this.toggleClass("close",e,this.$.bundleContainer))}},{key:"toggleTransition",value:function(e){this.$.drawer._transition=e,this.toggleClass("transition",e,this.$.bundleContainer)}},{key:"defaultState",value:function(){return"1"===this.isOpen?"drawer":"main"}},{key:"toggleSearch",value:function(){this.$.search.togglePanel()}},{key:"refocus",value:function(){this.$.search.querySelector("#searchPanel").querySelector("sb-group").$$("sb-product-bundles-filter-item").$$("sb-field").$$("div#f").firstChild.focus()}},{key:"reverseFocus",value:function(){this.$.clear.focus()}},{key:"setMD",value:function(){this.$.md.object="ProductOption__c",this.$.md.fields=this.searchFilters}},{key:"applyFilters",value:function(){this.$.clear.focus(),this.$.search.closeDrawer(),this.configSearch=new a(this.searchValuesByFilter,this.prefix,this.searchFilterTypeMap)}},{key:"clearFields",value:function(){this.fire("iron-signal",{name:"sb-clear-product-filter"}),this.blur(),this.configSearch=new a(this.searchValuesByFilter,this.prefix,this.searchFilterTypeMap)}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport}},{key:"getProductId",value:function(e,t){var i=this.configuredProducts[e];return(t?"_":"")+(i.productKey||i.record.Id)}},{key:"setSelected",value:function(e){this.removeAllSelected(),this.toggleClass("selected-tab",!0,this.$$("#_"+e))}},{key:"removeAllSelected",value:function(){var e=Polymer.dom(this.root).querySelectorAll("div.nav-item"),t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this.toggleClass("selected-tab",!1,s)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}},{key:"_setIsMobile",value:function(e){if(e)return e.isMobile()}},{key:"_updateProductFromPopupResponse",value:function(){var e=this.popupResponse.products;if(e&&0!==e.length){var t=this.configuredProducts.length,i=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;this.push("configuredProducts",a)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}1===t&&this.buildPanelIfMultipleBundesAndNotMobile()}}},{key:"formatBundlesLayout",value:function(){this.toggleClass("multiple-bundles",this.hasMultipleBundles,this.$.bundleContainer)}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["setMD(searchFilters)","initSearchFilter(searchFieldMD, prefix)","_updateProductFromPopupResponse(popupResponse, configuredProducts)","_resize(configuredProducts.*)","selectBundle(isMobile, configuredProducts, isClassic, hasMultipleBundles, productIndex)"]}}]),o=e)),t("ProductBundlesLayout",o),Polymer(o)}}}),System.register("products/config/feature/sb-product-feature/ProductFeature.js",["../../../../common/layout/fields/FieldSetHandler.js","../../../../common/core/sb-page-container/PageContainer.js","common/core/AppContext.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.FieldSetHandler},function(e){o=e.PageContainer},function(e){r=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ProductFeature",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-product-feature",this.listeners={"selection-changed":"handleSelectionCounter"},this.properties={featureId:String,model:Object,maxOptions:Object,feature:Object,fieldSetKey:String,fieldSetHandler:Object,tabNames:{type:Array,readOnly:!0,value:["options","attributes"]},tabs:{type:Array,value:[]},viewport:{type:Object,value:function(){return o.getViewport()}},configSearch:Object,isMobile:{type:Boolean,value:!1,computed:"_setIsMobile(viewport)"},hasConfigAttributes:{type:Boolean,value:!1,computed:"_setHasConfigAttributes(model, featureId)"},hasTopConfigAttributes:{type:Boolean,computed:"_setHasTopConfigAttributes(model, featureId)"},hasBottomConfigAttributes:{type:Boolean,computed:"_setHasBottomConfigAttributes(model, featureId)"},mobileHasConfigAttributes:{type:Boolean,value:!1},hasOptions:{type:Boolean,computed:"_setHasOptions(model, featureId)"},mobileHasOptions:Boolean,hasOptionsAndConfigAttributes:{type:Boolean,value:!1,computed:"_setHasOptionsAndConfigAttributes(hasConfigAttributes, hasOptions)"},mobileHasOptionsAndConfigAttributes:Boolean,hasInstructions:{type:Boolean,computed:"_setHasInstructions(feature)"},mobileHasInstructions:Boolean,expanded:{type:Boolean,value:!1},selectedOptions:{type:Number,value:0},hasSelectedOptions:{type:Boolean,value:!1,computed:"_hasSelectedOptions(selectedOptions)"},featureIndex:Number,configAttributes:{type:Object,notify:!0},hasUpgradeOptions:{type:Boolean,computed:"_setHasUpgradedOptions(feature)"},mobileRendering:{type:Boolean,value:!1},mobileExpanded:{type:Boolean,value:!1},spinner:{type:Boolean,notify:!0}}}},{key:"_setHasUpgradedOptions",value:function(){return this.model.getHasUpgradeOptions(this.feature)}},{key:"_hasSelectedOptions",value:function(e){return!e}},{key:"render",value:function(){this.model.featureIdsWithOptionsOrConfigAttr[this.featureId]&&(this.setFeatureAndOptionSelectionMethod(),this.setOptionsDetails(),this.setFieldSetHandler(),this.renderFeatureInDesktopOrMobileView(),this.initSelectedOptions(),this.handleDeleteOptions(),this.handleOptionChangedByRule())}},{key:"buildTabs",value:function(){if(this.isMobile){var e=r.properties.i18n.value(),t={name:"t1",label:e.l("Options"),pageComponent:"sb-product-option-table",attributes:[{name:"id",value:"ot"}],bind:["model","featureId","fieldSet","fieldSetName","routeSource","isClickSelection","disabledStateMap","configSearch","hasUpgradeOptions"]},i={name:"t2",label:e.l("Attributes"),pageComponent:"sb-attribute-table",attributes:[{name:"id",value:"configAttributesTop"},{name:"added-class",value:"header-attributes"}],bind:["featureId","model","configAttributes"]};this.tabs=[t,i]}}},{key:"setFieldSetHandler",value:function(){this.fieldSetHandler=new i(this.model.product.optionFieldSets,"OptionConfiguration","OptionConfigurationTablet","OptionConfigurationPhone")}},{key:"setFeatureAndOptionSelectionMethod",value:function(){this.feature=this.model.getFeature(this.featureId)}},{key:"setOptionsDetails",value:function(){this.isClickSelection="Click"===this.feature.optionSelectionMethod,this.routeSource="Configurator"}},{key:"featureChanged",value:function(){var e=this.feature.record[this.model.prefix+"ConfigurationFieldSet__c"];this.fieldSetKey=void 0===e?null:e}},{key:"setFieldSetFromViewport",value:function(){var e=this.fieldSetHandler.getByViewport(this.viewport);this.fieldSet=e.fields,this.fieldSetName=e.name}},{key:"initFieldSet",value:function(){this.fieldSetKey?(this.fieldSet=this.model.product.optionFieldSets[this.fieldSetKey],this.fieldSetName=this.fieldSetKey):this.setFieldSetFromViewport()}},{key:"_setIsMobile",value:function(e){if(e)return e.isMobile()}},{key:"_setHasConfigAttributes",value:function(e,t){var i=this.model.configAttributesByFeatureId[t];if(!i)return!1;for(var n=0;n<i.length;n++)if(!i[n].hidden)return!0;return!1}},{key:"_setHasTopConfigAttributes",value:function(e,t){return this._hasTopOrBottomConfigAttributes("Top",t)}},{key:"_setHasBottomConfigAttributes",value:function(e,t){return this._hasTopOrBottomConfigAttributes("Bottom",t)}},{key:"_hasTopOrBottomConfigAttributes",value:function(e,t){if(!this.model.configAttributesByFeatureId[t])return!1;var i=!0,n=!1,o=void 0;try{for(var r,s=this.model.configAttributesByFeatureId[t][Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;if(a.position===e&&!a.hidden)return!0}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return!1}},{key:"_setHasOptions",value:function(){return!!this.model.optionsByFeatureId[this.featureId]||this.model.featureIdsWIthSelectionMethodDynamic[this.featureId]}},{key:"_setHasOptionsAndConfigAttributes",value:function(e,t){return e&&t}},{key:"_setHasInstructions",value:function(){return!!this.feature.instructionsText||!!this.feature.additionalInstructions}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport,this.fieldSetKey||this.setFieldSetFromViewport()}},{key:"renderFeatureInDesktopOrMobileView",value:function(){this.toggleClass("group",!this.isMobile,this.$.feature)}},{key:"applyFilters",value:function(){var e=this.model.getOptionsByFeatureId(this.featureId),t=new ConfiguratorSearch(this.searchFilters,e,{});this.filtered=!t.hasOptions||!t.containsFeature(this.feature)}},{key:"mobileExpand",value:function(e){var t=this;this.mobileExpanded?this.expand(e):this.mobileRendering||(this.mobileRendering=!0,this.toggleClass("first",!1,this.$$("header")),Polymer.RenderStatus.afterNextRender(this,function(){t.mobileHasInstructions=t.hasInstructions,t.mobileHasOptionsAndConfigAttributes=t.hasOptionsAndConfigAttributes,t.mobileHasConfigAttributes=t.hasConfigAttributes,t.mobileHasOptions=t.hasOptions,Polymer.dom(t.$.feature).observeNodes(function(){this.mobileExpanded=!0,this.mobileRendering=!1,this.toggleClass("first",!0,this.$$("header")),this.expand(e)}.bind(t))}))}},{key:"expand",value:function(e){this.expanded=!this.expanded,this.fire("feature-expanded",{expanded:this.expanded,path:Polymer.dom(e).path})}},{key:"initSelectedOptions",value:function(){for(var e=""!==r.org.prefix?r.org.prefix+"__":"",t=this.model.getOptionsByFeatureId(this.featureId),i=0,n=t.length;i<n;i++)if(t[i].selected&&this.selectedOptions++,void 0===t[i].record[e+"UnitPrice__c"])return console.warn("Option is missing entry in selected pricebook => "+t[i].record[e+"ProductCode__c"]+": "+t[i].record[e+"ProductName__c"]),!0}},{key:"handleSelectionCounter",value:function(e){e.detail.changed&&("radio"!==e.detail.selectionType?(this.selectedOptions||e.detail.selected)&&(this.selectedOptions+=e.detail.selected?1:-1):this.selectedOptions=e.detail.selected?1:0)}},{key:"handleDeleteOptions",value:function(e){this.addEventListener("delete-tapped",function(e){0<this.selectedOptions&&this.selectedOptions--})}},{key:"handleOptionChangedByRule",value:function(e){this.addEventListener("option-changed-by-rule",function(e){e.detail.added?this.selectedOptions++:this.selectedOptions--})}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["render(featureId, model)","buildTabs(viewport, model, featureId)","featureChanged(feature)","initFieldSet(model, fieldSetKey, fieldSetHandler)"]}}]),s=e)),t("ProductFeature",s),Polymer(s)}}}),System.register("products/config/feature/sb-product-feature-category-list/ProductFeatureCategoryList.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ProductFeatureCategoryList",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-product-feature-category-list",this.properties={categoryNamesOrFeatures:Array,hasCategories:{type:Boolean,value:!1}}}},{key:"setHasCategories",value:function(e){this.hasCategories=e.checkAtLeastOneFeatureHasCategory()}},{key:"setCategoryNamesOrFeatures",value:function(e,t){this.categoryNamesOrFeatures=t?Object.keys(e.getTabFeaturesMap()):e.featuresWithOptionsOrConfigAttr}},{key:"getFeaturesByCategory",value:function(e){return this.model.getTabFeaturesMap()[e]}},{key:"observers",get:function(){return["setHasCategories(model)","setCategoryNamesOrFeatures(model, hasCategories)"]}}]),i=e)),t("ProductFeatureCategoryList",i),Polymer(i)}}}),System.register("products/config/feature/sb-product-feature-layout/ProductFeatureLayout.js",["../../../../common/core/Page.js","../../../../common/core/sb-page-container/PageContainer.js","../../viewmodel/ProductViewModel.js","../../../resources/optionConstraints/OptionConstraintsHandler.js"],function(t,e){var i,o,r,s,a,l,u;return{setters:[function(e){i=e.Page},function(e){o=e.PageContainer},function(e){r=e.ProductViewModel},function(e){s=e.OptionConstraintsHandler}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("ProductFeatureLayout",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),l(e,[{key:"beforeRegister",value:function(){this.is="sb-product-feature-layout",this.properties=Polymer.Base.extend({qId:String,product:Object,model:Object,configAttributes:{type:Object,notify:!0},features:{type:Object,value:{},computed:"_setFeatures(model)"},vp:{type:Object,value:function(){return o.getViewport()}},isMobile:{type:Boolean,value:!1,computed:"_setIsMobile(vp)"},hasTopConfigAttributes:{type:Boolean,computed:"_setHasTopConfigAttributes(configAttributes)"},hasBottomConfigAttributes:{type:Boolean,computed:"_setHasBottomConfigAttributes(configAttributes)"},hasFeaturelessConfigAttributes:{type:Boolean,computed:"_setHasFeaturelessConfigAttributes(configAttributes)"},isMobileAndHasConfigAttributes:{type:Boolean,value:!1,computed:"_setIsMobileAndHasFeaturelessConfigAttributes(isMobile, hasFeaturelessConfigAttributes)"},isSectionLayout:{type:Boolean,value:!1},isPaginationRequired:{type:Boolean,value:!1},tabsForFeatureLayout:Object,tabsForTabsAndWizardLayout:Object,selectedTabIndex:{type:Number,notify:!0},optionConstraintsHandler:{type:Object,value:{},computed:"setOptionConstraintsHandler(model)"},disabledStateMap:{type:Object,value:{}},configSearch:Object,listenersAttached:{type:Boolean,value:!1},spinner:{type:Boolean}},i.properties)}},{key:"buildModel",value:function(){this.model=new r(this.qId,this.product,this.app.org.prefix,this.currencyIsoCode)}},{key:"_setConfigAttributes",value:function(){this.configAttributes=this.model.configurationAttributeValueMap}},{key:"_setHasFeaturelessConfigAttributes",value:function(){var e=this.model.configAttributesByFeatureId.featureless;if(!e)return!1;for(var t=0;t<e.length;t++)if(!e[t].hidden)return!0;return!1}},{key:"_setFeatures",value:function(e){return e.featuresWithOptionsOrConfigAttr}},{key:"_setIsMobile",value:function(e){if(e)return e.isMobile()}},{key:"_setHasTopConfigAttributes",value:function(e){if(!this.model||!this.model.configAttributesByFeatureId.featureless)return!1;var t=!0,i=!1,n=void 0;try{for(var o,r=this.model.configAttributesByFeatureId.featureless[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;if("Top"===s.position&&!s.hidden)return!0}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return!1}},{key:"_setHasBottomConfigAttributes",value:function(e){if(!this.model||!this.model.configAttributesByFeatureId.featureless)return!1;var t=!0,i=!1,n=void 0;try{for(var o,r=this.model.configAttributesByFeatureId.featureless[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;if("Bottom"===s.position&&!s.hidden)return!0}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return!1}},{key:"_setIsMobileAndHasFeaturelessConfigAttributes",value:function(e,t){return e&&t}},{key:"viewportChanged",value:function(e){this.vp=e.detail.viewport}},{key:"render",value:function(){var e=this.model.getOptionLayout();if(this.isMobile&&(e="Sections",this.hasFeaturelessConfigAttributes))return this.buildFeatureLayoutTabs(),void this.handleOptionSelectionChanged();this.isSectionLayout&&(e="Sections"),this.isMobile||"Tabs"!==e&&!this.model.checkAtLeastOneFeatureHasCategory()?"Wizard"===e?(this.buildTabsAndWizardLayoutTabs(),this.isPaginationRequired=!0):"Sections"!==e&&"None"!==e||(this.isSectionLayout=!0):(this.buildTabsAndWizardLayoutTabs(),this.isPaginationRequired=!1),this.handleOptionSelectionChanged(),this.listenersAttached=!0}},{key:"buildFeatureLayoutTabs",value:function(){var e={name:"t1",label:this.i18n.l("Features"),pageComponent:"sb-product-feature-category-list",bind:["model","configAttributes","disabledStateMap","configSearch"]},t={name:"t2",label:this.i18n.l("Attributes"),pageComponent:"sb-attribute-table",attributes:[{name:"id",value:"globalConfigAttributes"},{name:"added-class",value:"header-attributes"},{name:"feature-id",value:"featureless"}],bind:["model","configAttributes"]};this.tabsForFeatureLayout=[e,t]}},{key:"buildTabsAndWizardLayoutTabs",value:function(){for(var e=this.model.getTabFeaturesMap(),t=Object.keys(e),i=[],n=0,o=t.length;n<o;n++){var r="t"+n;i.push({name:r,label:t[n]})}this.isSectionLayout=!1,this.tabsForTabsAndWizardLayout=i}},{key:"setOptionConstraintsHandler",value:function(){return new s(this.model.product,this.model.prefix)}},{key:"handleOptionSelectionChanged",value:function(){this.listenersAttached||(this.addEventListener("selection-changed",function(e){var i=this;if(e&&e.detail){if(!1===e.detail.selected&&this.model.getOption(e.detail.Id).added){var t=this.model.getOption(e.detail.Id);t.added=!1,t.removed=!0}this.handleOptionConstraints(e.detail.Id,e.detail.selected),this.optionConstraintsHandler.getUnrenderedConstraining(e.detail.Id).forEach(function(e){var t=e.selected&&!i.disabledStateMap[e.record.Id];i.handleOptionConstraints(e.record.Id,t)})}}),this.addEventListener("delete-tapped",function(e){if(e&&e.detail&&!this.hasSameOptionAdded(e.detail.Id)){var t=this.model.getOption(e.detail.Id);t.added=!1,t.removed=!0,t._transient_&&(t._transient_.rendered=!1),this.handleOptionConstraints(e.detail.Id,!1)}}.bind(this)))}},{key:"hasSameOptionAdded",value:function(e){for(var t=this.model.getOption(e).record[this.model.prefix+"Feature__c"],i=this.model.getFeature(t),n=i?i._transient_.optionConfigurations:[],o=0,r=n.length;o<r;o++)if(n[o].record.Id===e)return!0;return!1}},{key:"handleOptionConstraints",value:function(e,t){var i=this,n=this.optionConstraintsHandler.handleOptionConstraints(e,t);n&&n.forEach(function(e){i.set("disabledStateMap."+e.optionId,e.disabledState),e.rendered||i.handleOptionConstraints(e.optionId,e.selected&&!e.disabledState)})}},{key:"handleProductRulesResponse",value:function(){if(this.domHost&&this.product.configuration.productRulesActions){var e=!0,t=!1,i=void 0;try{for(var n,o=Object.keys(this.product.configuration.productRulesActions.enableOptions)[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value;this.model.optionSystemOrRequired(r)?delete this.product.configuration.productRulesActions.enableOptions[r]:this.product.configuration.productRulesActions.enableOptions[r]=!this.optionConstraintsHandler.optionShouldBeDisabled(r)}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}var s=!0,a=!1,l=void 0;try{for(var u,d=Object.keys(this.product.configuration.productRulesActions.disableOptions)[Symbol.iterator]();!(s=(u=d.next()).done);s=!0)r=u.value,this.model.optionSystemOrRequired(r)?delete this.product.configuration.productRulesActions.enableOptions[r]:this.product.configuration.productRulesActions.disableOptions[r]=this.optionConstraintsHandler.optionShouldBeDisabled(r)}catch(e){a=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(a)throw l}}var c=!0,h=!1,p=void 0;try{for(var f,g=Object.keys(this.product.configuration.productRulesActions.hideOptions)[Symbol.iterator]();!(c=(f=g.next()).done);c=!0)r=f.value,this.handleShownAndHiddenOptions(this.model.featureIdByOptionId[r],!0)}catch(e){h=!0,p=e}finally{try{!c&&g.return&&g.return()}finally{if(h)throw p}}var y=!0,v=!1,m=void 0;try{for(var b,_=Object.keys(this.product.configuration.productRulesActions.showOptions)[Symbol.iterator]();!(y=(b=_.next()).done);y=!0)r=b.value,this.handleShownAndHiddenOptions(this.model.featureIdByOptionId[r],!1)}catch(e){v=!0,m=e}finally{try{!y&&_.return&&_.return()}finally{if(v)throw m}}this.set("model.productRulesActions",this.product.configuration.productRulesActions),this._handleOptionSelectionsInUnrenderedTabs(this.model),delete this.product.configuration.productRulesActions}}},{key:"_handleOptionSelectionsInUnrenderedTabs",value:function(e){var t=e.getOptionLayout();"Tabs"!==t&&"Wizard"!==t||(this._setOptionSelections(e,this.product.configuration.productRulesActions.selectOptions,!0),this._setOptionSelections(e,this.product.configuration.productRulesActions.deselectOptions,!1))}},{key:"_setOptionSelections",value:function(i,e,n){e&&Object.keys(e).forEach(function(e){var t=i.getOption(e);t&&t.selected!==n&&(t.selected=n)})}},{key:"handleShownAndHiddenOptions",value:function(t,e){if((e?this.featureContainsOneVisibleOptions:this.featureContainsNoVisibleOptions).call(this,t)){var i=this.features.findIndex(function(e){return e.record.Id===t});this.set(["features",i,"hidden"],e)}}},{key:"_setOptionData",value:function(){this.domHost&&(this.set("model.optionDataByOptionIdAndIndex",this.product.configuration.optionDataByOptionIdAndIndex),delete this.product.configuration.optionDataByOptionIdAndIndex)}},{key:"featureContainsOneVisibleOptions",value:function(e){for(var t=0,i=this.model.optionsByFeatureId[e],n=i.length,o=0;t<=1&&o<n;)i[o].hidden||t++,o++;return 1===t}},{key:"featureContainsNoVisibleOptions",value:function(e){for(var t=!0,i=this.model.optionsByFeatureId[e],n=i.length,o=0;t&&o<n;)i[o].hidden||(t=!1),o++;return t}},{key:"_updateProductFromPopupResponse",value:function(){this.popupResponse.dynamicOptions&&0<this.popupResponse.dynamicOptions.length||this._bindResponseChangesToUI()}},{key:"_bindResponseChangesToUI",value:function(){this.model.init(this.popupResponse.product),this._setConfigAttributes(),this.set("model.optionNotifications",this.popupResponse.optionNotifications)}},{key:"handleDynamicOptionsAdded",value:function(e){for(var t in e){var i=this._getDynamicOption(t,e[t].record[this.model.prefix+"Feature__c"]),n=this._extendDataToOption(e[t],i),o=this.model.getFeature(i.featureId);this.popupResponse.product.options.push(n),o._transient_.optionConfigurations.push(n),o._transient_.changedExternally=!0}this.syncConfigurationAttributesToProduct(n),this._bindResponseChangesToUI()}},{key:"_getDynamicOption",value:function(t,i){return this.popupResponse.dynamicOptions.find(function(e){return e.productId.substring(0,15)===t.substring(0,15)&&e.featureId.substring(0,15)===i.substring(0,15)})}},{key:"_extendDataToOption",value:function(e,t){if(t.configurationData&&"object"===a(t.configurationData))for(var i in t.configurationData)e.record[i]=t.configurationData[i];return e.record[this.model.prefix+"Quantity__c"]=t.Quantity,e.index=t.index,e.isDynamicOption=!0,e.selected=!0,e.added=!0,void 0===e.record[this.model.prefix+"UnitPrice__c"]&&(e.record[this.model.prefix+"UnitPrice__c"]=0),e}},{key:"syncConfigurationAttributesToProduct",value:function(e){if(void 0===this.autoSelectAttributes){var t=!0,i=!(this.autoSelectAttributes={}),n=void 0;try{for(var o,r=this.popupResponse.product.configurationAttributes[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;!0===s.autoSelect&&void 0===this.autoSelectAttributes[s.targetFieldName]&&(this.autoSelectAttributes[s.targetFieldName]=!0)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}for(var a in this.autoSelectAttributes)this.popupResponse.product.configuration.configurationData[a]=e.record[a]}},{key:"_createConstraintsHoverMessages",value:function(){this.model.optionConstraintsByConstrained||this.model.createConstraintsHoverMessages(this.optionConstraintsHandler.optionConstraints.byConstrained)}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["_setConfigAttributes(model)","render(model, isSectionLayout)","buildModel(product, qId, currencyIsoCode)","handleProductRulesResponse(model, disabledStateMap, product.configuration.*)","_setOptionData(model, product.configuration.optionDataByOptionIdAndIndex)","_updateProductFromPopupResponse(popupResponse, model)","_createConstraintsHoverMessages(model, optionConstraintsHandler)"]}}]),u=e)),t("ProductFeatureLayout",u),Polymer(u)}}}),System.register("products/config/feature/sb-product-feature-list/ProductFeatureList.js",["common/core/AppContext.js","common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.AppContext},function(e){o=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ProductFeatureList",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-product-feature-list",this.properties={features:Object,configSearch:Object,model:Object,label:String,spinner:{type:Boolean,value:!1},show:{type:Boolean,value:!1},tabs:{type:Boolean,value:!1},viewport:{type:Object,value:function(){return o.getViewport()}}}}},{key:"initLazyTabRendering",value:function(){this.show=!0===this.isMobile()||!1===this.tabs,!1===this.show&&this.addEventListener("sb-tab-selected",this.handleTabSelected.bind(this))}},{key:"initFeatures",value:function(){this.features=this.features||this.model.getTabFeaturesMap()[this.label]}},{key:"filterFeaturesFromRules",value:function(e){this.configSearch&&this.features&&e&&0<Object.keys(e).length&&this.filterFeatures(this.configSearch,this.features,this.model,e)}},{key:"filterFeatures",value:function(e,t,i,n){this.domHost?this._filterFeatures(e,t,i,n):this._filterQueuedForNextRender||(Polymer.RenderStatus.afterNextRender(this,this._filterFeatures.bind(this,e,t,i,n)),this._filterQueuedForNextRender=!0)}},{key:"_filterFeatures",value:function(e,t,i,n){for(var o=!0,r=0,s=this.features.length;r<s;r++)o=this._filterFeatureByIndex(e,t,i,n,r)&&o;this._parentHandleContentFiltered(!o),this._filterQueuedForNextRender=!1}},{key:"_parentHandleContentFiltered",value:function(e){null!=this.label&&this.domHost&&"function"==typeof this.domHost.contentFilteredHandler&&this.domHost.contentFilteredHandler(this.label,e)}},{key:"_filterFeatureByIndex",value:function(e,t,i,n,o){var r=n?n.showOptions:null,s=i.optionsByFeatureId[t[o].record.Id]||[];!this.show&&n&&this._updateHiddenByRuleOptionPropertyForUnRenderedFeatures(s,n),s=e.setOptionVisibility(s);var a=this._hideFeature(e,t[o],i,s,r);return this.set("features."+o+".hidden",a),a}},{key:"_hideFeature",value:function(e,t,i,n,o){if(e.hasRequiredConfigAttributes(t,i))return!1;if(!e.containsFeature(t))return!0;if(e.hasVisibleOptions(n,o))return!1;var r=e.allOptionsHiddenByRule(n),s=e.hasConfigAttributes(t,i);if(r&&s)return!1;var a=t.optionSelectionMethod;return"Click"===a||!!i.maxOptionsMet(t)||"Dynamic"!==a&&!e.hasVisibleOptions(t._transient_.optionConfigurations,o)}},{key:"_updateHiddenByRuleOptionPropertyForUnRenderedFeatures",value:function(e,t){for(var i=0,n=e.length;i<n;i++)e[i].hiddenByRule&&t.showOptions&&t.showOptions[e[i].record.Id]?e[i].hiddenByRule=!1:!e[i].hiddenByRule&&t.hideOptions&&t.hideOptions[e[i].record.Id]&&(e[i].hiddenByRule=!0)}},{key:"handleFeatureExpandEvent",value:function(){this.addEventListener("feature-expanded",function(t){t.detail.path.forEach(function(e){if("feature-header"===e.id)for(;e.nextElementSibling;)e.classList.toggle("expanded",t.detail.expanded),e=e.nextElementSibling}.bind(this))}.bind(this))}},{key:"handleTabSelected",value:function(){!0!==this.show&&(this.spinner=!0,this.async(this.renderComponent.bind(this),0))}},{key:"renderComponent",value:function(){this.renderingComponent||(this.renderingComponent=!0,Polymer.RenderStatus.afterNextRender(this,function(){this.show=!0,this.spinner=!1,this.renderingComponent=!1}.bind(this)))}},{key:"isMobile",value:function(){return!(!this.viewport||!this.viewport.isMobile())}},{key:"setFeatureOptionsAsRendered",value:function(){var i=this;!1!==this.show&&this.features.forEach(function(e){i.model.getOptionsByFeatureId(e.record.Id).forEach(function(t){"Add"==e.optionSelectionMethod&&(t=i.model.product.options.find(function(e){return e.record.Id===t.record.Id})),t._transient_=t._transient_||{},t._transient_.rendered=!0})})}},{key:"observers",get:function(){return["initFeatures(label, model)","filterFeatures(configSearch, features, model)","filterFeaturesFromRules(model.productRulesActions)","handleFeatureExpandEvent(features)","setFeatureOptionsAsRendered(show, features, model)","initLazyTabRendering(tabs, viewport)"]}},{key:"prefix",get:function(){return i.org.prefix?i.org.prefix+"__":""}}]),r=e)),t("ProductFeatureList",r),Polymer(r)}}}),System.register("products/config/option/sb-option-cell/OptionCell.js",["common/core/AppContext.js","common/relationship/RelationshipFieldManager.js","common/core/sb-page-container/PageContainer.js"],function(t,e){var i,o,r,s;return{setters:[function(e){i=e.AppContext},function(e){o=e.RelationshipFieldManager},function(e){r=e.PageContainer}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("OptionCell",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-option-cell",this.properties={item:String,itemLabel:String,value:{notify:!0},model:Object,data:Object,prefix:{type:String,value:function(){return i.org.prefix?i.org.prefix+"__":""}},selected:{type:Boolean,value:!1},index:Number,display:String,viewport:{type:Object,value:function(){return r.getViewport()}},optionDrawer:{type:Boolean,value:function(){return this.classList.contains("drawerCell")}},renderReadOnly:{type:Boolean,computed:"getRenderReadOnly(optionDrawer)"},isDisabled:{type:Boolean,computed:"getDisabled(optionDrawer, selected)"}}}},{key:"buildCell",value:function(){this.field=this.getField(),this.itemLabel===this.prefix+"Quantity__c"?this.initQuantityCell():this.itemLabel===this.prefix+"UnitPrice__c"?this.initUnitPriceCell():this.initCell()}},{key:"getQuantityEditable",value:function(){return this.getFieldRecordValue("QuantityEditable__c")||!1===this.data.recordHasQuantity}},{key:"getPriceEditable",value:function(){return"Yes"===this.getFieldRecordValue("PriceEditable__c")&&!1===this.getFieldRecordValue("Bundled__c")}},{key:"getField",value:function(){return this.model.fieldDetails[this.item]}},{key:"initQuantityCell",value:function(){if(!0===this.data.hasDimension&&!0===this.data.isSegmented&&!0===this.data.configured)return this.mdqWarningIcon=!0;this.editable=this.getQuantityEditable(),null!=this.getFieldRecordValue("ProductQuantityScale__c")?(this.field=JSON.parse(JSON.stringify(this.field)),this.field.scale=this.getFieldRecordValue("ProductQuantityScale__c")):void 0!==i.org.quantityScale&&(this.field.scale=i.org.quantityScale),this.$.field.preventNumericAlignment=!0,this.attachQuantityChangeCallback(),this.initCell()}},{key:"initUnitPriceCell",value:function(){this.editable=this.getPriceEditable(),this.initCell()}},{key:"initCell",value:function(){0===this.index&&this.viewport&&this.viewport.isMobile()&&(this.editable=!1),void 0===this.editable&&this.optionDrawer&&(this.editable=!0),void 0===this.editable&&(this.editable=this.field.updateable&&this.quoteLineHasField(this.itemLabel)),void 0===this.value&&(this.value=""),this.setDisplayIfRelationshipItem(),this.attachValueChangedCallback(),this.handleOriginalValues(),(this.$.field.record=this).$.field.md=this.field}},{key:"attachQuantityChangeCallback",value:function(){this.addEventListener("value-changed",function(e){this.fire("sb-quantity-changed",{Id:this.data.record.Id,bundleId:this.getBundleId(),changed:!0,invalidQuantity:this.data.invalidQuantity,validQuantity:this.data.validQuantity,path:e.path})}.bind(this))}},{key:"attachValueChangedCallback",value:function(){this.addEventListener("value-changed",this.syncValueChangeWithOptionConfiguration.bind(this))}},{key:"getBundleId",value:function(){return this.data.parentProductKey||this.getFieldRecordValue("ConfiguredSKU__c")}},{key:"getFieldRecordValue",value:function(e){return this.data.record[this.prefix+e]}},{key:"quoteLineHasField",value:function(e){return!!this.model.quoteLineFields[e]}},{key:"setItemLabel",value:function(){this.item.startsWith("record.")?this.itemLabel=this.item.split(".")[1]:this.itemLabel=this.item}},{key:"syncValueChangeWithOptionConfiguration",value:function(){if(this.data.configuration&&0!=this.data.configuration.length&&!(1<this.data.configuration.length)){var e=this.data.configuration[0].optionData;if(e){var t=this.item.split("."),i=t[t.length-1];void 0!==e[i]&&(e[i]=this.value)}}}},{key:"handleOriginalValues",value:function(){!this.data._transient_.original&&this.data.record&&(this.data._transient_.original={},this.data._transient_.original.record=JSON.parse(JSON.stringify(this.data.record))),this.data._transient_.original&&(this.data._transient_.original.record.hasOwnProperty(this.item.split(".")[1])||this.set("data._transient_.original."+this.item,this.value),this.$.field.originalValue=this.get("data._transient_.original."+this.item))}},{key:"setDisplayIfRelationshipItem",value:function(){var e=new o(this.item,function(e){return this.get("data."+e)}.bind(this));e.hasRelationship()&&(this.display=e.getRelationshipName())}},{key:"_displayChanged",value:function(){new o(this.item,function(e,t){if(!t)return this.get("data."+e);this.set("data."+e,t)}.bind(this)).addRelationshipName(this.value,this.display,this.field.referenceTo[0])}},{key:"getValue",value:function(e){return this.data.record[e]}},{key:"setValue",value:function(e,t){this.set("data."+e,t)}},{key:"equals",value:function(e){return this.data===e.data}},{key:"getRenderReadOnly",value:function(){return!this.optionDrawer}},{key:"getDisabled",value:function(){return!!this.optionDrawer||this.selected}},{key:"observers",get:function(){return["buildCell(itemLabel, model, data, prefix)","setItemLabel(item)","_displayChanged(value, display, item, data, field)"]}}]),s=e)),t("OptionCell",s),Polymer(s)}}}),System.register("products/config/option/sb-option-drawer/OptionDrawer.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("OptionDrawer",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-option-drawer",this.properties={option:Object,md:Object,fieldNames:Array,richTextFields:Array}}},{key:"setFieldNamesAndRichTextFields",value:function(){var e=[],t=[];for(var i in this.option._transient_.attributeItems)e.push("record."+i),this.md.fieldDetails["record."+i]&&"richtextarea"===this.md.fieldDetails["record."+i].extraTypeInfo&&t.push("record."+i);this.fieldNames=e,this.richTextFields=t}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["setFieldNamesAndRichTextFields(option, md)"]}}]),i=e)),t("OptionDrawer",i),Polymer(i)}}}),System.register("products/config/option/sb-product-option-table/ProductOptionTable.js",["../../../../common/core/AppContext.js","common/layout/tables/ImageCellSizer.js","common/layout/tables/TableClassBuilder.js","common/core/sb-page-container/PageContainer.js","products/resources/optionUpgrades/OptionUpgradeHandler.js","../../../../common/calculate/asset-upgrade-quantity-calculator/AssetUpgradeQuantityCalculator.js"],function(t,e){var r,i,o,a,l,v,s;return{setters:[function(e){e.AppContext},function(e){r=e.ImageCellSizer},function(e){i=e.TableClassBuilder},function(e){o=e.PageContainer},function(e){a=e.OptionUpgradeHandler},function(e){l=e.AssetUpgradeQuantityCalculator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}v=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},t("ProductOptionTable",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-product-option-table",this.properties={featureId:String,model:Object,isClickSelection:Boolean,index:String,routeSource:String,options:Array,showAddOptionsButton:Boolean,md:Object,fieldSet:Array,featureless:Boolean,prefix:{type:String,computed:"getPrefix(model)"},primaryMobileCol:{type:Array,computed:"_getPrimaryMobileColumns(prefix, fieldSet, fieldSetName)"},parentIdDataPath:{type:String,computed:"setParentIdDataPath(model, prefix)"},disabledStateMap:Object,configSearch:Object,viewport:{type:Object,value:function(){return o.getViewport()}},showUpgradeOptions:{type:Boolean,value:!1},upgradeOptionButtonText:{type:String,value:"Show Available Upgrades"},hasUpgradeOptions:Boolean,headerActions:{type:Array,value:[]},spinner:{type:Boolean,notify:!0},attributeItemFields:{type:Array,value:[]},productHasAttributeSet:Boolean,displayStyle:{type:String,computed:"_getDisplayStyle(productHasAttributeSet)"}}}},{key:"ready",value:function(){this.$.header.selectable=!1,this.handleSelectionChanged(),this.handleMetadataChanged(),this.handleDeleteOption(),this.handleConfigureOption(),this.viewport&&this.viewport.isMobile()||(this.editFirstWhenSelected="sb-field")}},{key:"handleSelectionChanged",value:function(){this.addEventListener("selection-changed",this._selectionChanged.bind(this)),this.addEventListener("sb-quantity-changed",this._handleOptionUpgrades.bind(this))}},{key:"_selectionChanged",value:function(e){this.model.setOptionSelected(e.detail.Id,e.detail.selected),this.ifRadioSelectedClearOtherRadioSelections(e);var t=null!=e.detail.index?e.detail.index:this.getOptionIndex(e.detail.Id);if(!(t<0)){if(!0===e.detail.selected&&"Configurator"===this.routeSource?(this._displayAvailableRowActions(t,!1),this.set(["options",t,"selected"],e.detail.selected)):this._displayAvailableRowActions(t,!0),!e.detail.selected&&e.detail.changed){var i=this.model.originalDataByOptionIds[e.detail.Id];i.priceRule&&(this.set(["options",t,"record",this.prefix+"Discount__c"],i.discountRate),this.set(["options",t,"record",this.prefix+"DiscountAmount__c"],i.discountAmount),this.set(["options",t,"record",this.prefix+"UnitPrice__c"],i.unitPrice),this.set(["options",t,"record",this.prefix+"Quantity__c"],i.quantity))}"Configurator"===this.routeSource&&e.detail.path&&this.options.length>t&&(this.options[t].upgradedAssetId||this.options[t].sourceProductIds)&&this._handleOptionUpgrades(e,t)}}},{key:"_displayAvailableRowActions",value:function(e,t){if(!(this.options.length<=e))for(var i=0;i<this.options[e]._transient_.rowActions.length;i++)this.set(["options",e,"_transient_.rowActions",i,"invisible"],t),"OptionLookup"===this.routeSource&&this.set(["options",e,"_transient_.rowActions",i,"hidden"],t),"Configure"===this.options[e]._transient_.rowActions[i].title&&!0!==this.options[e].configurable&&this.set(["options",e,"_transient_.rowActions",i,"invisible"],!0)}},{key:"handleMetadataChanged",value:function(){this.$.fieldMetaData.addEventListener("md-changed",function(e){var t=this.initFieldMetadata(e.detail.value.fieldsByObject);this.rowClassMap=t.fieldSetMd.rowClassMap,this.md=t.fieldSetMd,this.attributeItemMd=t.attributeItemMd,this.spinner=!1}.bind(this))}},{key:"_handleOptionUpgrades",value:function(e,t){var i=this;if("Amendment"===this.model.product.quoteType){var n=this.options[t||this.getOptionIndex(e.detail.Id)],o=new a(this.prefix,this.options,n);if(new l(o).setQuantitiesByRatio(),o.getSourceOption()||o.getUpgradeOption()){var r=this.getOptionIndex(o.getSourceOption().record.Id),s=this.getOptionIndex(o.getUpgradeOption().record.Id);this.debounce("Wait for function to finish",function(){var e=o.getSourceOption(),t=o.getUpgradeOption();e.invalidQuantity?i._notifyQuantityChange(r,s,e,!0):t.invalidQuantity?i._notifyQuantityChange(s,r,t,!0):i._notifyQuantityChange(r,s),e.invalidQuantity=null,t.invalidQuantity=null},10)}}}},{key:"_notifyQuantityChange",value:function(e,t,i,n){n&&(i.record[this.prefix+"Quantity__c"]=i.invalidQuantity,this.notifyPath(["options",e,"record",this.prefix+"Quantity__c"]),i.record[this.prefix+"Quantity__c"]=i.validQuantity),this.notifyPath(["options",t,"record",this.prefix+"Quantity__c"]),this.notifyPath(["options",e,"record",this.prefix+"Quantity__c"])}},{key:"_getPrimaryMobileColumns",value:function(){var e=["record."+this.prefix+"ProductName__c"];return e&&0<e.length&&this.fieldSetName.endsWith("Phone")&&(e=["record."+this.fieldSet[0]]),e}},{key:"setMetadataRequest",value:function(){this.spinner=!0;var e=new Set,t=[],i=!0,n=!1,o=void 0;try{for(var r,s=this.fieldSet[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;e.add(a)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}e=this.setAttributeItemMetaData(e);var l=!0,u=!1,d=void 0;try{for(var c,h=e.values()[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var p=c.value;t.push("ProductOption__c."+p),t.push("QuoteLine__c."+p)}}catch(e){u=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(u)throw d}}JSON.stringify(this.$.fieldMetaData.fields)!==JSON.stringify(t)&&(this.$.fieldMetaData.fields=t)}},{key:"setAttributeItemMetaData",value:function(e){var t=new Set,i=!0,n=!1,o=void 0;try{for(var r,s=this.options[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;if(this.hasAttributeItems(a))for(var l in a._transient_.attributeItems)e.add(l),t.add(l)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}var u=!0,d=!1,c=void 0;try{for(var h,p=t.values()[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){var f=h.value;this.attributeItemFields.push(f)}}catch(e){d=!0,c=e}finally{try{!u&&p.return&&p.return()}finally{if(d)throw c}}return e}},{key:"initFieldMetadata",value:function(e){var t={fieldLabelMap:{},recordKeys:[],fieldLabels:[],fieldDetails:{},labelTypeMap:{},itemTypeMap:{},fields:this.fieldSet},i={fieldLabelMap:{},recordKeys:[],fieldLabels:[],fieldDetails:{},labelTypeMap:{},itemTypeMap:{},fields:this.attributeItemFields};for(var n in e[this.prefix+"ProductOption__c"]){var o=e[this.prefix+"ProductOption__c"][n];"currency"===o.type.toLowerCase()&&(o.CurrencyIsoCode=this.model.currencyIsoCode),this.addMetaDataProperties(t,o),0<this.attributeItemFields.length&&this.addMetaDataProperties(i,o)}return this.addAdditionalMetaDataProperties(t,e),this.addAdditionalMetaDataProperties(i,e),{fieldSetMd:t,attributeItemMd:i}}},{key:"addMetaDataProperties",value:function(e,t){var i=t.name;if(-1!=e.fields.indexOf(i)){e.fieldLabels.push(t.label),e.recordKeys.push("record."+i),e.fieldLabelMap[i]=t.label;var n=(e.fieldDetails["record."+i]=t).type;if(!this._isMobile()){i===this.prefix+"Quantity__c"&&(n="string");var o=new r(t).getImageWidth(20);o&&(n+=":"+o)}e.labelTypeMap[t.label.replace(/\W/g,"")]=n,e.itemTypeMap["record."+i]=n}}},{key:"addAdditionalMetaDataProperties",value:function(e,t){e.quoteLineFields=t[this.prefix+"QuoteLine__c"],e.headerClassMap=new i(Object.keys(e.labelTypeMap),"Th",e.labelTypeMap).build(),e.rowClassMap=new i(e.recordKeys,"Td",e.itemTypeMap,["initial"]).build(),delete e.fields}},{key:"initOptions",value:function(){this.productHasAttributeSet=!this._isMobile()&&this.model.product._transient_&&this.model.product._transient_.hasAttributeItems,this.options=this.model.getOptionsByFeatureId(this.featureId)}},{key:"notify",value:function(t){if(this.isClickSelection)for(var e=0,i=this.options.length;e<i;e++){var n=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;this.notifyPath("options."+e+"."+l)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}else{this.model.getFeature(this.featureId)._transient_.changedExternally&&this._optionsExternallyChanged();var u=Polymer.dom(this.$.tbody).querySelectorAll("sb-table-row");u.length&&u.forEach(function(e){e.notify(t)})}}},{key:"_optionsExternallyChanged",value:function(){Polymer.dom(this.$.tbody).querySelector('template[is="dom-repeat"]').render(),this._renderChangedRows(),this.isFeatureOptionless(),this._setHeaderActions()}},{key:"_renderChangedRows",value:function(){for(var e=Polymer.dom(this.$.tbody).querySelectorAll("sb-table-row"),t=this.options.length-1;0<=t;t--)this.options[t].selected?this._addSelectedOption(this.options[t],e[t],t):this.deleteOption(this.options[t].record.Id,t)}},{key:"_addSelectedOption",value:function(e,t,i){t.rowData||(e._transient_.rowActions=this.model.getOption(e.record.Id)._transient_.rowActions,t.rowData=e,t.$.row.selected=!0,this._displayAvailableRowActions(i,!1))}},{key:"getOptionIndex",value:function(e){for(var t=-1,i=0,n=this.options.length;t<0&&i<n;)this.options[i].record.Id===e&&(t=i),i++;return t}},{key:"ifRadioSelectedClearOtherRadioSelections",value:function(e){if("radio"===e.detail.selectionType&&e.detail.selected){var t=Polymer.dom(this.$.tbody).querySelectorAll("sb-table-row");if(t&&0!=t.length){var i=Polymer.dom(e).rootTarget,n=!0,o=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;"radio"==l.selectionType&&l!==i&&(l.$.row.fire("group-selected",{selected:!1}),l.selected=!1)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}}}},{key:"setParentIdDataPath",value:function(){return"record."+this.prefix+"ConfiguredSKU__c"}},{key:"navigationChanged",value:function(){this.model.getFeature(this.featureId)._transient_.changedExternally||this.reset()}},{key:"setOptionsDisabledData",value:function(){this.options.length&&this.disabledStateMap&&Object.keys(this.disabledStateMap).length&&this.options.forEach(function(e,t){this.optionShouldChange(e)&&this.changeOptionDisabled(e,t)}.bind(this))}},{key:"disabledStateMapChanged",value:function(e){if(this.options&&this.options.length&&Object.keys(this.disabledStateMap).length){var t=e.path.split(".")[1],i=this.model.optionsById[t],n=this.options.findIndex(function(e){return e.record.Id===t});0<=n&&this.optionShouldChange(i)&&this.changeOptionDisabled(i,n)}}},{key:"optionShouldChange",value:function(e){return e.disabledData&&this.disabledStateMap[e.record.Id]!==e.disabledData.constrained}},{key:"changeOptionDisabled",value:function(e,t){var i=!!this.disabledStateMap[e.record.Id],n=e.disabledData.disabled;this.set("options."+t+".disabledData",{disabled:n,constrained:i}),this.isClickSelection||1!=this.disabledStateMap[e.record.Id]||this.deleteOption(e.record.Id,t,!0)}},{key:"reset",value:function(){Polymer._collections.delete(this.options)}},{key:"routeToLookup",value:function(){var e={qId:this.model.qId,pId:this.model.product.record.Id,fId:this.featureId};"Dynamic"===this.model.getFeature(this.featureId).optionSelectionMethod&&(e.path=["product","dl"]),this.fire("add-option-clicked",e)}},{key:"isFeatureOptionless",value:function(){this.options&&(this.featureless=0===this.options.length?"featureless":null)}},{key:"isOptionSelected",value:function(e){return"OptionLookup"!==this.routeSource&&!!e.selected}},{key:"handleDeleteOption",value:function(){this.addEventListener("delete-tapped",function(e){this.deleteOption(e.detail.Id,e.detail.index)}.bind(this))}},{key:"deleteOption",value:function(e,t,i){var n=this.sameOptionAdded(e,t,!0);n||(this.model.optionsById[e].selected=!1),this.fire("sb-option-deleted",this.options[t]),this.splice("options",t,1),this.showOrHideAddOptionsButton(),i&&n&&this.deleteOption(n.id,n.index,!0)}},{key:"sameOptionAdded",value:function(e,t){var i=null,n=!0,o=!1,r=void 0;try{for(var s,a=this.options.entries()[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=v(s.value,2),u=l[0],d=l[1];u!==t&&d.record.Id===e&&(i={id:e,index:u},d.index>t&&d.index--)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}},{key:"handleConfigureOption",value:function(){this.addEventListener("configure-tapped",function(e){var t=this.isClickSelection?null:e.detail.index,i=this.isClickSelection?this.model.optionsById[e.detail.Id]:this.model.getFeature(this.featureId)._transient_.optionConfigurations[e.detail.index],n=void 0;("Tabs"===this.model.product.record[this.prefix+"OptionLayout__c"]||0<this.model.product.featureCategories.length)&&(n=this.getTabIndex()),this.fire("configure-option-tapped",{addedIndex:i.index||0,index:t,optionId:i.record.Id,optionalSKU:i.record[this.prefix+"OptionalSKU__c"],productId:this.model.product.record.Id,tabIndex:n,optionData:i.record,isDynamicOption:i.isDynamicOption})}.bind(this))}},{key:"getTabIndex",value:function(){var e=void 0,t=!0,i=!1,n=void 0;try{for(var o,r=this.model.product.features.entries()[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=v(o.value,2),a=s[0],l=s[1];if(l.record.Id===this.featureId){if(0<this.model.product.featureCategories.length){if(null==(e=l.record[this.prefix+"Category__c"]))return this.model.product.featureCategories.length;break}return a}}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}var u=!0,d=!1,c=void 0;try{for(var h,p=this.model.product.featureCategories.entries()[Symbol.iterator]();!(u=(h=p.next()).done);u=!0){var f=v(h.value,2),g=f[0],y=f[1];if(this.model.product.featureCategoryLabels[y]===e)return g}}catch(e){d=!0,c=e}finally{try{!u&&p.return&&p.return()}finally{if(d)throw c}}}},{key:"filterOptions",value:function(){for(var e=this.configSearch.setOptionVisibility(this.options),t=0;t<this.options.length;t++)this.options[t].hiddenByRule||this.set("options."+t+".hidden",e[t].hidden)}},{key:"setOptionIndex",value:function(){for(var e={},t=0;t<this.options.length;t++){e[this.options[t].record.Id]||(e[this.options[t].record.Id]=0),this.set("options."+t+".index",e[this.options[t].record.Id]);var i="_"+this.options[t].record.Id+"_"+this.options[t].index,n=this.model.product.configuration.configuredOptions&&this.model.product.configuration.configuredOptions[i];this.set("options."+t+".configured",n),e[this.options[t].record.Id]++}}},{key:"setProductRulesActions",value:function(){0!=Object.keys(this.model.productRulesActions).length&&this.model.optionsByFeatureId[this.featureId]&&(0==this.isClickSelection&&this.setUnaddedOptionsRulesActions(),void 0!==this.options[0]&&this.setDisplayedOptionsRulesActions())}},{key:"setUnaddedOptionsRulesActions",value:function(){for(var e=this.model.optionsByFeatureId[this.featureId],t=0;t<e.length;t++){var i=e[t];this.model.productRulesActions.selectOptions[i.record.Id]&&!this.sameOptionAdded(i.record.Id,t)&&(i.selected=!0,i.added=!0,this.push("options",i),this.showOrHideAddOptionsButton(),this.fireOptionChangedByRule(!0)),this.model.productRulesActions.showOptions[i.record.Id]&&(i.hidden=!1,i.hiddenByRule=!1),this.model.productRulesActions.hideOptions[i.record.Id]&&(i.hidden=!0,i.hiddenByRule=!0),!0===this.model.productRulesActions.disableOptions[i.record.Id]&&(i.disabledData={disabled:!0,constrained:!0}),!1===this.model.productRulesActions.disableOptions[i.record.Id]&&(i.disabledData={disabled:!0,constrained:!1}),!0===this.model.productRulesActions.enableOptions[i.record.Id]&&(i.disabledData={disabled:!1,constrained:!1}),!1===this.model.productRulesActions.enableOptions[i.record.Id]&&(i.disabledData={disabled:!1,constrained:!0})}}},{key:"setDisplayedOptionsRulesActions",value:function(){for(var e=0;e<this.options.length;e++){if(this.isClickSelection&&this.model.productRulesActions.selectOptions[this.options[e].record.Id]&&(this.set("options."+e+".selected",!0),this.fireOptionChangedByRule(!0)),this.model.productRulesActions.deselectOptions[this.options[e].record.Id])if(this.isClickSelection)this.set("options."+e+".selected",!1),this.fireOptionChangedByRule(!1);else if(this.deleteOption(this.options[e].record.Id,e),void 0===this.options[e])return;this.model.productRulesActions.hideOptions[this.options[e].record.Id]&&(this.set("options."+e+".hidden",!0),this.options[e].hiddenByRule=!0),this.model.productRulesActions.showOptions[this.options[e].record.Id]&&(this.set("options."+e+".hidden",!1),this.options[e].hiddenByRule=!1),!0===this.model.productRulesActions.disableOptions[this.options[e].record.Id]&&this.set("options."+e+".disabledData",{disabled:!0,constrained:!0}),!1===this.model.productRulesActions.disableOptions[this.options[e].record.Id]&&this.set("options."+e+".disabledData",{disabled:!0,constrained:!1}),!0===this.model.productRulesActions.enableOptions[this.options[e].record.Id]&&this.set("options."+e+".disabledData",{disabled:!1,constrained:!1}),!1===this.model.productRulesActions.enableOptions[this.options[e].record.Id]&&this.set("options."+e+".disabledData",{disabled:!1,constrained:!0})}}},{key:"fireOptionChangedByRule",value:function(e){this.viewport&&!this.viewport.isMobile()||this.fire("option-changed-by-rule",{added:e})}},{key:"_firePriceRules",value:function(){var e=this.model.optionDataByOptionIdAndIndex,t=this.options;if(null!=t)for(var i=0;i<t.length;i++){var n=t[i].optionId||t[i].record.Id,o=t[i].index;if(e[n]&&null!=e[n][o]){var r=this._getPriceActions(t[i],n,o);for(var s in r)r.hasOwnProperty(s)&&this.set(["options",i,"record",s],r[s])}}}},{key:"_getPriceActions",value:function(e,t,i){var n={},o=this.model.optionDataByOptionIdAndIndex[t][i].optionData,r=this.model.optionDataByOptionIdAndIndex[t][i].listPrice||this.model.originalDataByOptionIds[t].unitPrice;for(var s in o)o.hasOwnProperty(s)&&"attributes"!=s&&e.record[s]!=o[s]&&(n[s]=o[s]);return this._calculateUnitPrice(n,o,r),n}},{key:"_calculateUnitPrice",value:function(e,t,i){var n=this.getPrefix(),o=t[n+"Discount__c"],r=t[n+"DiscountAmount__c"];o?i*=(100-o)/100:r&&(i-=r),e[n+"UnitPrice__c"]=i}},{key:"setUpgradeOptionClass",value:function(){Polymer.dom(this.$.tbody).observeNodes(function(){for(var e=Polymer.dom(this.$.tbody).node.querySelectorAll("#row[hidden]"),t=0;t<e.length;t++)e[t].rowData.isUpgrade&&this.toggleClass("upgradeOption",!0,e[t])}.bind(this))}},{key:"toggleUpgradeOptions",value:function(){var e=this.options;this.showUpgradeOptions=!this.showUpgradeOptions,this.showUpgradeOptions?this.upgradeOptionButtonText="Hide Available Upgrades":this.upgradeOptionButtonText="Show Available Upgrades";for(var t=0;t<e.length;t++)!0===e[t].isUpgrade&&(this.showUpgradeOptions?this.set("options."+t+".hidden",!1):this.set("options."+t+".hidden",!0))}},{key:"showOrHideAddOptionsButton",value:function(){this.showAddOptionsButton=!this.isClickSelection&&!this.model.maxOptionsMet(this.model.getFeature(this.featureId))}},{key:"getPrefix",value:function(){return this.model.prefix}},{key:"setHasUpgradeOptions",value:function(e,t){this.hasUpgradeOptions=e&&!t}},{key:"_setHeaderActions",value:function(){if("OptionLookup"!==this.routeSource&&0!==this.options.length&&this.options[0]._transient_.rowActions){this.headerActions=JSON.parse(JSON.stringify(this.options[0]._transient_.rowActions));for(var e=this.headerActions.length-1;0<=e;e--)this.headerActions[e].invisible=!0;this.isClickSelection||(this.headerActions[0].hidden=!0)}}},{key:"_getDisplayStyle",value:function(){return this.productHasAttributeSet?"table-row":"table-row-group"}},{key:"_showUpgradeOptionIfSelectionMethodAdd",value:function(){if(!this.isClickSelection)for(var e=0;e<this.options.length;e++)this.options[e].isUpgrade&&this.set("options."+e+".hidden",!1)}},{key:"_isMobile",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"hasAttributeItems",value:function(e){return!this._isMobile()&&"Add"!==this.model.getFeature(this.featureId).optionSelectionMethod&&e&&e._transient_&&e._transient_.attributeItems&&0<Object.keys(e._transient_.attributeItems).length||!1}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["setMetadataRequest(model, fieldSet, prefix, options)","initOptions(model, featureId, isClickSelection, fieldSet)","disabledStateMapChanged(disabledStateMap.*)","setOptionsDisabledData(disabledStateMap, options)","setUpgradeOptionClass(options)","filterOptions(configSearch, options)","setProductRulesActions(options, model.productRulesActions.*)","_firePriceRules(options, model.optionDataByOptionIdAndIndex.*)","notify(model.optionNotifications, options)","showOrHideAddOptionsButton(model, featureId, isClickSelection)","setHasUpgradeOptions(hasUpgradeOptions, showAddOptionsButton)","_setHeaderActions(options)","_showUpgradeOptionIfSelectionMethodAdd(options, isClickSelection)","setOptionIndex(options)","isFeatureOptionless(options)"]}}]),s=e)),t("ProductOptionTable",s),Polymer(s)}}}),System.register("products/config/routes/sb-dynamic-lookup/DynamicLookup.js",["common/core/Page.js","common/layout/tables/TableClassBuilder.js","common/filter/searcher/Searcher.js","common/core/sb-page-container/PageContainer.js","products/localization/LocalizeFields.js","../../viewmodel/ProductViewModel.js","common/data/format/ErrorFormatter.js"],function(t,e){var i,o,r,u,s,a,l;return{setters:[function(e){i=e.Page},function(e){e.TableClassBuilder},function(e){o=e.Searcher},function(e){e.PageContainer},function(e){r=e.LocalizeFields},function(e){u=e.ProductViewModel},function(e){s=e.ErrorFormatter}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("DynamicLookup",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),a(e,[{key:"beforeRegister",value:function(){this.is="sb-dynamic-lookup",this.properties=Polymer.Base.extend({quote:Object,model:Object,feature:Object,selectedProducts:{type:Object,value:{}},lineEditorModel:Object,redirectUrl:String,hiddenByGroup:{type:Object,value:{}},defaultFilters:{type:Object,value:{}},internal:{type:Boolean,value:!1},errors:{type:Array,value:[],notify:!0},error:{type:Array,value:[]},productIds:{type:String,computed:"getProductIds(ctx)"},optionId:{type:String,computed:"getOptionId(ctx)"},ignoreCache:{type:Boolean,computed:"getIgnoreCache(ctx)"},hasInstructions:{type:Boolean,computed:"setHasInstructions(feature)"},validationMessages:Array},i.properties)}},{key:"searchModelChanged",value:function(){this.deSelectAll()}},{key:"ready",value:function(){this.$.lookupLayout.additionalFields=["PricebookEntry.UnitPrice"],this.$.drawer.addEventListener("transitionend",this.refocus.bind(this)),this.addEventListener("iron-deselect",this.handleDrawerClosed.bind(this)),this.handleOptionConfiguratorResponse()}},{key:"cancel",value:function(){this.spinner=!0;var e=this._createQueryParams();this.nav("#",e,["product","pc"],!1)}},{key:"add",value:function(){if(0!==Object.keys(this.selectedProducts).length){var e=[];for(var t in this.selectedProducts)e.push(this.ctx.params.fId+":"+t);var i=this.validateMaximumOptionsNotExceeded(e.length);this.validationMessages=[],0<i?this.validationMessages=[this.i18n.l("Please deselect at least {0} option(s). The max number of options allowed for this feature is {1}.",[i,this.feature.record[this.prefix+"MaxOptionCount__c"]])]:(this.$.productLoader.featureOptionIds=e,this.$.productLoader.ignoreCache=!0)}else this.cancel()}},{key:"convertProductsToOptions",value:function(e){for(var t in e){var i=e[t];i.record[this.prefix+"UnitPrice__c"]=this.selectedProducts[t].record.UnitPrice,i.isDynamicOption=!0,this.push("product.options",i),this.push("feature._transient_.optionConfigurations",i)}this.syncConfigurationAttributesToProduct(i);var n=this._createQueryParams();this.nav("#",n,["product","pc"],!1)}},{key:"syncConfigurationAttributesToProduct",value:function(e){if(void 0===this.autoSelectAttributes){var t=!0,i=!(this.autoSelectAttributes={}),n=void 0;try{for(var o,r=this.product.configurationAttributes[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;!0===s.autoSelect&&void 0===this.autoSelectAttributes[s.targetFieldName]&&(this.autoSelectAttributes[s.targetFieldName]=!0)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}for(var a in this.autoSelectAttributes)this.product.configuration.configurationData[a]=e.record[a]}},{key:"_createQueryParams",value:function(){var e={qId:this.model.qId},t=this.ctx.params;return t&&(t.pId&&(e.pId=t.pId),t.oId&&(e.oId=t.oId,e.origin="dl"),t.lineKey&&(e.lineKey=t.lineKey),t.redirectUrl&&(e.redirectUrl=t.redirectUrl),t.productIdx&&(e.productIdx=t.productIdx),t.tab&&(e.tab=t.tab),t.groupKey&&(e.groupKey=t.groupKey),t.aId&&(e.aId=t.aId)),e}},{key:"handleProductsLoadServerResponse",value:function(){this.$.qo.addEventListener("line-editor-model-changed",function(e){this.lineEditorModel=e.detail.value,this.isoCode=this.lineEditorModel.quote.record.CurrencyIsoCode||null,this.quote=e.detail.value.quote,this.$.productLoader.productIds=this.productIds,this.$.productLoader.quote=this.$.optionConfigure.quote=this.quote,this.headerSubtitle=e.detail.value.headerSubtitle}.bind(this)),this.$.productLoader.addEventListener("product-load-model-changed",function(e){if(0<Object.keys(this.selectedProducts).length)return this.convertProductsToOptions(e.detail.value);var t=this.ctx.params.productIdx?e.detail.value.configuredProducts[this.ctx.params.productIdx]:e.detail.value.configuredProducts[0];if(this.localizer=new r(this.prefix),""!==this.optionId)return this.$.optionConfigure.product=t;this.setCurrentProductModel(t)}.bind(this)),this.$.smLoadService.addEventListener("search-model-changed",function(e){var t=this.localizer.localizeSearchModel(e.detail.value),i=this.product.productFieldSets[this.feature.record[this.prefix+"DynamicProductLookupFieldSet__c"]];i&&(t.resultFieldNames=i),this.$.lookupLayout.fieldPrefix=t.targetObjectName+".",this.searchModel=t,this.buildDelegator()}.bind(this))}},{key:"handleOptionConfiguratorResponse",value:function(){this.$.optionConfigure.addEventListener("option-configurator-response-changed",function(e){this.setCurrentProductModel(e.detail.value.configuredProducts[0])}.bind(this))}},{key:"setCurrentProductModel",value:function(e){if(this.product=e,this.model=new u(this.quote.record.Id,e,this.app.org.prefix,this.isoCode,this.ctx.params.fId),this.feature=this.model.getFeature(this.ctx.params.fId),void 0!==this.feature){var t=[],i=!1;if(this.feature.searchFilters){null!=this.defaultFilters[this.feature.record.Id]?i=!0:this.defaultFilters[this.feature.record.Id]=[];var n=!0,o=!1,r=void 0;try{for(var s,a=this.feature.searchFilters[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;null!=l.valueObject&&(l.stringValue=this.getStringValue(l)),t.push(JSON.stringify(l)),i||this.defaultFilters[this.feature.record.Id].push(l)}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}}this.$.smLoadService.filters=t,this.$.smLoadService.fieldSet=this.feature.record[this.prefix+"DynamicProductFilterFieldSet__c"],this.$.smLoadService.quote=this.quote}else this.validationMessages=[this.i18n.l("Attempted to access a feature not associated with this bundle.")]}},{key:"buildDelegator",value:function(){var e=new o(this.searchModel);e.dynamicSearchFilters=this.defaultFilters[this.feature.record.Id]?this.defaultFilters[this.feature.record.Id]:[],e.dynamicFieldSet=this.feature.record[this.prefix+"DynamicProductLookupFieldSet__c"],this.searcher=e}},{key:"toggleFilter",value:function(){this.$$("sb-page-header")._closeMenu(),this.panelHeader="Product Filter",this.$.drawer.togglePanel(),this.refocus()}},{key:"closeDrawer",value:function(){this.refocus(),this.$.drawer.closeDrawer()}},{key:"refocus",value:function(){this.$.pf.focusFirstField()}},{key:"reverseFocus",value:function(){this.$.clearfilter.focus()}},{key:"runSearcher",value:function(){this.$$("#submit").focus(),this.lastSubmit="pf",this.$.pf.runService(),this.closeDrawer()}},{key:"removeFilter",value:function(){this.$$(".actions").removeChild(this.$$("#fb"))}},{key:"getConfigProductIds",value:function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e.detail.value.configuredProducts[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t.push(a.record.Id)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t.join(",")}},{key:"deSelectAll",value:function(){this.$.lookupLayout.deSelectAll()}},{key:"getOrderedSelectedProducts",value:function(){var e=Object.keys(this.selectedProducts).sort(function(e,t){return this.selectedProducts[e].index-this.selectedProducts[t].index}.bind(this)),t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t.push(this.selectedProducts[a])}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t}},{key:"handleDrawerClosed",value:function(){"main"===this.$.drawer.selected&&this.fire("iron-signal",{name:"sb-panel-closed"})}},{key:"clearFilterFields",value:function(){this.filterData=this.searcher.clearFields()}},{key:"getStringValue",value:function(e){return"Product"===e.valueObject?this.product.record[e.valueField]:"Quote"===e.valueObject?this.quote.record[e.valueField]:"Configuration Attributes"===e.valueObject?this.product.configuration.configurationData[e.valueField]:void 0}},{key:"bindFilterEnterCallBacks",value:function(){this.$.pf.enterCallback=this.runSearcher.bind(this)}},{key:"getProductIds",value:function(){return this.ctx.params&&this.ctx.params.pId||""}},{key:"getOptionId",value:function(){return this.ctx.params&&this.ctx.params.oId||""}},{key:"getIgnoreCache",value:function(){return!!this.ctx.params&&"true"===this.ctx.params.ignoreCache}},{key:"clearStackTrace",value:function(){this.errors[0]&&(this.validationMessages=new s(this.errors).truncate(),this.spinner=!1)}},{key:"setHasInstructions",value:function(){return!!this.feature.instructionsText||!!this.feature.additionalInstructions}},{key:"validateMaximumOptionsNotExceeded",value:function(e){return this.feature._transient_.optionConfigurations.length+e-this.feature.record[this.prefix+"MaxOptionCount__c"]}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.LookupBehavior]}},{key:"listeners",get:function(){return{"errors-changed":"clearStackTrace"}}},{key:"observers",get:function(){return["searchModelChanged(searchModel)"]}},{key:"prefix",get:function(){return this.app.org.prefix?this.app.org.prefix+"__":""}}]),l=e)),t("DynamicLookup",l),Polymer(l)}}}),System.register("products/config/routes/sb-option-lookup/OptionLookup.js",["../../../../common/core/Page.js","../../../resources/rules/RuleProcessor.js","../../viewmodel/ProductViewModel.js","../../../resources/optionConstraints/OptionConstraintsHandler.js","common/data/format/ErrorFormatter.js"],function(t,e){var i,o,r,s,a,l,u;return{setters:[function(e){i=e.Page},function(e){o=e.RuleProcessor},function(e){r=e.ProductViewModel},function(e){s=e.OptionConstraintsHandler},function(e){a=e.ErrorFormatter}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}l=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("OptionLookup",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),l(e,[{key:"beforeRegister",value:function(){this.is="sb-option-lookup",this.properties=Polymer.Base.extend({topLevelBundle:Object,currentProductModel:Object,feature:Object,disabledStateMap:{type:Object,value:{}},optionConstraintsHandler:Object,headerSubtitle:String,selectedOptions:Object,productIds:{type:String,computed:"getProductIds(ctx)"},lineKey:{type:Number,computed:"getLineKey(ctx)"},ignoreCache:{type:Boolean,computed:"getIgnoreCache(ctx)"},hasUpgradeOptions:{type:Boolean,computed:"setHasUpgradeOptions(feature)"},optionId:{type:String,computed:"getOptionId(ctx)"},validationMessages:Array,errors:{type:Array,value:[],notify:!0}},i.properties)}},{key:"ready",value:function(){this.preLoadObjects(),this._handleLineEditorModelResponse(),this._handleProductLoadResponse(),this.handleOptionConfiguratorResponse(),this.addEventListener("selection-changed",this._handleOptionSelection)}},{key:"add",value:function(){this.validationMessages=[];var e=this._validateMaximumOptionsNotExceeded();0<e?this.validationMessages=[this.i18n.l("Please deselect at least {0} option(s). The max number of options allowed for this feature is {1}.",[e,this.feature.record[this.prefix+"MaxOptionCount__c"]])]:(this._addSelected(),this._routeToConfig())}},{key:"cancel",value:function(){for(var e in this.selectedOptions)this.currentProductModel.optionsById[e].added=!1,this.currentProductModel.optionsById[e].selected=!1;this._routeToConfig()}},{key:"_handleLineEditorModelResponse",value:function(){this.$.lineEditorRead.addEventListener("line-editor-model-changed",function(e){this.$.productLoad.quote=this.$.optionConfigure.quote=e.detail.value.quote,this.headerSubtitle=e.detail.value.headerSubtitle,this.currencyIsoCode=e.detail.value.quote.record.CurrencyIsoCode||null}.bind(this))}},{key:"_handleProductLoadResponse",value:function(){this.$.productLoad.addEventListener("product-load-model-changed",function(e){var t=e.detail&&e.detail.value?e.detail.value.configuredProducts:null,i=this.ctx.params&&this.ctx.params.productIdx?this.ctx.params.productIdx:0,n=t?t[i]:e.detail.value;if(n.rulesProcessed||new o(n.configuration,n).initProductRulesActions(""===this.optionId?"load":"reconfigure"),this.topLevelBundle=n,""!==this.optionId)return this.$.optionConfigure.product=n;this.setCurrentProductModel(n)}.bind(this))}},{key:"handleOptionConfiguratorResponse",value:function(){this.$.optionConfigure.addEventListener("option-configurator-response-changed",function(e){this.setCurrentProductModel(e.detail.value.configuredProducts[0])}.bind(this))}},{key:"setCurrentProductModel",value:function(e){this.currentProductModel=new r(this.$.productLoad.quote.record.Id,e,this.app.org.prefix,this.currencyIsoCode,this.ctx.params.fId),this.feature=this.currentProductModel.getFeature(this.ctx.params.fId),void 0!==this.feature?(this.selectedOptions={},this.optionConstraintsHandler=new s(this.currentProductModel.product,this.currentProductModel.prefix),this.$.optionTable.fieldSetName="OptionLookup",this.$.optionTable.fieldSet=this.currentProductModel.product.optionFieldSets[this.$.optionTable.fieldSetName],this.$.optionTable.displayDelete=!1,this._createConstraintsHoverMessages(),this._fireSelectionStatesForOtherFeatures()):this.validationMessages=[this.i18n.l("Attempted to access a feature not associated with this bundle.")]}},{key:"_handleOptionSelection",value:function(e){e&&e.detail&&(this._toggleOptionSelection(e.detail.Id,e.detail.selected),this._handleOptionConstraints(e.detail.Id,e.detail.selected))}},{key:"_fireSelectionStatesForOtherFeatures",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,o=Object.keys(this.currentProductModel.featureIdsWithSelectionMethodClick)[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var r=n.value,s=!0,a=!1,l=void 0;try{for(var u,d=this.currentProductModel.optionsByFeatureId[r][Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var c=u.value;this._handleOptionConstraints(c.record.Id,c.selected)}}catch(e){a=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(a)throw l}}}}catch(e){t=!0,i=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw i}}}},{key:"_toggleOptionSelection",value:function(e,t){!t&&this.selectedOptions[e]?delete this.selectedOptions[e]:t&&!this.selectedOptions[e]&&(this.selectedOptions[e]=this.currentProductModel.getOption(e))}},{key:"_handleOptionConstraints",value:function(t,e){var i=this,n=this.feature._transient_.optionConfigurations.find(function(e){return e.record.Id===t}),o=n&&n.selected,r=this.optionConstraintsHandler.handleOptionConstraints(t,e||o);r&&r.forEach(function(e){i.set("disabledStateMap."+e.optionId,e.disabledState)})}},{key:"_addSelected",value:function(){function e(t){i.currentProductModel.optionsById[t];var e=JSON.parse(JSON.stringify(i.currentProductModel.optionsById[t]));i.currentProductModel.initOptionActions(e,!0),e.addedManually=!0,e.index=i.feature._transient_.optionConfigurations.filter(function(e){return e.record.Id===t}).length,e.configured=!1,i.currentProductModel.setOptionDisabledData(e),i.push("feature._transient_.optionConfigurations",e),i.currentProductModel.optionsById[t].added=!0,i.currentProductModel.optionsById[t].selected=!0}var i=this;for(var t in this.selectedOptions)e(t)}},{key:"_validateMaximumOptionsNotExceeded",value:function(){return this.feature._transient_.optionConfigurations.length+Object.keys(this.selectedOptions).length-this.feature.record[this.prefix+"MaxOptionCount__c"]}},{key:"_routeToConfig",value:function(){this.selectedOptions={};var e=this._createQueryParams();this.nav("#",e,["product","pc"],!1)}},{key:"_createQueryParams",value:function(){var e={qId:this.currentProductModel?this.currentProductModel.qId:this.ctx.params.qId},t=this.ctx.params;return t&&(t.pId&&(e.pId=t.pId),t.oId&&(e.oId=t.oId,e.origin="ol"),t.lineKey&&(e.lineKey=t.lineKey),t.redirectUrl&&(e.redirectUrl=t.redirectUrl),t.productIdx&&(e.productIdx=t.productIdx),t.tab&&(e.tab=t.tab),t.groupKey&&(e.groupKey=t.groupKey),t.aId&&(e.aId=t.aId)),e}},{key:"preLoadObjects",value:function(){this.optionLookupObjects=[this.prefix+"ProductOption__c",this.prefix+"QuoteLine__c"]}},{key:"getProductIds",value:function(){return this.ctx.params&&this.ctx.params.pId||""}},{key:"getLineKey",value:function(){return this.ctx.params?parseInt(this.ctx.params.lineKey||-1):-1}},{key:"getIgnoreCache",value:function(){return!!this.ctx.params&&"true"===this.ctx.params.ignoreCache}},{key:"setHasUpgradeOptions",value:function(){return this.currentProductModel.getHasUpgradeOptions(this.feature)}},{key:"_createConstraintsHoverMessages",value:function(){this.currentProductModel.createConstraintsHoverMessages(this.optionConstraintsHandler.optionConstraints.byConstrained)}},{key:"getOptionId",value:function(){return this.ctx.params&&this.ctx.params.oId||""}},{key:"clearStackTrace",value:function(){this.errors[0]&&(this.validationMessages=new a(this.errors).truncate(),this.spinner=!1)}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior]}},{key:"listeners",get:function(){return{"errors-changed":"clearStackTrace"}}},{key:"prefix",get:function(){return this.app.org.prefix?this.app.org.prefix+"__":""}}]),u=e)),t("OptionLookup",u),Polymer(u)}}}),System.register("products/config/routes/sb-product-config/ProductConfig.js",["../../../../common/core/Page.js","../../../resources/rules/RuleProcessor.js","products/resources/reconfigure/ProductReconfigurer.js","products/resources/optionUpgrades/OptionUpgradeHandler.js","../../../resources/model/nestedOptions/NestedOptionsModel.js","common/data/format/ErrorFormatter.js","common/core/Navigator.js"],function(t,e){var i,p,f,m,h,o,s,b,r,a;return{setters:[function(e){i=e.Page},function(e){p=e.RuleProcessor},function(e){f=e.ProductReconfigurer},function(e){m=e.OptionUpgradeHandler},function(e){h=e.NestedOptionsModel},function(e){o=e.ErrorFormatter},function(e){s=e.Navigator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}b=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("ProductConfig",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),r(e,[{key:"beforeRegister",value:function(){this.is="sb-product-config",this.properties=Polymer.Base.extend({lineEditorModel:Object,productSelectionModel:Object,topLevelBundle:Object,currentTarget:Object,productIndex:Number,headerSubtitle:String,hasMultipleBundles:Boolean,isClassic:Boolean,searchValuesByFilter:Object,searchFilters:Array,validationMessages:Array,headerTitle:String,isMobileAndHasMultipleBundles:{type:Boolean,value:!1,computed:"_setIsMobileAndHasMultipleBundles(viewport, hasMultipleBundles)"},productIds:{type:String,computed:"getProductIds(ctx)"},lineKey:{type:Number,computed:"getLineKey(ctx)"},groupKey:{type:Number,computed:"getGroupKey(ctx)"},ignoreCache:{type:Boolean,computed:"getIgnoreCache(ctx)"},prefix:{type:String,computed:"getPrefix(app.org)"},optionId:{type:String,computed:"getOptionId(ctx)"},spinner:{type:Boolean,value:!1},errors:{type:Array,value:[],notify:!0},preventPreLoadObjects:{type:Boolean,value:!1}},i.properties)}},{key:"ready",value:function(){this.handleLineEditorModelResponse(),this.handleProductLoadResponse(),this.handleOptionSaveResponse(),this.handleProductRulesInvokerResponse(),this.handleCustomActionsCollapsed(),this.handleOnAddOptionClick(),this.handleBundlePanelClick(),this.handleChangeEvents(),this.handleBundleNameChange(),this.handleExternalConfiguration(),this.handleConfigureOptionEvent(),this.handleOptionConfiguratorResponse()}},{key:"attached",value:function(){this.preventPreLoadObjects||this.preLoadObjects()}},{key:"handleLineEditorModelResponse",value:function(){this.$.lineEditorRead.addEventListener("line-editor-model-changed",function(e){this.lineEditorModel=e.detail.value,this.isoCode=this.lineEditorModel.quote.record.CurrencyIsoCode||null,this.$.optionSave.stripLinesThreshold=this.lineEditorModel.settings.largeQuoteThreshold,this.$.optionSave.stripLinesMessage=this.lineEditorModel.customLabels.msg_large_quote_sent_without_lines,this.$.productLoad.quote=this.$.optionSave.quote=this.$.productRulesInvoke.quote=this.$.optionConfigure.quote=e.detail.value.quote,this.headerSubtitle=e.detail.value.headerSubtitle}.bind(this))}},{key:"handleProductLoadResponse",value:function(){this.$.productLoad.addEventListener("product-load-model-changed",function(e){if(e.detail.value&&void 0===e.detail.value.configuredProducts)this._handleExternalDynamicOptionsResponse(e.detail.value);else{var t=this.handleProductConfigurationInitializer(e.detail.value);if(t.returnToQuote)return this.$.productAlerts.displayContinueButton=!1,this.$.productAlerts.cancelCB=function(){return this.nav("#",{qId:this.lineEditorModel.quote.record.Id},["quote","le"],!1)}.bind(this),this.$.productAlerts.alerts=[t.returnToQuote];if(""!==this.optionId)return this.setOptionConfigurationDetails(t);this.loadedModelIsReconfigure(t)&&(new f(t.configuredProducts[0],this.lineEditorModel.quote.record[this.prefix+"Type__c"]).reconfigure(),this.addAttributeSetFromServerProductVO(t.configuredProducts[0]));var i=!0,n=!1,o=void 0;try{for(var r,s=t.configuredProducts[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;a.rulesProcessed||new p(a.configuration,a).initProductRulesActions(!0),null!=t.attributeSet&&0<Object.keys(t.attributeSet.attributeItemIdsByOptionId).length&&(a._transient_=a._transient_||{},a._transient_.attributeSet=t.attributeSet),null!=a.configuration&&null==a.nestedOptionModel&&(a.nestedOptionModel=new h(a.configuration)),a.configuration.configuredOptions=a.nestedOptionModel.getConfiguredOptionsFromPath()}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}this.productSelectionModel=void 0,this.productSelectionModel=t,this.hasMultipleBundles=1<this.productSelectionModel.configuredProducts.length,this.isClassic=this.hasMultipleBundles&&"Classic"===this.lineEditorModel.settings.multipleBundlesView,this.currentTarget=this.productSelectionModel;for(var l=0;l<this.productSelectionModel.configuredProducts.length;l++)this.productIndex=l;this.productIndex=this.getProductIndex(),this.searchFilters=this.productSelectionModel.configuredProducts[0].optionFieldSets.SearchFilters;var u={};if(this.searchFilters&&!this.productSelectionModel.searchValuesByFilter){for(var d=0,c=this.searchFilters.length;d<c;d++)u[this.searchFilters[d]]=null;this.productSelectionModel.searchValuesByFilter=u}this.$.bundles.searchValuesByFilter=this.productSelectionModel.searchValuesByFilter,this.$.bundles.searchFilters=this.searchFilters,this.checkForExternalConfiguration()}}.bind(this))}},{key:"handleOptionSaveResponse",value:function(){this.$.optionSave.addEventListener("psm-response-changed",function(e){this.validationMessages=null;var t=e.detail.value,i=new p(t,this.topLevelBundle);if(i.initValidationMessages(),this.validationMessages=i.getValidationMessages(),!(0<this.validationMessages.length))return t.guidedMessages&&0<t.guidedMessages.length?(this.$.productAlerts.cancelCB=null,this.$.productAlerts.displayContinueButton=!0,this.$.productAlerts.continueCB=this.afterSaveNavigate.bind(this,t,i),this.spinner=!1,void(this.$.productAlerts.alerts=t.guidedMessages)):void this.afterSaveNavigate(t,i);this.spinner=!1}.bind(this))}},{key:"afterSaveNavigate",value:function(e,t){var i="none",n=void 0;""!==this.optionId&&(n=this.topLevelBundle.nestedOptionModel.getLastFromPath().tabIndex,i=this.topLevelBundle.nestedOptionModel.popFromPathAndGetNextSKU()||"none",t.initDescendantTree());var o=this.ctx.params?this.ctx.params.redirectUrl:null,r=this.createPathParams(o),s=void 0;""!==this.optionId?s=this.createQueryParams({oId:i,ignoreCache:!1,jspr:!0},n):(s={qId:e.quote.record.Id},null!=this.ctx.params.groupKey&&(s.groupKey=this.ctx.params.groupKey),this.ctx.params.aId&&"quote"!==r[0]&&(s.aId=this.ctx.params.aId)),e.quote&&(this.lineEditorModel.quote=e.quote),this.nav("#",s,r,!1)}},{key:"handleProductRulesInvokerResponse",value:function(){this.$.productRulesInvoke.addEventListener("config-response-changed",function(e){var t=e.detail.value,i=this.currentTarget.configuredProducts.findIndex(function(e){return(e.productKey||e.record.Id)===t.configuredProductKey}),n=this.currentTarget.configuredProducts[i],o=new p(t,n);o.init(void 0!==this.topLevelBundle?this.topLevelBundle.nestedOptionModel:n.nestedOptionModel),this.validationMessages=o.getValidationMessages(),void 0!==n.configuration&&void 0!==n.configuration.configurationData&&(t.configurationData=n.configuration.configurationData),this.$.bundles.set("configuredProducts."+i+".configuration.productRulesActions",o.getProductRulesActions()),this.$.bundles.set("configuredProducts."+i+".configuration.optionDataByOptionIdAndIndex",o.getOptionDataByOptionIdAndIndex()),Polymer.RenderStatus.afterNextRender(this,function(){this.spinner=!1})}.bind(this))}},{key:"handleCustomActionsCollapsed",value:function(){this.changeAllActions(this.$.customActions.buttonsCollapsed),this.$.customActions.addEventListener("buttons-collapsed-changed",function(e){var t=e.detail.value;this.changeAllActions(t)}.bind(this))}},{key:"handleOnAddOptionClick",value:function(){var r=void 0;this.addEventListener("selected-page-changed",function(e){r=e.detail}.bind(this)),this.addEventListener("add-option-clicked",function(e){var t=""===this.optionId?e.detail:Object.assign({},e.detail,{oId:this.optionId}),i=void 0;t.path&&""===this.optionId&&(i=this.getProductIndex(e.detail.pId));var n=this.createQueryParams(t,r),o=null!=t.path?t.path:["product","ol"];i&&(n.productIdx=i),this.nav("#",n,o,!1)}.bind(this))}},{key:"handleBundlePanelClick",value:function(){this.addEventListener("bundle-panel-clicked",this.navToBundle)}},{key:"navToBundle",value:function(e){var t=this.createQueryParams(this.ctx.params);t.productIdx=e.detail,t.open=1,t.tab&&delete t.tab,this.nav("#",t,["product","pc"],!1)}},{key:"handleChangeEvents",value:function(){this.addEventListener("selection-changed",function(e){this.handleChangeEvent(e,"On Selection")}.bind(this)),this.addEventListener("sb-quantity-changed",function(e){this.handleChangeEvent(e,"On Quantity Change")}.bind(this)),this.addEventListener("sb-config-attribute-changed",function(e){this.handleChangeEvent(e,"On Attribute Change")}.bind(this)),this.addEventListener("sb-option-deleted",function(e){var t=this.topLevelBundle||this.productSelectionModel.configuredProducts[this.productIndex];t.nestedOptionModel&&t.nestedOptionModel.remove(e.detail)}.bind(this))}},{key:"handleBundleNameChange",value:function(){this.isMobileViewport()?this.addEventListener("bundle-name-changed",function(e){this.headerTitle=e.detail.name}.bind(this)):this.headerTitle=this.i18n.l("Configure Products")}},{key:"handleExternalConfiguration",value:function(){this.addEventListener("sb-close-popup",function(e){if(e.detail.dynamicOptions&&0<e.detail.dynamicOptions.length&&e.detail.featureOptionIds)this._handleExternalDynamicOptions(e.detail);else{if(!e.detail.redirect)return null;if(1===this.productSelectionModel.configuredProducts.length){if(!e.detail.redirect.auto&&!e.detail.redirect.back)return null;e.detail.redirect.save?this.save():this.cancel(e.detail.redirect.back)}else if(e.detail.redirect.back&&e.detail.redirect.save)this.productIndex===this.productSelectionModel.configuredProducts.length-1?this.save():this.navToBundle({detail:this.productIndex+1});else{if(!e.detail.redirect.back)return null;this.cancel(!0)}}})}},{key:"handleProductConfigurationInitializer",value:function(e){if(this.isReconfigure(e))return e;var t=!0,i=!1,n=void 0;try{for(var o,r=e.configuredProducts[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value,a=s.configuration,l=!0,u=!1,d=void 0;try{for(var c,h=a.optionConfigurations[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var p=c.value,f=p.optionData.Id,g=!0,y=!1,v=void 0;try{for(var m,b=s.options[Symbol.iterator]();!(g=(m=b.next()).done);g=!0){var _=m.value;if(_.record.Id===f)for(var S in p.optionData)_.record[S]&&_.record[S]!=p.optionData[S]&&(_.record[S]=p.optionData[S])}}catch(e){y=!0,v=e}finally{try{!g&&b.return&&b.return()}finally{if(y)throw v}}}}catch(e){u=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(u)throw d}}}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return e}},{key:"save",value:function(){if(!1!==this.configurationAttributesValid()){if(this.validationMessages=null,""!==this.optionId){var e=this.prepareProductForServer(this.currentTarget.configuredProducts[0]);if(this.validationMessages)return;return this.spinner=!0,this.$.optionSave.configuration=void 0,this.$.optionSave.configuration=e.configuration}var t=this.isReconfigure(this.productSelectionModel)?this.getConfiguredProductsToSave():this.getSelectedProductsToSave();this.validationMessages||(this.spinner=!0,this.$.optionSave.products=void 0,this.$.optionSave.products=t)}else this.validationMessages=[this.i18n.l("Please review required configuration attributes")+this.getConfigurationAttributeMissingFeaturesMessage()]}},{key:"cancel",value:function(e){var t=0<arguments.length&&void 0!==e&&e;if(this.spinner=!0,""===this.optionId){var i={qId:this.lineEditorModel.quote.record.Id};return null!=this.ctx.params.groupKey&&(i.groupKey=this.ctx.params.groupKey),!0===t?s.navToPreviousRoute(this,i,["product","lookup"]):this.nav("#",i,["quote","le"],!1)}this.topLevelBundle.nestedOptionModel.cancel();var n=this.topLevelBundle.nestedOptionModel.getLastFromPath().tabIndex,o=this.topLevelBundle.nestedOptionModel.popFromPathAndGetNextSKU(),r=o?this.createQueryParams({oId:o,ignoreCache:!1},n):this.createQueryParams({qId:this.lineEditorModel.quote.record.Id},n);this.nav("#",r,["product","pc"],!1)}},{key:"getConfiguredProductsToSave",value:function(){var t=this,i=[];return this.productSelectionModel.configuredProducts.forEach(function(e){i.push(t.prepareProductForServer(e))}),i}},{key:"getSelectedProductsToSave",value:function(){var e=this.productSelectionModel.configuredProducts,t={},i=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l=this.prepareProductForServer(a),u=a.record.Id,d=t[u];(d=d||[]).push(l),t[u]=d}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}var c=this.productSelectionModel.selectedProducts,h=Object.keys(c).sort(function(e,t){return c[e].index-c[t].index}),p=[],f=!0,g=!1,y=void 0;try{for(var v,m=h[Symbol.iterator]();!(f=(v=m.next()).done);f=!0){var b=v.value,_=c[b],S=t[b];S?p=p.concat(S):_.invalid||p.push(_)}}catch(e){g=!0,y=e}finally{try{!f&&m.return&&m.return()}finally{if(g)throw y}}return p}},{key:"checkForExternalConfiguration",value:function(){var e=this.productSelectionModel.configuredProducts[this.productIndex],t=this.prefix+"ExternallyConfigurable__c",i=this.lineEditorModel.settings.externalConfiguratorUrl,n=this.lineEditorModel.settings.thirdPartyConfigurator;!e.record[t]||e.visitedExternal&&!n||this.isClassic||null===i||(e.visitedExternal=!0,this.$.customActions.handlePopup(i,!0,n))}},{key:"_handleExternalDynamicOptions",value:function(e){this.$.productLoad.featureOptionIds=e.featureOptionIds,this.$.productLoad.ignoreCache=void 0,this.$.productLoad.ignoreCache=!0,e.redirect&&e.redirect.auto&&(e.redirect.save?this.redirectAfterOptionsAdded="save":this.redirectAfterOptionsAdded="cancel")}},{key:"_handleExternalDynamicOptionsResponse",value:function(e){this.$.bundles.$$("#features").handleDynamicOptionsAdded(e),void 0!==this.redirectAfterOptionsAdded&&("save"===this.redirectAfterOptionsAdded?this.save():this.cancel())}},{key:"handleChangeEvent",value:function(e,t){if(e&&e.detail&&e.detail.bundleId&&e.detail.changed&&e.detail.path){var i=this.getProductById(e.detail.bundleId);this.handleApplyImmediatelyProductRules(i,e.detail,t)}if("On Quantity Change"===t&&(this.validationMessages=null,0<e.detail.invalidQuantity)){var n=this.i18n.l("Exceeded maximum quantity available. Value has been reduced to {0}",[e.detail.validQuantity]);this.validationMessages=[{type:"warning",msg:n}]}}},{key:"handleApplyImmediatelyProductRules",value:function(e,t,i){e&&this.isAppliedImmediately(e,t,i)&&(this.spinner=!0,this.debounce("ApplyImmediatelyProductRules",function(){this.$.productRulesInvoke.product=void 0,this._updateProductConfigurationHiddenOptions(e),e=this.prepareProductForServer(e,!0),this.$.productRulesInvoke.upgradeAssetId=e.upgradedAssetId||null,this.$.productRulesInvoke.product=e},250))}},{key:"_updateProductConfigurationHiddenOptions",value:function(e){var t=e.configuration.hiddenOptionIds||[],i=!0,n=!1,o=void 0;try{for(var r,s=e.options[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l=a.hiddenByRule,u=t.indexOf(a.record.Id),d=-1!==u;l&&!d&&t.push(a.record.Id),!l&&d&&t.splice(u,1)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}e.configuration.hiddenOptionIds=t}},{key:"isAppliedImmediately",value:function(e,t,i){var n=this.prefix+"AppliedImmediately__c",o=this.prefix+"AppliedImmediatelyContext__c",r=void 0,s=void 0;return"On Attribute Change"===i?(r=e.configurationAttributes.find(function(e){return e.myId===t.Id})).appliedImmediately:("Always"===(s=(r=e.options.find(function(e){return e.record.Id===t.Id})).record[o])||s===i||void 0===s&&"On Selection"===i)&&r.record[n]}},{key:"handleConfigureOptionEvent",value:function(){this.addEventListener("configure-option-tapped",function(e){var t=this.prepareProductForNestedConfigure(e.detail),i=this.createQueryParams({oId:t.nestedOptionModel.getLastFromPath().optionalSKU,ignoreCache:!1});this.nav("#",i,["product","pc"],!1)}.bind(this))}},{key:"prepareProductForNestedConfigure",value:function(e){var t=void 0;if(""===this.optionId){var i=this.productSelectionModel.currentIndex=this.getProductIndex(e.productId);t=this.productSelectionModel.configuredProducts[i]}else t=this.topLevelBundle;return t.nestedOptionModel=t.nestedOptionModel||new h,t.nestedOptionModel.addToPath(e.optionId,e.optionalSKU,e.addedIndex,e.tabIndex),t.nestedOptionModel.stagedOption={optionData:e.optionData,isDynamicOption:e.isDynamicOption},t}},{key:"handleOptionConfiguratorResponse",value:function(){this.$.optionConfigure.addEventListener("option-configurator-response-changed",function(e){this.currentTarget=e.detail.value;var t=this.currentTarget.configuredProducts[0];if(this.ctx.params.oId&&0==t.options.length&&0==t.configurationAttributes.length&&!this.hasDynamicFeature(t)){var i=this.topLevelBundle.nestedOptionModel.getLastFromPath().tabIndex,n=this.topLevelBundle.nestedOptionModel.popFromPathAndGetNextSKU(),o=n?this.createQueryParams({oId:n,ignoreCache:!1},i):this.createQueryParams({qId:this.lineEditorModel.quote.record.Id},i);return this.$.productAlerts.displayContinueButton=!1,this.$.productAlerts.cancelCB=function(){return this.nav("#",o,["product","pc"],!1)}.bind(this),this.$.productAlerts.alerts=[this.i18n.l("This product has no options and configurations. To add this product, add options/configurations or change Configuration Type to not be Required.")]}if(this.topLevelBundle.nestedOptionModel)if(this.topLevelBundle.nestedOptionModel.descendLevel){var r=this.topLevelBundle.nestedOptionModel.configure(t.configuration);new f(t,this.lineEditorModel.quote.record[this.prefix+"Type__c"]).reconfigure(r),this.ctx.params.tab&&(this.ctx.params.tab=0)}else t.configuration=this.topLevelBundle.nestedOptionModel.getCurrentLevel(),t.configuration.configuredOptions=this.topLevelBundle.nestedOptionModel.getConfiguredOptionsFromPath();t.rulesProcessed||new p(t.configuration,t).initProductRulesActions(!0),this.addAttributeSetFromServerProductVO(t);var s=this.topLevelBundle.optionFieldSets.SearchFilters,a={},l=!0,u=!1,d=void 0;try{for(var c,h=s[Symbol.iterator]();!(l=(c=h.next()).done);l=!0)a[c.value]=null}catch(e){u=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(u)throw d}}this.productIndex=0,this.$.bundles.searchValuesByFilter=a,this.$.bundles.searchFilters=s,this.$.bundles.set("configuredProducts",this.currentTarget.configuredProducts)}.bind(this))}},{key:"getProductById",value:function(t){return this.currentTarget.configuredProducts.find(function(e){return(e.productKey||e.record.Id)===t})}},{key:"getProductIndex",value:function(e){if(e)for(var t=0;t<this.productSelectionModel.configuredProducts.length;t++)if(this.productSelectionModel.configuredProducts[t].record.Id===e)return t;if(!this.ctx.params||!this.ctx.params.productIdx)return 0;var i=+this.ctx.params.productIdx;return Number.isNaN(i)||i<0||i>=this.currentTarget.configuredProducts.length?0:i}},{key:"hasDynamicFeature",value:function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=e.features[Symbol.iterator]();!(t=(o=r.next()).done);t=!0)if("Dynamic"===o.value.record[this.prefix+"OptionSelectionMethod__c"])return!0}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return!1}},{key:"addAttributeSetFromServerProductVO",value:function(e){e.attributeSet&&0===Object.keys(e.attributeSet.attributeItemIdsByOptionId).length||(e._transient_=e._transient_||{},e._transient_.attributeSet=e.attributeSet)}},{key:"changeAllActions",value:function(e){e?this.$$("#allActions").classList.add("actionsCollapsed"):this.$$("#allActions").classList.remove("actionsCollapsed")}},{key:"prepareProductForServer",value:function(e,t){var i={record:{}},n=this.topLevelBundle?this.topLevelBundle.nestedOptionModel:e.nestedOptionModel;i.upgradedAssetId=e.upgradedAssetId;var o=this.getSelectedOptions(e,t,n);return i.configuration=n.save(o,t),i.configuration.configurationData=e.configuration.configurationData,i.configuration.configuredProductId=i.record.Id=e.record.Id,i}},{key:"getSelectedOptions",value:function(e,t,i){var n=[],o=!0,r=!1,s=void 0;try{for(var a,l=e.features[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var u=a.value,d=!0,c=!1,h=void 0;try{for(var p,f=u._transient_.optionConfigurations.entries()[Symbol.iterator]();!(d=(p=f.next()).done);d=!0){var g=b(p.value,2),y=(g[0],g[1]);if(y.selected){this.optionId&&this.topLevelBundle,!t&&y.configurationRequired&&!0!==y.configured&&(this.validationMessages=[this.i18n.l("Some or all options require further configuration. Look for configuration icon next to options that must be configured.")]),y.isUpgrade&&new m(this.prefix,e.options,y).setUpgradedAssetId();var v=JSON.parse(JSON.stringify(y));this.buildOptionForLineEditor(v,n)}else i&&i.remove(y)}}catch(e){c=!0,h=e}finally{try{!d&&f.return&&f.return()}finally{if(c)throw h}}}}catch(e){r=!0,s=e}finally{try{!o&&l.return&&l.return()}finally{if(r)throw s}}return n}},{key:"buildOptionForLineEditor",value:function(e,t){e.optionConfigurations=e.optionConfigurations||[],e.optionId=e.record.Id,e.optionData=e.record,void 0===e.configurationData&&(e.configurationData={}),e.isDynamicOption=e.isDynamicOption||e.isUpgrade,delete e.record,t.push(e)}},{key:"createQueryParams",value:function(e,t){var i=this.ctx.params;return i&&(i.pId?e.pId=i.pId:e.pId=this.getAllProductIds(),i.redirectUrl&&(e.redirectUrl=i.redirectUrl),e.oId&&(e.qId=i.qId,"none"===e.oId&&delete e.oId),i.productIdx?e.productIdx=i.productIdx:null!=i.pId&&"string"!=typeof i.pId&&1<i.pId.length&&(e.productIdx=0),i.lineKey&&(e.lineKey=i.lineKey),null==e.ignoreCache&&i.ignoreCache&&(e.ignoreCache=!1),t||0==t?e.tab=t:i.tab&&(e.tab=i.tab),i.groupKey&&(e.groupKey=i.groupKey),i.aId&&(e.aId=i.aId)),e}},{key:"getAllProductIds",value:function(){var e=[],t=!0,i=!1,n=void 0;try{for(var o,r=this.currentTarget.configuredProducts[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;e.push(s.record.Id)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return e.join()}},{key:"createPathParams",value:function(e){return""!==this.optionId?["product","pc"]:"ProductLookup"===e?["product","lookup"]:["quote","le"]}},{key:"toggle",value:function(){this.viewport.isMobile()&&this.hasMultipleBundles&&this.$.bundles.toggle()}},{key:"isMobileViewport",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"_setIsMobileAndHasMultipleBundles",value:function(e,t){return e.isMobile()&&t}},{key:"getRequiredConfigurationAttributes",value:function(){if(this.requiredConfigAttributes)return this.requiredConfigAttributes;for(var e=this.currentTarget.configuredProducts,t={},i=0,n=e.length;i<n;i++){for(var o=e[i].configurationAttributes,r={},s=0,a=o.length;s<a;s++){var l=o[s];!0===l.required&&-1===Object.keys(r).indexOf(l.targetFieldName)&&(r[l.targetFieldName]=l)}t[i]=r}return this.requiredConfigAttributes=t,this.requiredConfigAttributes}},{key:"configurationAttributesValid",value:function(){for(var e=this.getRequiredConfigurationAttributes(),t={},i=this.currentTarget.configuredProducts,n=0,o=i.length;n<o;n++){var r=i[n].configuration.configurationData,s=e[n];for(var a in s)this.requiredConfigurationAttributeValid(r[a])||(t[a]=!0)}return this.requiredAttributeMissingValue=t,0===Object.keys(t).length}},{key:"getConfigurationAttributeMissingFeaturesMessage",value:function(){var e={};for(var t in void 0===this.requiredAttributeMissingValue&&this.getRequiredConfigurationAttributes(),this.requiredConfigAttributes)for(var i in this.requiredConfigAttributes[t])if(!0===this.requiredAttributeMissingValue[i]){var n=this.getFeatureNameFromId(this.requiredConfigAttributes[t][i].featureId);void 0!==n&&(e[n]=void 0)}var o=Object.keys(e);return 0===o.length?"":" in the following features: "+o}},{key:"getFeatureNameFromId",value:function(e){if(void 0!==e){var t=!0,i=!1,n=void 0;try{for(var o,r=this.currentTarget.configuredProducts[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value,a=!0,l=!1,u=void 0;try{for(var d,c=s.features[Symbol.iterator]();!(a=(d=c.next()).done);a=!0){var h=d.value;if(h.record.Id===e)return h.record.Name}}catch(e){l=!0,u=e}finally{try{!a&&c.return&&c.return()}finally{if(l)throw u}}}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}}}},{key:"requiredConfigurationAttributeValid",value:function(e){return!this.isNil(e)}},{key:"search",value:function(){this.$.bundles.toggleSearch()}},{key:"setOptionConfigurationDetails",value:function(e){if(this.topLevelBundle=e.currentIndex?e.configuredProducts[e.currentIndex]:e.configuredProducts[0],null==this.topLevelBundle.nestedOptionModel)return delete this.ctx.params.oId,this.nav("#",this.ctx.params,["product","pc"],!1);var t=this.topLevelBundle.nestedOptionModel.getCurrentLevel();this.topLevelBundle.nestedOptionModel&&t&&t.configured&&(this.$.optionConfigure.featureOptionalSKUs=this.buildDynamicConfigurations(t),this.$.optionConfigure.configuration=t),this.topLevelBundle.nestedOptionModel?this.$.optionConfigure.ignoreCache="ol"!==this.ctx.params.origin&&this.topLevelBundle.nestedOptionModel.descendLevel:this.$.optionConfigure.ignoreCache=!0,this.$.optionConfigure.product=void 0,this.$.optionConfigure.product=this.topLevelBundle}},{key:"buildDynamicConfigurations",value:function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e.optionConfigurations[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;if(a.isDynamicOption){var l=a.optionData;l.Id&&l[this.prefix+"Feature__c"]&&l[this.prefix+"OptionalSKU__c"]&&t.push(l[this.prefix+"Feature__c"]+":"+l[this.prefix+"OptionalSKU__c"]+":"+l.Id)}}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t}},{key:"preLoadObjects",value:function(){this.configuratorObjects=[this.prefix+"DiscountSchedule__c",this.prefix+"ProductOption__c",this.prefix+"QuoteLine__c"]}},{key:"getProductIds",value:function(){return this.ctx.params&&this.ctx.params.pId||""}},{key:"getLineKey",value:function(){return this.ctx.params?parseInt(this.ctx.params.lineKey||-1):-1}},{key:"getGroupKey",value:function(){return this.ctx.params?parseInt(this.ctx.params.groupKey||-1):-1}},{key:"getIgnoreCache",value:function(){return!!this.ctx.params&&"true"===this.ctx.params.ignoreCache}},{key:"getPrefix",value:function(){return this.app.org.prefix?this.app.org.prefix+"__":""}},{key:"getOptionId",value:function(){return this.ctx.params&&this.ctx.params.oId||""}},{key:"isNil",value:function(e){return null==e||""===e}},{key:"loadedModelIsReconfigure",value:function(e){return!e.quote&&1==e.configuredProducts.length}},{key:"clearStackTrace",value:function(){this.errors[0]&&(this.validationMessages=new o(this.errors).truncate(),this.spinner=!1)}},{key:"isReconfigure",value:function(e){return!e.selectedProducts}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior]}},{key:"listeners",get:function(){return{"errors-changed":"clearStackTrace"}}}]),a=e)),t("ProductConfig",a),Polymer(a)}}}),System.register("products/resources/model/nestedOptions/NestedOptionsModel.js",["products/resources/tree/ConfigTree.js"],function(e,t){var o,r;return{setters:[function(e){o=e.ConfigTree}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.init(e,t)}e("NestedOptionsModel",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(i,[{key:"init",value:function(e,t){this.path=[],this.descendLevel=!1,this.configTree=new o(e),this._setConfiguredOptionsObject(t)}},{key:"configure",value:function(e){var t=this.getLastFromPath(),i=this._getPreviousLevel();return e.index=e.index||t.index,e.optionId=e.optionId||t.optionId,void 0!==this.stagedOption&&(e.optionData=this.stagedOption.optionData||e.optionData,e.isDynamicOption=this.stagedOption.isDynamicOption||e.isDynamicOption||!1,delete this.stagedOption),(e=this._updateThenGetSubtree(e,i,!1)).staged=!0,e.configuredOptions=this.getConfiguredOptionsFromPath(),this.descendLevel=!1,e}},{key:"save",value:function(e,t){for(var i=0<arguments.length&&void 0!==e?e:[],n=t,o=this.getCurrentLevel(),r=0,s=i.length;r<s;r++)this._updateThenGetSubtree(i[r],o,!0,r);return n||this._setConfigured(o),o}},{key:"remove",value:function(e){var t=this.getCurrentLevel();!t.getChildren||t.getChildren().length<1||(e.optionId=e.record?e.record.Id:e.optionId,e.index=e.index||0,this._removeSubtree(e,this.getCurrentLevel()))}},{key:"cancel",value:function(){for(var e=this.getCurrentLevel(),t=e.getChildren(),i=0;i<t.length;)t[i].staged?this._removeConfiguration(e,i,t[i].nodeId):i++}},{key:"handleDescendantRules",value:function(e,i,t,n){var o=this,r=this.configTree.getFromPath(this.path.concat(e)),s=void 0;if(r){var a={};s=r.getChildren(),i.forEach(function(t){a[t.optionId]=void 0===a[t.optionId]?0:a[t.optionId]+1,t.index=a[t.optionId],void 0===s.find(function(e){return o._buildId(t)===e.nodeId})&&(o.configTree.buildSubtree(t),s.push(t))}),s.forEach(function(t){void 0===i.find(function(e){return t.nodeId===o._buildId(e)})&&o._removeSubtree(t,r)}),r=this._propagateRuleData(r,n,t)}}},{key:"getCurrentLevel",value:function(){return this.configTree.getFromPath(this.path)}},{key:"addToPath",value:function(e,t,i,n){this.path.push({optionId:e,optionalSKU:t,index:i,tabIndex:n}),this.descendLevel=!0}},{key:"popFromPathAndGetNextSKU",value:function(){this.path.pop(),this.descendLevel=!1;var e=this.getLastFromPath();return e?e.optionalSKU:e}},{key:"getLastFromPath",value:function(){return this.path[this.path.length-1]}},{key:"getConfiguredOptionsFromPath",value:function(){return this.configuredOptions[this._buildPathString(!0)]||{}}},{key:"_getPreviousLevel",value:function(){return this.configTree.getFromPath(this.path.slice(0,this.path.length-1))}},{key:"_setConfiguredOptionsObject",value:function(e){this.configuredOptions={},e&&(this._addConfigsToConfigurationObject(this.configTree.root,[]),this.configTree.root.configuredOptions=this.getConfiguredOptionsFromPath())}},{key:"_addConfigsToConfigurationObject",value:function(e,i){var n=this;e.getChildren().forEach(function(e){var t={optionId:e.optionId,index:e.index};n._addConfigsToConfigurationObject(e,i.concat([t]))}),this._setConfigured(e,i)}},{key:"_setConfigured",value:function(e,t){var i=this._buildPathString(!1,t);e.configured=!0,e.configurationEntered=!0,i&&(this.configuredOptions[i]=this.configuredOptions[i]||{},this.configuredOptions[i][e.nodeId]=!0)}},{key:"_updateThenGetSubtree",value:function(e,t,i,n){var o=this._findOnLevel(e,t);return o?(this._updateSubtree(o,e,i),o):(this._appendSubtree(e,t,n),e)}},{key:"_updateSubtree",value:function(e,t,i){i&&(delete e.staged,e.optionData=t.optionData,e.externalConfigurationData=t.externalConfigurationData),this._propagateRuleData(e,t.disabledOptionIds,t.hiddenOptionIds),this._propagateAttributes(e.configurationData,t.configurationData),this._mergeNestedConfigurations(t,e)}},{key:"_mergeNestedConfigurations",value:function(e,t){var i=this;if(0<e.optionConfigurations.length){var n={};e.optionConfigurations.forEach(function(e){n[e.optionId]=void 0===n[e.optionId]?0:n[e.optionId]+1,e.index=n[e.optionId],e.selected=!0,i._updateThenGetSubtree(e,t,!1)})}}},{key:"_propagateRuleData",value:function(e,t,i){e.disabledOptionIds=e.disabledOptionIds||t,e.hiddenOptionIds=e.hiddenOptionIds||i}},{key:"_propagateAttributes",value:function(t,i){Object.keys(i).forEach(function(e){t[e]=t[e]||i[e]})}},{key:"_appendSubtree",value:function(e,t,i){this._addIndexProperty(e,t),this.configTree.buildSubtree(e),null!=i?t.getChildren().splice(i,0,e):t.getChildren().push(e)}},{key:"_removeSubtree",value:function(e,t){var i=this._getChildIndexAndAdjustIndices(e.optionId,e.index,t.getChildren());0<=i&&this._removeConfiguration(t,i,this._buildId(e))}},{key:"_removeConfiguration",value:function(e,t,i){var n=this._buildPathString(!0);e.getChildren().splice(t,1),n&&this.configuredOptions[n]&&this.configuredOptions[n][i]&&!this._findOnLevel(i,e)&&delete this.configuredOptions[n][i]}},{key:"_findOnLevel",value:function(e,t){var i=e.constructor===String?e:this._buildId(e);return t.getChildren().find(function(e){return e.nodeId===i})}},{key:"_addIndexProperty",value:function(e,t){for(var i=e.index||0;this._findOnLevel({optionId:e.optionId,index:i},t);)i++;e.index=i}},{key:"_getChildIndexAndAdjustIndices",value:function(e,t,i){var n=0,o=-1,r=this._buildId({optionId:e,index:t}),s=!0,a=!1,l=void 0;try{for(var u,d=i[Symbol.iterator]();!(s=(u=d.next()).done);s=!0){var c=u.value;c.nodeId===r?o=n:c.optionId===e&&c.index>t&&this._alterIndexPropertyAndNodeId(c),n++}}catch(e){a=!0,l=e}finally{try{!s&&d.return&&d.return()}finally{if(a)throw l}}return o}},{key:"_alterIndexPropertyAndNodeId",value:function(e){var t=e.nodeId;e.index--,e.nodeId=this._buildId(e);var i=this._buildPathString(!0);i&&this.configuredOptions[i]&&(this.configuredOptions[i][e.nodeId]=!0,delete this.configuredOptions[i][t])}},{key:"_buildId",value:function(e){return"_"+e.optionId+"_"+e.index}},{key:"_buildPathString",value:function(e,t){for(var i=1<arguments.length&&void 0!==t?t:this.path,n=this.configTree.root.nodeId,o=e?0:1,r=0;r<i.length-o;r++)n+="-"+this._buildId(i[r]);return n}}]),r=i)),e("NestedOptionsModel",r)}}}),System.register("products/selection/filter/sb-suggester/Suggester.js",["../../../../common/Util.js","common/data/client/ServiceClient.js","common/core/AppContext.js","common/forms/sb-lookup/map/LookupNameMapper.js"],function(e,t){var g,r,v,i;return{setters:[function(e){g=e.Util},function(e){r=e.ServiceClient},function(e){e.AppContext},function(e){v=e.LookupNameMapper}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.prefix=e,this.searchModel=t,this.searchFilterData={},this.filterContext=i}e("Suggester",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(o,[{key:"buildFields",value:function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t.push(a.replace("Product2","ProcessInput__c"))}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t}},{key:"getSearchTable",value:function(){return this.prefix+"ProcessInput__c"}},{key:"getGroupKey",value:function(e){return e.record.Id}},{key:"setDefaultFilterValues",value:function(e,t){var c={},i=[],n=!0,o=!1,r=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value,u=!0,d=!1,h=void 0;try{for(var p,f=this.searchModel.quoteProcess.inputs[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var g=p.value;if(g.record.Id===l){this.searchModel.processInputValues[l]&&t&&this.isLookupType(t[l].model.type)&&this.searchModel.processInputValues[l][this.prefix+"Value__c"]&&i.push(this.queryLookupFilterName(this.searchModel.processInputValues[l][this.prefix+"Value__c"],t[l].model.referenceTo[0]));var y=null;y=this.searchModel.processInputValues[l]?this.searchModel.processInputValues[l][this.prefix+"Value__c"]||null:g.record[g.record[this.prefix+"InputField__c"]]||null,c[l]={value:y,hidden:!1,field:g.targetFieldName};break}}}catch(e){d=!0,h=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw h}}}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return new Promise(function(d){0===i.length?(this.searchFilterData=c,d(c)):Promise.all(i).then(function(e){var t=!0,i=!1,n=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value.records[0];if(s){var a=new v(s.attributes.type).getNameField();for(var l in c){var u=c[l];if(u.value&&u.value.substring(0,15)===s.Id.substring(0,15)){u.label=s[a];break}}}}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}this.searchFilterData=c,this.evaluateProcessInputConditions(),d(c)}.bind(this))}.bind(this))}},{key:"getFilterContext",value:function(){var e=JSON.parse(JSON.stringify(this.filterContext)),t=!0,i=!1,n=void 0;try{for(var o,r=e.inputs[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;this.searchFilterData[s.record.Id].hidden?(s.record[s.targetFieldName]=null,s.hidden=!0):this.searchFilterData[s.record.Id]&&(""===this.searchFilterData[s.record.Id].value?s.record[s.targetFieldName]=null:s.record[s.targetFieldName]=this.searchFilterData[s.record.Id].value)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}for(var a=e.inputs.length,l=0;l<a;l++)e.inputs[l].hidden&&(e.inputs.splice(l,1),a--,l--);return e}},{key:"getAdditionalProperties",value:function(){return null}},{key:"evaluateProcessInputConditions",value:function(){var e=JSON.parse(JSON.stringify(this.searchFilterData)),t=!0,i=!1,n=void 0;try{for(var o,r=this.filterContext.inputs[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value,a=0;if(0!==s.conditions.length){var l=!0,u=!1,d=void 0;try{for(var c,h=s.conditions[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var p=c.value,f=e[p[this.prefix+"MasterProcessInput__c"]].value;g.arithmeticOperatorConversion(f,p[this.prefix+"Value__c"],p[this.prefix+"Operator__c"])&&a++}}catch(e){u=!0,d=e}finally{try{!l&&h.return&&h.return()}finally{if(u)throw d}}"All"===s.record[this.prefix+"ConditionsMet__c"]?e[s.record.Id].hidden=!(a===s.conditions.length):e[s.record.Id].hidden=!(0<a)}else e[s.record.Id].hidden=!1}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}return this.searchFilterData=e}},{key:"runOnLoad",value:function(){var e=[],t=!0,i=!1,n=void 0;try{for(var o,r=this.searchModel.quoteProcess.inputs[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){var s=o.value;e.push(s.record.Id)}}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}this.setDefaultFilterValues(e)}},{key:"isLookupType",value:function(e){return"reference"===e||"id"===e}},{key:"queryLookupFilterName",value:function(e,t){var i=new v(t).getNameField(),n=e?"'"+e+"'":null;return(new r).query(("SELECT Id, "+i+" FROM "+t+" WHERE Id = ").concat(n))}}]),i=o)),e("Suggester",i)}}}),System.register("products/selection/routes/sb-product-lookup/ProductLookup.js",["common/core/Page.js","common/layout/fields/FieldSetHandler.js","common/filter/searcher/Searcher.js","products/selection/filter/sb-suggester/Suggester.js","common/core/sb-page-container/PageContainer.js","products/localization/LocalizeFields.js","common/data/format/ErrorFormatter.js","common/aggregate/quote-line-aggregator/QuoteLineAggregator.js","common/rules/RuleExecutor.js"],function(t,e){var i,o,r,s,a,l,u,d,c,h;return{setters:[function(e){i=e.Page},function(e){e.FieldSetHandler},function(e){o=e.Searcher},function(e){r=e.Suggester},function(e){s=e.PageContainer},function(e){a=e.LocalizeFields},function(e){l=e.ErrorFormatter},function(e){u=e.QuoteLineAggregator},function(e){e.RuleExecutor}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}d=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},c=["#gslayout","#pflayout"],t("ProductLookup",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),d(e,[{key:"beforeRegister",value:function(){this.is="sb-product-lookup",this.properties=Polymer.Base.extend({selectedProducts:{type:Object,value:{}},lineEditorModel:Object,redirectUrl:String,hiddenByGroup:{type:Object,value:{}},totalCount:String,hasTotalCount:Boolean,quote:Object,internal:{type:Boolean,value:!1},viewport:{type:Object,value:function(){return s.getViewport()}},errors:{type:Array,value:[],notify:!0},error:{type:Array,value:[]},isMobile:{type:Boolean,computed:"_setIsMobile(viewport)"},searchContext:String,searchedValue:String,filterContext:Object,searcher:Object},i.properties)}},{key:"modal",value:function(){!this.modalActive&&this.hasQuoteProcess?(this.$.selectionSaver.save({uid:this.quote.record.Id,model:{modalActive:!0}}),this.toggleClass("modaloverflow",!0,this),this.$.modal.show=!0,this.refocus()):(this.hasQuoteProcess||this.setPanelDisplay("#pflayout"),!0===this.lineEditorModel.settings.openSearchFilterByDefault&&this.toggleFilter(),this.panelSuggester=this.suggester,this.panelGroupItems=this.groupItems)}},{key:"ready",value:function(){this.preLoadObjects(),this.handleClearSelected(),this.handleSelectButtonClickedServerResponseAndNavigation(),this.$.lookupLayout.additionalFields=["PricebookEntry.UnitPrice"],this.$.modal.addEventListener("sb-gs-modal-close",this.closeDialog.bind(this)),this.$.drawer.addEventListener("transitionend",this.refocus.bind(this)),this.$.modal.addEventListener("filter-item-value-changed",this.handleLabelChanged.bind(this)),this.addEventListener("iron-deselect",this.handleDrawerClosed.bind(this)),this.addEventListener("clear-filters",this.clearFilterFields),this.addEventListener("sb-type-clear",this.resetSearchBar),this.attachSearchBarEventListeners()}},{key:"handleTransientCache",value:function(){this.$.selectionReader.read({uid:this.quote.record.Id}).then(function(e){this.lastSubmit=e?e.lastSubmit:null,this.modalActive=!!e&&e.modalActive,"gs"===this.lastSubmit?(this.suggester.runOnLoad(),this.runSuggester()):"pf"===this.lastSubmit&&(this.searcher.runOnLoad(e.filterValues),this.runSearcher())}.bind(this))}},{key:"handleProductsLoadServerResponse",value:function(){this.$.qo.addEventListener("line-editor-model-changed",function(e){this.lineEditorModel=e.detail.value,this.quote=e.detail.value.quote,this.inputField=this.prefix+"InputField__c",this.localizer=new a(this.prefix);var t=parseInt(this.ctx.params.groupKey),i=this.getQuoteProcessId(this.quote,t);this.hasQuoteProcess=null!==i,!0===this.hasQuoteProcess?this.setPanelDisplay("#gslayout"):this.setPanelDisplay("#pflayout"),this.ctx.params.aId&&(this.$.smLoadService.actionId=this.ctx.params.aId),this.$.smLoadService.processId=i,this.$.smLoadService.quote=this.$.smSelectService.quote=this.quote}.bind(this)),this.$.smLoadService.addEventListener("search-model-changed",function(e){var t=this.localizer.localizeSearchModel(e.detail.value);this.setFilterButtonState(t),this.onLoadSearchModel||(this.onLoadSearchModel=Object.assign({},t)),this.$.lookupLayout.groupByField=t.productResultsGroupFieldName,this.$.lookupLayout.fieldPrefix=t.targetObjectName+".",this.quoteProcess=t.quoteProcess,this.searchModel=t,this.buildDelegator(),this.handleTransientCache()}.bind(this))}},{key:"getQuoteProcessId",value:function(e,t){var i=void 0,n=!0,o=!1,r=void 0;try{for(var s,a=e.lineItemGroups[Symbol.iterator]();!(n=(s=a.next()).done);n=!0){var l=s.value;if(l.key===t){i=l.record[this.prefix+"QuoteProcess__c"];break}}}catch(e){o=!0,r=e}finally{try{!n&&a.return&&a.return()}finally{if(o)throw r}}return i||e.record[this.prefix+"QuoteProcessId__c"]||null}},{key:"attachSearchBarEventListeners",value:function(){this.addEventListener("sb-search-invoked",this.searchBarResultsChanged.bind(this)),this.addEventListener("sb-search-item-selected",this.searchBarItemSelected.bind(this)),this.addEventListener("sb-search-reset-clicked",this.searchBarResetClicked.bind(this)),this.addEventListener("sb-search-nil-search-invoked",this.searchBarNilSearchInvoked.bind(this))}},{key:"handleSelectButtonClickedServerResponseAndNavigation",value:function(){this.$.smSelectService.addEventListener("result-changed",function(e){this._updateQuote(e.detail.value.quote),0==e.detail.value.configuredProducts.length&&this.handleNonConfigurableProducts(e),0<e.detail.value.configuredProducts.length&&this.handleConfigurableProducts(e)}.bind(this))}},{key:"handleNonConfigurableProducts",value:function(e){"LineEditor"===this.redirectUrl?this.navigateToLineEditor():"ProductLookup"===this.redirectUrl&&(this.$.smSelectService.quote=e.detail.value.quote,this.$.lookupLayout.deSelectAll(),this.navigateToSelf(),this.spinner=!1)}},{key:"handleConfigurableProducts",value:function(e){var t={};e.detail.value.selectedProducts=this.selectedProducts;var i=this.getConfigProductIds(e);t.qId=e.detail.value.quote.record.Id,void 0!==this.ctx.params.groupKey&&(t.groupKey=this.ctx.params.groupKey),void 0!==this.ctx.params.aId&&(t.aId=this.ctx.params.aId),t.pId=i,t.redirectUrl=this.redirectUrl,t.open=0,this.nav("#",t,["product","pc"],!1)}},{key:"_updateQuote",value:function(e){if(e.partialVO){var t=this.lineEditorModel.quote.lineItems;e.lineItems=t.concat(e.lineItems),delete e.existingProductIds,delete e.segmentTemplatesByDimensionTypeByGroupKey,delete e.emptyGroupKeys,e.partialVO=!1}this.lineEditorModel.quote=e}},{key:"handleLabelChanged",value:function(e){this.searchFilterData&&(this.searchFilterData[e.detail.item].label=e.detail.value)}},{key:"buildDelegator",value:function(){this.hasQuoteProcess&&(this.suggester=new r(this.prefix,this.searchModel,this.quoteProcess)),this.searcher||(this.searcher=new o(this.searchModel))}},{key:"handleValueChanged",value:function(){this.internal||(this.internal=!0,this.updateSearchFilterData(),this.internal=!1)}},{key:"updateSearchFilterData",value:function(){this.suggester.searchFilterData=this.searchFilterData;var e=this.suggester.evaluateProcessInputConditions();this.searchFilterData=e}},{key:"setPanelDisplay",value:function(i){var n=this;c.forEach(function(e){var t=i===e;n.toggleClass("hidden-panel",!t,n.$$(e)),n.toggleClass("visible-panel",t,n.$$(e))})}},{key:"toggleFilter",value:function(){this.togglePanel("pflayout")}},{key:"toggleGuidedSelling",value:function(){this.togglePanel("gslayout")}},{key:"togglePanel",value:function(e){this.$$("sb-page-header")._closeMenu(),this.$$(".visible-panel").id!==e&&"main"!==this.$.drawer.selected||this.$.drawer.togglePanel(),this.setPanelDisplay("#"+e),this.refocus()}},{key:"closeDrawer",value:function(){this.refocus(),this.$.drawer.closeDrawer()}},{key:"refocus",value:function(){this.$$(".visible-panel")&&(this.$.modal.show?this.$.modalGroup.focusFirstField():"gslayout"===this.$$(".visible-panel").id?this.$.gs.focusFirstField():"pflayout"===this.$$(".visible-panel").id&&this.$.pf.focusFirstField())}},{key:"reverseFocus",value:function(){this.$$(".visible-panel")&&(this.$.modal.show?this.$.suggest.focus():"gslayout"===this.$$(".visible-panel").id?this.$.cleargs.focus():"pflayout"===this.$$(".visible-panel").id&&this.$.clearfilter.focus())}},{key:"closeDialog",value:function(){this.toggleClass("modaloverflow",!1,this),this.suggester.skipDefaults=!0,this.panelSuggester=this.suggester,this.panelGroupItems||(this.panelGroupItems=this.groupItems),this.$.modal.show=!1}},{key:"suggestClicked",value:function(){this.suggest=!0,this.runSuggester()}},{key:"runSuggester",value:function(){this.searchContext=this.searchedValue,this.saveCache(),this.lastSubmit="gs",this.closeDialog(),this.$.gs.runService(),this.closeDrawer()}},{key:"runSearcher",value:function(){this.searchContext=this.searchedValue,this.saveCache(),this.lastSubmit="pf",this.$.pf.actionId=this.ctx.params.aId,this.searchContext=this.searchedValue,this.filterContext=this.$.pf.filterDelegator.getFilterContext(),this.$.pf.runService(),this.closeDrawer()}},{key:"saveCache",value:function(){this.$.selectionSaver.save({uid:this.quote.record.Id,model:{modalActive:!0,lastSubmit:this.$$(".visible-panel").id.substring(0,2),filterValues:this.searcher.searchFilterData}})}},{key:"setFilterButtonState",value:function(e){if(0!==e.searchFilters.length){var t=!0,i=!1,n=void 0;try{for(var o,r=e.searchFilters[Symbol.iterator]();!(t=(o=r.next()).done);t=!0)if(!o.value.hidden)return}catch(e){i=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(i)throw n}}this.removeFilter()}else this.removeFilter()}},{key:"removeFilter",value:function(){this.$$("#fb").disabled=!0}},{key:"getConfigProductIds",value:function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e.detail.value.configuredProducts[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t.push(a.record.Id)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t.join(",")}},{key:"onSelect",value:function(){this.redirectUrl="LineEditor",this.selectedProducts&&0<Object.keys(this.selectedProducts).length?(this._addAggregateDataIfThresholdExceeded(),this.spinner=!0,this.quoteProcess&&(this.$.smSelectService.quoteProcess=this.suggester.getFilterContext()),this.$.smSelectService.selectedProductList=this.getOrderedSelectedProducts()):this.navigateToLineEditor()}},{key:"onSelectMore",value:function(){this.redirectUrl="ProductLookup",this.selectedProducts&&0<Object.keys(this.selectedProducts).length?(this._addAggregateDataIfThresholdExceeded(),this.spinner=!0,this.quoteProcess&&(this.$.smSelectService.quoteProcess=this.suggester.getFilterContext()),this.$.smSelectService.selectedProductList=this.getOrderedSelectedProducts()):this.navigateToSelf()}},{key:"_addAggregateDataIfThresholdExceeded",value:function(){var e=this.lineEditorModel.settings.largeQuoteThreshold;if(null!=e&&this.quote.lineItems.length>e){this.$.smSelectService.stripQuoteLines=!0;var t=this.lineEditorModel.customLabels.msg_large_quote_sent_without_lines;t=t.replace("{0}",this.lineEditorModel.quote.record.Id).replace("{1}",e),console.log(t);var i=new u(this.quote);this.quote.existingProductIds=i.getExistingProductIdsFromLines();var n=this.ctx.params.groupKey,o=i.getSegmentTemplatesByDimensionTypeForGroupKey(n);this.quote.segmentTemplatesByDimensionTypeByGroupKey={},this.quote.segmentTemplatesByDimensionTypeByGroupKey[(n||-1)+""]=o,this.quote.emptyGroupKeys=i.getKeysOfEmptyGroups()}}},{key:"getOrderedSelectedProducts",value:function(){var e=Object.keys(this.selectedProducts).sort(function(e,t){return this.selectedProducts[e].index-this.selectedProducts[t].index}.bind(this)),t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value,l=this.selectedProducts[a];l.invalid||(delete l.record.UnitPrice,t.push(l))}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t}},{key:"onCancel",value:function(){this.spinner=!0;var e={qId:this.quote.record.Id};null!=this.ctx.params.groupKey&&(e.groupKey=this.ctx.params.groupKey),this.nav("#",e,["quote","le"],!1)}},{key:"navigateToLineEditor",value:function(){var e={qId:this.quote.record.Id};0<Object.keys(this.selectedProducts).length&&(e.jspr=!0),null!=this.ctx.params.groupKey&&(e.groupKey=this.ctx.params.groupKey),this.nav("#",e,["quote","le"],!1)}},{key:"navigateToSelf",value:function(){var e=this.ctx.params.aId?"&aId="+this.ctx.params.aId:"";this.fire("iron-signal",{name:"sb-navigation-changed",data:{url:"#",location:"#/product/lookup?qId="+this.quote.record.Id+e}}),this.$.plSelectMore.blur()}},{key:"navToFavorites",value:function(){var e={qId:this.quote.record.Id};void 0!==this.ctx.params.groupKey&&(e.groupKey=this.ctx.params.groupKey),void 0!==this.ctx.params.aId&&(e.aId=this.ctx.params.aId),this.nav("#",e,["favorite","lookup"],!1)}},{key:"handleAutoSelect",value:function(){if(this.suggest&&this.quoteProcess&&this.quoteProcess.record[this.prefix+"ProductAutoSelected__c"]&&1===this.searchModel.results.length){var e=this.searchModel.results[0];this.selectedProducts[e.record.Product2Id]={record:{Id:e.record.Product2Id,attributes:e.record.attributes,UnitPrice:e.record.UnitPrice},invalid:!1},this.suggest=!1,this.onSelect()}}},{key:"handleClearSelected",value:function(){this.addEventListener("suggestion-loaded",function(){this.$.lookupLayout.deSelectAll()}.bind(this))}},{key:"handleDrawerClosed",value:function(){"main"===this.$.drawer.selected&&this.fire("iron-signal",{name:"sb-panel-closed"})}},{key:"clearFilterFields",value:function(){this.filterData=this.searcher.clearFields()}},{key:"clearGSFields",value:function(){var e=JSON.parse(JSON.stringify(this.suggester.searchFilterData));for(var t in e)e[t].value=null;this.suggester.searchFilterData=e,this.searchFilterData=this.suggester.evaluateProcessInputConditions()}},{key:"bindFilterEnterCallBacks",value:function(){this.$.pf.enterCallback=this.runSearcher.bind(this),this.$.gs.enterCallback=this.runSuggester.bind(this),this.$.modalGroup.enterCallback=this.runSuggester.bind(this)}},{key:"searchBarResultsChanged",value:function(e){var t=e.detail.searchModel,i=e.detail.searchValue;this.searchContext=i,this.searchedValue=i,this.$$("#headersearch").toggleResetButton(!0),void 0!==t&&(this.searchModel=t)}},{key:"searchBarItemSelected",value:function(e){var t=e.detail.item,i=Object.assign({},this.searchModel),n=e.detail.searchValue;this.searchContext=n,this.searchedValue=n,void 0!==t&&(this.$$("#headersearch").toggleResetButton(!0),i.results=[t],i.totalCount=1,this.searchModel=i)}},{key:"searchBarResetClicked",value:function(){this.searchContext="",this.searchedValue="",this.$$("#headersearch").toggleResetButton(!1),this.searchModel=Object.assign({},this.onLoadSearchModel)}},{key:"searchBarNilSearchInvoked",value:function(){this.searcher.hasSearchFilterValues()?this.runSearcher():this.searchBarResetClicked()}},{key:"resetSearchBar",value:function(){this.searchContext="",this.searchedValue=""}},{key:"preLoadObjects",value:function(){this.lookupObjects=["Product2","PricebookEntry",this.prefix+"ProcessInput__c"]}},{key:"isMobileViewport",value:function(){return this.viewport&&this.viewport.isMobile()}},{key:"clearStackTrace",value:function(){this.errors[0]&&(this.error=new l(this.errors).truncate(),this.spinner=!1)}},{key:"_setIsMobile",value:function(e){if(e)return e.isMobile()}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.LookupBehavior]}},{key:"observers",get:function(){return["handleAutoSelect(searchModel)","modal(quote, modalActive)","handleValueChanged(searchFilterData.*)"]}},{key:"listeners",get:function(){return{"errors-changed":"clearStackTrace"}}},{key:"prefix",get:function(){return this.app.org.prefix?this.app.org.prefix+"__":""}}]),h=e)),t("ProductLookup",h),Polymer(h)}}}),System.register("quotes/layout/sb-le-summary-row/sb-le-summary-cell/LESummaryCell.js",[],function(t,e){var i;return{setters:[],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("LESummaryCell",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-le-summary-cell",this.properties={model:Object,item:String,summaries:Object}}},{key:"_getMD",value:function(e,t){return e.md.fieldsMap[e.data.quoteLineObjectName][t]}},{key:"_updateCurrency",value:function(e,t){this._getMD(e.editorModel,t).CurrencyIsoCode=e.quoteModel.quoteVO.record.CurrencyIsoCode}},{key:"_getValue",value:function(e,t){return e[t.toLowerCase()]}},{key:"_setWidthStyle",value:function(e,t){this.style.minWidth=e.Standard[t]+"px",this.style.maxWidth=this.style.minWidth}},{key:"observers",get:function(){return["_updateCurrency(model, item)","_setWidthStyle(model.colWidth, item)"]}}]),i=e)),t("LESummaryCell",i),Polymer(i)}}}),System.register("quotes/layout/sb-line-editor-tabs/sb-group-tabs/GroupTabs.js",["common/core/AppContext.js"],function(t,e){var i,o;return{setters:[function(e){i=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("GroupTabs",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-group-tabs",this.properties={isGroupFieldPage:{type:Boolean,computed:"_setIsGroupFieldPage(pageType)"},isSegmentedLinesPage:{type:Boolean,computed:"_setIsSegmentedLinesPage(pageType)"},isStandardLinesPage:{type:Boolean,computed:"_setIsStandardLinesPage(pageType)"},editorModel:{notify:!0,type:Object}}}},{key:"buildPage",value:function(){this.groupModel&&(this.pageType=this.attributes.label.value,this.ui3Enabled=i.org.isUI3Enabled||!1,this.pageComponent=this.ui3Enabled?"sf-segmented-table":"sb-segmented-lines",this.groupObjectName=this.groupModel.groupObjectName,this.groupModel.groupMDQTabs&&(this.tabs=this.groupModel.groupMDQTabs),this.hideTabs=!!this.tabs&&1==this.tabs.length&&"Custom"!=this.tabs[0].key,this.containerClass=this.groupModel.editorModel.largeQuoteExperienceEnabled?"largeQuote":"")}},{key:"_setIsGroupFieldPage",value:function(e){return"details"===e}},{key:"_setIsStandardLinesPage",value:function(e){return"standard"===e}},{key:"_setIsSegmentedLinesPage",value:function(e){return"segmented"===e}},{key:"observers",get:function(){return["buildPage(groupModel)"]}}]),o=e)),t("GroupTabs",o),Polymer(o)}}}),System.register("quotes/layout/sb-line-editor-tabs/sb-quote-tabs/QuoteTabs.js",["common/core/sb-page-container/PageContainer.js","common/core/AppContext.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.PageContainer},function(e){o=e.AppContext}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("QuoteTabs",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-quote-tabs",this.properties={isQuoteFieldPage:{type:Boolean,computed:"_setIsQuoteFieldPage(pageType)"},isGroupsPage:{type:Boolean,computed:"_setIsGroupsPage(pageType)"},isSegmentedLinesPage:{type:Boolean,computed:"_setIsSegmentedLinesPage(pageType)"},isStandardLinesPageUI2:{type:Boolean,computed:"_setIsStandardLinesPageUI2(pageType)"},isStandardLinesPageUI3:{type:Boolean,computed:"_setIsStandardLinesPageUI3(pageType)"},editorModel:{notify:!0,type:Object},groupModels:{notify:!0,type:Object},viewport:{type:Object,value:function(){return i.getViewport()}},ui3Enabled:Boolean,segmentedCompName:String}}},{key:"_groupModelsChanged",value:function(e){if(1==this.groupModels.length&&"groupModels"!=e.path&&!this.groupModels[0].quoteModel.grouped){var t=e.path.split("."),i=t.splice(2,t.length).join(".");this.set("groupModel."+i,e.value)}}},{key:"ready",value:function(){this.handleResize(),this.ui3Enabled=o.org.isUI3Enabled||!1,this.segmentedCompName=this.ui3Enabled?"sf-segmented-table":"sb-segmented-lines"}},{key:"attached",value:function(){this.resize()}},{key:"buildPage",value:function(){this.groupModels&&(this.pageType=this.attributes.label.value,"details"!=this.pageType&&"groups"!=this.pageType&&(this.groupModel=this.groupModels[0],this.quoteModel=this.groupModel.quoteModel),"segmented"==this.pageType&&this.groupModel.quoteMDQTabs&&(this.segmentedTabs=this.groupModel.quoteMDQTabs),this.hideTabs=!!this.segmentedTabs&&1==this.segmentedTabs.length&&"Custom"!=this.segmentedTabs[0].key,this.resize())}},{key:"viewportChanged",value:function(e){this.viewport=e.detail.viewport}},{key:"handleResize",value:function(){window.addEventListener("resize",function(e){this.resize()}.bind(this))}},{key:"resize",value:function(){if(this.domHost){var e=1==this.domHost.tabs.length&&"Custom"!=this.domHost.tabs[0].key?0:43;this.layoutHeight=this.domHost.getBoundingClientRect().height-e+"px",Polymer.dom(this).parentNode.style.height=this.layoutHeight}}},{key:"_setIsQuoteFieldPage",value:function(e){return"details"===e}},{key:"_setIsGroupsPage",value:function(e){return"groups"===e}},{key:"_setIsStandardLinesPageUI2",value:function(e){return"standard"===e&&!o.org.isUI3Enabled}},{key:"_setIsStandardLinesPageUI3",value:function(e){return"standard"===e&&o.org.isUI3Enabled}},{key:"_setIsSegmentedLinesPage",value:function(e){return"segmented"===e}},{key:"behaviors",get:function(){return[window.CommonBehaviors.DeviceBehavior]}},{key:"observers",get:function(){return["buildPage(groupModels)","_groupModelsChanged(groupModels.*)"]}}]),r=e)),t("QuoteTabs",r),Polymer(r)}}}),System.register("subscriptions/selection/routes/sb-subscription-lookup/SubscriptionLookup.js",["../../../../common/core/Page.js","common/layout/fields/FieldSetHandler.js","common/layout/tables/TableClassBuilder.js","common/filter/searcher/Searcher.js","common/data/format/ErrorFormatter.js","../../../../common/data/client/ConnectionClient.js"],function(t,e){var i,o,r,d,s,a;return{setters:[function(e){i=e.Page},function(e){e.FieldSetHandler},function(e){e.TableClassBuilder},function(e){o=e.Searcher},function(e){r=e.ErrorFormatter},function(e){d=e.ConnectionClient}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}s=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e},t("SubscriptionLookup",(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(e,i),s(e,[{key:"beforeRegister",value:function(){this.is="sb-subscription-lookup",this.properties=Polymer.Base.extend({selectedProducts:{type:Object,value:{}},lineEditorModel:Object,totalCount:String,hasTotalCount:String,errors:{type:Array,value:[],notify:!0},error:{type:Array,value:[]}},i.properties)}},{key:"ready",value:function(){this.preLoadObjects(),this.handleSelectButtonClickedServerResponseAndNavigation()}},{key:"handleProductsLoadServerResponse",value:function(){this.$.qo.addEventListener("line-editor-model-changed",function(e){this.lineEditorModel=e.detail.value,this.quote=this.$.smLoadService.quote=this.$.smSelectService.quote=e.detail.value.quote}.bind(this)),this.$.smLoadService.addEventListener("search-model-changed",function(e){this.searchModel=e.detail.value,this.primaryMobileColumn=this.searchModel.resultFieldNames[0],this.searcher=new o(this.searchModel),this.hasTotalCount=0<this.searchModel.totalCount,this.totalCount=this.searchModel.totalCount,this.maxSelectAll=this.lineEditorModel.settings.usesClientAmendRenew?500:100}.bind(this))}},{key:"handleSelectButtonClickedServerResponseAndNavigation",value:function(){this.$.smSelectService.addEventListener("result-changed",function(e){var t=this.lineEditorModel.quote.lineItems;this.lineEditorModel.quote=e.detail.value,this.lineEditorModel.settings.usesClientCalculator&&(this.lineEditorModel.quote.lineItems=t.concat(this.lineEditorModel.quote.lineItems)),this.navigateToLineEditor()}.bind(this))}},{key:"refocus",value:function(){this.$.sf.focusFirstField()}},{key:"toggleFilter",value:function(){this.$$("sb-page-header")._closeMenu(),this.$.drawer.togglePanel()}},{key:"removeFilter",value:function(){this.$$(".actions").removeChild(this.$$("#fb"))}},{key:"closeDrawer",value:function(){this.refocus(),this.$.drawer.closeDrawer()}},{key:"getConfigProductIds",value:function(e){var t=[],i=!0,n=!1,o=void 0;try{for(var r,s=e.detail.value.configuredProducts[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var a=r.value;t.push(a.record.Id)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}return t.join(",")}},{key:"deSelectAll",value:function(){this.$.lookupLayout.deSelectAll()}},{key:"onSelect",value:function(){var u=this;if(this.spinner=!0,this.selectedProducts&&0<Object.keys(this.selectedProducts).length){if(this.lineEditorModel.settings.usesClientAmendRenew)return new Promise(function(s,a){if(SB&&SB.JSARSettings&&SB.JSARServices&&SB.JSARLineGenManager){var l=new SB.JSARSettings(u.app.orgPrefix,u.lineEditorModel.amendRenewSettings);new d(u.app.orgPrefix).getConnection().then(function(e){var t=new SB.JSARServices(e,l),i=new SB.JSARLineGenManager(e,l,t),n=u.lineEditorModel.quote,o="Renewal"===n.record[u.prefix+"Type__c"],r=Object.keys(u.selectedProducts);(o?i.renewSubscriptionsToQuote(r,n):i.amendSubscriptionsToQuote(r,n)).then(function(e){s(e)},function(e){a(e.message||e)})},function(e){a(e.message||e)})}else a("ERROR: Could not find Client-Side Amend/Renew")}).then(function(e){e.calculationRequired=!0,u.lineEditorModel.quote=e,u.navigateToLineEditor()},function(e){u.errors=[e]});this.$.smSelectService.selectedProducts=this.selectedProducts}else this.navigateToLineEditor()}},{key:"onCancel",value:function(){this.spinner=!0;var e={qId:this.lineEditorModel.quote.record.Id};null!=this.ctx.params.groupKey&&(e.groupKey=this.ctx.params.groupKey),this.nav("#",e,["quote","le"],!1)}},{key:"navigateToLineEditor",value:function(){var e={qId:this.lineEditorModel.quote.record.Id};0<Object.keys(this.selectedProducts).length&&(e.jspr=!0),null!=this.ctx.params.groupKey&&(e.groupKey=this.ctx.params.groupKey),this.nav("#",e,["quote","le"],!1)}},{key:"runSearcher",value:function(){this.$$("#submit").focus(),this.$.sf.runService(),this.closeDrawer()}},{key:"preLoadObjects",value:function(){this.subscriptionLookupObjects=[this.prefix+"Subscription__c","Contract"]}},{key:"bindFilterEnterCallBacks",value:function(){this.$.sf.enterCallback=this.runSearcher.bind(this)}},{key:"clearFilterFields",value:function(){this.filterData=this.searcher.clearFields()}},{key:"clearStackTrace",value:function(){this.errors[0]&&(this.error=new r(this.errors).truncate(),this.spinner=!1)}},{key:"behaviors",get:function(){return[sb.common.core.Page,window.CommonBehaviors.DeviceBehavior,window.CommonBehaviors.LookupBehavior]}},{key:"listeners",get:function(){return{"errors-changed":"clearStackTrace"}}},{key:"prefix",get:function(){return this.app.org.prefix?this.app.org.prefix+"__":""}}]),a=e)),t("SubscriptionLookup",a),Polymer(a)}}}),System.register("products/config/routes/services/sb-pc-option-configure/OptionConfigurator.js",["common/data/format/DataBuilder.js"],function(t,e){var i,o;return{setters:[function(e){i=e.DataBuilder}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("OptionConfigurator",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-pc-option-configure",this.properties={quote:Object,product:Object,optionId:String,featureOptionalSKUs:{type:Array,value:[]},ignoreCache:{type:Boolean,value:!1},configuration:Object,error:{type:Array,notify:!0},optionConfiguratorResponse:{type:String,notify:!0}}}},{key:"ready",value:function(){var e=this.$.service;e.addEventListener("response-changed",function(e){this.optionConfiguratorResponse=e.detail.value}.bind(this)),e.addEventListener("error-changed",function(e){e.detail.value&&(e.detail.value.validations?this.error=e.detail.value.validations:this.error=[e.detail.value.message]),console.log(e.detail)}.bind(this))}},{key:"load",value:function(){this.$.service.uid=this.optionId,this.$.service.ignoreCache=this.ignoreCache;var e=this.quote.lineItems;this.quote.lineItems=[];var t=(new i).addQuote("quote",this.quote).add("optionId",this.optionId).add("featureOptionalSKUs",this.featureOptionalSKUs).addObject("configuration",this.configuration).addObject("parentProduct",this.serverProduct).addObject("stagedOption",this.stagedOption);this.quote.lineItems=e,this.$.service.context=t.build()}},{key:"observers",get:function(){return["load(quote, product, optionId, ignoreCache)"]}},{key:"serverProduct",get:function(){var e={};return e.configurationAttributes=this.product.configurationAttributes,e.inheritedConfigurationAttributes=this.product.inheritedConfigurationAttributes,void 0===this.product.configuration||(e.configuration={configurationData:this.product.configuration.configurationData,inheritedConfigurationData:this.product.configuration.inheritedConfigurationData}),e}},{key:"stagedOption",get:function(){return null==this.product.nestedOptionModel||null==this.product.nestedOptionModel.stagedOption||this.product.nestedOptionModel.stagedOption.isDynamicOption?null:this.product.nestedOptionModel.stagedOption.optionData}}]),o=e)),t("OptionConfigurator",o),Polymer(o)}}}),System.register("products/config/routes/services/sb-pc-option-save/OptionSaver.js",["common/data/format/DataBuilder.js","common/aggregate/quote-line-aggregator/QuoteLineAggregator.js","common/data/minimize/QuoteMinimizer.js","common/aggregate/quote-aggregator/QuoteAggregator.js"],function(t,e){var i,o,r,s,a;return{setters:[function(e){i=e.DataBuilder},function(e){o=e.QuoteLineAggregator},function(e){r=e.QuoteMinimizer},function(e){s=e.QuoteAggregator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("OptionSaver",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-pc-option-save",this.properties={quote:Object,products:Array,configuration:Object,upgradeAssetId:String,groupKey:{type:Number,value:-1},error:{type:Array,notify:!0},psmResponse:{type:String,notify:!0},background:{type:Boolean,value:!0},stripLinesThreshold:Number,stripLinesMessage:String,cache:String}}},{key:"ready",value:function(){this.$.service.addEventListener("response-changed",function(e){var t=e.detail.value.quote;if(t&&t.partialVO){var i=new s(this.quote,t,this.requiredKeys);e.detail.value.quote=i.reconcileServerQuoteWithUIQuote()}this.psmResponse=e.detail.value}.bind(this)),this.$.service.addEventListener("error-changed",function(e){e.detail.value&&(e.detail.value.validations?this.error=e.detail.value.validations:this.error=[e.detail.value.message]),console.log(e.detail)}.bind(this))}},{key:"topLevelSave",value:function(){void 0!==this.cache&&(this.$.service.uid=this.quote.record.Id.substring(0,15)),this.$.service.warningCallback=function(e){var t=e.detail.value.validationMessages;console.log(t)};var e=new i;if(e.addObject("products",this.products),null!=this.groupKey&&0<=this.groupKey&&e.add("groupKey",this.groupKey),null==this.stripLinesThreshold||this.quote.lineItems.length<this.stripLinesThreshold)e.addQuote("quote",this.quote),this.$.service.model=e.build();else{var t=new r(this.quote,this.products,this.groupkey,this.stripLinesThreshold,this.stripLinesMessage);this.quote=t.reduceQuote(),this.requiredKeys=t.getRequiredKeys(),e.addQuote("quote",this.quote),this.$.service.model=e.build(),this.quote=t.revertQuote()}}},{key:"nestedConfigurationSave",value:function(){void 0!==this.cache&&(this.$.service.uid=this.quote.record.Id.substring(0,15)),this.$.service.warningCallback=function(e){var t=e.detail.value.validationMessages;console.log(t)},this.quote.priorBundledQuantityByLineKey=new o(this.quote).mapPriorBundledQuantityByLineKey();var e=this.quote.lineItems;this.quote.lineItems=null;var t=(new i).addQuote("quote",this.quote).addObject("configuration",this.configuration).add("upgradeAssetId",null);this.quote.lineItems=e,delete this.quote.priorBundledQuantityByLineKey,this.$.service.model=t.build()}},{key:"observers",get:function(){return["topLevelSave(quote, products)","nestedConfigurationSave(quote, configuration)"]}}]),a=e)),t("OptionSaver",a),Polymer(a)}}}),System.register("products/config/routes/services/sb-pc-product-load/ProductLoader.js",["common/data/format/DataBuilder.js"],function(t,e){var r,i;return{setters:[function(e){r=e.DataBuilder}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ProductLoader",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-pc-product-load",this.properties={productIds:{type:String,value:""},lineKey:{type:Number,value:-1},featureOptionIds:{type:Array,value:null},groupKey:{type:Number,value:-1},fieldSet:{type:String,value:null},quote:Object,product:{type:Object,notify:!0},error:{type:Array,notify:!0},productLoadModel:{type:Object,notify:!0},ignoreCache:{type:Boolean,value:!1}}}},{key:"ready",value:function(){this.$.service.addEventListener("response-changed",function(e){this.featureOptionIds=null,this.productLoadModel=e.detail&&e.detail.value?e.detail.value:null}.bind(this)),this.$.service.addEventListener("error-changed",function(e){e.detail.value&&(e.detail.value.validations?this.error=e.detail.value.validations:this.error=[e.detail.value.message]),console.log(e.detail)}.bind(this))}},{key:"load",value:function(){if(null!=this.lineKey&&0<=this.lineKey&&this.lineKey>this.quote.nextKey)return this.productLoadModel={returnToQuote:"The quote line you are attempting to reconfigure does not exist. Please add the product again to configure it."};var t=[];this.productIds.split(",").forEach(function(e){t.push({record:{Id:e}})}),this.$.service.context=void 0,this.$.service.uid=this.featureOptionIds?"dynamic":this.quote.record.Id.substring(0,15),this.$.service.ignoreCache=this.ignoreCache;var e=new r;if(null!=this.featureOptionIds)e.add("featureOptionIds",this.featureOptionIds).add("fieldSet",this.fieldSet),e.addObject("quoteRecord",this.quote.record);else if(null!=this.lineKey&&0<=this.lineKey){e.add("lineKey",this.lineKey);var i=this._getLinesRelevantToParentKey(this.lineKey),n=this.quote.lineItems;this.quote.lineItems=i,e.addQuote("quote",this.quote),this.quote.lineItems=n}else{e.addObject("products",t);var o=this.quote.lineItems;this.quote.lineItems=[],e.addQuote("quote",this.quote),this.quote.lineItems=o}null!=this.groupKey&&0<=this.groupKey&&e.add("groupKey",this.groupKey),this.$.service.context=e.build()}},{key:"_getLinesRelevantToParentKey",value:function(e){var n=this,o="Quote__c"==this.quote.record.attributes.type?"":this.quote.record.attributes.type.slice(0,-8),r=new Set;!function t(i){r.add(i),n.quote.lineItems.forEach(function(e){e.parentItemKey===i&&(r.add(e.key),e.record[o+"Bundle__c"]&&t(e.key),null!=e.sourceLineKey&&t(e.sourceLineKey))})}(e);var t=[];return this.quote.lineItems.forEach(function(e){r.has(e.key)&&t.push(e)}),t}},{key:"observers",get:function(){return["load(quote, productIds, lineKey, ignoreCache)"]}}]),i=e)),t("ProductLoader",i),Polymer(i)}}}),System.register("products/config/routes/services/sb-product-rules-invoke/ProductRulesInvoker.js",["common/data/format/DataBuilder.js","common/aggregate/quote-line-aggregator/QuoteLineAggregator.js"],function(t,e){var i,o,r;return{setters:[function(e){i=e.DataBuilder},function(e){o=e.QuoteLineAggregator}],execute:function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}t("ProductRulesInvoker",(function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}(e,[{key:"beforeRegister",value:function(){this.is="sb-product-rules-invoke",this.properties={quote:Object,product:Object,upgradeAssetId:{type:String,value:null},error:{type:Array,notify:!0},configResponse:{type:String,notify:!0}}}},{key:"ready",value:function(){this.$.service.addEventListener("response-changed",function(e){this.configResponse=e.detail.value}.bind(this)),this.$.service.addEventListener("error-changed",function(e){e.detail.value&&(e.detail.value.validations?this.error=e.detail.value.validations:this.error=[e.detail.value.message]),console.log(e.detail)}.bind(this))}},{key:"update",value:function(){this.product.configuration.configuredProductKey=this.product.productKey||this.product.configuration.configuredProductId,this.quote.priorBundledQuantityByLineKey=new o(this.quote).mapPriorBundledQuantityByLineKey();var e=this.quote.lineItems;this.quote.lineItems=null,this.$.service.model=(new i).addQuote("quote",this.quote,!0).addObject("configuration",this.product.configuration).add("upgradeAssetId",this.upgradeAssetId).build(),this.quote.lineItems=e,delete this.quote.priorBundledQuantityByLineKey}},{key:"observers",get:function(){return["update(quote, product)"]}}]),r=e)),t("ProductRulesInvoker",r),Polymer(r)}}});
//# sourceMappingURL=/resource/1564510314652/SBQQ__sb_app_map
